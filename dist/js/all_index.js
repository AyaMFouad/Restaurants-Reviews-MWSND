class DBHelper{static get DATABASE_URL(){return"http://localhost:1337/restaurants"}static fetchRestaurants(e){DBHelper.fetchRestaurantsFromIDB((t,r)=>{t&&DBHelper.fetchRestaurantsFromNetwork((t,r)=>{r&&(DBHelper.saveRestaurantstoIDB(r),e(null,r)),t&&e(t,null)}),r&&e(null,r)})}static fetchReviews(e){DBHelper.fetchReviewsFromIDB((t,r)=>{t&&DBHelper.fetchReviewsFromNetwork((t,r)=>{r&&r.length&&(DBHelper.saveReviewsIntoIDB(r),e(null,r)),t&&e(t,null)}),r&&e(null,r)})}static fetchReviewsFromIDB(e){return DBHelper.openIDB().then(t=>{if(!t)return;return t.transaction("reviews").objectStore("reviews").getAll().then(t=>{if(t.length)e(null,t);else{e("There is no reviews in IDB",null)}})})}static saveReviewsIntoIDB(e){return DBHelper.openIDB().then(t=>{if(!t)return;const r=t.transaction("reviews","readwrite"),n=r.objectStore("reviews");return e.forEach(e=>{n.put(e)}),r.complete})}static saveSyncReviewsIntoIDB(e){return DBHelper.openIDB().then(t=>{if(!t)return;const r=t.transaction("sync-reviews","readwrite");return r.objectStore("sync-reviews").put(e),r.complete})}static getSyncReviewsFromIDB(){return DBHelper.openIDB().then(e=>{if(!e)return;return e.transaction("sync-reviews").objectStore("sync-reviews").getAll()})}static fetchReviewsFromNetwork(e){return fetch("http://localhost:1337/reviews").then(e=>e.json()).then(t=>{t&&e(null,t)}).catch(t=>{e("Request failed. Returned status of 404",null)})}static saveRestaurantstoIDB(e){return DBHelper.openDatabase().then(function(t){if(!t)return;let r=t.transaction("restaurants","readwrite").objectStore("restaurants");e.forEach(function(e){r.put(e)})})}static fetchRestaurantsFromNetwork(e){return fetch(DBHelper.DATABASE_URL).then(function(t){200===t.status?t.json().then(function(t){e(null,t)}):console.log("Fetch Issue - Status Code: "+t.status)}).catch(function(e){console.log("Fetch Error: ",e)})}static fetchRestaurantsFromIDB(e){return DBHelper.openDatabase().then(function(e){if(e)return e.transaction("restaurants","readwrite").objectStore("restaurants").getAll()}).then(function(t){0!==t.length&&e(null,t)})}static openDatabase(){return navigator.serviceWorker?idb.open("restaurants-db",2,e=>{switch(e.oldVersion){case 0:e.createObjectStore("restaurants",{keyPath:"id"});case 1:e.createObjectStore("reviews",{keyPath:"id"});case 2:e.createObjectStore("sync-reviews",{keyPath:"id"});case 3:e.createObjectStore("sync-favorites",{keyPath:"id"})}}):Promise.resolve()}static createPostReview(e){return fetch("http://localhost:1337/reviews/",{method:"post",body:JSON.stringify(e)}).then(e=>e.json()).then(e=>{DBHelper.saveReviewsIntoIDB([e])}).catch(e=>{console.log("something went wrong",e)})}static fetchRestaurantById(e,t){DBHelper.fetchRestaurants((r,n)=>{if(r)t(r,null);else{const r=n.find(t=>t.id==e);r?t(null,r):t("Restaurant does not exist",null)}})}static fetchRestaurantByCuisine(e,t){DBHelper.fetchRestaurants((r,n)=>{if(r)t(r,null);else{const r=n.filter(t=>t.cuisine_type==e);t(null,r)}})}static fetchRestaurantByNeighborhood(e,t){DBHelper.fetchRestaurants((r,n)=>{if(r)t(r,null);else{const r=n.filter(t=>t.neighborhood==e);t(null,r)}})}static fetchRestaurantByCuisineAndNeighborhood(e,t,r){DBHelper.fetchRestaurants((n,s)=>{if(n)r(n,null);else{let n=s;"all"!=e&&(n=n.filter(t=>t.cuisine_type==e)),"all"!=t&&(n=n.filter(e=>e.neighborhood==t)),r(null,n)}})}static fetchNeighborhoods(e){DBHelper.fetchRestaurants((t,r)=>{if(t)e(t,null);else{const t=r.map((e,t)=>r[t].neighborhood),n=t.filter((e,r)=>t.indexOf(e)==r);e(null,n)}})}static fetchCuisines(e){DBHelper.fetchRestaurants((t,r)=>{if(t)e(t,null);else{const t=r.map((e,t)=>r[t].cuisine_type),n=t.filter((e,r)=>t.indexOf(e)==r);e(null,n)}})}static urlForRestaurant(e){return`./restaurant.html?id=${e.id}`}static imageUrlForRestaurant(e){return`/img/${e.photograph}.webp`}static imageResponsiveUrlForRestaurant(e){return`/img_responsive/${e.id}-320.webp 320w,\n        /img_responsive/${e.id}-480.webp 480w,\n        /img_responsive/${e.id}-640.webp 640w,\n        /img_responsive/${e.id}-800.webp 800w`}static mapMarkerForRestaurant(e,t){return new google.maps.Marker({position:e.latlng,title:e.name,url:DBHelper.urlForRestaurant(e),map:t,animation:google.maps.Animation.DROP})}}let restaurants,neighborhoods,cuisines;var map,markers=[];let observer=new IntersectionObserver(e=>{for(const t of e)t.intersecionRation>=.9&&DBHelper.fetchRestaurants((e,t)=>{e?console.error(e):fillRestaurantHTML(t)})},{threshold:[.9]});observer.observe(document.getElementById("restaurants-list"));const photographAlts={1:"Sereval groups of people having quality time at a restaurant.",2:"A lovely margeritta pizza",3:"An empty restaurant setting which has heaters",4:"A corner shot of the outside of the restaurat.",5:"A crowded restaurant and staff serving food from behind the bar.",6:"Restaurant with wooden tables, charis, and a US flag as a wall decoration",7:"a dog watching from the outside of a crowded burger shop, accompanied by two men.",8:"Close up of the dutch restaurant logo beside a flowering tree",9:"Black and white picture of people eating at an asian restaurat.",10:"Empty restaurant's white chairs, walls and ceilings."};document.addEventListener("DOMContentLoaded",e=>{fetchNeighborhoods(),fetchCuisines()}),fetchNeighborhoods=(()=>{DBHelper.fetchNeighborhoods((e,t)=>{e?console.error(e):(self.neighborhoods=t,fillNeighborhoodsHTML())})}),fillNeighborhoodsHTML=((e=self.neighborhoods)=>{const t=document.getElementById("neighborhoods-select");e.forEach(e=>{const r=document.createElement("option");r.innerHTML=e,r.value=e,t.append(r)})}),fetchCuisines=(()=>{DBHelper.fetchCuisines((e,t)=>{e?console.error(e):(self.cuisines=t,fillCuisinesHTML())})}),fillCuisinesHTML=((e=self.cuisines)=>{const t=document.getElementById("cuisines-select");e.forEach(e=>{const r=document.createElement("option");r.innerHTML=e,r.value=e,t.append(r)})}),window.initMap=(()=>{document.getElementById("map"),self.map=new google.maps.Map(document.getElementById("map"),{zoom:12,center:{lat:40.722216,lng:-73.987501},scrollwheel:!1}),updateRestaurants()}),callMap=document.getElementById("mapToggle").addEventListener("click",function(e){"block"===document.getElementById("map-container").style.display?(document.getElementById("map-container").style.display="none",window.initMap()):document.getElementById("map-container").style.display="block"}),updateRestaurants=(()=>{const e=document.getElementById("cuisines-select"),t=document.getElementById("neighborhoods-select"),r=e.selectedIndex,n=t.selectedIndex,s=e[r].value,a=t[n].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(s,a,(e,t)=>{e?console.error(e):(resetRestaurants(t),fillRestaurantsHTML())})}),resetRestaurants=(e=>{self.restaurants=[],document.getElementById("restaurants-list").innerHTML="",self.markers.forEach(e=>e.setMap(null)),self.markers=[],self.restaurants=e}),fillRestaurantsHTML=((e=self.restaurants)=>{const t=document.getElementById("restaurants-list");e.forEach(e=>{t.append(createRestaurantHTML(e))}),addMarkersToMap()}),createRestaurantHTML=(e=>{const t=document.createElement("li");t.tabIndex="0";const r=document.createElement("img");r.className="restaurant-img",r.src=DBHelper.imageUrlForRestaurant(e),r.srcset=DBHelper.imageResponsiveUrlForRestaurant(e),r.alt=photographAlts[e.id],t.append(r);const n=document.createElement("h2");n.innerHTML=e.name,t.append(n);const s=document.createElement("p");s.innerHTML=e.neighborhood,t.append(s);const a=document.createElement("p");a.innerHTML=e.address,t.append(a);const o=document.createElement("a");return o.innerHTML="View Details",o.href=DBHelper.urlForRestaurant(e),t.append(o),t}),addMarkersToMap=((e=self.restaurants)=>{e.forEach(e=>{const t=DBHelper.mapMarkerForRestaurant(e,self.map);google.maps.event.addListener(t,"click",()=>{window.location.href=t.url}),self.markers.push(t)})}),navigator.serviceWorker&&navigator.serviceWorker.register("sw.js").then(()=>console.log("Passed Test")),registerServiceWorker=(()=>{navigator.serviceWorker&&navigator.serviceWorker.register("/sw.js").catch(function(){console.log("Something went wrong. ServiceWorker not registered")})}),registerServiceWorker();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRiaGVscGVyLmpzIiwibWFpbi5qcyIsInJlZ2lzdGVyU2VydmljZVdvcmtlci5qcyJdLCJuYW1lcyI6WyJEQkhlbHBlciIsIkRBVEFCQVNFX1VSTCIsIltvYmplY3QgT2JqZWN0XSIsImNhbGxiYWNrIiwiZmV0Y2hSZXN0YXVyYW50c0Zyb21JREIiLCJlcnJvciIsInJlc3RhdXJhbnRzIiwiZmV0Y2hSZXN0YXVyYW50c0Zyb21OZXR3b3JrIiwic2F2ZVJlc3RhdXJhbnRzdG9JREIiLCJmZXRjaFJldmlld3NGcm9tSURCIiwicmV2aWV3cyIsImZldGNoUmV2aWV3c0Zyb21OZXR3b3JrIiwicmV2aWV3c0Zvcm1OZXR3b3JrIiwibGVuZ3RoIiwic2F2ZVJldmlld3NJbnRvSURCIiwib3BlbklEQiIsInRoZW4iLCJkYiIsInRyYW5zYWN0aW9uIiwib2JqZWN0U3RvcmUiLCJnZXRBbGwiLCJ0eCIsInN0b3JlIiwiZm9yRWFjaCIsInJldmlldyIsInB1dCIsImNvbXBsZXRlIiwiZmV0Y2giLCJyZXNwb25zZSIsImpzb24iLCJjYXRjaCIsImUiLCJvcGVuRGF0YWJhc2UiLCJyZXN0YXVyYW50Iiwic3RhdHVzIiwiY29uc29sZSIsImxvZyIsImVyciIsIm5hdmlnYXRvciIsInNlcnZpY2VXb3JrZXIiLCJpZGIiLCJvcGVuIiwidXBncmFkZURCIiwib2xkVmVyc2lvbiIsImNyZWF0ZU9iamVjdFN0b3JlIiwia2V5UGF0aCIsIlByb21pc2UiLCJyZXNvbHZlIiwibWV0aG9kIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJkYXRhIiwiaWQiLCJmZXRjaFJlc3RhdXJhbnRzIiwiZmluZCIsInIiLCJjdWlzaW5lIiwicmVzdWx0cyIsImZpbHRlciIsImN1aXNpbmVfdHlwZSIsIm5laWdoYm9yaG9vZCIsIm5laWdoYm9yaG9vZHMiLCJtYXAiLCJ2IiwiaSIsInVuaXF1ZU5laWdoYm9yaG9vZHMiLCJpbmRleE9mIiwiY3Vpc2luZXMiLCJ1bmlxdWVDdWlzaW5lcyIsInBob3RvZ3JhcGgiLCJnb29nbGUiLCJtYXBzIiwiTWFya2VyIiwicG9zaXRpb24iLCJsYXRsbmciLCJ0aXRsZSIsIm5hbWUiLCJ1cmwiLCJ1cmxGb3JSZXN0YXVyYW50IiwiYW5pbWF0aW9uIiwiQW5pbWF0aW9uIiwiRFJPUCIsIm1hcmtlcnMiLCJvYnNlcnZlciIsIkludGVyc2VjdGlvbk9ic2VydmVyIiwiY2hhbmdlcyIsImNoYW5nZSIsImludGVyc2VjaW9uUmF0aW9uIiwiZmlsbFJlc3RhdXJhbnRIVE1MIiwidGhyZXNob2xkIiwib2JzZXJ2ZSIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJwaG90b2dyYXBoQWx0cyIsIjEiLCIyIiwiMyIsIjQiLCI1IiwiNiIsIjciLCI4IiwiOSIsIjEwIiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2ZW50IiwiZmV0Y2hOZWlnaGJvcmhvb2RzIiwiZmV0Y2hDdWlzaW5lcyIsInNlbGYiLCJmaWxsTmVpZ2hib3Job29kc0hUTUwiLCJzZWxlY3QiLCJvcHRpb24iLCJjcmVhdGVFbGVtZW50IiwiaW5uZXJIVE1MIiwidmFsdWUiLCJhcHBlbmQiLCJmaWxsQ3Vpc2luZXNIVE1MIiwid2luZG93IiwiaW5pdE1hcCIsIk1hcCIsInpvb20iLCJjZW50ZXIiLCJsYXQiLCJsbmciLCJzY3JvbGx3aGVlbCIsInVwZGF0ZVJlc3RhdXJhbnRzIiwiY2FsbE1hcCIsInN0eWxlIiwiZGlzcGxheSIsImNTZWxlY3QiLCJuU2VsZWN0IiwiY0luZGV4Iiwic2VsZWN0ZWRJbmRleCIsIm5JbmRleCIsImZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZCIsInJlc2V0UmVzdGF1cmFudHMiLCJmaWxsUmVzdGF1cmFudHNIVE1MIiwibSIsInNldE1hcCIsInVsIiwiY3JlYXRlUmVzdGF1cmFudEhUTUwiLCJhZGRNYXJrZXJzVG9NYXAiLCJsaSIsInRhYkluZGV4IiwiaW1hZ2UiLCJjbGFzc05hbWUiLCJzcmMiLCJpbWFnZVVybEZvclJlc3RhdXJhbnQiLCJzcmNzZXQiLCJpbWFnZVJlc3BvbnNpdmVVcmxGb3JSZXN0YXVyYW50IiwiYWx0IiwiYWRkcmVzcyIsIm1vcmUiLCJocmVmIiwibWFya2VyIiwibWFwTWFya2VyRm9yUmVzdGF1cmFudCIsImFkZExpc3RlbmVyIiwibG9jYXRpb24iLCJwdXNoIiwicmVnaXN0ZXIiLCJyZWdpc3RlclNlcnZpY2VXb3JrZXIiXSwibWFwcGluZ3MiOiJNQUdNQSxTQU1KQywwQkFFRSxNQUFRLG9DQU1WQyx3QkFBd0JDLEdBRXRCSCxTQUFTSSx3QkFBd0IsQ0FBQ0MsRUFBT0MsS0FDcENELEdBQ0RMLFNBQVNPLDRCQUE0QixDQUFDRixFQUFPQyxLQUN4Q0EsSUFDRE4sU0FBU1EscUJBQXFCRixHQUU5QkgsRUFBUyxLQUFNRyxJQUVkRCxHQUNERixFQUFTRSxFQUFPLFFBSW5CQyxHQUNESCxFQUFTLEtBQUtHLEtBVXRCSixvQkFBb0JDLEdBQ2xCSCxTQUFTUyxvQkFBb0IsQ0FBQ0osRUFBT0ssS0FDaENMLEdBQ0RMLFNBQVNXLHdCQUF3QixDQUFDTixFQUFPTyxLQUNwQ0EsR0FBc0JBLEVBQW1CQyxTQUMxQ2IsU0FBU2MsbUJBQW1CRixHQUU1QlQsRUFBUyxLQUFNUyxJQUdkUCxHQUNERixFQUFTRSxFQUFPLFFBSW5CSyxHQUNEUCxFQUFTLEtBQU1PLEtBU3JCUiwyQkFBMkJDLEdBRXpCLE9BQU9ILFNBQVNlLFVBQVVDLEtBQU1DLElBQzlCLElBQUlBLEVBQUksT0FLUixPQUhXQSxFQUFHQyxZQUFZLFdBQ1JDLFlBQVksV0FFakJDLFNBQVNKLEtBQU1OLElBQzFCLEdBQUdBLEVBQVFHLE9BQ1RWLEVBQVMsS0FBTU8sT0FDVixDQUVMUCxFQURjLDZCQUNFLFdBU3hCRCwwQkFBMEJRLEdBRXhCLE9BQU9WLFNBQVNlLFVBQVVDLEtBQU1DLElBQzlCLElBQUlBLEVBQUksT0FDUixNQUFNSSxFQUFLSixFQUFHQyxZQUFZLFVBQVcsYUFDL0JJLEVBQVFELEVBQUdGLFlBQVksV0FJN0IsT0FIQVQsRUFBUWEsUUFBU0MsSUFDZkYsRUFBTUcsSUFBSUQsS0FFTEgsRUFBR0ssV0FPZHhCLDhCQUE4QnNCLEdBQzVCLE9BQU94QixTQUFTZSxVQUFVQyxLQUFNQyxJQUM5QixJQUFJQSxFQUFJLE9BQ1IsTUFBTUksRUFBS0osRUFBR0MsWUFBWSxlQUFnQixhQUcxQyxPQUZjRyxFQUFHRixZQUFZLGdCQUN2Qk0sSUFBSUQsR0FDSEgsRUFBR0ssV0FPZHhCLCtCQUNFLE9BQU9GLFNBQVNlLFVBQVVDLEtBQU1DLElBQzVCLElBQUlBLEVBQUksT0FLUixPQUhXQSxFQUFHQyxZQUFZLGdCQUNSQyxZQUFZLGdCQUVqQkMsV0FPbkJsQiwrQkFBK0JDLEdBRzdCLE9BQU93QixNQURLLGlDQUNNWCxLQUFNWSxHQUNmQSxFQUFTQyxRQUNmYixLQUFNTixJQUNKQSxHQUNEUCxFQUFTLEtBQU1PLEtBRWhCb0IsTUFBTUMsSUFFUDVCLEVBRGdCLHlDQUNBLFFBS2xCRCw0QkFBNEJJLEdBQzVCLE9BQU9OLFNBQVNnQyxlQUFlaEIsS0FBSyxTQUFVQyxHQUM1QyxJQUFLQSxFQUFJLE9BQ1AsSUFBSUssRUFBUUwsRUFBR0MsWUFBWSxjQUFlLGFBQzNCQyxZQUFZLGVBQzNCYixFQUFZaUIsUUFBUSxTQUFVVSxHQUM1QlgsRUFBTUcsSUFBSVEsT0FNbEIvQixtQ0FBbUNDLEdBQ2pDLE9BQVd3QixNQUFNM0IsU0FBU0MsY0FDckJlLEtBQ0MsU0FBVVksR0FDZ0IsTUFBcEJBLEVBQVNNLE9BSWJOLEVBQVNDLE9BQU9iLEtBQUssU0FBVVYsR0FDN0JILEVBQVMsS0FBTUcsS0FKZjZCLFFBQVFDLElBQUksOEJBQWdDUixFQUFTTSxVQVExREosTUFBTSxTQUFVTyxHQUNmRixRQUFRQyxJQUFJLGdCQUFpQkMsS0FLckNuQywrQkFBK0JDLEdBQzdCLE9BQVFILFNBQVNnQyxlQUFlaEIsS0FBSyxTQUFVQyxHQUN6QyxHQUFLQSxFQUNILE9BQU9BLEVBQUdDLFlBQVksY0FBZSxhQUMzQkMsWUFBWSxlQUNaQyxXQUNYSixLQUFLLFNBQVVWLEdBQ1csSUFBdkJBLEVBQVlPLFFBQ2hCVixFQUFTLEtBQU1HLEtBUXJCSixzQkFFRSxPQUFLb0MsVUFBVUMsY0FLUkMsSUFBSUMsS0FBSyxpQkFBa0IsRUFBSUMsSUFDcEMsT0FBUUEsRUFBVUMsWUFDaEIsS0FBSyxFQUNIRCxFQUFVRSxrQkFBa0IsZUFDMUJDLFFBQVMsT0FFYixLQUFLLEVBQ0hILEVBQVVFLGtCQUFrQixXQUMxQkMsUUFBUyxPQUViLEtBQUssRUFDSEgsRUFBVUUsa0JBQWtCLGdCQUMxQkMsUUFBUyxPQUViLEtBQUssRUFDSEgsRUFBVUUsa0JBQWtCLGtCQUMxQkMsUUFBUyxVQW5CUkMsUUFBUUMsVUE0Qm5CN0Msd0JBQXlCc0IsR0FFekIsT0FBT0csTUFESyxrQ0FFVnFCLE9BQVEsT0FDUkMsS0FBTUMsS0FBS0MsVUFBVTNCLEtBQ3BCUixLQUFLWSxHQUNDQSxFQUFTQyxRQUNmYixLQUFNb0MsSUFFUHBELFNBQVNjLG9CQUFvQnNDLE1BQzVCdEIsTUFBT0MsSUFDUkksUUFBUUMsSUFBSSx1QkFBd0JMLEtBT3RDN0IsMkJBQTJCbUQsRUFBSWxELEdBRTdCSCxTQUFTc0QsaUJBQWlCLENBQUNqRCxFQUFPQyxLQUNoQyxHQUFJRCxFQUNGRixFQUFTRSxFQUFPLFVBQ1gsQ0FDTCxNQUFNNEIsRUFBYTNCLEVBQVlpRCxLQUFLQyxHQUFLQSxFQUFFSCxJQUFNQSxHQUM3Q3BCLEVBQ0Y5QixFQUFTLEtBQU04QixHQUVmOUIsRUFBUyw0QkFBNkIsU0FTOUNELGdDQUFnQ3VELEVBQVN0RCxHQUV2Q0gsU0FBU3NELGlCQUFpQixDQUFDakQsRUFBT0MsS0FDaEMsR0FBSUQsRUFDRkYsRUFBU0UsRUFBTyxVQUNYLENBRUwsTUFBTXFELEVBQVVwRCxFQUFZcUQsT0FBT0gsR0FBS0EsRUFBRUksY0FBZ0JILEdBQzFEdEQsRUFBUyxLQUFNdUQsTUFRckJ4RCxxQ0FBcUMyRCxFQUFjMUQsR0FFakRILFNBQVNzRCxpQkFBaUIsQ0FBQ2pELEVBQU9DLEtBQ2hDLEdBQUlELEVBQ0ZGLEVBQVNFLEVBQU8sVUFDWCxDQUVMLE1BQU1xRCxFQUFVcEQsRUFBWXFELE9BQU9ILEdBQUtBLEVBQUVLLGNBQWdCQSxHQUMxRDFELEVBQVMsS0FBTXVELE1BUXJCeEQsK0NBQStDdUQsRUFBU0ksRUFBYzFELEdBRXBFSCxTQUFTc0QsaUJBQWlCLENBQUNqRCxFQUFPQyxLQUNoQyxHQUFJRCxFQUNGRixFQUFTRSxFQUFPLFVBQ1gsQ0FDTCxJQUFJcUQsRUFBVXBELEVBQ0MsT0FBWG1ELElBQ0ZDLEVBQVVBLEVBQVFDLE9BQU9ILEdBQUtBLEVBQUVJLGNBQWdCSCxJQUc5QixPQUFoQkksSUFDRkgsRUFBVUEsRUFBUUMsT0FBT0gsR0FBS0EsRUFBRUssY0FBZ0JBLElBR2xEMUQsRUFBUyxLQUFNdUQsTUFRckJ4RCwwQkFBMEJDLEdBRXhCSCxTQUFTc0QsaUJBQWlCLENBQUNqRCxFQUFPQyxLQUNoQyxHQUFJRCxFQUNGRixFQUFTRSxFQUFPLFVBQ1gsQ0FFTCxNQUFNeUQsRUFBZ0J4RCxFQUFZeUQsSUFBSSxDQUFDQyxFQUFHQyxJQUFNM0QsRUFBWTJELEdBQUdKLGNBR3pESyxFQUFzQkosRUFBY0gsT0FBTyxDQUFDSyxFQUFHQyxJQUFNSCxFQUFjSyxRQUFRSCxJQUFNQyxHQUN2RjlELEVBQVMsS0FBTStELE1BUXJCaEUscUJBQXFCQyxHQUVuQkgsU0FBU3NELGlCQUFpQixDQUFDakQsRUFBT0MsS0FDaEMsR0FBSUQsRUFDRkYsRUFBU0UsRUFBTyxVQUNYLENBRUwsTUFBTStELEVBQVc5RCxFQUFZeUQsSUFBSSxDQUFDQyxFQUFHQyxJQUFNM0QsRUFBWTJELEdBQUdMLGNBR3BEUyxFQUFpQkQsRUFBU1QsT0FBTyxDQUFDSyxFQUFHQyxJQUFNRyxFQUFTRCxRQUFRSCxJQUFNQyxHQUN4RTlELEVBQVMsS0FBTWtFLE1BUXJCbkUsd0JBQXdCK0IsR0FDdEIsOEJBQWdDQSxFQUFXb0IsS0FNN0NuRCw2QkFBNkIrQixHQUMzQixjQUFnQkEsRUFBV3FDLGtCQU0vQnBFLHVDQUF1QytCLEdBTW5DLHlCQUN1QkEsRUFBV29CLDhDQUNacEIsRUFBV29CLDhDQUNYcEIsRUFBV29CLDhDQUNYcEIsRUFBV29CLG1CQU1uQ25ELDhCQUE4QitCLEVBQVk4QixHQVF4QyxPQVBlLElBQUlRLE9BQU9DLEtBQUtDLFFBQzdCQyxTQUFVekMsRUFBVzBDLE9BQ3JCQyxNQUFPM0MsRUFBVzRDLEtBQ2xCQyxJQUFLOUUsU0FBUytFLGlCQUFpQjlDLEdBQy9COEIsSUFBS0EsRUFDTGlCLFVBQVdULE9BQU9DLEtBQUtTLFVBQVVDLFFDMVl2QyxJQUFJNUUsWUFDRndELGNBQ0FNLFNBQ0YsSUFBSUwsSUFDQW9CLFdBRUosSUFBSUMsU0FBVyxJQUFJQyxxQkFBcUJDLElBQ3RDLElBQUssTUFBTUMsS0FBVUQsRUFDZkMsRUFBT0MsbUJBQXFCLElBQzlCeEYsU0FBU3NELGlCQUFpQixDQUFDakQsRUFBTytDLEtBQzVCL0MsRUFDRjhCLFFBQVE5QixNQUFNQSxHQUVkb0YsbUJBQW1CckMsT0FPekJzQyxXQUFZLE1BSWhCTixTQUFTTyxRQUFRQyxTQUFTQyxlQUFlLHFCQUt6QyxNQUFNQyxnQkFDTEMsRUFBRyxnRUFDSEMsRUFBRyw0QkFDSEMsRUFBRyxnREFDSEMsRUFBRyxpREFDSEMsRUFBRyxtRUFDSEMsRUFBRyw0RUFDSEMsRUFBRyxvRkFDSEMsRUFBRyxnRUFDSEMsRUFBRyxrRUFDSEMsR0FBSSx3REFRTFosU0FBU2EsaUJBQWlCLG1CQUFxQkMsSUFDN0NDLHFCQUNBQyxrQkFNRkQsbUJBQXFCLE1BQ25CM0csU0FBUzJHLG1CQUFtQixDQUFDdEcsRUFBT3lELEtBQzlCekQsRUFDRjhCLFFBQVE5QixNQUFNQSxJQUVkd0csS0FBSy9DLGNBQWdCQSxFQUNyQmdELDZCQVFOQSxzQkFBd0IsRUFBQ2hELEVBQWdCK0MsS0FBSy9DLGlCQUM1QyxNQUFNaUQsRUFBU25CLFNBQVNDLGVBQWUsd0JBQ3ZDL0IsRUFBY3ZDLFFBQVFzQyxJQUNwQixNQUFNbUQsRUFBU3BCLFNBQVNxQixjQUFjLFVBQ3RDRCxFQUFPRSxVQUFZckQsRUFDbkJtRCxFQUFPRyxNQUFRdEQsRUFDZmtELEVBQU9LLE9BQU9KLE9BT2xCSixjQUFnQixNQUNkNUcsU0FBUzRHLGNBQWMsQ0FBQ3ZHLEVBQU8rRCxLQUN6Qi9ELEVBQ0Y4QixRQUFROUIsTUFBTUEsSUFFZHdHLEtBQUt6QyxTQUFXQSxFQUNoQmlELHdCQVFOQSxpQkFBbUIsRUFBQ2pELEVBQVd5QyxLQUFLekMsWUFDbEMsTUFBTTJDLEVBQVNuQixTQUFTQyxlQUFlLG1CQUV2Q3pCLEVBQVM3QyxRQUFRa0MsSUFDZixNQUFNdUQsRUFBU3BCLFNBQVNxQixjQUFjLFVBQ3RDRCxFQUFPRSxVQUFZekQsRUFDbkJ1RCxFQUFPRyxNQUFRMUQsRUFDZnNELEVBQU9LLE9BQU9KLE9BT2pCTSxPQUFPQyxRQUFVLE1BS2hCM0IsU0FBU0MsZUFBZSxPQUN4QmdCLEtBQUs5QyxJQUFNLElBQUlRLE9BQU9DLEtBQUtnRCxJQUFJNUIsU0FBU0MsZUFBZSxRQUNyRDRCLEtBQU0sR0FDTkMsUUFOQUMsSUFBSyxVQUNMQyxLQUFNLFdBTU5DLGFBQWEsSUFHZkMsc0JBTUZDLFFBQ0FuQyxTQUFTQyxlQUFlLGFBQWFZLGlCQUFpQixRQUFTLFNBQVNDLEdBQ0wsVUFBNURkLFNBQVNDLGVBQWUsaUJBQWlCbUMsTUFBTUMsU0FDbERyQyxTQUFTQyxlQUFlLGlCQUFpQm1DLE1BQU1DLFFBQVUsT0FDekRYLE9BQU9DLFdBRVAzQixTQUFTQyxlQUFlLGlCQUFpQm1DLE1BQU1DLFFBQVUsVUFNN0RILGtCQUFvQixNQUNsQixNQUFNSSxFQUFVdEMsU0FBU0MsZUFBZSxtQkFDbENzQyxFQUFVdkMsU0FBU0MsZUFBZSx3QkFFbEN1QyxFQUFTRixFQUFRRyxjQUNqQkMsRUFBU0gsRUFBUUUsY0FFakI1RSxFQUFVeUUsRUFBUUUsR0FBUWpCLE1BQzFCdEQsRUFBZXNFLEVBQVFHLEdBQVFuQixNQUVyQ25ILFNBQVN1SSx3Q0FBd0M5RSxFQUFTSSxFQUFjLENBQUN4RCxFQUFPQyxLQUMxRUQsRUFDRjhCLFFBQVE5QixNQUFNQSxJQUVkbUksaUJBQWlCbEksR0FDakJtSSwyQkFRTkQsaUJBQW9CbEksQ0FBQUEsSUFFbEJ1RyxLQUFLdkcsZUFDTXNGLFNBQVNDLGVBQWUsb0JBQ2hDcUIsVUFBWSxHQUdmTCxLQUFLMUIsUUFBUTVELFFBQVFtSCxHQUFLQSxFQUFFQyxPQUFPLE9BQ25DOUIsS0FBSzFCLFdBQ0wwQixLQUFLdkcsWUFBY0EsSUFNckJtSSxvQkFBc0IsRUFBQ25JLEVBQWN1RyxLQUFLdkcsZUFDeEMsTUFBTXNJLEVBQUtoRCxTQUFTQyxlQUFlLG9CQUNuQ3ZGLEVBQVlpQixRQUFRVSxJQUNsQjJHLEVBQUd4QixPQUFPeUIscUJBQXFCNUcsTUFFakM2RyxvQkFNRkQscUJBQXdCNUcsQ0FBQUEsSUFDdEIsTUFBTThHLEVBQUtuRCxTQUFTcUIsY0FBYyxNQUNsQzhCLEVBQUdDLFNBQVUsSUFFYixNQUFNQyxFQUFRckQsU0FBU3FCLGNBQWMsT0FDckNnQyxFQUFNQyxVQUFZLGlCQUNsQkQsRUFBTUUsSUFBTW5KLFNBQVNvSixzQkFBc0JuSCxHQUMzQ2dILEVBQU1JLE9BQVNySixTQUFTc0osZ0NBQWdDckgsR0FDeERnSCxFQUFNTSxJQUFNekQsZUFBZTdELEVBQVdvQixJQUN0QzBGLEVBQUczQixPQUFPNkIsR0FFVixNQUFNcEUsRUFBT2UsU0FBU3FCLGNBQWMsTUFDcENwQyxFQUFLcUMsVUFBWWpGLEVBQVc0QyxLQUM1QmtFLEVBQUczQixPQUFPdkMsR0FFVixNQUFNaEIsRUFBZStCLFNBQVNxQixjQUFjLEtBQzVDcEQsRUFBYXFELFVBQVlqRixFQUFXNEIsYUFDcENrRixFQUFHM0IsT0FBT3ZELEdBRVYsTUFBTTJGLEVBQVU1RCxTQUFTcUIsY0FBYyxLQUN2Q3VDLEVBQVF0QyxVQUFZakYsRUFBV3VILFFBQy9CVCxFQUFHM0IsT0FBT29DLEdBRVYsTUFBTUMsRUFBTzdELFNBQVNxQixjQUFjLEtBS3BDLE9BSkF3QyxFQUFLdkMsVUFBWSxlQUNqQnVDLEVBQUtDLEtBQU8xSixTQUFTK0UsaUJBQWlCOUMsR0FDdEM4RyxFQUFHM0IsT0FBT3FDLEdBRUhWLElBTVRELGdCQUFrQixFQUFDeEksRUFBY3VHLEtBQUt2RyxlQUNwQ0EsRUFBWWlCLFFBQVFVLElBRWxCLE1BQU0wSCxFQUFTM0osU0FBUzRKLHVCQUF1QjNILEVBQVk0RSxLQUFLOUMsS0FDaEVRLE9BQU9DLEtBQUtrQyxNQUFNbUQsWUFBWUYsRUFBUSxRQUFTLEtBQzdDckMsT0FBT3dDLFNBQVNKLEtBQU9DLEVBQU83RSxNQUVoQytCLEtBQUsxQixRQUFRNEUsS0FBS0osT0FLbEJySCxVQUFVQyxlQUNaRCxVQUFVQyxjQUFjeUgsU0FBUyxTQUM5QmhKLEtBQUssSUFBTW1CLFFBQVFDLElBQUksZ0JDek81QjZILHNCQUF3QixNQUVmM0gsVUFBVUMsZUFFZkQsVUFBVUMsY0FBY3lILFNBQVMsVUFBVWxJLE1BQU0sV0FDL0NLLFFBQVFDLElBQUksMERBSWhCNkgiLCJmaWxlIjoiYWxsX2luZGV4LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIENvbW1vbiBkYXRhYmFzZSBoZWxwZXIgZnVuY3Rpb25zLlxyXG4gKi9cclxuY2xhc3MgREJIZWxwZXIge1xyXG5cclxuICAvKipcclxuICAgKiBEYXRhYmFzZSBVUkwuXHJcbiAgICogQ2hhbmdlIHRoaXMgdG8gcmVzdGF1cmFudHMuanNvbiBmaWxlIGxvY2F0aW9uIG9uIHlvdXIgc2VydmVyLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBnZXQgREFUQUJBU0VfVVJMKCkge1xyXG4gICAgY29uc3QgcG9ydCA9IDEzMzc7XHJcbiAgICByZXR1cm4gYGh0dHA6Ly9sb2NhbGhvc3Q6JHtwb3J0fS9yZXN0YXVyYW50c2A7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCBhbGwgcmVzdGF1cmFudHMgKHVzaW5nIEFQSXMpXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudHMoY2FsbGJhY2spIHtcclxuXHJcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzRnJvbUlEQigoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgIGlmKGVycm9yKSB7XHJcbiAgICAgICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50c0Zyb21OZXR3b3JrKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcclxuICAgICAgICAgIGlmKHJlc3RhdXJhbnRzKSB7XHJcbiAgICAgICAgICAgIERCSGVscGVyLnNhdmVSZXN0YXVyYW50c3RvSURCKHJlc3RhdXJhbnRzKTtcclxuXHJcbiAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3RhdXJhbnRzKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGlmKGVycm9yKSB7XHJcbiAgICAgICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgICBpZihyZXN0YXVyYW50cykge1xyXG4gICAgICAgIGNhbGxiYWNrKG51bGwscmVzdGF1cmFudHMpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKiBJQkQgQVBJUyAqL1xyXG5cclxuICAvKipcclxuICogRmV0Y2ggUmV2aWV3c1xyXG4gKi9cclxuc3RhdGljIGZldGNoUmV2aWV3cyhjYWxsYmFjaykge1xyXG4gIERCSGVscGVyLmZldGNoUmV2aWV3c0Zyb21JREIoKGVycm9yLCByZXZpZXdzKSA9PiB7XHJcbiAgICBpZihlcnJvcikge1xyXG4gICAgICBEQkhlbHBlci5mZXRjaFJldmlld3NGcm9tTmV0d29yaygoZXJyb3IsIHJldmlld3NGb3JtTmV0d29yaykgPT4ge1xyXG4gICAgICAgIGlmKHJldmlld3NGb3JtTmV0d29yayAmJiByZXZpZXdzRm9ybU5ldHdvcmsubGVuZ3RoKSB7XHJcbiAgICAgICAgICBEQkhlbHBlci5zYXZlUmV2aWV3c0ludG9JREIocmV2aWV3c0Zvcm1OZXR3b3JrKTtcclxuXHJcbiAgICAgICAgICBjYWxsYmFjayhudWxsLCByZXZpZXdzRm9ybU5ldHdvcmspO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYoZXJyb3IpIHtcclxuICAgICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgaWYocmV2aWV3cykge1xyXG4gICAgICBjYWxsYmFjayhudWxsLCByZXZpZXdzKTtcclxuICAgIH1cclxuXHJcbiAgfSlcclxufVxyXG5cclxuLyoqXHJcbiAqIEZldGNoIHJldmlld3MgZnJvbSBJbmRleGVkIERCXHJcbiAqL1xyXG5zdGF0aWMgZmV0Y2hSZXZpZXdzRnJvbUlEQihjYWxsYmFjaykge1xyXG4gIC8vIGNvbnN0IGRiUHJvbWlzZSA9IERCSGVscGVyLm9wZW5JREIoKTtcclxuICByZXR1cm4gREJIZWxwZXIub3BlbklEQigpLnRoZW4oKGRiKSA9PiB7XHJcbiAgICBpZighZGIpIHJldHVybjtcclxuXHJcbiAgICBjb25zdCB0eCA9IGRiLnRyYW5zYWN0aW9uKCdyZXZpZXdzJyk7XHJcbiAgICBjb25zdCBzdG9yZSA9ICB0eC5vYmplY3RTdG9yZSgncmV2aWV3cycpO1xyXG5cclxuICAgIHJldHVybiBzdG9yZS5nZXRBbGwoKS50aGVuKChyZXZpZXdzKSA9PiB7XHJcbiAgICAgIGlmKHJldmlld3MubGVuZ3RoKSB7XHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmV2aWV3cyk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY29uc3QgZXJyb3IgPSAnVGhlcmUgaXMgbm8gcmV2aWV3cyBpbiBJREInO1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfSk7XHJcbn1cclxuXHJcbi8qKlxyXG4qIFNhdmUgcmV2aWV3cyBpbnRvIHRoZSBpbmRleGVkIERCXHJcbiovXHJcbnN0YXRpYyBzYXZlUmV2aWV3c0ludG9JREIocmV2aWV3cykge1xyXG5cclxuICByZXR1cm4gREJIZWxwZXIub3BlbklEQigpLnRoZW4oKGRiKSA9PiB7XHJcbiAgICBpZighZGIpIHJldHVybjtcclxuICAgIGNvbnN0IHR4ID0gZGIudHJhbnNhY3Rpb24oJ3Jldmlld3MnLCAncmVhZHdyaXRlJylcclxuICAgIGNvbnN0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoJ3Jldmlld3MnKTtcclxuICAgIHJldmlld3MuZm9yRWFjaCgocmV2aWV3KSA9PiB7XHJcbiAgICAgIHN0b3JlLnB1dChyZXZpZXcpO1xyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gdHguY29tcGxldGU7XHJcbiAgfSk7XHJcbn1cclxuXHJcbi8qKlxyXG4qIFNhdmUgU3luYyByZXZpZXdzIGludG8gdGhlIGluZGV4ZWQgREJcclxuKi9cclxuc3RhdGljIHNhdmVTeW5jUmV2aWV3c0ludG9JREIocmV2aWV3KSB7XHJcbiAgcmV0dXJuIERCSGVscGVyLm9wZW5JREIoKS50aGVuKChkYikgPT4ge1xyXG4gICAgaWYoIWRiKSByZXR1cm47XHJcbiAgICBjb25zdCB0eCA9IGRiLnRyYW5zYWN0aW9uKCdzeW5jLXJldmlld3MnLCAncmVhZHdyaXRlJylcclxuICAgIGNvbnN0IHN0b3JlID0gdHgub2JqZWN0U3RvcmUoJ3N5bmMtcmV2aWV3cycpO1xyXG4gICAgc3RvcmUucHV0KHJldmlldyk7XHJcbiAgICByZXR1cm4gdHguY29tcGxldGU7XHJcbiAgfSk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBnZXQgYWxsIHN5bmNpbmcgcmV2aWV3c1xyXG4gKi9cclxuc3RhdGljIGdldFN5bmNSZXZpZXdzRnJvbUlEQigpIHtcclxuICByZXR1cm4gREJIZWxwZXIub3BlbklEQigpLnRoZW4oKGRiKSA9PiB7XHJcbiAgICAgIGlmKCFkYikgcmV0dXJuO1xyXG5cclxuICAgICAgY29uc3QgdHggPSBkYi50cmFuc2FjdGlvbignc3luYy1yZXZpZXdzJyk7XHJcbiAgICAgIGNvbnN0IHN0b3JlID0gIHR4Lm9iamVjdFN0b3JlKCdzeW5jLXJldmlld3MnKTtcclxuXHJcbiAgICAgIHJldHVybiBzdG9yZS5nZXRBbGwoKTtcclxuICB9KTtcclxufVxyXG5cclxuLyoqXHJcbiAqIEZldGNoIHJldmlld3MgZnJvbSBuZXR3b3JrXHJcbiAqL1xyXG5zdGF0aWMgZmV0Y2hSZXZpZXdzRnJvbU5ldHdvcmsoY2FsbGJhY2spIHtcclxuXHJcbiAgY29uc3QgdXJsID0gXCJodHRwOi8vbG9jYWxob3N0OjEzMzcvcmV2aWV3c1wiO1xyXG4gIHJldHVybiBmZXRjaCh1cmwpLnRoZW4oKHJlc3BvbnNlKSA9PiB7XHJcbiAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpO1xyXG4gIH0pLnRoZW4oKHJldmlld3MpID0+IHtcclxuICAgIGlmKHJldmlld3MpIHtcclxuICAgICAgY2FsbGJhY2sobnVsbCwgcmV2aWV3cyk7XHJcbiAgICB9XHJcbiAgfSkuY2F0Y2goZSA9PiB7XHJcbiAgICBjb25zdCBlcnJvciA9IChgUmVxdWVzdCBmYWlsZWQuIFJldHVybmVkIHN0YXR1cyBvZiA0MDRgKTtcclxuICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICB9KTtcclxufVxyXG5cclxuICAvKiBBZGQgcmVzdGF1cmFudHMgdG8gaW5kZXhlZERCICovXHJcbiAgc3RhdGljIHNhdmVSZXN0YXVyYW50c3RvSURCKHJlc3RhdXJhbnRzKXtcclxuICByZXR1cm4gREJIZWxwZXIub3BlbkRhdGFiYXNlKCkudGhlbihmdW5jdGlvbiAoZGIpIHtcclxuICAgIGlmICghZGIpIHJldHVybjtcclxuICAgICAgbGV0IHN0b3JlID0gZGIudHJhbnNhY3Rpb24oJ3Jlc3RhdXJhbnRzJywgJ3JlYWR3cml0ZScpXHJcbiAgICAgICAgICAgICAgICAgICAgLm9iamVjdFN0b3JlKCdyZXN0YXVyYW50cycpO1xyXG4gICAgICByZXN0YXVyYW50cy5mb3JFYWNoKGZ1bmN0aW9uIChyZXN0YXVyYW50KSB7XHJcbiAgICAgICAgc3RvcmUucHV0KHJlc3RhdXJhbnQpO1xyXG4gICAgICB9KTtcclxuICB9KTtcclxufVxyXG5cclxuLypmZXRjaCByZXN0YXVyYW50cyBmcm9tIG5ldHdvcmsqL1xyXG5zdGF0aWMgZmV0Y2hSZXN0YXVyYW50c0Zyb21OZXR3b3JrKGNhbGxiYWNrKSB7XHJcbiAgcmV0dXJuICAgICBmZXRjaChEQkhlbHBlci5EQVRBQkFTRV9VUkwpXHJcbiAgICAgIC50aGVuKFxyXG4gICAgICAgIGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdGZXRjaCBJc3N1ZSAtIFN0YXR1cyBDb2RlOiAnICsgcmVzcG9uc2Uuc3RhdHVzKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgcmVzcG9uc2UuanNvbigpLnRoZW4oZnVuY3Rpb24gKHJlc3RhdXJhbnRzKSB7XHJcbiAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3RhdXJhbnRzKTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgICAgKVxyXG4gICAgICAuY2F0Y2goZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCdGZXRjaCBFcnJvcjogJywgZXJyKTtcclxuICAgICAgfSk7XHJcbn1cclxuXHJcbi8qKmZldGNoIHJlc3RhdXJhbnRzIGZyb20gaWRiKi9cclxuc3RhdGljIGZldGNoUmVzdGF1cmFudHNGcm9tSURCKGNhbGxiYWNrKSB7XHJcbiAgcmV0dXJuICBEQkhlbHBlci5vcGVuRGF0YWJhc2UoKS50aGVuKGZ1bmN0aW9uIChkYikge1xyXG4gICAgICAgIGlmICghZGIpIHJldHVybjtcclxuICAgICAgICAgIHJldHVybiBkYi50cmFuc2FjdGlvbigncmVzdGF1cmFudHMnLCAncmVhZHdyaXRlJylcclxuICAgICAgICAgICAgICAgICAgIC5vYmplY3RTdG9yZSgncmVzdGF1cmFudHMnKVxyXG4gICAgICAgICAgICAgICAgICAgLmdldEFsbCgpO1xyXG4gICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN0YXVyYW50cykge1xyXG4gICAgICAgIGlmIChyZXN0YXVyYW50cy5sZW5ndGggPT09IDApIHJldHVybjtcclxuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN0YXVyYW50cyk7XHJcbiAgICAgIH0pO1xyXG59XHJcblxyXG5cclxuICAgLy8gSURCIGNyZWF0aW9uXHJcblxyXG5cclxuICBzdGF0aWMgb3BlbkRhdGFiYXNlICgpIHtcclxuXHJcbiAgICBpZiAoIW5hdmlnYXRvci5zZXJ2aWNlV29ya2VyKSB7XHJcbiAgICAgIC8vY29uc29sZS5sb2coYFNlcnZpY2UgV29ya2VycyBpcyBub3Qgc3VwcG9ydGVkIGJ5IGJyb3dzZXJzYCk7XHJcbiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gaWRiLm9wZW4oJ3Jlc3RhdXJhbnRzLWRiJywgMiwgKHVwZ3JhZGVEQikgPT4ge1xyXG4gICAgICBzd2l0Y2ggKHVwZ3JhZGVEQi5vbGRWZXJzaW9uKSB7XHJcbiAgICAgICAgY2FzZSAwOlxyXG4gICAgICAgICAgdXBncmFkZURCLmNyZWF0ZU9iamVjdFN0b3JlKCdyZXN0YXVyYW50cycsIHtcclxuICAgICAgICAgICAga2V5UGF0aDogJ2lkJ1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgY2FzZSAxOlxyXG4gICAgICAgICAgdXBncmFkZURCLmNyZWF0ZU9iamVjdFN0b3JlKCdyZXZpZXdzJywge1xyXG4gICAgICAgICAgICBrZXlQYXRoOiAnaWQnXHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICBjYXNlIDI6XHJcbiAgICAgICAgICB1cGdyYWRlREIuY3JlYXRlT2JqZWN0U3RvcmUoJ3N5bmMtcmV2aWV3cycsIHtcclxuICAgICAgICAgICAga2V5UGF0aDogJ2lkJ1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgY2FzZSAzOlxyXG4gICAgICAgICAgdXBncmFkZURCLmNyZWF0ZU9iamVjdFN0b3JlKCdzeW5jLWZhdm9yaXRlcycsIHtcclxuICAgICAgICAgICAga2V5UGF0aDogJ2lkJ1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuXHJcbiAgLyoqY3JlYXRlIHJldmlldyovXHJcblxyXG4gIHN0YXRpYyBjcmVhdGVQb3N0UmV2aWV3IChyZXZpZXcpIHtcclxuICBjb25zdCB1cmwgPSAnaHR0cDovL2xvY2FsaG9zdDoxMzM3L3Jldmlld3MvJztcclxuICByZXR1cm4gZmV0Y2godXJsLCB7XHJcbiAgICBtZXRob2Q6ICdwb3N0JyxcclxuICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHJldmlldyksXHJcbiAgfSkudGhlbihyZXNwb25zZSA9PiB7XHJcbiAgICByZXR1cm4gcmVzcG9uc2UuanNvbigpO1xyXG4gIH0pLnRoZW4oKGRhdGEpID0+IHtcclxuICAgIC8vIGNvbnNvbGUubG9nKGRhdGEpO1xyXG4gICAgREJIZWxwZXIuc2F2ZVJldmlld3NJbnRvSURCKFtkYXRhXSk7XHJcbiAgfSkuY2F0Y2goKGUpID0+IHtcclxuICAgIGNvbnNvbGUubG9nKCdzb21ldGhpbmcgd2VudCB3cm9uZycsIGUpO1xyXG4gIH0pXHJcbn1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggYSByZXN0YXVyYW50IGJ5IGl0cyBJRC5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlJZChpZCwgY2FsbGJhY2spIHtcclxuICAgIC8vIGZldGNoIGFsbCByZXN0YXVyYW50cyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY29uc3QgcmVzdGF1cmFudCA9IHJlc3RhdXJhbnRzLmZpbmQociA9PiByLmlkID09IGlkKTtcclxuICAgICAgICBpZiAocmVzdGF1cmFudCkgeyAvLyBHb3QgdGhlIHJlc3RhdXJhbnRcclxuICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3RhdXJhbnQpO1xyXG4gICAgICAgIH0gZWxzZSB7IC8vIFJlc3RhdXJhbnQgZG9lcyBub3QgZXhpc3QgaW4gdGhlIGRhdGFiYXNlXHJcbiAgICAgICAgICBjYWxsYmFjaygnUmVzdGF1cmFudCBkb2VzIG5vdCBleGlzdCcsIG51bGwpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIGN1aXNpbmUgdHlwZSB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lKGN1aXNpbmUsIGNhbGxiYWNrKSB7XHJcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHMgIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nXHJcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcclxuICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIEZpbHRlciByZXN0YXVyYW50cyB0byBoYXZlIG9ubHkgZ2l2ZW4gY3Vpc2luZSB0eXBlXHJcbiAgICAgICAgY29uc3QgcmVzdWx0cyA9IHJlc3RhdXJhbnRzLmZpbHRlcihyID0+IHIuY3Vpc2luZV90eXBlID09IGN1aXNpbmUpO1xyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdHMpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgbmVpZ2hib3Job29kIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeU5laWdoYm9yaG9vZChuZWlnaGJvcmhvb2QsIGNhbGxiYWNrKSB7XHJcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gRmlsdGVyIHJlc3RhdXJhbnRzIHRvIGhhdmUgb25seSBnaXZlbiBuZWlnaGJvcmhvb2RcclxuICAgICAgICBjb25zdCByZXN1bHRzID0gcmVzdGF1cmFudHMuZmlsdGVyKHIgPT4gci5uZWlnaGJvcmhvb2QgPT0gbmVpZ2hib3Job29kKTtcclxuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHRzKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIGN1aXNpbmUgYW5kIGEgbmVpZ2hib3Job29kIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QoY3Vpc2luZSwgbmVpZ2hib3Job29kLCBjYWxsYmFjaykge1xyXG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXHJcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcclxuICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGxldCByZXN1bHRzID0gcmVzdGF1cmFudHM7XHJcbiAgICAgICAgaWYgKGN1aXNpbmUgIT0gJ2FsbCcpIHsgLy8gZmlsdGVyIGJ5IGN1aXNpbmVcclxuICAgICAgICAgIHJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcihyID0+IHIuY3Vpc2luZV90eXBlID09IGN1aXNpbmUpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKG5laWdoYm9yaG9vZCAhPSAnYWxsJykgeyAvLyBmaWx0ZXIgYnkgbmVpZ2hib3Job29kXHJcbiAgICAgICAgICByZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIociA9PiByLm5laWdoYm9yaG9vZCA9PSBuZWlnaGJvcmhvb2QpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0cyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggYWxsIG5laWdoYm9yaG9vZHMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoTmVpZ2hib3Job29kcyhjYWxsYmFjaykge1xyXG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXHJcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcclxuICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIEdldCBhbGwgbmVpZ2hib3Job29kcyBmcm9tIGFsbCByZXN0YXVyYW50c1xyXG4gICAgICAgIGNvbnN0IG5laWdoYm9yaG9vZHMgPSByZXN0YXVyYW50cy5tYXAoKHYsIGkpID0+IHJlc3RhdXJhbnRzW2ldLm5laWdoYm9yaG9vZCk7XHJcblxyXG4gICAgICAgIC8vIFJlbW92ZSBkdXBsaWNhdGVzIGZyb20gbmVpZ2hib3Job29kc1xyXG4gICAgICAgIGNvbnN0IHVuaXF1ZU5laWdoYm9yaG9vZHMgPSBuZWlnaGJvcmhvb2RzLmZpbHRlcigodiwgaSkgPT4gbmVpZ2hib3Job29kcy5pbmRleE9mKHYpID09IGkpO1xyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHVuaXF1ZU5laWdoYm9yaG9vZHMpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIGFsbCBjdWlzaW5lcyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hDdWlzaW5lcyhjYWxsYmFjaykge1xyXG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXHJcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcclxuICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIEdldCBhbGwgY3Vpc2luZXMgZnJvbSBhbGwgcmVzdGF1cmFudHNcclxuICAgICAgICBjb25zdCBjdWlzaW5lcyA9IHJlc3RhdXJhbnRzLm1hcCgodiwgaSkgPT4gcmVzdGF1cmFudHNbaV0uY3Vpc2luZV90eXBlKTtcclxuXHJcbiAgICAgICAgLy8gUmVtb3ZlIGR1cGxpY2F0ZXMgZnJvbSBjdWlzaW5lc1xyXG4gICAgICAgIGNvbnN0IHVuaXF1ZUN1aXNpbmVzID0gY3Vpc2luZXMuZmlsdGVyKCh2LCBpKSA9PiBjdWlzaW5lcy5pbmRleE9mKHYpID09IGkpO1xyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHVuaXF1ZUN1aXNpbmVzKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXN0YXVyYW50IHBhZ2UgVVJMLlxyXG4gICAqL1xyXG4gIHN0YXRpYyB1cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcclxuICAgIHJldHVybiAoYC4vcmVzdGF1cmFudC5odG1sP2lkPSR7cmVzdGF1cmFudC5pZH1gKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlc3RhdXJhbnQgaW1hZ2UgVVJMLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBpbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xyXG4gICAgcmV0dXJuIChgL2ltZy8ke3Jlc3RhdXJhbnQucGhvdG9ncmFwaH0ud2VicGApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAqIFJlc3RhdXJhbnQgcmVzcG9uc2l2ZSBpbWFnZXMgc291cmNlIHNldC5cclxuICovXHJcbnN0YXRpYyBpbWFnZVJlc3BvbnNpdmVVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcclxuICAgIGNvbnN0IHNjYWxlMXggPSAnMzIwJztcclxuICAgIGNvbnN0IHNjYWxlMV81eCA9ICc0ODAnO1xyXG4gICAgY29uc3Qgc2NhbGUyeCA9ICc2NDAnO1xyXG4gICAgY29uc3Qgc2NhbGUzeCA9ICc4MDAnO1xyXG5cclxuICAgIHJldHVybiAoXHJcbiAgICAgICAgYC9pbWdfcmVzcG9uc2l2ZS8ke3Jlc3RhdXJhbnQuaWR9LSR7c2NhbGUxeH0ud2VicCAke3NjYWxlMXh9dyxcclxuICAgICAgICAvaW1nX3Jlc3BvbnNpdmUvJHtyZXN0YXVyYW50LmlkfS0ke3NjYWxlMV81eH0ud2VicCAke3NjYWxlMV81eH13LFxyXG4gICAgICAgIC9pbWdfcmVzcG9uc2l2ZS8ke3Jlc3RhdXJhbnQuaWR9LSR7c2NhbGUyeH0ud2VicCAke3NjYWxlMnh9dyxcclxuICAgICAgICAvaW1nX3Jlc3BvbnNpdmUvJHtyZXN0YXVyYW50LmlkfS0ke3NjYWxlM3h9LndlYnAgJHtzY2FsZTN4fXdgKTtcclxufVxyXG5cclxuICAvKipcclxuICAgKiBNYXAgbWFya2VyIGZvciBhIHJlc3RhdXJhbnQuXHJcbiAgICovXHJcbiAgc3RhdGljIG1hcE1hcmtlckZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgbWFwKSB7XHJcbiAgICBjb25zdCBtYXJrZXIgPSBuZXcgZ29vZ2xlLm1hcHMuTWFya2VyKHtcclxuICAgICAgcG9zaXRpb246IHJlc3RhdXJhbnQubGF0bG5nLFxyXG4gICAgICB0aXRsZTogcmVzdGF1cmFudC5uYW1lLFxyXG4gICAgICB1cmw6IERCSGVscGVyLnVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCksXHJcbiAgICAgIG1hcDogbWFwLFxyXG4gICAgICBhbmltYXRpb246IGdvb2dsZS5tYXBzLkFuaW1hdGlvbi5EUk9QLFxyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gbWFya2VyO1xyXG4gIH1cclxuXHJcbn1cclxuIiwibGV0IHJlc3RhdXJhbnRzLFxyXG4gIG5laWdoYm9yaG9vZHMsXHJcbiAgY3Vpc2luZXNcclxudmFyIG1hcFxyXG52YXIgbWFya2VycyA9IFtdXHJcblxyXG5sZXQgb2JzZXJ2ZXIgPSBuZXcgSW50ZXJzZWN0aW9uT2JzZXJ2ZXIoY2hhbmdlcyA9PiB7XHJcbiAgZm9yIChjb25zdCBjaGFuZ2Ugb2YgY2hhbmdlcykge1xyXG4gICAgaWYgKGNoYW5nZS5pbnRlcnNlY2lvblJhdGlvbiA+PSAwLjkpIHtcclxuICAgICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIGRhdGEpID0+IHtcclxuICAgICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBmaWxsUmVzdGF1cmFudEhUTUwoZGF0YSlcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxufSxcclxuICB7XHJcbiAgICB0aHJlc2hvbGQ6IFswLjldXHJcbiAgfVxyXG4pO1xyXG5cclxub2JzZXJ2ZXIub2JzZXJ2ZShkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudHMtbGlzdCcpKTtcclxuXHJcbi8qXHJcblNldHRpbmcgcGhvdG9ncmFwaHMgYWx0cyovXHJcblxyXG5jb25zdCBwaG90b2dyYXBoQWx0cyA9IHtcclxuXHQxOiBcIlNlcmV2YWwgZ3JvdXBzIG9mIHBlb3BsZSBoYXZpbmcgcXVhbGl0eSB0aW1lIGF0IGEgcmVzdGF1cmFudC5cIixcclxuXHQyOiBcIkEgbG92ZWx5IG1hcmdlcml0dGEgcGl6emFcIixcclxuXHQzOiBcIkFuIGVtcHR5IHJlc3RhdXJhbnQgc2V0dGluZyB3aGljaCBoYXMgaGVhdGVyc1wiLFxyXG5cdDQ6IFwiQSBjb3JuZXIgc2hvdCBvZiB0aGUgb3V0c2lkZSBvZiB0aGUgcmVzdGF1cmF0LlwiLFxyXG5cdDU6IFwiQSBjcm93ZGVkIHJlc3RhdXJhbnQgYW5kIHN0YWZmIHNlcnZpbmcgZm9vZCBmcm9tIGJlaGluZCB0aGUgYmFyLlwiLFxyXG5cdDY6IFwiUmVzdGF1cmFudCB3aXRoIHdvb2RlbiB0YWJsZXMsIGNoYXJpcywgYW5kIGEgVVMgZmxhZyBhcyBhIHdhbGwgZGVjb3JhdGlvblwiLFxyXG5cdDc6IFwiYSBkb2cgd2F0Y2hpbmcgZnJvbSB0aGUgb3V0c2lkZSBvZiBhIGNyb3dkZWQgYnVyZ2VyIHNob3AsIGFjY29tcGFuaWVkIGJ5IHR3byBtZW4uXCIsXHJcblx0ODogXCJDbG9zZSB1cCBvZiB0aGUgZHV0Y2ggcmVzdGF1cmFudCBsb2dvIGJlc2lkZSBhIGZsb3dlcmluZyB0cmVlXCIsXHJcblx0OTogXCJCbGFjayBhbmQgd2hpdGUgcGljdHVyZSBvZiBwZW9wbGUgZWF0aW5nIGF0IGFuIGFzaWFuIHJlc3RhdXJhdC5cIixcclxuXHQxMDogXCJFbXB0eSByZXN0YXVyYW50J3Mgd2hpdGUgY2hhaXJzLCB3YWxscyBhbmQgY2VpbGluZ3MuXCJcclxufTtcclxuXHJcblxyXG5cclxuLyoqXHJcbiAqIEZldGNoIG5laWdoYm9yaG9vZHMgYW5kIGN1aXNpbmVzIGFzIHNvb24gYXMgdGhlIHBhZ2UgaXMgbG9hZGVkLlxyXG4gKi9cclxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIChldmVudCkgPT4ge1xyXG4gIGZldGNoTmVpZ2hib3Job29kcygpO1xyXG4gIGZldGNoQ3Vpc2luZXMoKTtcclxufSk7XHJcblxyXG4vKipcclxuICogRmV0Y2ggYWxsIG5laWdoYm9yaG9vZHMgYW5kIHNldCB0aGVpciBIVE1MLlxyXG4gKi9cclxuZmV0Y2hOZWlnaGJvcmhvb2RzID0gKCkgPT4ge1xyXG4gIERCSGVscGVyLmZldGNoTmVpZ2hib3Job29kcygoZXJyb3IsIG5laWdoYm9yaG9vZHMpID0+IHtcclxuICAgIGlmIChlcnJvcikgeyAvLyBHb3QgYW4gZXJyb3JcclxuICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBzZWxmLm5laWdoYm9yaG9vZHMgPSBuZWlnaGJvcmhvb2RzO1xyXG4gICAgICBmaWxsTmVpZ2hib3Job29kc0hUTUwoKTtcclxuICAgIH1cclxuICB9KTtcclxufVxyXG5cclxuLyoqXHJcbiAqIFNldCBuZWlnaGJvcmhvb2RzIEhUTUwuXHJcbiAqL1xyXG5maWxsTmVpZ2hib3Job29kc0hUTUwgPSAobmVpZ2hib3Job29kcyA9IHNlbGYubmVpZ2hib3Job29kcykgPT4ge1xyXG4gIGNvbnN0IHNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZWlnaGJvcmhvb2RzLXNlbGVjdCcpO1xyXG4gIG5laWdoYm9yaG9vZHMuZm9yRWFjaChuZWlnaGJvcmhvb2QgPT4ge1xyXG4gICAgY29uc3Qgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7XHJcbiAgICBvcHRpb24uaW5uZXJIVE1MID0gbmVpZ2hib3Job29kO1xyXG4gICAgb3B0aW9uLnZhbHVlID0gbmVpZ2hib3Job29kO1xyXG4gICAgc2VsZWN0LmFwcGVuZChvcHRpb24pO1xyXG4gIH0pO1xyXG59XHJcblxyXG4vKipcclxuICogRmV0Y2ggYWxsIGN1aXNpbmVzIGFuZCBzZXQgdGhlaXIgSFRNTC5cclxuICovXHJcbmZldGNoQ3Vpc2luZXMgPSAoKSA9PiB7XHJcbiAgREJIZWxwZXIuZmV0Y2hDdWlzaW5lcygoZXJyb3IsIGN1aXNpbmVzKSA9PiB7XHJcbiAgICBpZiAoZXJyb3IpIHsgLy8gR290IGFuIGVycm9yIVxyXG4gICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHNlbGYuY3Vpc2luZXMgPSBjdWlzaW5lcztcclxuICAgICAgZmlsbEN1aXNpbmVzSFRNTCgpO1xyXG4gICAgfVxyXG4gIH0pO1xyXG59XHJcblxyXG4vKipcclxuICogU2V0IGN1aXNpbmVzIEhUTUwuXHJcbiAqL1xyXG5maWxsQ3Vpc2luZXNIVE1MID0gKGN1aXNpbmVzID0gc2VsZi5jdWlzaW5lcykgPT4ge1xyXG4gIGNvbnN0IHNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjdWlzaW5lcy1zZWxlY3QnKTtcclxuXHJcbiAgY3Vpc2luZXMuZm9yRWFjaChjdWlzaW5lID0+IHtcclxuICAgIGNvbnN0IG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpO1xyXG4gICAgb3B0aW9uLmlubmVySFRNTCA9IGN1aXNpbmU7XHJcbiAgICBvcHRpb24udmFsdWUgPSBjdWlzaW5lO1xyXG4gICAgc2VsZWN0LmFwcGVuZChvcHRpb24pO1xyXG4gIH0pO1xyXG59XHJcblxyXG4vKipcclxuICogSW5pdGlhbGl6ZSBHb29nbGUgbWFwLCBjYWxsZWQgZnJvbSBIVE1MLlxyXG4gKi9cclxuIHdpbmRvdy5pbml0TWFwID0gKCkgPT4ge1xyXG4gIGxldCBsb2MgPSB7XHJcbiAgICBsYXQ6IDQwLjcyMjIxNixcclxuICAgIGxuZzogLTczLjk4NzUwMVxyXG4gIH07XHJcbiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcCcpO1xyXG4gIHNlbGYubWFwID0gbmV3IGdvb2dsZS5tYXBzLk1hcChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFwJyksIHtcclxuICAgIHpvb206IDEyLFxyXG4gICAgY2VudGVyOiBsb2MsXHJcbiAgICBzY3JvbGx3aGVlbDogZmFsc2VcclxuICB9KTtcclxuXHJcbiAgdXBkYXRlUmVzdGF1cmFudHMoKTtcclxufVxyXG5cclxuLyoqXHJcblNob3cgbWFwIGJ1dHRvblxyXG4qL1xyXG5jYWxsTWFwID1cclxuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcFRvZ2dsZScpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oZXZlbnQpIHtcclxuICBpZiAoKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAtY29udGFpbmVyJykuc3R5bGUuZGlzcGxheSkgPT09ICdibG9jaycpIHtcclxuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAtY29udGFpbmVyJykuc3R5bGUuZGlzcGxheSA9ICdub25lJztcclxuICAgIHdpbmRvdy5pbml0TWFwKCk7XHJcbiAgfSBlbHNlIHtcclxuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAtY29udGFpbmVyJykuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XHJcbiAgfVxyXG59KTtcclxuLyoqXHJcbiAqIFVwZGF0ZSBwYWdlIGFuZCBtYXAgZm9yIGN1cnJlbnQgcmVzdGF1cmFudHMuXHJcbiAqL1xyXG51cGRhdGVSZXN0YXVyYW50cyA9ICgpID0+IHtcclxuICBjb25zdCBjU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2N1aXNpbmVzLXNlbGVjdCcpO1xyXG4gIGNvbnN0IG5TZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmVpZ2hib3Job29kcy1zZWxlY3QnKTtcclxuXHJcbiAgY29uc3QgY0luZGV4ID0gY1NlbGVjdC5zZWxlY3RlZEluZGV4O1xyXG4gIGNvbnN0IG5JbmRleCA9IG5TZWxlY3Quc2VsZWN0ZWRJbmRleDtcclxuXHJcbiAgY29uc3QgY3Vpc2luZSA9IGNTZWxlY3RbY0luZGV4XS52YWx1ZTtcclxuICBjb25zdCBuZWlnaGJvcmhvb2QgPSBuU2VsZWN0W25JbmRleF0udmFsdWU7XHJcblxyXG4gIERCSGVscGVyLmZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZChjdWlzaW5lLCBuZWlnaGJvcmhvb2QsIChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcclxuICAgIGlmIChlcnJvcikgeyAvLyBHb3QgYW4gZXJyb3IhXHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmVzZXRSZXN0YXVyYW50cyhyZXN0YXVyYW50cyk7XHJcbiAgICAgIGZpbGxSZXN0YXVyYW50c0hUTUwoKTtcclxuICAgIH1cclxuICB9KVxyXG59XHJcblxyXG4vKipcclxuICogQ2xlYXIgY3VycmVudCByZXN0YXVyYW50cywgdGhlaXIgSFRNTCBhbmQgcmVtb3ZlIHRoZWlyIG1hcCBtYXJrZXJzLlxyXG4gKi9cclxucmVzZXRSZXN0YXVyYW50cyA9IChyZXN0YXVyYW50cykgPT4ge1xyXG4gIC8vIFJlbW92ZSBhbGwgcmVzdGF1cmFudHNcclxuICBzZWxmLnJlc3RhdXJhbnRzID0gW107XHJcbiAgY29uc3QgdWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudHMtbGlzdCcpO1xyXG4gIHVsLmlubmVySFRNTCA9ICcnO1xyXG5cclxuICAvLyBSZW1vdmUgYWxsIG1hcCBtYXJrZXJzXHJcbiAgc2VsZi5tYXJrZXJzLmZvckVhY2gobSA9PiBtLnNldE1hcChudWxsKSk7XHJcbiAgc2VsZi5tYXJrZXJzID0gW107XHJcbiAgc2VsZi5yZXN0YXVyYW50cyA9IHJlc3RhdXJhbnRzO1xyXG59XHJcblxyXG4vKipcclxuICogQ3JlYXRlIGFsbCByZXN0YXVyYW50cyBIVE1MIGFuZCBhZGQgdGhlbSB0byB0aGUgd2VicGFnZS5cclxuICovXHJcbmZpbGxSZXN0YXVyYW50c0hUTUwgPSAocmVzdGF1cmFudHMgPSBzZWxmLnJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgY29uc3QgdWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudHMtbGlzdCcpO1xyXG4gIHJlc3RhdXJhbnRzLmZvckVhY2gocmVzdGF1cmFudCA9PiB7XHJcbiAgICB1bC5hcHBlbmQoY3JlYXRlUmVzdGF1cmFudEhUTUwocmVzdGF1cmFudCkpO1xyXG4gIH0pO1xyXG4gIGFkZE1hcmtlcnNUb01hcCgpO1xyXG59XHJcblxyXG4vKipcclxuICogQ3JlYXRlIHJlc3RhdXJhbnQgSFRNTC5cclxuICovXHJcbmNyZWF0ZVJlc3RhdXJhbnRIVE1MID0gKHJlc3RhdXJhbnQpID0+IHtcclxuICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XHJcbiAgbGkudGFiSW5kZXggPScwJztcclxuXHJcbiAgY29uc3QgaW1hZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcclxuICBpbWFnZS5jbGFzc05hbWUgPSAncmVzdGF1cmFudC1pbWcnO1xyXG4gIGltYWdlLnNyYyA9IERCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KTtcclxuICBpbWFnZS5zcmNzZXQgPSBEQkhlbHBlci5pbWFnZVJlc3BvbnNpdmVVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpO1xyXG4gIGltYWdlLmFsdCA9IHBob3RvZ3JhcGhBbHRzW3Jlc3RhdXJhbnQuaWRdO1xyXG4gIGxpLmFwcGVuZChpbWFnZSk7XHJcblxyXG4gIGNvbnN0IG5hbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdoMicpO1xyXG4gIG5hbWUuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xyXG4gIGxpLmFwcGVuZChuYW1lKTtcclxuXHJcbiAgY29uc3QgbmVpZ2hib3Job29kID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xyXG4gIG5laWdoYm9yaG9vZC5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5laWdoYm9yaG9vZDtcclxuICBsaS5hcHBlbmQobmVpZ2hib3Job29kKTtcclxuXHJcbiAgY29uc3QgYWRkcmVzcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcclxuICBhZGRyZXNzLmlubmVySFRNTCA9IHJlc3RhdXJhbnQuYWRkcmVzcztcclxuICBsaS5hcHBlbmQoYWRkcmVzcyk7XHJcblxyXG4gIGNvbnN0IG1vcmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7XHJcbiAgbW9yZS5pbm5lckhUTUwgPSAnVmlldyBEZXRhaWxzJztcclxuICBtb3JlLmhyZWYgPSBEQkhlbHBlci51cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpO1xyXG4gIGxpLmFwcGVuZChtb3JlKVxyXG5cclxuICByZXR1cm4gbGlcclxufVxyXG5cclxuLyoqXHJcbiAqIEFkZCBtYXJrZXJzIGZvciBjdXJyZW50IHJlc3RhdXJhbnRzIHRvIHRoZSBtYXAuXHJcbiAqL1xyXG5hZGRNYXJrZXJzVG9NYXAgPSAocmVzdGF1cmFudHMgPSBzZWxmLnJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgcmVzdGF1cmFudHMuZm9yRWFjaChyZXN0YXVyYW50ID0+IHtcclxuICAgIC8vIEFkZCBtYXJrZXIgdG8gdGhlIG1hcFxyXG4gICAgY29uc3QgbWFya2VyID0gREJIZWxwZXIubWFwTWFya2VyRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCBzZWxmLm1hcCk7XHJcbiAgICBnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihtYXJrZXIsICdjbGljaycsICgpID0+IHtcclxuICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBtYXJrZXIudXJsXHJcbiAgICB9KTtcclxuICAgIHNlbGYubWFya2Vycy5wdXNoKG1hcmtlcik7XHJcbiAgfSk7XHJcbn1cclxuXHJcblxyXG5pZiAobmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIpIHtcclxuICBuYXZpZ2F0b3Iuc2VydmljZVdvcmtlci5yZWdpc3Rlcignc3cuanMnKVxyXG4gICAgLnRoZW4oKCkgPT4gY29uc29sZS5sb2coJ1Bhc3NlZCBUZXN0JykpXHJcbn07XHJcbiIsIlxyXG4vKipcclxuICogUmVnaXN0ZXIgYSBzZXJ2aWNlV29ya2VyXHJcbiAqL1xyXG5yZWdpc3RlclNlcnZpY2VXb3JrZXIgPSAoKSA9PiB7XHJcbiAgICAvL2NoZWNrIGlmIHNlcnZpY2VXb3JrZXIgaXMgc3VwcG9ydGVkLCBvdGhlcndpc2UgcmV0dXJuXHJcbiAgICBpZiAoIW5hdmlnYXRvci5zZXJ2aWNlV29ya2VyKSByZXR1cm47XHJcblxyXG4gICAgbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIucmVnaXN0ZXIoJy9zdy5qcycpLmNhdGNoKGZ1bmN0aW9uKCl7XHJcbiAgICAgIGNvbnNvbGUubG9nKFwiU29tZXRoaW5nIHdlbnQgd3JvbmcuIFNlcnZpY2VXb3JrZXIgbm90IHJlZ2lzdGVyZWRcIik7XHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICByZWdpc3RlclNlcnZpY2VXb3JrZXIoKTtcclxuIl19
