class DBHelper{static get DATABASE_URL(){return"http://localhost:1337"}static get RESTAURANT_URL(){return"http://localhost:1337/restaurants"}static get REVIEWS_URL(){return"http://localhost:1337/reviews/?restaurant_id="}static openDatabase(){return navigator.serviceWorker?idb.open("restaurants-db",1,function(e){e.createObjectStore("restaurants",{keyPath:"id"}).createIndex("rest-id","id"),e.createObjectStore("reviews",{keyPath:"id",autoIncrement:!0}).createIndex("restaurant_id","restaurant_id",{unique:!1}),e.createObjectStore("sync-reviews",{keyPath:"id",autoIncrement:!0}).createIndex("restaurant_id","restaurant_id",{unique:!1})}):(console.log("Browser doesn't support Service Workers"),Promise.resolve())}static fetchRestaurants(e){DBHelper.openDatabase().then(function(e){return e?e.transaction("restaurants","readwrite").objectStore("restaurants").getAll():void 0}).then(function(t){0!==t.length&&e(null,t)}),fetch(DBHelper.RESTAURANT_URL).then(function(t){200===t.status?t.json().then(function(t){DBHelper.openDatabase().then(function(e){if(e){let r=e.transaction("restaurants","readwrite"),n=r.objectStore("restaurants");return t.forEach(function(e){n.put(e)}),r.complete}}),e(null,t)}):console.log("Fetch Issue - Status Code: "+t.status)}).catch(function(e){console.log("Fetch Error: ",e)})}static fetchRestaurantById(e,t){DBHelper.fetchRestaurants((r,n)=>{if(r)t(r,null);else{const r=n.find(t=>t.id==e);r?t(null,r):t("Restaurant does not exist",null)}})}static fetchRestaurantByCuisine(e,t){DBHelper.fetchRestaurants((r,n)=>{if(r)t(r,null);else{const r=n.filter(t=>t.cuisine_type==e);t(null,r)}})}static fetchRestaurantByNeighborhood(e,t){DBHelper.fetchRestaurants((r,n)=>{if(r)t(r,null);else{const r=n.filter(t=>t.neighborhood==e);t(null,r)}})}static fetchRestaurantByCuisineAndNeighborhood(e,t,r){DBHelper.fetchRestaurants((n,a)=>{if(n)r(n,null);else{let n=a;"all"!=e&&(n=n.filter(t=>t.cuisine_type==e)),"all"!=t&&(n=n.filter(e=>e.neighborhood==t)),r(null,n)}})}static fetchNeighborhoods(e){DBHelper.fetchRestaurants((t,r)=>{if(t)e(t,null);else{const t=r.map((e,t)=>r[t].neighborhood),n=t.filter((e,r)=>t.indexOf(e)==r);e(null,n)}})}static fetchCuisines(e){DBHelper.fetchRestaurants((t,r)=>{if(t)e(t,null);else{const t=r.map((e,t)=>r[t].cuisine_type),n=t.filter((e,r)=>t.indexOf(e)==r);e(null,n)}})}static fetchReviews(e,t){DBHelper.openDatabase().then(function(t){if(t){return t.transaction("reviews","readwrite").objectStore("reviews").index("restaurant_id").getAll(parseInt(e))}}).then(function(e){0!==e.length&&t(null,e)}),fetch(`${DBHelper.REVIEWS_URL}${e}`).then(e=>e.json()).then(e=>{DBHelper.openDatabase().then(function(t){if(t){let r=t.transaction("reviews","readwrite"),n=r.objectStore("reviews");return e.forEach(function(e){n.put(e)}),r.complete}}),t(null,e)}).catch(e=>t(`Request failed. Returned ${e}`,null))}static fetchTmpReviews(e,t){DBHelper.openDatabase().then(function(t){if(t){return t.transaction("sync-reviews","readonly").objectStore("sync-reviews").index("restaurant_id").getAll(parseInt(e))}}).then(function(e){0!==e.length&&t(null,e)})}static postReview(e){return DBHelper.openDatabase().then(function(t){if(t){let r=t.transaction("sync-reviews","readwrite");return r.objectStore("sync-reviews").put(e),r.complete}}).then(function(){return Promise.resolve()}).catch(function(e){return console.log(e),Promise.resolve()})}static urlForRestaurant(e){return`./restaurant.html?id=${e.id}`}static imageUrlForRestaurant(e){return`/img/${e.photograph}.webp`}static imageResponsiveUrlForRestaurant(e){return`/img_responsive/${e.id}-320.webp 320w,\n        /img_responsive/${e.id}-480.webp 480w,\n        /img_responsive/${e.id}-640.webp 640w,\n        /img_responsive/${e.id}-800.webp 800w`}static mapMarkerForRestaurant(e,t){return new google.maps.Marker({position:e.latlng,title:e.name,url:DBHelper.urlForRestaurant(e),map:t,animation:google.maps.Animation.DROP})}}let restaurants,neighborhoods,cuisines;var map,markers=[];let observer=new IntersectionObserver(e=>{for(const t of e)t.intersecionRation>=.9&&DBHelper.fetchRestaurants((e,t)=>{e?console.error(e):fillRestaurantHTML(t)})},{threshold:[.9]});observer.observe(document.getElementById("restaurants-list"));const photographAlts={1:"Sereval groups of people having quality time at a restaurant.",2:"A lovely margeritta pizza",3:"An empty restaurant setting which has heaters",4:"A corner shot of the outside of the restaurat.",5:"A crowded restaurant and staff serving food from behind the bar.",6:"Restaurant with wooden tables, charis, and a US flag as a wall decoration",7:"a dog watching from the outside of a crowded burger shop, accompanied by two men.",8:"Close up of the dutch restaurant logo beside a flowering tree",9:"Black and white picture of people eating at an asian restaurat.",10:"Empty restaurant's white chairs, walls and ceilings."};document.addEventListener("DOMContentLoaded",e=>{fetchNeighborhoods(),fetchCuisines()}),fetchNeighborhoods=(()=>{DBHelper.fetchNeighborhoods((e,t)=>{e?console.error(e):(self.neighborhoods=t,fillNeighborhoodsHTML())})}),fillNeighborhoodsHTML=((e=self.neighborhoods)=>{const t=document.getElementById("neighborhoods-select");e.forEach(e=>{const r=document.createElement("option");r.innerHTML=e,r.value=e,t.append(r)})}),fetchCuisines=(()=>{DBHelper.fetchCuisines((e,t)=>{e?console.error(e):(self.cuisines=t,fillCuisinesHTML())})}),fillCuisinesHTML=((e=self.cuisines)=>{const t=document.getElementById("cuisines-select");e.forEach(e=>{const r=document.createElement("option");r.innerHTML=e,r.value=e,t.append(r)})}),window.initMap=(()=>{document.getElementById("map"),self.map=new google.maps.Map(document.getElementById("map"),{zoom:12,center:{lat:40.722216,lng:-73.987501},scrollwheel:!1}),updateRestaurants()}),callMap=document.getElementById("mapToggle").addEventListener("click",function(e){"block"===document.getElementById("map-container").style.display?(document.getElementById("map-container").style.display="none",window.initMap()):document.getElementById("map-container").style.display="block"}),updateRestaurants=(()=>{const e=document.getElementById("cuisines-select"),t=document.getElementById("neighborhoods-select"),r=e.selectedIndex,n=t.selectedIndex,a=e[r].value,s=t[n].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(a,s,(e,t)=>{e?console.error(e):(resetRestaurants(t),fillRestaurantsHTML())})}),resetRestaurants=(e=>{self.restaurants=[],document.getElementById("restaurants-list").innerHTML="",self.markers.forEach(e=>e.setMap(null)),self.markers=[],self.restaurants=e}),fillRestaurantsHTML=((e=self.restaurants)=>{const t=document.getElementById("restaurants-list");e.forEach(e=>{t.append(createRestaurantHTML(e))}),addMarkersToMap()}),createRestaurantHTML=(e=>{const t=document.createElement("li");t.tabIndex="0";const r=document.createElement("img");r.className="restaurant-img",r.src=DBHelper.imageUrlForRestaurant(e),r.srcset=DBHelper.imageResponsiveUrlForRestaurant(e),r.alt=photographAlts[e.id],t.append(r);const n=document.createElement("h2");n.innerHTML=e.name,t.append(n);const a=document.createElement("p");a.innerHTML=e.neighborhood,t.append(a);const s=document.createElement("p");s.innerHTML=e.address,t.append(s);const o=document.createElement("a");return o.innerHTML="View Details",o.href=DBHelper.urlForRestaurant(e),t.append(o),t}),addMarkersToMap=((e=self.restaurants)=>{e.forEach(e=>{const t=DBHelper.mapMarkerForRestaurant(e,self.map);google.maps.event.addListener(t,"click",()=>{window.location.href=t.url}),self.markers.push(t)})}),navigator.serviceWorker&&navigator.serviceWorker.register("sw.js").then(()=>console.log("Passed Test")),registerServiceWorker=(()=>{navigator.serviceWorker&&navigator.serviceWorker.register("/sw.js").catch(function(){console.log("Something went wrong. ServiceWorker not registered")})}),registerServiceWorker();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRiaGVscGVyLmpzIiwibWFpbi5qcyIsInJlZ2lzdGVyU2VydmljZVdvcmtlci5qcyJdLCJuYW1lcyI6WyJEQkhlbHBlciIsIkRBVEFCQVNFX1VSTCIsIlJFU1RBVVJBTlRfVVJMIiwiUkVWSUVXU19VUkwiLCJbb2JqZWN0IE9iamVjdF0iLCJuYXZpZ2F0b3IiLCJzZXJ2aWNlV29ya2VyIiwiaWRiIiwib3BlbiIsInVwZ3JhZGVEYiIsImNyZWF0ZU9iamVjdFN0b3JlIiwia2V5UGF0aCIsImNyZWF0ZUluZGV4IiwiYXV0b0luY3JlbWVudCIsInVuaXF1ZSIsImNvbnNvbGUiLCJsb2ciLCJQcm9taXNlIiwicmVzb2x2ZSIsImNhbGxiYWNrIiwib3BlbkRhdGFiYXNlIiwidGhlbiIsImRiIiwidHJhbnNhY3Rpb24iLCJvYmplY3RTdG9yZSIsImdldEFsbCIsInJlc3RhdXJhbnRzIiwibGVuZ3RoIiwiZmV0Y2giLCJyZXNwb25zZSIsInN0YXR1cyIsImpzb24iLCJ0eCIsInN0b3JlUmVzdGF1cmFudHMiLCJmb3JFYWNoIiwicmVzdGF1cmFudCIsInB1dCIsImNvbXBsZXRlIiwiY2F0Y2giLCJlcnIiLCJpZCIsImZldGNoUmVzdGF1cmFudHMiLCJlcnJvciIsImZpbmQiLCJyIiwiY3Vpc2luZSIsInJlc3VsdHMiLCJmaWx0ZXIiLCJjdWlzaW5lX3R5cGUiLCJuZWlnaGJvcmhvb2QiLCJuZWlnaGJvcmhvb2RzIiwibWFwIiwidiIsImkiLCJ1bmlxdWVOZWlnaGJvcmhvb2RzIiwiaW5kZXhPZiIsImN1aXNpbmVzIiwidW5pcXVlQ3Vpc2luZXMiLCJpbmRleCIsInBhcnNlSW50IiwicmV2aWV3cyIsInN0b3JlUmV2aWV3cyIsInJldmlldyIsInBob3RvZ3JhcGgiLCJnb29nbGUiLCJtYXBzIiwiTWFya2VyIiwicG9zaXRpb24iLCJsYXRsbmciLCJ0aXRsZSIsIm5hbWUiLCJ1cmwiLCJ1cmxGb3JSZXN0YXVyYW50IiwiYW5pbWF0aW9uIiwiQW5pbWF0aW9uIiwiRFJPUCIsIm1hcmtlcnMiLCJvYnNlcnZlciIsIkludGVyc2VjdGlvbk9ic2VydmVyIiwiY2hhbmdlcyIsImNoYW5nZSIsImludGVyc2VjaW9uUmF0aW9uIiwiZGF0YSIsImZpbGxSZXN0YXVyYW50SFRNTCIsInRocmVzaG9sZCIsIm9ic2VydmUiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwicGhvdG9ncmFwaEFsdHMiLCIxIiwiMiIsIjMiLCI0IiwiNSIsIjYiLCI3IiwiOCIsIjkiLCIxMCIsImFkZEV2ZW50TGlzdGVuZXIiLCJldmVudCIsImZldGNoTmVpZ2hib3Job29kcyIsImZldGNoQ3Vpc2luZXMiLCJzZWxmIiwiZmlsbE5laWdoYm9yaG9vZHNIVE1MIiwic2VsZWN0Iiwib3B0aW9uIiwiY3JlYXRlRWxlbWVudCIsImlubmVySFRNTCIsInZhbHVlIiwiYXBwZW5kIiwiZmlsbEN1aXNpbmVzSFRNTCIsIndpbmRvdyIsImluaXRNYXAiLCJNYXAiLCJ6b29tIiwiY2VudGVyIiwibGF0IiwibG5nIiwic2Nyb2xsd2hlZWwiLCJ1cGRhdGVSZXN0YXVyYW50cyIsImNhbGxNYXAiLCJzdHlsZSIsImRpc3BsYXkiLCJjU2VsZWN0IiwiblNlbGVjdCIsImNJbmRleCIsInNlbGVjdGVkSW5kZXgiLCJuSW5kZXgiLCJmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QiLCJyZXNldFJlc3RhdXJhbnRzIiwiZmlsbFJlc3RhdXJhbnRzSFRNTCIsIm0iLCJzZXRNYXAiLCJ1bCIsImNyZWF0ZVJlc3RhdXJhbnRIVE1MIiwiYWRkTWFya2Vyc1RvTWFwIiwibGkiLCJ0YWJJbmRleCIsImltYWdlIiwiY2xhc3NOYW1lIiwic3JjIiwiaW1hZ2VVcmxGb3JSZXN0YXVyYW50Iiwic3Jjc2V0IiwiaW1hZ2VSZXNwb25zaXZlVXJsRm9yUmVzdGF1cmFudCIsImFsdCIsImFkZHJlc3MiLCJtb3JlIiwiaHJlZiIsIm1hcmtlciIsIm1hcE1hcmtlckZvclJlc3RhdXJhbnQiLCJhZGRMaXN0ZW5lciIsImxv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KlxyXG4gKiBDb21tb24gZGF0YWJhc2UgaGVscGVyIGZ1bmN0aW9ucy5cclxuICovXHJcbmNsYXNzIERCSGVscGVyIHtcclxuXHJcbiAgLyoqXHJcbiAgICogRGF0YWJhc2UgVVJMLlxyXG4gICAqIENoYW5nZSB0aGlzIHRvIHJlc3RhdXJhbnRzLmpzb24gZmlsZSBsb2NhdGlvbiBvbiB5b3VyIHNlcnZlci5cclxuICAgKi9cclxuICBzdGF0aWMgZ2V0IERBVEFCQVNFX1VSTCgpIHtcclxuICAgIGNvbnN0IHBvcnQgPSAxMzM3O1xyXG4gICAgcmV0dXJuIGBodHRwOi8vbG9jYWxob3N0OiR7cG9ydH1gO1xyXG4gIH1cclxuICBzdGF0aWMgZ2V0IFJFU1RBVVJBTlRfVVJMKCkge1xyXG4gIGNvbnN0IHBvcnQgPSAxMzM3O1xyXG4gIHJldHVybiBgaHR0cDovL2xvY2FsaG9zdDoke3BvcnR9L3Jlc3RhdXJhbnRzYDtcclxufVxyXG5cclxuc3RhdGljIGdldCBSRVZJRVdTX1VSTCgpIHtcclxuICBjb25zdCBwb3J0ID0gMTMzNztcclxuICByZXR1cm4gYGh0dHA6Ly9sb2NhbGhvc3Q6JHtwb3J0fS9yZXZpZXdzLz9yZXN0YXVyYW50X2lkPWA7XHJcbn1cclxuXHJcbi8vIElEQiBjcmVhdGlvblxyXG5cclxuXHJcbnN0YXRpYyBvcGVuRGF0YWJhc2UgKCkge1xyXG5cclxuICAvLyBJZiB0aGUgYnJvd3NlciBkb2Vzbid0IHN1cHBvcnQgc2VydmljZSB3b3JrZXIsXHJcbiAgLy8gd2UgZG9uJ3QgY2FyZSBhYm91dCBoYXZpbmcgYSBkYXRhYmFzZVxyXG4gIGlmICghbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIpIHtcclxuICAgIGNvbnNvbGUubG9nKGBCcm93c2VyIGRvZXNuJ3Qgc3VwcG9ydCBTZXJ2aWNlIFdvcmtlcnNgKTtcclxuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcclxuICB9XHJcblxyXG4gIHJldHVybiBpZGIub3BlbigncmVzdGF1cmFudHMtZGInLCAxLCBmdW5jdGlvbiAodXBncmFkZURiKSB7XHJcbiAgICB2YXIgc3RvcmVSZXN0YXVyYW50cyA9IHVwZ3JhZGVEYi5jcmVhdGVPYmplY3RTdG9yZSgncmVzdGF1cmFudHMnLCB7XHJcbiAgICAgIGtleVBhdGg6ICdpZCcsXHJcbiAgICB9KTtcclxuICAgIHN0b3JlUmVzdGF1cmFudHMuY3JlYXRlSW5kZXgoJ3Jlc3QtaWQnLCAnaWQnKTtcclxuICAgIHZhciBzdG9yZVJldmlld3MgPSB1cGdyYWRlRGIuY3JlYXRlT2JqZWN0U3RvcmUoJ3Jldmlld3MnLCB7XHJcbiAgICAgIGtleVBhdGg6ICdpZCcsXHJcbiAgICAgIGF1dG9JbmNyZW1lbnQ6IHRydWUsXHJcbiAgICB9KTtcclxuICAgIHN0b3JlUmV2aWV3cy5jcmVhdGVJbmRleCgncmVzdGF1cmFudF9pZCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3Jlc3RhdXJhbnRfaWQnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgdW5pcXVlOiBmYWxzZSB9KTtcclxuICAgIHZhciBzdG9yZVN5bmNSZXZpZXcgPSB1cGdyYWRlRGIuY3JlYXRlT2JqZWN0U3RvcmUoJ3N5bmMtcmV2aWV3cycsIHtcclxuICAgICAga2V5UGF0aDogJ2lkJyxcclxuICAgICAgYXV0b0luY3JlbWVudDogdHJ1ZSxcclxuICAgIH0pO1xyXG4gICAgc3RvcmVTeW5jUmV2aWV3LmNyZWF0ZUluZGV4KCdyZXN0YXVyYW50X2lkJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAncmVzdGF1cmFudF9pZCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeyB1bmlxdWU6IGZhbHNlIH0pO1xyXG4gIH0pO1xyXG59XHJcblxyXG5cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggYWxsIHJlc3RhdXJhbnRzLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRzKGNhbGxiYWNrKSB7XHJcblxyXG4gICAgLy8gZ2V0IHJlc3RhdXJhbnRzIGZyb20gaW5kZXhlZERCXHJcbiAgICBEQkhlbHBlci5vcGVuRGF0YWJhc2UoKS50aGVuKGZ1bmN0aW9uIChkYikge1xyXG4gICAgICBpZiAoIWRiKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9ICBlbHNlIHtcclxuICAgICAgICByZXR1cm4gZGIudHJhbnNhY3Rpb24oJ3Jlc3RhdXJhbnRzJywgJ3JlYWR3cml0ZScpXHJcbiAgICAgICAgICAgICAgICAgLm9iamVjdFN0b3JlKCdyZXN0YXVyYW50cycpXHJcbiAgICAgICAgICAgICAgICAgLmdldEFsbCgpO1xyXG4gICAgICB9XHJcbiAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN0YXVyYW50cykge1xyXG4gICAgICBpZiAocmVzdGF1cmFudHMubGVuZ3RoID09PSAwKSByZXR1cm47XHJcbiAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3RhdXJhbnRzKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGZldGNoKERCSGVscGVyLlJFU1RBVVJBTlRfVVJMKVxyXG4gICAgLnRoZW4oXHJcbiAgICAgIGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xyXG4gICAgICAgICAgY29uc29sZS5sb2coJ0ZldGNoIElzc3VlIC0gU3RhdHVzIENvZGU6ICcgKyByZXNwb25zZS5zdGF0dXMpO1xyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmVzcG9uc2UuanNvbigpLnRoZW4oZnVuY3Rpb24gKHJlc3RhdXJhbnRzKSB7XHJcblxyXG4gICAgICAgICAgLyogQWRkIHJlc3RhdXJhbnRzIHRvIGluZGV4ZWREQiAqL1xyXG4gICAgICAgICAgREJIZWxwZXIub3BlbkRhdGFiYXNlKCkudGhlbihmdW5jdGlvbiAoZGIpIHtcclxuICAgICAgICAgICAgaWYgKCFkYikge1xyXG4gICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICBsZXQgdHggPSBkYi50cmFuc2FjdGlvbigncmVzdGF1cmFudHMnLCAncmVhZHdyaXRlJyk7XHJcbiAgICAgICAgICAgICAgbGV0IHN0b3JlUmVzdGF1cmFudHMgPSB0eC5vYmplY3RTdG9yZSgncmVzdGF1cmFudHMnKTtcclxuXHJcbiAgICAgICAgICAgICAgcmVzdGF1cmFudHMuZm9yRWFjaChmdW5jdGlvbiAocmVzdGF1cmFudCkge1xyXG4gICAgICAgICAgICAgICAgc3RvcmVSZXN0YXVyYW50cy5wdXQocmVzdGF1cmFudCk7XHJcbiAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgIHJldHVybiB0eC5jb21wbGV0ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdGF1cmFudHMpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICApXHJcbiAgICAuY2F0Y2goZnVuY3Rpb24gKGVycikge1xyXG4gICAgICBjb25zb2xlLmxvZygnRmV0Y2ggRXJyb3I6ICcsIGVycik7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIGEgcmVzdGF1cmFudCBieSBpdHMgSUQuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5SWQoaWQsIGNhbGxiYWNrKSB7XHJcbiAgICAvLyBmZXRjaCBhbGwgcmVzdGF1cmFudHMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcclxuICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbnN0IHJlc3RhdXJhbnQgPSByZXN0YXVyYW50cy5maW5kKHIgPT4gci5pZCA9PSBpZCk7XHJcbiAgICAgICAgaWYgKHJlc3RhdXJhbnQpIHsgLy8gR290IHRoZSByZXN0YXVyYW50XHJcbiAgICAgICAgICBjYWxsYmFjayhudWxsLCByZXN0YXVyYW50KTtcclxuICAgICAgICB9IGVsc2UgeyAvLyBSZXN0YXVyYW50IGRvZXMgbm90IGV4aXN0IGluIHRoZSBkYXRhYmFzZVxyXG4gICAgICAgICAgY2FsbGJhY2soJ1Jlc3RhdXJhbnQgZG9lcyBub3QgZXhpc3QnLCBudWxsKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBjdWlzaW5lIHR5cGUgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZShjdWlzaW5lLCBjYWxsYmFjaykge1xyXG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzICB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZ1xyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBGaWx0ZXIgcmVzdGF1cmFudHMgdG8gaGF2ZSBvbmx5IGdpdmVuIGN1aXNpbmUgdHlwZVxyXG4gICAgICAgIGNvbnN0IHJlc3VsdHMgPSByZXN0YXVyYW50cy5maWx0ZXIociA9PiByLmN1aXNpbmVfdHlwZSA9PSBjdWlzaW5lKTtcclxuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHRzKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIG5laWdoYm9yaG9vZCB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlOZWlnaGJvcmhvb2QobmVpZ2hib3Job29kLCBjYWxsYmFjaykge1xyXG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXHJcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcclxuICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIEZpbHRlciByZXN0YXVyYW50cyB0byBoYXZlIG9ubHkgZ2l2ZW4gbmVpZ2hib3Job29kXHJcbiAgICAgICAgY29uc3QgcmVzdWx0cyA9IHJlc3RhdXJhbnRzLmZpbHRlcihyID0+IHIubmVpZ2hib3Job29kID09IG5laWdoYm9yaG9vZCk7XHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0cyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBjdWlzaW5lIGFuZCBhIG5laWdoYm9yaG9vZCB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lQW5kTmVpZ2hib3Job29kKGN1aXNpbmUsIG5laWdoYm9yaG9vZCwgY2FsbGJhY2spIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBsZXQgcmVzdWx0cyA9IHJlc3RhdXJhbnRzO1xyXG4gICAgICAgIGlmIChjdWlzaW5lICE9ICdhbGwnKSB7IC8vIGZpbHRlciBieSBjdWlzaW5lXHJcbiAgICAgICAgICByZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIociA9PiByLmN1aXNpbmVfdHlwZSA9PSBjdWlzaW5lKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChuZWlnaGJvcmhvb2QgIT0gJ2FsbCcpIHsgLy8gZmlsdGVyIGJ5IG5laWdoYm9yaG9vZFxyXG4gICAgICAgICAgcmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKHIgPT4gci5uZWlnaGJvcmhvb2QgPT0gbmVpZ2hib3Job29kKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdHMpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIGFsbCBuZWlnaGJvcmhvb2RzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaE5laWdoYm9yaG9vZHMoY2FsbGJhY2spIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBHZXQgYWxsIG5laWdoYm9yaG9vZHMgZnJvbSBhbGwgcmVzdGF1cmFudHNcclxuICAgICAgICBjb25zdCBuZWlnaGJvcmhvb2RzID0gcmVzdGF1cmFudHMubWFwKCh2LCBpKSA9PiByZXN0YXVyYW50c1tpXS5uZWlnaGJvcmhvb2QpO1xyXG5cclxuICAgICAgICAvLyBSZW1vdmUgZHVwbGljYXRlcyBmcm9tIG5laWdoYm9yaG9vZHNcclxuICAgICAgICBjb25zdCB1bmlxdWVOZWlnaGJvcmhvb2RzID0gbmVpZ2hib3Job29kcy5maWx0ZXIoKHYsIGkpID0+IG5laWdoYm9yaG9vZHMuaW5kZXhPZih2KSA9PSBpKTtcclxuICAgICAgICBjYWxsYmFjayhudWxsLCB1bmlxdWVOZWlnaGJvcmhvb2RzKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCBhbGwgY3Vpc2luZXMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoQ3Vpc2luZXMoY2FsbGJhY2spIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBHZXQgYWxsIGN1aXNpbmVzIGZyb20gYWxsIHJlc3RhdXJhbnRzXHJcbiAgICAgICAgY29uc3QgY3Vpc2luZXMgPSByZXN0YXVyYW50cy5tYXAoKHYsIGkpID0+IHJlc3RhdXJhbnRzW2ldLmN1aXNpbmVfdHlwZSk7XHJcblxyXG4gICAgICAgIC8vIFJlbW92ZSBkdXBsaWNhdGVzIGZyb20gY3Vpc2luZXNcclxuICAgICAgICBjb25zdCB1bmlxdWVDdWlzaW5lcyA9IGN1aXNpbmVzLmZpbHRlcigodiwgaSkgPT4gY3Vpc2luZXMuaW5kZXhPZih2KSA9PSBpKTtcclxuICAgICAgICBjYWxsYmFjayhudWxsLCB1bmlxdWVDdWlzaW5lcyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICAgKiBGZXRjaCBhbGwgcmV2aWV3cy5cclxuICAgICAqL1xyXG4gICAgc3RhdGljIGZldGNoUmV2aWV3cyhpZCwgY2FsbGJhY2spIHtcclxuXHJcbiAgICAgIC8vIGdldCByZXZpZXdzIGZyb20gaW5kZXhlZERCXHJcbiAgICAgIERCSGVscGVyLm9wZW5EYXRhYmFzZSgpLnRoZW4oZnVuY3Rpb24gKGRiKSB7XHJcbiAgICAgICAgaWYgKCFkYikge1xyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH0gIGVsc2Uge1xyXG4gICAgICAgICAgbGV0IHN0b3JlUmV2aWV3cyA9IGRiLnRyYW5zYWN0aW9uKCdyZXZpZXdzJywgJ3JlYWR3cml0ZScpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAub2JqZWN0U3RvcmUoJ3Jldmlld3MnKTtcclxuICAgICAgICAgIGxldCByZXN0SW5kZXggPSBzdG9yZVJldmlld3MuaW5kZXgoJ3Jlc3RhdXJhbnRfaWQnKTtcclxuICAgICAgICAgIHJldHVybiByZXN0SW5kZXguZ2V0QWxsKHBhcnNlSW50KGlkKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXZpZXdzKSB7XHJcbiAgICAgICAgaWYgKHJldmlld3MubGVuZ3RoID09PSAwKSByZXR1cm47XHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmV2aWV3cyk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgLyogRmV0Y2ggcmV2aWV3cyBmcm9tIG5ldHdvcmsgKi9cclxuICAgICAgZmV0Y2goYCR7REJIZWxwZXIuUkVWSUVXU19VUkx9JHtpZH1gKVxyXG4gICAgICAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4gcmVzcG9uc2UuanNvbigpKVxyXG4gICAgICAgICAgICAgLnRoZW4ocmV2aWV3cyA9PiB7XHJcblxyXG4gICAgICAgICAgICAgICAgLyogQWRkIHJldmlld3MgdG8gaW5kZXhlZERCICovXHJcbiAgICAgICAgICAgICAgICBEQkhlbHBlci5vcGVuRGF0YWJhc2UoKS50aGVuKGZ1bmN0aW9uIChkYikge1xyXG4gICAgICAgICAgICAgICAgICBpZiAoIWRiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCB0eCA9IGRiLnRyYW5zYWN0aW9uKCdyZXZpZXdzJywgJ3JlYWR3cml0ZScpO1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBzdG9yZVJldmlld3MgPSB0eC5vYmplY3RTdG9yZSgncmV2aWV3cycpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXZpZXdzLmZvckVhY2goZnVuY3Rpb24gKHJldmlldykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgc3RvcmVSZXZpZXdzLnB1dChyZXZpZXcpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHguY29tcGxldGU7XHJcbiAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHJldmlld3MpO1xyXG4gICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4gY2FsbGJhY2soYFJlcXVlc3QgZmFpbGVkLiBSZXR1cm5lZCAke2Vycm9yfWAsIG51bGwpKTtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgZmV0Y2hUbXBSZXZpZXdzKGlkLCBjYWxsYmFjaykge1xyXG5cclxuICAgICAgLy8gZ2V0IHJldmlld3MgZnJvbSBpbmRleGVkREJcclxuICAgICAgREJIZWxwZXIub3BlbkRhdGFiYXNlKCkudGhlbihmdW5jdGlvbiAoZGIpIHtcclxuICAgICAgICBpZiAoIWRiKSB7XHJcbiAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfSAgZWxzZSB7XHJcbiAgICAgICAgICBsZXQgc3RvcmVSZXZpZXdzID0gZGIudHJhbnNhY3Rpb24oJ3N5bmMtcmV2aWV3cycsICdyZWFkb25seScpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAub2JqZWN0U3RvcmUoJ3N5bmMtcmV2aWV3cycpO1xyXG4gICAgICAgICAgbGV0IHJlc3RJbmRleCA9IHN0b3JlUmV2aWV3cy5pbmRleCgncmVzdGF1cmFudF9pZCcpO1xyXG4gICAgICAgICAgcmV0dXJuIHJlc3RJbmRleC5nZXRBbGwocGFyc2VJbnQoaWQpKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJldmlld3MpIHtcclxuICAgICAgICBpZiAocmV2aWV3cy5sZW5ndGggPT09IDApIHJldHVybjtcclxuICAgICAgICBjYWxsYmFjayhudWxsLCByZXZpZXdzKTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBQb3N0IHJldmlld3MgdG8gREJcclxuICAgICAqL1xyXG4gICAgc3RhdGljIHBvc3RSZXZpZXcocmV2aWV3KSB7XHJcbiAgICAgIHJldHVybiBEQkhlbHBlci5vcGVuRGF0YWJhc2UoKS50aGVuKGZ1bmN0aW9uIChkYikge1xyXG4gICAgICAgIGlmICghZGIpIHtcclxuICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgbGV0IHR4ID0gZGIudHJhbnNhY3Rpb24oJ3N5bmMtcmV2aWV3cycsICdyZWFkd3JpdGUnKTtcclxuICAgICAgICAgIGxldCBzdG9yZVJldmlld3MgPSB0eC5vYmplY3RTdG9yZSgnc3luYy1yZXZpZXdzJyk7XHJcblxyXG4gICAgICAgICAgc3RvcmVSZXZpZXdzLnB1dChyZXZpZXcpO1xyXG4gICAgICAgICAgcmV0dXJuIHR4LmNvbXBsZXRlO1xyXG4gICAgICAgIH1cclxuICAgICAgfSkudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xyXG4gICAgICB9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coZXJyKTtcclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXN0YXVyYW50IHBhZ2UgVVJMLlxyXG4gICAqL1xyXG4gIHN0YXRpYyB1cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcclxuICAgIHJldHVybiAoYC4vcmVzdGF1cmFudC5odG1sP2lkPSR7cmVzdGF1cmFudC5pZH1gKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlc3RhdXJhbnQgaW1hZ2UgVVJMLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBpbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xyXG4gICAgcmV0dXJuIChgL2ltZy8ke3Jlc3RhdXJhbnQucGhvdG9ncmFwaH0ud2VicGApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAqIFJlc3RhdXJhbnQgcmVzcG9uc2l2ZSBpbWFnZXMgc291cmNlIHNldC5cclxuICovXHJcbnN0YXRpYyBpbWFnZVJlc3BvbnNpdmVVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcclxuICAgIGNvbnN0IHNjYWxlMXggPSAnMzIwJztcclxuICAgIGNvbnN0IHNjYWxlMV81eCA9ICc0ODAnO1xyXG4gICAgY29uc3Qgc2NhbGUyeCA9ICc2NDAnO1xyXG4gICAgY29uc3Qgc2NhbGUzeCA9ICc4MDAnO1xyXG5cclxuICAgIHJldHVybiAoXHJcbiAgICAgICAgYC9pbWdfcmVzcG9uc2l2ZS8ke3Jlc3RhdXJhbnQuaWR9LSR7c2NhbGUxeH0ud2VicCAke3NjYWxlMXh9dyxcclxuICAgICAgICAvaW1nX3Jlc3BvbnNpdmUvJHtyZXN0YXVyYW50LmlkfS0ke3NjYWxlMV81eH0ud2VicCAke3NjYWxlMV81eH13LFxyXG4gICAgICAgIC9pbWdfcmVzcG9uc2l2ZS8ke3Jlc3RhdXJhbnQuaWR9LSR7c2NhbGUyeH0ud2VicCAke3NjYWxlMnh9dyxcclxuICAgICAgICAvaW1nX3Jlc3BvbnNpdmUvJHtyZXN0YXVyYW50LmlkfS0ke3NjYWxlM3h9LndlYnAgJHtzY2FsZTN4fXdgKTtcclxufVxyXG5cclxuICAvKipcclxuICAgKiBNYXAgbWFya2VyIGZvciBhIHJlc3RhdXJhbnQuXHJcbiAgICovXHJcbiAgc3RhdGljIG1hcE1hcmtlckZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgbWFwKSB7XHJcbiAgICBjb25zdCBtYXJrZXIgPSBuZXcgZ29vZ2xlLm1hcHMuTWFya2VyKHtcclxuICAgICAgcG9zaXRpb246IHJlc3RhdXJhbnQubGF0bG5nLFxyXG4gICAgICB0aXRsZTogcmVzdGF1cmFudC5uYW1lLFxyXG4gICAgICB1cmw6IERCSGVscGVyLnVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCksXHJcbiAgICAgIG1hcDogbWFwLFxyXG4gICAgICBhbmltYXRpb246IGdvb2dsZS5tYXBzLkFuaW1hdGlvbi5EUk9QLFxyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gbWFya2VyO1xyXG4gIH1cclxuXHJcbn1cclxuIiwibGV0IHJlc3RhdXJhbnRzLFxyXG4gIG5laWdoYm9yaG9vZHMsXHJcbiAgY3Vpc2luZXNcclxudmFyIG1hcFxyXG52YXIgbWFya2VycyA9IFtdXHJcblxyXG5sZXQgb2JzZXJ2ZXIgPSBuZXcgSW50ZXJzZWN0aW9uT2JzZXJ2ZXIoY2hhbmdlcyA9PiB7XHJcbiAgZm9yIChjb25zdCBjaGFuZ2Ugb2YgY2hhbmdlcykge1xyXG4gICAgaWYgKGNoYW5nZS5pbnRlcnNlY2lvblJhdGlvbiA+PSAwLjkpIHtcclxuICAgICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIGRhdGEpID0+IHtcclxuICAgICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBmaWxsUmVzdGF1cmFudEhUTUwoZGF0YSlcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH1cclxufSxcclxuICB7XHJcbiAgICB0aHJlc2hvbGQ6IFswLjldXHJcbiAgfVxyXG4pO1xyXG5cclxub2JzZXJ2ZXIub2JzZXJ2ZShkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudHMtbGlzdCcpKTtcclxuXHJcbi8qXHJcblNldHRpbmcgcGhvdG9ncmFwaHMgYWx0cyovXHJcblxyXG5jb25zdCBwaG90b2dyYXBoQWx0cyA9IHtcclxuXHQxOiBcIlNlcmV2YWwgZ3JvdXBzIG9mIHBlb3BsZSBoYXZpbmcgcXVhbGl0eSB0aW1lIGF0IGEgcmVzdGF1cmFudC5cIixcclxuXHQyOiBcIkEgbG92ZWx5IG1hcmdlcml0dGEgcGl6emFcIixcclxuXHQzOiBcIkFuIGVtcHR5IHJlc3RhdXJhbnQgc2V0dGluZyB3aGljaCBoYXMgaGVhdGVyc1wiLFxyXG5cdDQ6IFwiQSBjb3JuZXIgc2hvdCBvZiB0aGUgb3V0c2lkZSBvZiB0aGUgcmVzdGF1cmF0LlwiLFxyXG5cdDU6IFwiQSBjcm93ZGVkIHJlc3RhdXJhbnQgYW5kIHN0YWZmIHNlcnZpbmcgZm9vZCBmcm9tIGJlaGluZCB0aGUgYmFyLlwiLFxyXG5cdDY6IFwiUmVzdGF1cmFudCB3aXRoIHdvb2RlbiB0YWJsZXMsIGNoYXJpcywgYW5kIGEgVVMgZmxhZyBhcyBhIHdhbGwgZGVjb3JhdGlvblwiLFxyXG5cdDc6IFwiYSBkb2cgd2F0Y2hpbmcgZnJvbSB0aGUgb3V0c2lkZSBvZiBhIGNyb3dkZWQgYnVyZ2VyIHNob3AsIGFjY29tcGFuaWVkIGJ5IHR3byBtZW4uXCIsXHJcblx0ODogXCJDbG9zZSB1cCBvZiB0aGUgZHV0Y2ggcmVzdGF1cmFudCBsb2dvIGJlc2lkZSBhIGZsb3dlcmluZyB0cmVlXCIsXHJcblx0OTogXCJCbGFjayBhbmQgd2hpdGUgcGljdHVyZSBvZiBwZW9wbGUgZWF0aW5nIGF0IGFuIGFzaWFuIHJlc3RhdXJhdC5cIixcclxuXHQxMDogXCJFbXB0eSByZXN0YXVyYW50J3Mgd2hpdGUgY2hhaXJzLCB3YWxscyBhbmQgY2VpbGluZ3MuXCJcclxufTtcclxuXHJcblxyXG5cclxuLyoqXHJcbiAqIEZldGNoIG5laWdoYm9yaG9vZHMgYW5kIGN1aXNpbmVzIGFzIHNvb24gYXMgdGhlIHBhZ2UgaXMgbG9hZGVkLlxyXG4gKi9cclxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIChldmVudCkgPT4ge1xyXG4gIGZldGNoTmVpZ2hib3Job29kcygpO1xyXG4gIGZldGNoQ3Vpc2luZXMoKTtcclxufSk7XHJcblxyXG4vKipcclxuICogRmV0Y2ggYWxsIG5laWdoYm9yaG9vZHMgYW5kIHNldCB0aGVpciBIVE1MLlxyXG4gKi9cclxuZmV0Y2hOZWlnaGJvcmhvb2RzID0gKCkgPT4ge1xyXG4gIERCSGVscGVyLmZldGNoTmVpZ2hib3Job29kcygoZXJyb3IsIG5laWdoYm9yaG9vZHMpID0+IHtcclxuICAgIGlmIChlcnJvcikgeyAvLyBHb3QgYW4gZXJyb3JcclxuICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBzZWxmLm5laWdoYm9yaG9vZHMgPSBuZWlnaGJvcmhvb2RzO1xyXG4gICAgICBmaWxsTmVpZ2hib3Job29kc0hUTUwoKTtcclxuICAgIH1cclxuICB9KTtcclxufVxyXG5cclxuLyoqXHJcbiAqIFNldCBuZWlnaGJvcmhvb2RzIEhUTUwuXHJcbiAqL1xyXG5maWxsTmVpZ2hib3Job29kc0hUTUwgPSAobmVpZ2hib3Job29kcyA9IHNlbGYubmVpZ2hib3Job29kcykgPT4ge1xyXG4gIGNvbnN0IHNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduZWlnaGJvcmhvb2RzLXNlbGVjdCcpO1xyXG4gIG5laWdoYm9yaG9vZHMuZm9yRWFjaChuZWlnaGJvcmhvb2QgPT4ge1xyXG4gICAgY29uc3Qgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7XHJcbiAgICBvcHRpb24uaW5uZXJIVE1MID0gbmVpZ2hib3Job29kO1xyXG4gICAgb3B0aW9uLnZhbHVlID0gbmVpZ2hib3Job29kO1xyXG4gICAgc2VsZWN0LmFwcGVuZChvcHRpb24pO1xyXG4gIH0pO1xyXG59XHJcblxyXG4vKipcclxuICogRmV0Y2ggYWxsIGN1aXNpbmVzIGFuZCBzZXQgdGhlaXIgSFRNTC5cclxuICovXHJcbmZldGNoQ3Vpc2luZXMgPSAoKSA9PiB7XHJcbiAgREJIZWxwZXIuZmV0Y2hDdWlzaW5lcygoZXJyb3IsIGN1aXNpbmVzKSA9PiB7XHJcbiAgICBpZiAoZXJyb3IpIHsgLy8gR290IGFuIGVycm9yIVxyXG4gICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHNlbGYuY3Vpc2luZXMgPSBjdWlzaW5lcztcclxuICAgICAgZmlsbEN1aXNpbmVzSFRNTCgpO1xyXG4gICAgfVxyXG4gIH0pO1xyXG59XHJcblxyXG4vKipcclxuICogU2V0IGN1aXNpbmVzIEhUTUwuXHJcbiAqL1xyXG5maWxsQ3Vpc2luZXNIVE1MID0gKGN1aXNpbmVzID0gc2VsZi5jdWlzaW5lcykgPT4ge1xyXG4gIGNvbnN0IHNlbGVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjdWlzaW5lcy1zZWxlY3QnKTtcclxuXHJcbiAgY3Vpc2luZXMuZm9yRWFjaChjdWlzaW5lID0+IHtcclxuICAgIGNvbnN0IG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpO1xyXG4gICAgb3B0aW9uLmlubmVySFRNTCA9IGN1aXNpbmU7XHJcbiAgICBvcHRpb24udmFsdWUgPSBjdWlzaW5lO1xyXG4gICAgc2VsZWN0LmFwcGVuZChvcHRpb24pO1xyXG4gIH0pO1xyXG59XHJcblxyXG4vKipcclxuICogSW5pdGlhbGl6ZSBHb29nbGUgbWFwLCBjYWxsZWQgZnJvbSBIVE1MLlxyXG4gKi9cclxuIHdpbmRvdy5pbml0TWFwID0gKCkgPT4ge1xyXG4gIGxldCBsb2MgPSB7XHJcbiAgICBsYXQ6IDQwLjcyMjIxNixcclxuICAgIGxuZzogLTczLjk4NzUwMVxyXG4gIH07XHJcbiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcCcpO1xyXG4gIHNlbGYubWFwID0gbmV3IGdvb2dsZS5tYXBzLk1hcChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFwJyksIHtcclxuICAgIHpvb206IDEyLFxyXG4gICAgY2VudGVyOiBsb2MsXHJcbiAgICBzY3JvbGx3aGVlbDogZmFsc2VcclxuICB9KTtcclxuXHJcbiAgdXBkYXRlUmVzdGF1cmFudHMoKTtcclxufVxyXG5cclxuLyoqXHJcblNob3cgbWFwIGJ1dHRvblxyXG4qL1xyXG5jYWxsTWFwID1cclxuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcFRvZ2dsZScpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oZXZlbnQpIHtcclxuICBpZiAoKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAtY29udGFpbmVyJykuc3R5bGUuZGlzcGxheSkgPT09ICdibG9jaycpIHtcclxuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAtY29udGFpbmVyJykuc3R5bGUuZGlzcGxheSA9ICdub25lJztcclxuICAgIHdpbmRvdy5pbml0TWFwKCk7XHJcbiAgfSBlbHNlIHtcclxuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAtY29udGFpbmVyJykuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7XHJcbiAgfVxyXG59KTtcclxuLyoqXHJcbiAqIFVwZGF0ZSBwYWdlIGFuZCBtYXAgZm9yIGN1cnJlbnQgcmVzdGF1cmFudHMuXHJcbiAqL1xyXG51cGRhdGVSZXN0YXVyYW50cyA9ICgpID0+IHtcclxuICBjb25zdCBjU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2N1aXNpbmVzLXNlbGVjdCcpO1xyXG4gIGNvbnN0IG5TZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmVpZ2hib3Job29kcy1zZWxlY3QnKTtcclxuXHJcbiAgY29uc3QgY0luZGV4ID0gY1NlbGVjdC5zZWxlY3RlZEluZGV4O1xyXG4gIGNvbnN0IG5JbmRleCA9IG5TZWxlY3Quc2VsZWN0ZWRJbmRleDtcclxuXHJcbiAgY29uc3QgY3Vpc2luZSA9IGNTZWxlY3RbY0luZGV4XS52YWx1ZTtcclxuICBjb25zdCBuZWlnaGJvcmhvb2QgPSBuU2VsZWN0W25JbmRleF0udmFsdWU7XHJcblxyXG4gIERCSGVscGVyLmZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZChjdWlzaW5lLCBuZWlnaGJvcmhvb2QsIChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcclxuICAgIGlmIChlcnJvcikgeyAvLyBHb3QgYW4gZXJyb3IhXHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmVzZXRSZXN0YXVyYW50cyhyZXN0YXVyYW50cyk7XHJcbiAgICAgIGZpbGxSZXN0YXVyYW50c0hUTUwoKTtcclxuICAgIH1cclxuICB9KVxyXG59XHJcblxyXG4vKipcclxuICogQ2xlYXIgY3VycmVudCByZXN0YXVyYW50cywgdGhlaXIgSFRNTCBhbmQgcmVtb3ZlIHRoZWlyIG1hcCBtYXJrZXJzLlxyXG4gKi9cclxucmVzZXRSZXN0YXVyYW50cyA9IChyZXN0YXVyYW50cykgPT4ge1xyXG4gIC8vIFJlbW92ZSBhbGwgcmVzdGF1cmFudHNcclxuICBzZWxmLnJlc3RhdXJhbnRzID0gW107XHJcbiAgY29uc3QgdWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudHMtbGlzdCcpO1xyXG4gIHVsLmlubmVySFRNTCA9ICcnO1xyXG5cclxuICAvLyBSZW1vdmUgYWxsIG1hcCBtYXJrZXJzXHJcbiAgc2VsZi5tYXJrZXJzLmZvckVhY2gobSA9PiBtLnNldE1hcChudWxsKSk7XHJcbiAgc2VsZi5tYXJrZXJzID0gW107XHJcbiAgc2VsZi5yZXN0YXVyYW50cyA9IHJlc3RhdXJhbnRzO1xyXG59XHJcblxyXG4vKipcclxuICogQ3JlYXRlIGFsbCByZXN0YXVyYW50cyBIVE1MIGFuZCBhZGQgdGhlbSB0byB0aGUgd2VicGFnZS5cclxuICovXHJcbmZpbGxSZXN0YXVyYW50c0hUTUwgPSAocmVzdGF1cmFudHMgPSBzZWxmLnJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgY29uc3QgdWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudHMtbGlzdCcpO1xyXG4gIHJlc3RhdXJhbnRzLmZvckVhY2gocmVzdGF1cmFudCA9PiB7XHJcbiAgICB1bC5hcHBlbmQoY3JlYXRlUmVzdGF1cmFudEhUTUwocmVzdGF1cmFudCkpO1xyXG4gIH0pO1xyXG4gIGFkZE1hcmtlcnNUb01hcCgpO1xyXG59XHJcblxyXG4vKipcclxuICogQ3JlYXRlIHJlc3RhdXJhbnQgSFRNTC5cclxuICovXHJcbmNyZWF0ZVJlc3RhdXJhbnRIVE1MID0gKHJlc3RhdXJhbnQpID0+IHtcclxuICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XHJcbiAgbGkudGFiSW5kZXggPScwJztcclxuXHJcbiAgY29uc3QgaW1hZ2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTtcclxuICBpbWFnZS5jbGFzc05hbWUgPSAncmVzdGF1cmFudC1pbWcnO1xyXG4gIGltYWdlLnNyYyA9IERCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KTtcclxuICBpbWFnZS5zcmNzZXQgPSBEQkhlbHBlci5pbWFnZVJlc3BvbnNpdmVVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpO1xyXG4gIGltYWdlLmFsdCA9IHBob3RvZ3JhcGhBbHRzW3Jlc3RhdXJhbnQuaWRdO1xyXG4gIGxpLmFwcGVuZChpbWFnZSk7XHJcblxyXG4gIGNvbnN0IG5hbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdoMicpO1xyXG4gIG5hbWUuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xyXG4gIGxpLmFwcGVuZChuYW1lKTtcclxuXHJcbiAgY29uc3QgbmVpZ2hib3Job29kID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xyXG4gIG5laWdoYm9yaG9vZC5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5laWdoYm9yaG9vZDtcclxuICBsaS5hcHBlbmQobmVpZ2hib3Job29kKTtcclxuXHJcbiAgY29uc3QgYWRkcmVzcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcclxuICBhZGRyZXNzLmlubmVySFRNTCA9IHJlc3RhdXJhbnQuYWRkcmVzcztcclxuICBsaS5hcHBlbmQoYWRkcmVzcyk7XHJcblxyXG4gIGNvbnN0IG1vcmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7XHJcbiAgbW9yZS5pbm5lckhUTUwgPSAnVmlldyBEZXRhaWxzJztcclxuICBtb3JlLmhyZWYgPSBEQkhlbHBlci51cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpO1xyXG4gIGxpLmFwcGVuZChtb3JlKVxyXG5cclxuICByZXR1cm4gbGlcclxufVxyXG5cclxuLyoqXHJcbiAqIEFkZCBtYXJrZXJzIGZvciBjdXJyZW50IHJlc3RhdXJhbnRzIHRvIHRoZSBtYXAuXHJcbiAqL1xyXG5hZGRNYXJrZXJzVG9NYXAgPSAocmVzdGF1cmFudHMgPSBzZWxmLnJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgcmVzdGF1cmFudHMuZm9yRWFjaChyZXN0YXVyYW50ID0+IHtcclxuICAgIC8vIEFkZCBtYXJrZXIgdG8gdGhlIG1hcFxyXG4gICAgY29uc3QgbWFya2VyID0gREJIZWxwZXIubWFwTWFya2VyRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCBzZWxmLm1hcCk7XHJcbiAgICBnb29nbGUubWFwcy5ldmVudC5hZGRMaXN0ZW5lcihtYXJrZXIsICdjbGljaycsICgpID0+IHtcclxuICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSBtYXJrZXIudXJsXHJcbiAgICB9KTtcclxuICAgIHNlbGYubWFya2Vycy5wdXNoKG1hcmtlcik7XHJcbiAgfSk7XHJcbn1cclxuXHJcblxyXG5pZiAobmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIpIHtcclxuICBuYXZpZ2F0b3Iuc2VydmljZVdvcmtlci5yZWdpc3Rlcignc3cuanMnKVxyXG4gICAgLnRoZW4oKCkgPT4gY29uc29sZS5sb2coJ1Bhc3NlZCBUZXN0JykpXHJcbn07XHJcbiIsIlxyXG4vKipcclxuICogUmVnaXN0ZXIgYSBzZXJ2aWNlV29ya2VyXHJcbiAqL1xyXG5yZWdpc3RlclNlcnZpY2VXb3JrZXIgPSAoKSA9PiB7XHJcbiAgICAvL2NoZWNrIGlmIHNlcnZpY2VXb3JrZXIgaXMgc3VwcG9ydGVkLCBvdGhlcndpc2UgcmV0dXJuXHJcbiAgICBpZiAoIW5hdmlnYXRvci5zZXJ2aWNlV29ya2VyKSByZXR1cm47XHJcblxyXG4gICAgbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIucmVnaXN0ZXIoJy9zdy5qcycpLmNhdGNoKGZ1bmN0aW9uKCl7XHJcbiAgICAgIGNvbnNvbGUubG9nKFwiU29tZXRoaW5nIHdlbnQgd3JvbmcuIFNlcnZpY2VXb3JrZXIgbm90IHJlZ2lzdGVyZWRcIik7XHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICByZWdpc3RlclNlcnZpY2VXb3JrZXIoKTtcclxuIl19
