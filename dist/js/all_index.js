class DBHelper{static get DATABASE_URL(){return"http://localhost:1337"}static get RESTAURANT_URL(){return"http://localhost:1337/restaurants"}static get REVIEWS_URL(){return"http://localhost:1337/reviews/?restaurant_id="}static openDatabase(){return navigator.serviceWorker?idb.open("restaurants-db",1,function(e){e.createObjectStore("restaurants",{keyPath:"id"}).createIndex("rest-id","id"),e.createObjectStore("reviews",{keyPath:"id",autoIncrement:!0}).createIndex("restaurant_id","restaurant_id",{unique:!1}),e.createObjectStore("sync-reviews",{keyPath:"id",autoIncrement:!0}).createIndex("restaurant_id","restaurant_id",{unique:!1})}):(console.log("Browser doesn't support Service Workers"),Promise.resolve())}static fetchRestaurants(e){DBHelper.openDatabase().then(function(e){return e?e.transaction("restaurants","readwrite").objectStore("restaurants").getAll():void 0}).then(function(t){0!==t.length&&e(null,t)}),fetch(DBHelper.RESTAURANT_URL).then(function(t){200===t.status?t.json().then(function(t){DBHelper.openDatabase().then(function(e){if(e){let r=e.transaction("restaurants","readwrite"),n=r.objectStore("restaurants");return t.forEach(function(e){n.put(e)}),r.complete}}),e(null,t)}):console.log("Fetch Issue - Status Code: "+t.status)}).catch(function(e){console.log("Fetch Error: ",e)})}static fetchRestaurantById(e,t){DBHelper.fetchRestaurants((r,n)=>{if(r)t(r,null);else{const r=n.find(t=>t.id==e);r?t(null,r):t("Restaurant does not exist",null)}})}static fetchRestaurantByCuisine(e,t){DBHelper.fetchRestaurants((r,n)=>{if(r)t(r,null);else{const r=n.filter(t=>t.cuisine_type==e);t(null,r)}})}static fetchRestaurantByNeighborhood(e,t){DBHelper.fetchRestaurants((r,n)=>{if(r)t(r,null);else{const r=n.filter(t=>t.neighborhood==e);t(null,r)}})}static fetchRestaurantByCuisineAndNeighborhood(e,t,r){DBHelper.fetchRestaurants((n,a)=>{if(n)r(n,null);else{let n=a;"all"!=e&&(n=n.filter(t=>t.cuisine_type==e)),"all"!=t&&(n=n.filter(e=>e.neighborhood==t)),r(null,n)}})}static fetchNeighborhoods(e){DBHelper.fetchRestaurants((t,r)=>{if(t)e(t,null);else{const t=r.map((e,t)=>r[t].neighborhood),n=t.filter((e,r)=>t.indexOf(e)==r);e(null,n)}})}static fetchCuisines(e){DBHelper.fetchRestaurants((t,r)=>{if(t)e(t,null);else{const t=r.map((e,t)=>r[t].cuisine_type),n=t.filter((e,r)=>t.indexOf(e)==r);e(null,n)}})}static fetchReviews(e,t){DBHelper.openDatabase().then(function(t){if(t){return t.transaction("reviews","readwrite").objectStore("reviews").index("restaurant_id").getAll(parseInt(e))}}).then(function(e){0!==e.length&&t(null,e)}),fetch(`${DBHelper.REVIEWS_URL}${e}`).then(e=>e.json()).then(e=>{DBHelper.openDatabase().then(function(t){if(t){let r=t.transaction("reviews","readwrite"),n=r.objectStore("reviews");return e.forEach(function(e){n.put(e)}),r.complete}}),t(null,e)}).catch(e=>t(`Request failed. Returned ${e}`,null))}static fetchOfflineReviews(e,t){DBHelper.openDatabase().then(function(t){if(t){return t.transaction("sync-reviews","readonly").objectStore("sync-reviews").index("restaurant_id").getAll(parseInt(e))}}).then(function(e){0!==e.length&&t(null,e)})}static postReview(e){return DBHelper.openDatabase().then(function(t){if(t){let r=t.transaction("sync-reviews","readwrite");return r.objectStore("sync-reviews").put(e),r.complete}}).then(function(){return Promise.resolve()}).catch(function(e){return console.log(e),Promise.resolve()})}static toggleFavorite(e,t){return DBHelper.openDatabase().then(function(e){if(e){return e.transaction("restaurants","readwrite").objectStore("restaurants").index("rest-id").openCursor()}}).then(function r(n){if(e=+e,n){if(n.value.id===e){var a=n.value;a.is_favorite=t,n.update(a).onsuccess=function(){}}return n.continue().then(r)}}).then(function(){fetch(`http://localhost:1337/restaurants/${e}/?is_favorite=${t}`,{method:"PUT"}).then(e=>e.json()).catch(e=>{console.log("Error fetching is_favorite: "+e)})}).then(function(){return Promise.resolve()})}static urlForRestaurant(e){return`./restaurant.html?id=${e.id}`}static imageUrlForRestaurant(e){return`/img/${e.photograph}.webp`}static imageResponsiveUrlForRestaurant(e){return`/img_responsive/${e.id}-320.webp 320w,\n        /img_responsive/${e.id}-480.webp 480w,\n        /img_responsive/${e.id}-640.webp 640w,\n        /img_responsive/${e.id}-800.webp 800w`}static mapMarkerForRestaurant(e,t){return new google.maps.Marker({position:e.latlng,title:e.name,url:DBHelper.urlForRestaurant(e),map:t,animation:google.maps.Animation.DROP})}}let restaurants,neighborhoods,cuisines,map;var markers=[];let observer=new IntersectionObserver(e=>{for(const t of e)t.intersecionRation>=.9&&DBHelper.fetchRestaurants((e,t)=>{e?console.error(e):(fillRestaurantsHTML(t),console.log("observer in action!"))})},{threshold:[.9]});observer.observe(document.getElementById("restaurants-list"));const photographAlts={1:"Sereval groups of people having quality time at a restaurant.",2:"A lovely margeritta pizza",3:"An empty restaurant setting which has heaters",4:"A corner shot of the outside of the restaurat.",5:"A crowded restaurant and staff serving food from behind the bar.",6:"Restaurant with wooden tables, charis, and a US flag as a wall decoration",7:"a dog watching from the outside of a crowded burger shop, accompanied by two men.",8:"Close up of the dutch restaurant logo beside a flowering tree",9:"Black and white picture of people eating at an asian restaurat.",10:"Empty restaurant's white chairs, walls and ceilings."};document.addEventListener("DOMContentLoaded",e=>{fetchNeighborhoods(),fetchCuisines(),updateRestaurants()}),fetchNeighborhoods=(()=>{DBHelper.fetchNeighborhoods((e,t)=>{e?console.error(e):(self.neighborhoods=t,fillNeighborhoodsHTML())})}),fillNeighborhoodsHTML=((e=self.neighborhoods)=>{const t=document.getElementById("neighborhoods-select");e.forEach(e=>{const r=document.createElement("option");r.innerHTML=e,r.value=e,t.append(r)})}),fetchCuisines=(()=>{DBHelper.fetchCuisines((e,t)=>{e?console.error(e):(self.cuisines=t,fillCuisinesHTML())})}),fillCuisinesHTML=((e=self.cuisines)=>{const t=document.getElementById("cuisines-select");e.forEach(e=>{const r=document.createElement("option");r.innerHTML=e,r.value=e,t.append(r)})}),window.initMap=(()=>{document.getElementById("map"),self.map=new google.maps.Map(document.getElementById("map"),{zoom:12,center:{lat:40.722216,lng:-73.987501},scrollwheel:!1}),updateRestaurants()}),document.getElementById("mapToggle").addEventListener("click",function(e){"block"===document.getElementById("map-container").style.display?(document.getElementById("map-container").style.display="none",window.initMap()):document.getElementById("map-container").style.display="block"}),updateRestaurants=(()=>{const e=document.getElementById("cuisines-select"),t=document.getElementById("neighborhoods-select"),r=e.selectedIndex,n=t.selectedIndex,a=e[r].value,s=t[n].value;DBHelper.fetchRestaurantByCuisineAndNeighborhood(a,s,(e,t)=>{e?console.error(e):(resetRestaurants(t),fillRestaurantsHTML())})}),resetRestaurants=(e=>{self.restaurants=[],document.getElementById("restaurants-list").innerHTML="",self.markers.forEach(e=>e.setMap(null)),self.markers=[],self.restaurants=e}),fillRestaurantsHTML=((e=self.restaurants)=>{const t=document.getElementById("restaurants-list");e.forEach(e=>{t.append(createRestaurantHTML(e))}),new LazyLoad({elements_selector:".js-lazy"}),addMarkersToMap()}),createRestaurantHTML=(e=>{const t=document.createElement("li");t.tabIndex="0";const r=document.createElement("img");r.dataset.src=DBHelper.imageUrlForRestaurant(e),r.dataset.srcset=DBHelper.imageResponsiveUrlForRestaurant(e),r.alt=photographAlts[e.id],r.className="restaurant-img js-lazy",t.append(r);const n=document.createElement("h2");n.innerHTML=e.name,t.append(n);const a=document.createElement("p");a.innerHTML=e.neighborhood,t.append(a);const s=document.createElement("p");s.innerHTML=e.address,t.append(s);const o=document.createElement("div");o.setAttribute("class","wrapper"),t.append(o);const i=document.createElement("a");i.innerHTML="View Details",i.href=DBHelper.urlForRestaurant(e),o.append(i);const l=document.createElement("i"),c="true"==e.is_favorite?"fas":"far";return l.setAttribute("id",`rest${e.id}`),l.setAttribute("class",`${c} fa-heart fa-2x`),l.setAttribute("tabindex","0"),l.setAttribute("role","button"),"true"==e.is_favorite?l.setAttribute("aria-label",`Unmark ${e.name} as favorite`):l.setAttribute("aria-label",`Mark ${e.name} as favorite`),l.addEventListener("click",()=>{const t=l.getAttribute("id");toggleFav(t,e.name)}),l.addEventListener("keydown",t=>{if(13===t.keyCode){const t=l.getAttribute("id");toggleFav(t,e.name)}}),o.append(l),t}),toggleFav=((e,t)=>{const r=document.getElementById(e),n=r.classList.contains("far");r.classList.toggle("far"),r.classList.toggle("fas"),n?r.setAttribute("aria-label",`Mark ${t} as favorite`):r.setAttribute("aria-label",`Unmark ${t} as favorite`),DBHelper.toggleFavorite(e.slice(4),n).then(()=>{setTimeout(function(){updateRestaurants()},200)})}),addMarkersToMap=((e=self.restaurants)=>{e.forEach(e=>{const t=DBHelper.mapMarkerForRestaurant(e,self.map);google.maps.event.addListener(t,"click",()=>{window.location.href=t.url}),self.markers.push(t)})}),navigator.serviceWorker&&navigator.serviceWorker.register("sw.js").then(()=>console.log("Passed Test")),registerServiceWorker=(()=>{navigator.serviceWorker&&navigator.serviceWorker.register("/sw.js").catch(function(){console.log("Something went wrong. ServiceWorker not registered")})}),registerServiceWorker();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRiaGVscGVyLmpzIiwibWFpbi5qcyIsInJlZ2lzdGVyU2VydmljZVdvcmtlci5qcyJdLCJuYW1lcyI6WyJEQkhlbHBlciIsIkRBVEFCQVNFX1VSTCIsIlJFU1RBVVJBTlRfVVJMIiwiUkVWSUVXU19VUkwiLCJbb2JqZWN0IE9iamVjdF0iLCJuYXZpZ2F0b3IiLCJzZXJ2aWNlV29ya2VyIiwiaWRiIiwib3BlbiIsInVwZ3JhZGVEYiIsImNyZWF0ZU9iamVjdFN0b3JlIiwia2V5UGF0aCIsImNyZWF0ZUluZGV4IiwiYXV0b0luY3JlbWVudCIsInVuaXF1ZSIsImNvbnNvbGUiLCJsb2ciLCJQcm9taXNlIiwicmVzb2x2ZSIsImNhbGxiYWNrIiwib3BlbkRhdGFiYXNlIiwidGhlbiIsImRiIiwidHJhbnNhY3Rpb24iLCJvYmplY3RTdG9yZSIsImdldEFsbCIsInJlc3RhdXJhbnRzIiwibGVuZ3RoIiwiZmV0Y2giLCJyZXNwb25zZSIsInN0YXR1cyIsImpzb24iLCJ0eCIsInN0b3JlUmVzdGF1cmFudHMiLCJmb3JFYWNoIiwicmVzdGF1cmFudCIsInB1dCIsImNvbXBsZXRlIiwiY2F0Y2giLCJlcnIiLCJpZCIsImZldGNoUmVzdGF1cmFudHMiLCJlcnJvciIsImZpbmQiLCJyIiwiY3Vpc2luZSIsInJlc3VsdHMiLCJmaWx0ZXIiLCJjdWlzaW5lX3R5cGUiLCJuZWlnaGJvcmhvb2QiLCJuZWlnaGJvcmhvb2RzIiwibWFwIiwidiIsImkiLCJ1bmlxdWVOZWlnaGJvcmhvb2RzIiwiaW5kZXhPZiIsImN1aXNpbmVzIiwidW5pcXVlQ3Vpc2luZXMiLCJpbmRleCIsInBhcnNlSW50IiwicmV2aWV3cyIsInN0b3JlUmV2aWV3cyIsInJldmlldyIsInJlc3RhdXJhbnRJZCIsInRvZ2dsZVZhbHVlIiwib3BlbkN1cnNvciIsInVwZGF0ZUZhdm9yaXRlIiwiY3Vyc29yIiwidmFsdWUiLCJ1cGRhdGVEYXRhIiwiaXNfZmF2b3JpdGUiLCJ1cGRhdGUiLCJvbnN1Y2Nlc3MiLCJjb250aW51ZSIsIm1ldGhvZCIsInBob3RvZ3JhcGgiLCJnb29nbGUiLCJtYXBzIiwiTWFya2VyIiwicG9zaXRpb24iLCJsYXRsbmciLCJ0aXRsZSIsIm5hbWUiLCJ1cmwiLCJ1cmxGb3JSZXN0YXVyYW50IiwiYW5pbWF0aW9uIiwiQW5pbWF0aW9uIiwiRFJPUCIsIm1hcmtlcnMiLCJvYnNlcnZlciIsIkludGVyc2VjdGlvbk9ic2VydmVyIiwiY2hhbmdlcyIsImNoYW5nZSIsImludGVyc2VjaW9uUmF0aW9uIiwiZGF0YSIsImZpbGxSZXN0YXVyYW50c0hUTUwiLCJ0aHJlc2hvbGQiLCJvYnNlcnZlIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsInBob3RvZ3JhcGhBbHRzIiwiMSIsIjIiLCIzIiwiNCIsIjUiLCI2IiwiNyIsIjgiLCI5IiwiMTAiLCJhZGRFdmVudExpc3RlbmVyIiwiZXZlbnQiLCJmZXRjaE5laWdoYm9yaG9vZHMiLCJmZXRjaEN1aXNpbmVzIiwidXBkYXRlUmVzdGF1cmFudHMiLCJzZWxmIiwiZmlsbE5laWdoYm9yaG9vZHNIVE1MIiwic2VsZWN0Iiwib3B0aW9uIiwiY3JlYXRlRWxlbWVudCIsImlubmVySFRNTCIsImFwcGVuZCIsImZpbGxDdWlzaW5lc0hUTUwiLCJ3aW5kb3ciLCJpbml0TWFwIiwiTWFwIiwiem9vbSIsImNlbnRlciIsImxhdCIsImxuZyIsInNjcm9sbHdoZWVsIiwic3R5bGUiLCJkaXNwbGF5IiwiY1NlbGVjdCIsIm5TZWxlY3QiLCJjSW5kZXgiLCJzZWxlY3RlZEluZGV4IiwibkluZGV4IiwiZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lQW5kTmVpZ2hib3Job29kIiwicmVzZXRSZXN0YXVyYW50cyIsIm0iLCJzZXRNYXAiLCJ1bCIsImNyZWF0ZVJlc3RhdXJhbnRIVE1MIiwiTGF6eUxvYWQiLCJlbGVtZW50c19zZWxlY3RvciIsImFkZE1hcmtlcnNUb01hcCIsImxpIiwidGFiSW5kZXgiLCJpbWFnZSIsImRhdGFzZXQiLCJzcmMiLCJpbWFnZVVybEZvclJlc3RhdXJhbnQiLCJzcmNzZXQiLCJpbWFnZVJlc3BvbnNpdmVVcmxGb3JSZXN0YXVyYW50IiwiYWx0IiwiY2xhc3NOYW1lIiwiYWRkcmVzcyIsIndyYXBwZXIiLCJzZXRBdHRyaWJ1dGUiLCJtb3JlIiwiaHJlZiIsImZhdm9yaXRlIiwiaXNGYXZvcml0ZSIsInJlc3RJZCIsImdldEF0dHJpYnV0ZSIsInRvZ2dsZUZhdiIsImUiLCJrZXlDb2RlIiwicmVzdE5hbWUiLCJlbGVtZW50Iiwic2V0VG9nZ2xlIiwiY2xhc3NMaXN0IiwiY29udGFpbnMiLCJ0b2dnbGUiLCJ0b2dnbGVGYXZvcml0ZSIsInNsaWNlIiwic2V0VGltZW91dCIsIm1hcmtlciIsIm1hcE1hcmtlckZvclJlc3RhdXJhbnQiLCJhZGRMaXN0ZW5lciIsImxvY2F0aW9uIiwicHVzaCIsInJlZ2lzdGVyIiwicmVnaXN0ZXJTZXJ2aWNlV29ya2VyIl0sIm1hcHBpbmdzIjoiTUFHTUEsU0FNSkMsMEJBRUUsTUFBUSx3QkFFVkMsNEJBRUEsTUFBUSxvQ0FHVkMseUJBRUUsTUFBUSxnREFNVkMsc0JBSUUsT0FBS0MsVUFBVUMsY0FLUkMsSUFBSUMsS0FBSyxpQkFBa0IsRUFBRyxTQUFVQyxHQUN0QkEsRUFBVUMsa0JBQWtCLGVBQ2pEQyxRQUFTLE9BRU1DLFlBQVksVUFBVyxNQUNyQkgsRUFBVUMsa0JBQWtCLFdBQzdDQyxRQUFTLEtBQ1RFLGVBQWUsSUFFSkQsWUFBWSxnQkFDQSxpQkFDRUUsUUFBUSxJQUNiTCxFQUFVQyxrQkFBa0IsZ0JBQ2hEQyxRQUFTLEtBQ1RFLGVBQWUsSUFFREQsWUFBWSxnQkFDSCxpQkFDRUUsUUFBUSxPQXRCbkNDLFFBQVFDLElBQUssMkNBQ05DLFFBQVFDLFdBOEJqQmQsd0JBQXdCZSxHQUd0Qm5CLFNBQVNvQixlQUFlQyxLQUFLLFNBQVVDLEdBQ3JDLE9BQUtBLEVBR0lBLEVBQUdDLFlBQVksY0FBZSxhQUMzQkMsWUFBWSxlQUNaQyxjQUpWLElBTURKLEtBQUssU0FBVUssR0FDVyxJQUF2QkEsRUFBWUMsUUFDaEJS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L0JpRixFQUFTcEQsaUJBQWlCLFVBQVl5RCxJQUNwQyxHQUFrQixLQUFkQSxFQUFFQyxRQUFnQixDQUNwQixNQUFNSixFQUFTRixFQUFTRyxhQUFhLE1BQ3JDQyxVQUFVRixFQUFRbEksRUFBVytDLFNBR2pDNkUsRUFBUXJDLE9BQU95QyxHQUVSZixJQUdSbUIsVUFBWSxFQUFDRixFQUFRSyxLQUNwQixNQUFNQyxFQUFVekUsU0FBU0MsZUFBZWtFLEdBQ2xDTyxFQUFZRCxFQUFRRSxVQUFVQyxTQUFTLE9BQzdDSCxFQUFRRSxVQUFVRSxPQUFPLE9BQ3pCSixFQUFRRSxVQUFVRSxPQUFPLE9BQ3JCSCxFQUNGRCxFQUFRWCxhQUFhLHFCQUFzQlUsaUJBRTNDQyxFQUFRWCxhQUFhLHVCQUF3QlUsaUJBRy9DMUssU0FBU2dMLGVBQWVYLEVBQU9ZLE1BQU0sR0FBSUwsR0FBV3ZKLEtBQUssS0FDdkQ2SixXQUFXLFdBQ1QvRCxxQkFDQyxTQVFQZ0MsZ0JBQWtCLEVBQUN6SCxFQUFjMEYsS0FBSzFGLGVBQ3BDQSxFQUFZUSxRQUFRQyxJQUVsQixNQUFNZ0osRUFBU25MLFNBQVNvTCx1QkFBdUJqSixFQUFZaUYsS0FBS2pFLEtBQ2hFeUIsT0FBT0MsS0FBS21DLE1BQU1xRSxZQUFZRixFQUFRLFFBQVMsS0FDN0N2RCxPQUFPMEQsU0FBU3BCLEtBQU9pQixFQUFPaEcsTUFFaENpQyxLQUFLNUIsUUFBUStGLEtBQUtKLE9BS2xCOUssVUFBVUMsZUFDWkQsVUFBVUMsY0FBY2tMLFNBQVMsU0FDOUJuSyxLQUFLLElBQU1OLFFBQVFDLElBQUksZ0JDNVI1QnlLLHNCQUF3QixNQUVmcEwsVUFBVUMsZUFFZkQsVUFBVUMsY0FBY2tMLFNBQVMsVUFBVWxKLE1BQU0sV0FDL0N2QixRQUFRQyxJQUFJLDBEQUloQnlLIiwiZmlsZSI6ImFsbF9pbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBDb21tb24gZGF0YWJhc2UgaGVscGVyIGZ1bmN0aW9ucy5cclxuICovXHJcbmNsYXNzIERCSGVscGVyIHtcclxuXHJcbiAgLyoqXHJcbiAgICogRGF0YWJhc2UgVVJMLlxyXG4gICAqIENoYW5nZSB0aGlzIHRvIHJlc3RhdXJhbnRzLmpzb24gZmlsZSBsb2NhdGlvbiBvbiB5b3VyIHNlcnZlci5cclxuICAgKi9cclxuICBzdGF0aWMgZ2V0IERBVEFCQVNFX1VSTCgpIHtcclxuICAgIGNvbnN0IHBvcnQgPSAxMzM3O1xyXG4gICAgcmV0dXJuIGBodHRwOi8vbG9jYWxob3N0OiR7cG9ydH1gO1xyXG4gIH1cclxuICBzdGF0aWMgZ2V0IFJFU1RBVVJBTlRfVVJMKCkge1xyXG4gIGNvbnN0IHBvcnQgPSAxMzM3O1xyXG4gIHJldHVybiBgaHR0cDovL2xvY2FsaG9zdDoke3BvcnR9L3Jlc3RhdXJhbnRzYDtcclxufVxyXG5cclxuc3RhdGljIGdldCBSRVZJRVdTX1VSTCgpIHtcclxuICBjb25zdCBwb3J0ID0gMTMzNztcclxuICByZXR1cm4gYGh0dHA6Ly9sb2NhbGhvc3Q6JHtwb3J0fS9yZXZpZXdzLz9yZXN0YXVyYW50X2lkPWA7XHJcbn1cclxuXHJcbi8vIElEQiBjcmVhdGlvblxyXG5cclxuXHJcbnN0YXRpYyBvcGVuRGF0YWJhc2UgKCkge1xyXG5cclxuICAvLyBJZiB0aGUgYnJvd3NlciBkb2Vzbid0IHN1cHBvcnQgc2VydmljZSB3b3JrZXIsXHJcbiAgLy8gd2UgZG9uJ3QgY2FyZSBhYm91dCBoYXZpbmcgYSBkYXRhYmFzZVxyXG4gIGlmICghbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIpIHtcclxuICAgIGNvbnNvbGUubG9nKGBCcm93c2VyIGRvZXNuJ3Qgc3VwcG9ydCBTZXJ2aWNlIFdvcmtlcnNgKTtcclxuICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcclxuICB9XHJcblxyXG4gIHJldHVybiBpZGIub3BlbigncmVzdGF1cmFudHMtZGInLCAxLCBmdW5jdGlvbiAodXBncmFkZURiKSB7XHJcbiAgICB2YXIgc3RvcmVSZXN0YXVyYW50cyA9IHVwZ3JhZGVEYi5jcmVhdGVPYmplY3RTdG9yZSgncmVzdGF1cmFudHMnLCB7XHJcbiAgICAgIGtleVBhdGg6ICdpZCcsXHJcbiAgICB9KTtcclxuICAgIHN0b3JlUmVzdGF1cmFudHMuY3JlYXRlSW5kZXgoJ3Jlc3QtaWQnLCAnaWQnKTtcclxuICAgIHZhciBzdG9yZVJldmlld3MgPSB1cGdyYWRlRGIuY3JlYXRlT2JqZWN0U3RvcmUoJ3Jldmlld3MnLCB7XHJcbiAgICAgIGtleVBhdGg6ICdpZCcsXHJcbiAgICAgIGF1dG9JbmNyZW1lbnQ6IHRydWUsXHJcbiAgICB9KTtcclxuICAgIHN0b3JlUmV2aWV3cy5jcmVhdGVJbmRleCgncmVzdGF1cmFudF9pZCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3Jlc3RhdXJhbnRfaWQnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgdW5pcXVlOiBmYWxzZSB9KTtcclxuICAgIHZhciBzdG9yZVN5bmNSZXZpZXcgPSB1cGdyYWRlRGIuY3JlYXRlT2JqZWN0U3RvcmUoJ3N5bmMtcmV2aWV3cycsIHtcclxuICAgICAga2V5UGF0aDogJ2lkJyxcclxuICAgICAgYXV0b0luY3JlbWVudDogdHJ1ZSxcclxuICAgIH0pO1xyXG4gICAgc3RvcmVTeW5jUmV2aWV3LmNyZWF0ZUluZGV4KCdyZXN0YXVyYW50X2lkJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAncmVzdGF1cmFudF9pZCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeyB1bmlxdWU6IGZhbHNlIH0pO1xyXG4gIH0pO1xyXG59XHJcblxyXG5cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggYWxsIHJlc3RhdXJhbnRzLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRzKGNhbGxiYWNrKSB7XHJcblxyXG4gICAgLy8gZ2V0IHJlc3RhdXJhbnRzIGZyb20gaW5kZXhlZERCXHJcbiAgICBEQkhlbHBlci5vcGVuRGF0YWJhc2UoKS50aGVuKGZ1bmN0aW9uIChkYikge1xyXG4gICAgICBpZiAoIWRiKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9ICBlbHNlIHtcclxuICAgICAgICByZXR1cm4gZGIudHJhbnNhY3Rpb24oJ3Jlc3RhdXJhbnRzJywgJ3JlYWR3cml0ZScpXHJcbiAgICAgICAgICAgICAgICAgLm9iamVjdFN0b3JlKCdyZXN0YXVyYW50cycpXHJcbiAgICAgICAgICAgICAgICAgLmdldEFsbCgpO1xyXG4gICAgICB9XHJcbiAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXN0YXVyYW50cykge1xyXG4gICAgICBpZiAocmVzdGF1cmFudHMubGVuZ3RoID09PSAwKSByZXR1cm47XHJcbiAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3RhdXJhbnRzKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGZldGNoKERCSGVscGVyLlJFU1RBVVJBTlRfVVJMKVxyXG4gICAgLnRoZW4oXHJcbiAgICAgIGZ1bmN0aW9uIChyZXNwb25zZSkge1xyXG4gICAgICAgIGlmIChyZXNwb25zZS5zdGF0dXMgIT09IDIwMCkge1xyXG4gICAgICAgICAgY29uc29sZS5sb2coJ0ZldGNoIElzc3VlIC0gU3RhdHVzIENvZGU6ICcgKyByZXNwb25zZS5zdGF0dXMpO1xyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmVzcG9uc2UuanNvbigpLnRoZW4oZnVuY3Rpb24gKHJlc3RhdXJhbnRzKSB7XHJcblxyXG4gICAgICAgICAgLyogQWRkIHJlc3RhdXJhbnRzIHRvIGluZGV4ZWREQiAqL1xyXG4gICAgICAgICAgREJIZWxwZXIub3BlbkRhdGFiYXNlKCkudGhlbihmdW5jdGlvbiAoZGIpIHtcclxuICAgICAgICAgICAgaWYgKCFkYikge1xyXG4gICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICBsZXQgdHggPSBkYi50cmFuc2FjdGlvbigncmVzdGF1cmFudHMnLCAncmVhZHdyaXRlJyk7XHJcbiAgICAgICAgICAgICAgbGV0IHN0b3JlUmVzdGF1cmFudHMgPSB0eC5vYmplY3RTdG9yZSgncmVzdGF1cmFudHMnKTtcclxuXHJcbiAgICAgICAgICAgICAgcmVzdGF1cmFudHMuZm9yRWFjaChmdW5jdGlvbiAocmVzdGF1cmFudCkge1xyXG4gICAgICAgICAgICAgICAgc3RvcmVSZXN0YXVyYW50cy5wdXQocmVzdGF1cmFudCk7XHJcbiAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgIHJldHVybiB0eC5jb21wbGV0ZTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdGF1cmFudHMpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICApXHJcbiAgICAuY2F0Y2goZnVuY3Rpb24gKGVycikge1xyXG4gICAgICBjb25zb2xlLmxvZygnRmV0Y2ggRXJyb3I6ICcsIGVycik7XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIGEgcmVzdGF1cmFudCBieSBpdHMgSUQuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5SWQoaWQsIGNhbGxiYWNrKSB7XHJcbiAgICAvLyBmZXRjaCBhbGwgcmVzdGF1cmFudHMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcclxuICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNvbnN0IHJlc3RhdXJhbnQgPSByZXN0YXVyYW50cy5maW5kKHIgPT4gci5pZCA9PSBpZCk7XHJcbiAgICAgICAgaWYgKHJlc3RhdXJhbnQpIHsgLy8gR290IHRoZSByZXN0YXVyYW50XHJcbiAgICAgICAgICBjYWxsYmFjayhudWxsLCByZXN0YXVyYW50KTtcclxuICAgICAgICB9IGVsc2UgeyAvLyBSZXN0YXVyYW50IGRvZXMgbm90IGV4aXN0IGluIHRoZSBkYXRhYmFzZVxyXG4gICAgICAgICAgY2FsbGJhY2soJ1Jlc3RhdXJhbnQgZG9lcyBub3QgZXhpc3QnLCBudWxsKTtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBjdWlzaW5lIHR5cGUgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZShjdWlzaW5lLCBjYWxsYmFjaykge1xyXG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzICB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZ1xyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBGaWx0ZXIgcmVzdGF1cmFudHMgdG8gaGF2ZSBvbmx5IGdpdmVuIGN1aXNpbmUgdHlwZVxyXG4gICAgICAgIGNvbnN0IHJlc3VsdHMgPSByZXN0YXVyYW50cy5maWx0ZXIociA9PiByLmN1aXNpbmVfdHlwZSA9PSBjdWlzaW5lKTtcclxuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHRzKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIG5laWdoYm9yaG9vZCB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlOZWlnaGJvcmhvb2QobmVpZ2hib3Job29kLCBjYWxsYmFjaykge1xyXG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXHJcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcclxuICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIEZpbHRlciByZXN0YXVyYW50cyB0byBoYXZlIG9ubHkgZ2l2ZW4gbmVpZ2hib3Job29kXHJcbiAgICAgICAgY29uc3QgcmVzdWx0cyA9IHJlc3RhdXJhbnRzLmZpbHRlcihyID0+IHIubmVpZ2hib3Job29kID09IG5laWdoYm9yaG9vZCk7XHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0cyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBjdWlzaW5lIGFuZCBhIG5laWdoYm9yaG9vZCB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lQW5kTmVpZ2hib3Job29kKGN1aXNpbmUsIG5laWdoYm9yaG9vZCwgY2FsbGJhY2spIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBsZXQgcmVzdWx0cyA9IHJlc3RhdXJhbnRzO1xyXG4gICAgICAgIGlmIChjdWlzaW5lICE9ICdhbGwnKSB7IC8vIGZpbHRlciBieSBjdWlzaW5lXHJcbiAgICAgICAgICByZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIociA9PiByLmN1aXNpbmVfdHlwZSA9PSBjdWlzaW5lKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChuZWlnaGJvcmhvb2QgIT0gJ2FsbCcpIHsgLy8gZmlsdGVyIGJ5IG5laWdoYm9yaG9vZFxyXG4gICAgICAgICAgcmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKHIgPT4gci5uZWlnaGJvcmhvb2QgPT0gbmVpZ2hib3Job29kKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdHMpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIGFsbCBuZWlnaGJvcmhvb2RzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaE5laWdoYm9yaG9vZHMoY2FsbGJhY2spIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBHZXQgYWxsIG5laWdoYm9yaG9vZHMgZnJvbSBhbGwgcmVzdGF1cmFudHNcclxuICAgICAgICBjb25zdCBuZWlnaGJvcmhvb2RzID0gcmVzdGF1cmFudHMubWFwKCh2LCBpKSA9PiByZXN0YXVyYW50c1tpXS5uZWlnaGJvcmhvb2QpO1xyXG5cclxuICAgICAgICAvLyBSZW1vdmUgZHVwbGljYXRlcyBmcm9tIG5laWdoYm9yaG9vZHNcclxuICAgICAgICBjb25zdCB1bmlxdWVOZWlnaGJvcmhvb2RzID0gbmVpZ2hib3Job29kcy5maWx0ZXIoKHYsIGkpID0+IG5laWdoYm9yaG9vZHMuaW5kZXhPZih2KSA9PSBpKTtcclxuICAgICAgICBjYWxsYmFjayhudWxsLCB1bmlxdWVOZWlnaGJvcmhvb2RzKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCBhbGwgY3Vpc2luZXMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoQ3Vpc2luZXMoY2FsbGJhY2spIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBHZXQgYWxsIGN1aXNpbmVzIGZyb20gYWxsIHJlc3RhdXJhbnRzXHJcbiAgICAgICAgY29uc3QgY3Vpc2luZXMgPSByZXN0YXVyYW50cy5tYXAoKHYsIGkpID0+IHJlc3RhdXJhbnRzW2ldLmN1aXNpbmVfdHlwZSk7XHJcblxyXG4gICAgICAgIC8vIFJlbW92ZSBkdXBsaWNhdGVzIGZyb20gY3Vpc2luZXNcclxuICAgICAgICBjb25zdCB1bmlxdWVDdWlzaW5lcyA9IGN1aXNpbmVzLmZpbHRlcigodiwgaSkgPT4gY3Vpc2luZXMuaW5kZXhPZih2KSA9PSBpKTtcclxuICAgICAgICBjYWxsYmFjayhudWxsLCB1bmlxdWVDdWlzaW5lcyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICAgKiBGZXRjaCBhbGwgcmV2aWV3cy5cclxuICAgICAqL1xyXG4gICAgc3RhdGljIGZldGNoUmV2aWV3cyhpZCwgY2FsbGJhY2spIHtcclxuXHJcbiAgICAgIC8vIGdldCByZXZpZXdzIGZyb20gaW5kZXhlZERCXHJcbiAgICAgIERCSGVscGVyLm9wZW5EYXRhYmFzZSgpLnRoZW4oZnVuY3Rpb24gKGRiKSB7XHJcbiAgICAgICAgaWYgKCFkYikge1xyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH0gIGVsc2Uge1xyXG4gICAgICAgICAgbGV0IHN0b3JlUmV2aWV3cyA9IGRiLnRyYW5zYWN0aW9uKCdyZXZpZXdzJywgJ3JlYWR3cml0ZScpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAub2JqZWN0U3RvcmUoJ3Jldmlld3MnKTtcclxuICAgICAgICAgIGxldCByZXN0SW5kZXggPSBzdG9yZVJldmlld3MuaW5kZXgoJ3Jlc3RhdXJhbnRfaWQnKTtcclxuICAgICAgICAgIHJldHVybiByZXN0SW5kZXguZ2V0QWxsKHBhcnNlSW50KGlkKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXZpZXdzKSB7XHJcbiAgICAgICAgaWYgKHJldmlld3MubGVuZ3RoID09PSAwKSByZXR1cm47XHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmV2aWV3cyk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgLyogRmV0Y2ggcmV2aWV3cyBmcm9tIG5ldHdvcmsgKi9cclxuICAgICAgZmV0Y2goYCR7REJIZWxwZXIuUkVWSUVXU19VUkx9JHtpZH1gKVxyXG4gICAgICAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4gcmVzcG9uc2UuanNvbigpKVxyXG4gICAgICAgICAgICAgLnRoZW4ocmV2aWV3cyA9PiB7XHJcblxyXG4gICAgICAgICAgICAgICAgLyogQWRkIHJldmlld3MgdG8gaW5kZXhlZERCICovXHJcbiAgICAgICAgICAgICAgICBEQkhlbHBlci5vcGVuRGF0YWJhc2UoKS50aGVuKGZ1bmN0aW9uIChkYikge1xyXG4gICAgICAgICAgICAgICAgICBpZiAoIWRiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCB0eCA9IGRiLnRyYW5zYWN0aW9uKCdyZXZpZXdzJywgJ3JlYWR3cml0ZScpO1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBzdG9yZVJldmlld3MgPSB0eC5vYmplY3RTdG9yZSgncmV2aWV3cycpO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXZpZXdzLmZvckVhY2goZnVuY3Rpb24gKHJldmlldykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgc3RvcmVSZXZpZXdzLnB1dChyZXZpZXcpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHguY29tcGxldGU7XHJcbiAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHJldmlld3MpO1xyXG4gICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4gY2FsbGJhY2soYFJlcXVlc3QgZmFpbGVkLiBSZXR1cm5lZCAke2Vycm9yfWAsIG51bGwpKTtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgZmV0Y2hPZmZsaW5lUmV2aWV3cyhpZCwgY2FsbGJhY2spIHtcclxuXHJcbiAgICAgIC8vIGdldCByZXZpZXdzIGZyb20gaW5kZXhlZERCXHJcbiAgICAgIERCSGVscGVyLm9wZW5EYXRhYmFzZSgpLnRoZW4oZnVuY3Rpb24gKGRiKSB7XHJcbiAgICAgICAgaWYgKCFkYikge1xyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH0gIGVsc2Uge1xyXG4gICAgICAgICAgbGV0IHN0b3JlUmV2aWV3cyA9IGRiLnRyYW5zYWN0aW9uKCdzeW5jLXJldmlld3MnLCAncmVhZG9ubHknKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLm9iamVjdFN0b3JlKCdzeW5jLXJldmlld3MnKTtcclxuICAgICAgICAgIGxldCByZXN0SW5kZXggPSBzdG9yZVJldmlld3MuaW5kZXgoJ3Jlc3RhdXJhbnRfaWQnKTtcclxuICAgICAgICAgIHJldHVybiByZXN0SW5kZXguZ2V0QWxsKHBhcnNlSW50KGlkKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KS50aGVuKGZ1bmN0aW9uIChyZXZpZXdzKSB7XHJcbiAgICAgICAgaWYgKHJldmlld3MubGVuZ3RoID09PSAwKSByZXR1cm47XHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmV2aWV3cyk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogUG9zdCByZXZpZXdzIHRvIERCXHJcbiAgICAgKi9cclxuICAgIHN0YXRpYyBwb3N0UmV2aWV3KHJldmlldykge1xyXG4gICAgICByZXR1cm4gREJIZWxwZXIub3BlbkRhdGFiYXNlKCkudGhlbihmdW5jdGlvbiAoZGIpIHtcclxuICAgICAgICBpZiAoIWRiKSB7XHJcbiAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGxldCB0eCA9IGRiLnRyYW5zYWN0aW9uKCdzeW5jLXJldmlld3MnLCAncmVhZHdyaXRlJyk7XHJcbiAgICAgICAgICBsZXQgc3RvcmVSZXZpZXdzID0gdHgub2JqZWN0U3RvcmUoJ3N5bmMtcmV2aWV3cycpO1xyXG5cclxuICAgICAgICAgIHN0b3JlUmV2aWV3cy5wdXQocmV2aWV3KTtcclxuICAgICAgICAgIHJldHVybiB0eC5jb21wbGV0ZTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcclxuICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGVycik7XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBzdGF0aWMgdG9nZ2xlRmF2b3JpdGUocmVzdGF1cmFudElkLCB0b2dnbGVWYWx1ZSkge1xyXG4gIHJldHVybiBEQkhlbHBlci5vcGVuRGF0YWJhc2UoKS50aGVuKGZ1bmN0aW9uIChkYikge1xyXG4gICAgaWYgKCFkYikge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBsZXQgc3RvcmVSZXN0YXVyYW50cyA9IGRiLnRyYW5zYWN0aW9uKCdyZXN0YXVyYW50cycsICdyZWFkd3JpdGUnKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLm9iamVjdFN0b3JlKCdyZXN0YXVyYW50cycpO1xyXG4gICAgICBsZXQgcmVzdGF1cmFudEluZGV4ID0gc3RvcmVSZXN0YXVyYW50cy5pbmRleCgncmVzdC1pZCcpO1xyXG4gICAgICByZXR1cm4gcmVzdGF1cmFudEluZGV4Lm9wZW5DdXJzb3IoKTtcclxuICAgIH1cclxuICB9KS50aGVuKGZ1bmN0aW9uIHVwZGF0ZUZhdm9yaXRlKGN1cnNvcikge1xyXG5cclxuICAgIHJlc3RhdXJhbnRJZCA9ICtyZXN0YXVyYW50SWQ7XHJcblxyXG4gICAgaWYgKCFjdXJzb3IpIHJldHVybjtcclxuXHJcbiAgICBpZiAoY3Vyc29yLnZhbHVlLmlkID09PSByZXN0YXVyYW50SWQpIHtcclxuICAgICAgdmFyIHVwZGF0ZURhdGEgPSBjdXJzb3IudmFsdWU7XHJcblxyXG4gICAgICB1cGRhdGVEYXRhLmlzX2Zhdm9yaXRlID0gdG9nZ2xlVmFsdWU7XHJcbiAgICAgIHZhciByZXF1ZXN0ID0gY3Vyc29yLnVwZGF0ZSh1cGRhdGVEYXRhKTtcclxuICAgICAgcmVxdWVzdC5vbnN1Y2Nlc3MgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9O1xyXG4gICAgfTtcclxuXHJcbiAgICByZXR1cm4gY3Vyc29yLmNvbnRpbnVlKCkudGhlbih1cGRhdGVGYXZvcml0ZSk7XHJcblxyXG4gIH0pLnRoZW4oZnVuY3Rpb24gKCkge1xyXG5cclxuICAgICAgY29uc3QgdXJsID0gYGh0dHA6Ly9sb2NhbGhvc3Q6MTMzNy9yZXN0YXVyYW50cy8ke3Jlc3RhdXJhbnRJZH0vP2lzX2Zhdm9yaXRlPSR7dG9nZ2xlVmFsdWV9YDtcclxuXHJcbiAgICAgIGZldGNoKHVybCwge1xyXG4gICAgICAgIG1ldGhvZDogJ1BVVCcsXHJcbiAgICAgIH0pLnRoZW4oKHJlc3BvbnNlKSA9PiByZXNwb25zZS5qc29uKClcclxuICAgICAgKS5jYXRjaCgoZXJyb3IpID0+IHtcclxuICAgICAgICBjb25zb2xlLmxvZygnRXJyb3IgZmV0Y2hpbmcgaXNfZmF2b3JpdGU6ICcgKyBlcnJvcik7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgIH0pLnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XHJcbiAgICB9KTtcclxufVxyXG5cclxuICAvKipcclxuICAgKiBSZXN0YXVyYW50IHBhZ2UgVVJMLlxyXG4gICAqL1xyXG4gIHN0YXRpYyB1cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcclxuICAgIHJldHVybiAoYC4vcmVzdGF1cmFudC5odG1sP2lkPSR7cmVzdGF1cmFudC5pZH1gKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlc3RhdXJhbnQgaW1hZ2UgVVJMLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBpbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xyXG4gICAgcmV0dXJuIChgL2ltZy8ke3Jlc3RhdXJhbnQucGhvdG9ncmFwaH0ud2VicGApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAqIFJlc3RhdXJhbnQgcmVzcG9uc2l2ZSBpbWFnZXMgc291cmNlIHNldC5cclxuICovXHJcbnN0YXRpYyBpbWFnZVJlc3BvbnNpdmVVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcclxuICAgIGNvbnN0IHNjYWxlMXggPSAnMzIwJztcclxuICAgIGNvbnN0IHNjYWxlMV81eCA9ICc0ODAnO1xyXG4gICAgY29uc3Qgc2NhbGUyeCA9ICc2NDAnO1xyXG4gICAgY29uc3Qgc2NhbGUzeCA9ICc4MDAnO1xyXG5cclxuICAgIHJldHVybiAoXHJcbiAgICAgICAgYC9pbWdfcmVzcG9uc2l2ZS8ke3Jlc3RhdXJhbnQuaWR9LSR7c2NhbGUxeH0ud2VicCAke3NjYWxlMXh9dyxcclxuICAgICAgICAvaW1nX3Jlc3BvbnNpdmUvJHtyZXN0YXVyYW50LmlkfS0ke3NjYWxlMV81eH0ud2VicCAke3NjYWxlMV81eH13LFxyXG4gICAgICAgIC9pbWdfcmVzcG9uc2l2ZS8ke3Jlc3RhdXJhbnQuaWR9LSR7c2NhbGUyeH0ud2VicCAke3NjYWxlMnh9dyxcclxuICAgICAgICAvaW1nX3Jlc3BvbnNpdmUvJHtyZXN0YXVyYW50LmlkfS0ke3NjYWxlM3h9LndlYnAgJHtzY2FsZTN4fXdgKTtcclxufVxyXG5cclxuICAvKipcclxuICAgKiBNYXAgbWFya2VyIGZvciBhIHJlc3RhdXJhbnQuXHJcbiAgICovXHJcbiAgc3RhdGljIG1hcE1hcmtlckZvclJlc3RhdXJhbnQocmVzdGF1cmFudCwgbWFwKSB7XHJcbiAgICBjb25zdCBtYXJrZXIgPSBuZXcgZ29vZ2xlLm1hcHMuTWFya2VyKHtcclxuICAgICAgcG9zaXRpb246IHJlc3RhdXJhbnQubGF0bG5nLFxyXG4gICAgICB0aXRsZTogcmVzdGF1cmFudC5uYW1lLFxyXG4gICAgICB1cmw6IERCSGVscGVyLnVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCksXHJcbiAgICAgIG1hcDogbWFwLFxyXG4gICAgICBhbmltYXRpb246IGdvb2dsZS5tYXBzLkFuaW1hdGlvbi5EUk9QLFxyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gbWFya2VyO1xyXG4gIH1cclxuXHJcbn1cclxuIiwiXHJcbmxldCByZXN0YXVyYW50cztcclxubGV0IG5laWdoYm9yaG9vZHM7XHJcbmxldCBjdWlzaW5lcztcclxubGV0IG1hcDtcclxudmFyIG1hcmtlcnMgPSBbXTtcclxuXHJcbmxldCBvYnNlcnZlciA9IG5ldyBJbnRlcnNlY3Rpb25PYnNlcnZlcihjaGFuZ2VzID0+IHtcclxuICBmb3IgKGNvbnN0IGNoYW5nZSBvZiBjaGFuZ2VzKSB7XHJcbiAgICBpZiAoY2hhbmdlLmludGVyc2VjaW9uUmF0aW9uID49IDAuOSkge1xyXG4gICAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgZGF0YSkgPT4ge1xyXG4gICAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIGZpbGxSZXN0YXVyYW50c0hUTUwoZGF0YSk7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZygnb2JzZXJ2ZXIgaW4gYWN0aW9uIScpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfVxyXG59LFxyXG4gIHtcclxuICAgIHRocmVzaG9sZDogWzAuOV1cclxuICB9XHJcbik7XHJcblxyXG5vYnNlcnZlci5vYnNlcnZlKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50cy1saXN0JykpO1xyXG5cclxuLypcclxuU2V0dGluZyBwaG90b2dyYXBocyBhbHRzKi9cclxuXHJcbmNvbnN0IHBob3RvZ3JhcGhBbHRzID0ge1xyXG5cdDE6IFwiU2VyZXZhbCBncm91cHMgb2YgcGVvcGxlIGhhdmluZyBxdWFsaXR5IHRpbWUgYXQgYSByZXN0YXVyYW50LlwiLFxyXG5cdDI6IFwiQSBsb3ZlbHkgbWFyZ2VyaXR0YSBwaXp6YVwiLFxyXG5cdDM6IFwiQW4gZW1wdHkgcmVzdGF1cmFudCBzZXR0aW5nIHdoaWNoIGhhcyBoZWF0ZXJzXCIsXHJcblx0NDogXCJBIGNvcm5lciBzaG90IG9mIHRoZSBvdXRzaWRlIG9mIHRoZSByZXN0YXVyYXQuXCIsXHJcblx0NTogXCJBIGNyb3dkZWQgcmVzdGF1cmFudCBhbmQgc3RhZmYgc2VydmluZyBmb29kIGZyb20gYmVoaW5kIHRoZSBiYXIuXCIsXHJcblx0NjogXCJSZXN0YXVyYW50IHdpdGggd29vZGVuIHRhYmxlcywgY2hhcmlzLCBhbmQgYSBVUyBmbGFnIGFzIGEgd2FsbCBkZWNvcmF0aW9uXCIsXHJcblx0NzogXCJhIGRvZyB3YXRjaGluZyBmcm9tIHRoZSBvdXRzaWRlIG9mIGEgY3Jvd2RlZCBidXJnZXIgc2hvcCwgYWNjb21wYW5pZWQgYnkgdHdvIG1lbi5cIixcclxuXHQ4OiBcIkNsb3NlIHVwIG9mIHRoZSBkdXRjaCByZXN0YXVyYW50IGxvZ28gYmVzaWRlIGEgZmxvd2VyaW5nIHRyZWVcIixcclxuXHQ5OiBcIkJsYWNrIGFuZCB3aGl0ZSBwaWN0dXJlIG9mIHBlb3BsZSBlYXRpbmcgYXQgYW4gYXNpYW4gcmVzdGF1cmF0LlwiLFxyXG5cdDEwOiBcIkVtcHR5IHJlc3RhdXJhbnQncyB3aGl0ZSBjaGFpcnMsIHdhbGxzIGFuZCBjZWlsaW5ncy5cIlxyXG59O1xyXG5cclxuXHJcblxyXG4vKipcclxuICogRmV0Y2ggbmVpZ2hib3Job29kcyBhbmQgY3Vpc2luZXMgYXMgc29vbiBhcyB0aGUgcGFnZSBpcyBsb2FkZWQuXHJcbiAqL1xyXG5kb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgKGV2ZW50KSA9PiB7XHJcbiAgZmV0Y2hOZWlnaGJvcmhvb2RzKCk7XHJcbiAgZmV0Y2hDdWlzaW5lcygpO1xyXG4gIHVwZGF0ZVJlc3RhdXJhbnRzKCk7XHJcbn0pO1xyXG5cclxuLyoqXHJcbiAqIEZldGNoIGFsbCBuZWlnaGJvcmhvb2RzIGFuZCBzZXQgdGhlaXIgSFRNTC5cclxuICovXHJcbiBmZXRjaE5laWdoYm9yaG9vZHMgPSAoKSA9PiB7XHJcbiAgREJIZWxwZXIuZmV0Y2hOZWlnaGJvcmhvb2RzKChlcnJvciwgbmVpZ2hib3Job29kcykgPT4ge1xyXG4gICAgaWYgKGVycm9yKSB7IC8vIEdvdCBhbiBlcnJvclxyXG4gICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHNlbGYubmVpZ2hib3Job29kcyA9IG5laWdoYm9yaG9vZHM7XHJcbiAgICAgIGZpbGxOZWlnaGJvcmhvb2RzSFRNTCgpO1xyXG4gICAgfVxyXG4gIH0pO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIFNldCBuZWlnaGJvcmhvb2RzIEhUTUwuXHJcbiAqL1xyXG4gZmlsbE5laWdoYm9yaG9vZHNIVE1MID0gKG5laWdoYm9yaG9vZHMgPSBzZWxmLm5laWdoYm9yaG9vZHMpID0+IHtcclxuICBjb25zdCBzZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmVpZ2hib3Job29kcy1zZWxlY3QnKTtcclxuICBuZWlnaGJvcmhvb2RzLmZvckVhY2gobmVpZ2hib3Job29kID0+IHtcclxuICAgIGNvbnN0IG9wdGlvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ29wdGlvbicpO1xyXG4gICAgb3B0aW9uLmlubmVySFRNTCA9IG5laWdoYm9yaG9vZDtcclxuICAgIG9wdGlvbi52YWx1ZSA9IG5laWdoYm9yaG9vZDtcclxuICAgIHNlbGVjdC5hcHBlbmQob3B0aW9uKTtcclxuICB9KTtcclxufTtcclxuXHJcbi8qKlxyXG4gKiBGZXRjaCBhbGwgY3Vpc2luZXMgYW5kIHNldCB0aGVpciBIVE1MLlxyXG4gKi9cclxuIGZldGNoQ3Vpc2luZXMgPSAoKSA9PiB7XHJcbiAgREJIZWxwZXIuZmV0Y2hDdWlzaW5lcygoZXJyb3IsIGN1aXNpbmVzKSA9PiB7XHJcbiAgICBpZiAoZXJyb3IpIHsgLy8gR290IGFuIGVycm9yIVxyXG4gICAgICBjb25zb2xlLmVycm9yKGVycm9yKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHNlbGYuY3Vpc2luZXMgPSBjdWlzaW5lcztcclxuICAgICAgZmlsbEN1aXNpbmVzSFRNTCgpO1xyXG4gICAgfVxyXG4gIH0pO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIFNldCBjdWlzaW5lcyBIVE1MLlxyXG4gKi9cclxuIGZpbGxDdWlzaW5lc0hUTUwgPSAoY3Vpc2luZXMgPSBzZWxmLmN1aXNpbmVzKSA9PiB7XHJcbiAgY29uc3Qgc2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2N1aXNpbmVzLXNlbGVjdCcpO1xyXG5cclxuICBjdWlzaW5lcy5mb3JFYWNoKGN1aXNpbmUgPT4ge1xyXG4gICAgY29uc3Qgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7XHJcbiAgICBvcHRpb24uaW5uZXJIVE1MID0gY3Vpc2luZTtcclxuICAgIG9wdGlvbi52YWx1ZSA9IGN1aXNpbmU7XHJcbiAgICBzZWxlY3QuYXBwZW5kKG9wdGlvbik7XHJcbiAgfSk7XHJcbn07XHJcblxyXG4vKipcclxuICogSW5pdGlhbGl6ZSBHb29nbGUgbWFwLCBjYWxsZWQgZnJvbSBIVE1MLlxyXG4gKi9cclxuIHdpbmRvdy5pbml0TWFwID0gKCkgPT4ge1xyXG4gIGxldCBsb2MgPSB7XHJcbiAgICBsYXQ6IDQwLjcyMjIxNixcclxuICAgIGxuZzogLTczLjk4NzUwMVxyXG4gIH07XHJcbiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcCcpO1xyXG4gIHNlbGYubWFwID0gbmV3IGdvb2dsZS5tYXBzLk1hcChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFwJyksIHtcclxuICAgIHpvb206IDEyLFxyXG4gICAgY2VudGVyOiBsb2MsXHJcbiAgICBzY3JvbGx3aGVlbDogZmFsc2VcclxuICB9KTtcclxuXHJcbiAgdXBkYXRlUmVzdGF1cmFudHMoKTtcclxufVxyXG5cclxuLyoqXHJcblNob3cgbWFwIGJ1dHRvblxyXG4qL1xyXG5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFwVG9nZ2xlJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbihldmVudCkge1xyXG4gIGlmICgoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcC1jb250YWluZXInKS5zdHlsZS5kaXNwbGF5KSA9PT0gJ2Jsb2NrJykge1xyXG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcC1jb250YWluZXInKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xyXG4gICAgd2luZG93LmluaXRNYXAoKTtcclxuICB9IGVsc2Uge1xyXG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcC1jb250YWluZXInKS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJztcclxuICB9XHJcbn0pO1xyXG4vKipcclxuICogVXBkYXRlIHBhZ2UgYW5kIG1hcCBmb3IgY3VycmVudCByZXN0YXVyYW50cy5cclxuICovXHJcbiB1cGRhdGVSZXN0YXVyYW50cyA9ICgpID0+IHtcclxuICBjb25zdCBjU2VsZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2N1aXNpbmVzLXNlbGVjdCcpO1xyXG4gIGNvbnN0IG5TZWxlY3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmVpZ2hib3Job29kcy1zZWxlY3QnKTtcclxuXHJcbiAgY29uc3QgY0luZGV4ID0gY1NlbGVjdC5zZWxlY3RlZEluZGV4O1xyXG4gIGNvbnN0IG5JbmRleCA9IG5TZWxlY3Quc2VsZWN0ZWRJbmRleDtcclxuXHJcbiAgY29uc3QgY3Vpc2luZSA9IGNTZWxlY3RbY0luZGV4XS52YWx1ZTtcclxuICBjb25zdCBuZWlnaGJvcmhvb2QgPSBuU2VsZWN0W25JbmRleF0udmFsdWU7XHJcblxyXG4gIERCSGVscGVyLmZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZChjdWlzaW5lLCBuZWlnaGJvcmhvb2QsIChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcclxuICAgIGlmIChlcnJvcikgeyAvLyBHb3QgYW4gZXJyb3IhXHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmVzZXRSZXN0YXVyYW50cyhyZXN0YXVyYW50cyk7XHJcbiAgICAgIGZpbGxSZXN0YXVyYW50c0hUTUwoKTtcclxuICAgIH1cclxuICB9KVxyXG59O1xyXG5cclxuLyoqXHJcbiAqIENsZWFyIGN1cnJlbnQgcmVzdGF1cmFudHMsIHRoZWlyIEhUTUwgYW5kIHJlbW92ZSB0aGVpciBtYXAgbWFya2Vycy5cclxuICovXHJcbiByZXNldFJlc3RhdXJhbnRzID0gKHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgLy8gUmVtb3ZlIGFsbCByZXN0YXVyYW50c1xyXG4gIHNlbGYucmVzdGF1cmFudHMgPSBbXTtcclxuICBjb25zdCB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50cy1saXN0Jyk7XHJcbiAgdWwuaW5uZXJIVE1MID0gJyc7XHJcblxyXG4gIC8vIFJlbW92ZSBhbGwgbWFwIG1hcmtlcnNcclxuICBzZWxmLm1hcmtlcnMuZm9yRWFjaChtID0+IG0uc2V0TWFwKG51bGwpKTtcclxuICBzZWxmLm1hcmtlcnMgPSBbXTtcclxuICBzZWxmLnJlc3RhdXJhbnRzID0gcmVzdGF1cmFudHM7XHJcbn07XHJcblxyXG4vKipcclxuICogQ3JlYXRlIGFsbCByZXN0YXVyYW50cyBIVE1MIGFuZCBhZGQgdGhlbSB0byB0aGUgd2VicGFnZS5cclxuICovXHJcbiBmaWxsUmVzdGF1cmFudHNIVE1MID0gKHJlc3RhdXJhbnRzID0gc2VsZi5yZXN0YXVyYW50cykgPT4ge1xyXG4gIGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnRzLWxpc3QnKTtcclxuICByZXN0YXVyYW50cy5mb3JFYWNoKHJlc3RhdXJhbnQgPT4ge1xyXG4gICAgdWwuYXBwZW5kKGNyZWF0ZVJlc3RhdXJhbnRIVE1MKHJlc3RhdXJhbnQpKTtcclxuICB9KTtcclxuICBuZXcgTGF6eUxvYWQoeyBlbGVtZW50c19zZWxlY3RvcjogXCIuanMtbGF6eVwifSk7XHJcbiAgYWRkTWFya2Vyc1RvTWFwKCk7XHJcbn07XHJcblxyXG4vKipcclxuICogQ3JlYXRlIHJlc3RhdXJhbnQgSFRNTC5cclxuICovXHJcbiBjcmVhdGVSZXN0YXVyYW50SFRNTCA9IChyZXN0YXVyYW50KSA9PiB7XHJcbiAgY29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xyXG4gIGxpLnRhYkluZGV4ID0nMCc7XHJcblxyXG4gIGNvbnN0IGltYWdlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW1nJyk7XHJcblxyXG4gIGltYWdlLmRhdGFzZXQuc3JjID0gREJIZWxwZXIuaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpO1xyXG4gIGltYWdlLmRhdGFzZXQuc3Jjc2V0ID0gREJIZWxwZXIuaW1hZ2VSZXNwb25zaXZlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KTtcclxuICBpbWFnZS5hbHQgPSBwaG90b2dyYXBoQWx0c1tyZXN0YXVyYW50LmlkXTtcclxuICBpbWFnZS5jbGFzc05hbWUgPSAncmVzdGF1cmFudC1pbWcganMtbGF6eSc7XHJcbiAgbGkuYXBwZW5kKGltYWdlKTtcclxuXHJcbiAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2gyJyk7XHJcbiAgbmFtZS5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5hbWU7XHJcbiAgbGkuYXBwZW5kKG5hbWUpO1xyXG5cclxuICBjb25zdCBuZWlnaGJvcmhvb2QgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XHJcbiAgbmVpZ2hib3Job29kLmlubmVySFRNTCA9IHJlc3RhdXJhbnQubmVpZ2hib3Job29kO1xyXG4gIGxpLmFwcGVuZChuZWlnaGJvcmhvb2QpO1xyXG5cclxuICBjb25zdCBhZGRyZXNzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xyXG4gIGFkZHJlc3MuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5hZGRyZXNzO1xyXG4gIGxpLmFwcGVuZChhZGRyZXNzKTtcclxuXHJcbiAgY29uc3Qgd3JhcHBlciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gIHdyYXBwZXIuc2V0QXR0cmlidXRlKCdjbGFzcycsICd3cmFwcGVyJyk7XHJcbiAgbGkuYXBwZW5kKHdyYXBwZXIpO1xyXG5cclxuICBjb25zdCBtb3JlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYScpO1xyXG4gIG1vcmUuaW5uZXJIVE1MID0gJ1ZpZXcgRGV0YWlscyc7XHJcbiAgbW9yZS5ocmVmID0gREJIZWxwZXIudXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KTtcclxuICB3cmFwcGVyLmFwcGVuZChtb3JlKVxyXG5cclxuICBjb25zdCBmYXZvcml0ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2knKTtcclxuICBjb25zdCBpc0Zhdm9yaXRlID0gcmVzdGF1cmFudC5pc19mYXZvcml0ZSA9PSAndHJ1ZScgPyAnZmFzJyA6ICdmYXInOyAvLyBBUEkgUFVUIGNvbnZlcnRzIHRydWUgaW50byAndHJ1ZScuLi5cclxuICBmYXZvcml0ZS5zZXRBdHRyaWJ1dGUoJ2lkJywgYHJlc3Qke3Jlc3RhdXJhbnQuaWR9YCk7XHJcbiAgZmF2b3JpdGUuc2V0QXR0cmlidXRlKCdjbGFzcycsIGAke2lzRmF2b3JpdGV9IGZhLWhlYXJ0IGZhLTJ4YCk7XHJcbiAgZmF2b3JpdGUuc2V0QXR0cmlidXRlKCd0YWJpbmRleCcsICcwJyk7XHJcbiAgZmF2b3JpdGUuc2V0QXR0cmlidXRlKCdyb2xlJywgJ2J1dHRvbicpO1xyXG4gIGlmIChyZXN0YXVyYW50LmlzX2Zhdm9yaXRlID09ICd0cnVlJykge1xyXG4gICAgZmF2b3JpdGUuc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgYFVubWFyayAke3Jlc3RhdXJhbnQubmFtZX0gYXMgZmF2b3JpdGVgKTtcclxuICB9IGVsc2Uge1xyXG4gICAgZmF2b3JpdGUuc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgYE1hcmsgJHtyZXN0YXVyYW50Lm5hbWV9IGFzIGZhdm9yaXRlYCk7XHJcbiAgfVxyXG5cclxuICBmYXZvcml0ZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcclxuICAgIGNvbnN0IHJlc3RJZCA9IGZhdm9yaXRlLmdldEF0dHJpYnV0ZSgnaWQnKTtcclxuICAgIHRvZ2dsZUZhdihyZXN0SWQsIHJlc3RhdXJhbnQubmFtZSk7XHJcbiAgfSk7XHJcbiAgZmF2b3JpdGUuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIChlKSA9PiB7XHJcbiAgICBpZiAoZS5rZXlDb2RlID09PSAxMykgeyAvLyA9IGVudGVyIGtleVxyXG4gICAgICBjb25zdCByZXN0SWQgPSBmYXZvcml0ZS5nZXRBdHRyaWJ1dGUoJ2lkJyk7XHJcbiAgICAgIHRvZ2dsZUZhdihyZXN0SWQsIHJlc3RhdXJhbnQubmFtZSk7XHJcbiAgICB9XHJcbiAgfSk7XHJcbiAgd3JhcHBlci5hcHBlbmQoZmF2b3JpdGUpO1xyXG5cclxuICByZXR1cm4gbGlcclxufTtcclxuXHJcbiB0b2dnbGVGYXYgPSAocmVzdElkLCByZXN0TmFtZSkgPT4ge1xyXG4gIGNvbnN0IGVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChyZXN0SWQpO1xyXG4gIGNvbnN0IHNldFRvZ2dsZSA9IGVsZW1lbnQuY2xhc3NMaXN0LmNvbnRhaW5zKCdmYXInKTtcclxuICBlbGVtZW50LmNsYXNzTGlzdC50b2dnbGUoJ2ZhcicpO1xyXG4gIGVsZW1lbnQuY2xhc3NMaXN0LnRvZ2dsZSgnZmFzJyk7XHJcbiAgaWYgKHNldFRvZ2dsZSkge1xyXG4gICAgZWxlbWVudC5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCBgTWFyayAke3Jlc3ROYW1lfSBhcyBmYXZvcml0ZWApO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBlbGVtZW50LnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsIGBVbm1hcmsgJHtyZXN0TmFtZX0gYXMgZmF2b3JpdGVgKTtcclxuICB9XHJcblxyXG4gIERCSGVscGVyLnRvZ2dsZUZhdm9yaXRlKHJlc3RJZC5zbGljZSg0KSwgc2V0VG9nZ2xlKS50aGVuKCgpID0+IHtcclxuICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xyXG4gICAgICB1cGRhdGVSZXN0YXVyYW50cygpO1xyXG4gICAgfSwgMjAwKTtcclxuICB9KTtcclxuXHJcbn07XHJcblxyXG4vKipcclxuICogQWRkIG1hcmtlcnMgZm9yIGN1cnJlbnQgcmVzdGF1cmFudHMgdG8gdGhlIG1hcC5cclxuICovXHJcbmFkZE1hcmtlcnNUb01hcCA9IChyZXN0YXVyYW50cyA9IHNlbGYucmVzdGF1cmFudHMpID0+IHtcclxuICByZXN0YXVyYW50cy5mb3JFYWNoKHJlc3RhdXJhbnQgPT4ge1xyXG4gICAgLy8gQWRkIG1hcmtlciB0byB0aGUgbWFwXHJcbiAgICBjb25zdCBtYXJrZXIgPSBEQkhlbHBlci5tYXBNYXJrZXJGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQsIHNlbGYubWFwKTtcclxuICAgIGdvb2dsZS5tYXBzLmV2ZW50LmFkZExpc3RlbmVyKG1hcmtlciwgJ2NsaWNrJywgKCkgPT4ge1xyXG4gICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IG1hcmtlci51cmxcclxuICAgIH0pO1xyXG4gICAgc2VsZi5tYXJrZXJzLnB1c2gobWFya2VyKTtcclxuICB9KTtcclxufTtcclxuXHJcblxyXG5pZiAobmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIpIHtcclxuICBuYXZpZ2F0b3Iuc2VydmljZVdvcmtlci5yZWdpc3Rlcignc3cuanMnKVxyXG4gICAgLnRoZW4oKCkgPT4gY29uc29sZS5sb2coJ1Bhc3NlZCBUZXN0JykpXHJcbn07XHJcbiIsIlxyXG4vKipcclxuICogUmVnaXN0ZXIgYSBzZXJ2aWNlV29ya2VyXHJcbiAqL1xyXG5yZWdpc3RlclNlcnZpY2VXb3JrZXIgPSAoKSA9PiB7XHJcbiAgICAvL2NoZWNrIGlmIHNlcnZpY2VXb3JrZXIgaXMgc3VwcG9ydGVkLCBvdGhlcndpc2UgcmV0dXJuXHJcbiAgICBpZiAoIW5hdmlnYXRvci5zZXJ2aWNlV29ya2VyKSByZXR1cm47XHJcblxyXG4gICAgbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIucmVnaXN0ZXIoJy9zdy5qcycpLmNhdGNoKGZ1bmN0aW9uKCl7XHJcbiAgICAgIGNvbnNvbGUubG9nKFwiU29tZXRoaW5nIHdlbnQgd3JvbmcuIFNlcnZpY2VXb3JrZXIgbm90IHJlZ2lzdGVyZWRcIik7XHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICByZWdpc3RlclNlcnZpY2VXb3JrZXIoKTtcclxuIl19
