class DBHelper{static get DATABASE_URL(){return"http://localhost:1337"}static get RESTAURANT_URL(){return"http://localhost:1337/restaurants"}static get REVIEWS_URL(){return"http://localhost:1337/reviews/?restaurant_id="}static openDatabase(){return navigator.serviceWorker?idb.open("restaurants-db",1,function(e){e.createObjectStore("restaurants",{keyPath:"id"}).createIndex("rest-id","id"),e.createObjectStore("reviews",{keyPath:"id",autoIncrement:!0}).createIndex("restaurant_id","restaurant_id",{unique:!1}),e.createObjectStore("sync-reviews",{keyPath:"id",autoIncrement:!0}).createIndex("restaurant_id","restaurant_id",{unique:!1})}):(console.log("Browser doesn't support Service Workers"),Promise.resolve())}static fetchRestaurants(e){DBHelper.openDatabase().then(function(e){return e?e.transaction("restaurants","readwrite").objectStore("restaurants").getAll():void 0}).then(function(t){0!==t.length&&e(null,t)}),fetch(DBHelper.RESTAURANT_URL).then(function(t){200===t.status?t.json().then(function(t){DBHelper.openDatabase().then(function(e){if(e){let n=e.transaction("restaurants","readwrite"),r=n.objectStore("restaurants");return t.forEach(function(e){r.put(e)}),n.complete}}),e(null,t)}):console.log("Fetch Issue - Status Code: "+t.status)}).catch(function(e){console.log("Fetch Error: ",e)})}static fetchRestaurantById(e,t){DBHelper.fetchRestaurants((n,r)=>{if(n)t(n,null);else{const n=r.find(t=>t.id==e);n?t(null,n):t("Restaurant does not exist",null)}})}static fetchRestaurantByCuisine(e,t){DBHelper.fetchRestaurants((n,r)=>{if(n)t(n,null);else{const n=r.filter(t=>t.cuisine_type==e);t(null,n)}})}static fetchRestaurantByNeighborhood(e,t){DBHelper.fetchRestaurants((n,r)=>{if(n)t(n,null);else{const n=r.filter(t=>t.neighborhood==e);t(null,n)}})}static fetchRestaurantByCuisineAndNeighborhood(e,t,n){DBHelper.fetchRestaurants((r,a)=>{if(r)n(r,null);else{let r=a;"all"!=e&&(r=r.filter(t=>t.cuisine_type==e)),"all"!=t&&(r=r.filter(e=>e.neighborhood==t)),n(null,r)}})}static fetchNeighborhoods(e){DBHelper.fetchRestaurants((t,n)=>{if(t)e(t,null);else{const t=n.map((e,t)=>n[t].neighborhood),r=t.filter((e,n)=>t.indexOf(e)==n);e(null,r)}})}static fetchCuisines(e){DBHelper.fetchRestaurants((t,n)=>{if(t)e(t,null);else{const t=n.map((e,t)=>n[t].cuisine_type),r=t.filter((e,n)=>t.indexOf(e)==n);e(null,r)}})}static fetchReviews(e,t){DBHelper.openDatabase().then(function(t){if(t){return t.transaction("reviews","readwrite").objectStore("reviews").index("restaurant_id").getAll(parseInt(e))}}).then(function(e){0!==e.length&&t(null,e)}),fetch(`${DBHelper.REVIEWS_URL}${e}`).then(e=>e.json()).then(e=>{DBHelper.openDatabase().then(function(t){if(t){let n=t.transaction("reviews","readwrite"),r=n.objectStore("reviews");return e.forEach(function(e){r.put(e)}),n.complete}}),t(null,e)}).catch(e=>t(`Request failed. Returned ${e}`,null))}static fetchTmpReviews(e,t){DBHelper.openDatabase().then(function(t){if(t){return t.transaction("sync-reviews","readonly").objectStore("sync-reviews").index("restaurant_id").getAll(parseInt(e))}}).then(function(e){0!==e.length&&t(null,e)})}static postReview(e){return DBHelper.openDatabase().then(function(t){if(t){let n=t.transaction("sync-reviews","readwrite");return n.objectStore("sync-reviews").put(e),n.complete}}).then(function(){return Promise.resolve()}).catch(function(e){return console.log(e),Promise.resolve()})}static urlForRestaurant(e){return`./restaurant.html?id=${e.id}`}static imageUrlForRestaurant(e){return`/img/${e.photograph}.webp`}static imageResponsiveUrlForRestaurant(e){return`/img_responsive/${e.id}-320.webp 320w,\n        /img_responsive/${e.id}-480.webp 480w,\n        /img_responsive/${e.id}-640.webp 640w,\n        /img_responsive/${e.id}-800.webp 800w`}static mapMarkerForRestaurant(e,t){return new google.maps.Marker({position:e.latlng,title:e.name,url:DBHelper.urlForRestaurant(e),map:t,animation:google.maps.Animation.DROP})}}let restaurant,reviews;var map;const photographAlts={1:"Sereval groups of people having quality time at a restaurant.",2:"A lovely margeritta pizza",3:"An empty restaurant setting which has heaters",4:"A corner shot of the outside of the restaurat.",5:"A crowded restaurant and staff serving food from behind the bar.",6:"Restaurant with wooden tables, charis, and a US flag as a wall decoration",7:"a dog watching from the outside of a crowded burger shop, accompanied by two men.",8:"Close up of the dutch restaurant logo beside a flowering tree",9:"Black and white picture of people eating at an asian restaurat.",10:"Empty restaurant's white chairs, walls and ceilings."};window.initMap=(()=>{fetchRestaurantFromURL((e,t)=>{e?console.error(e):(self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:t.latlng,scrollwheel:!1}),fillBreadcrumb(),DBHelper.mapMarkerForRestaurant(self.restaurant,self.map))})}),callMap=document.getElementById("mapToggle").addEventListener("click",function(e){"block"===document.getElementById("map-container").style.display?(document.getElementById("map-container").style.display="none",window.initMap()):document.getElementById("map-container").style.display="block"}),fetchRestaurantFromURL=(e=>{if(self.restaurant)return void e(null,self.restaurant);const t=getParameterByName("id");t?DBHelper.fetchRestaurantById(t,(t,n)=>{self.restaurant=n,n?(fillRestaurantHTML(),e(null,n)):console.error(t)}):(error="No restaurant id in URL",e(error,null))}),fillRestaurantHTML=((e=self.restaurant)=>{document.getElementById("restaurant-name").innerHTML=e.name,document.getElementById("restaurant-address").innerHTML=e.address;const t=document.getElementById("restaurant-img");t.className="restaurant-img",t.src=DBHelper.imageUrlForRestaurant(e),t.srcset=DBHelper.imageResponsiveUrlForRestaurant(e),t.alt=photographAlts[e.id],document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,e.operating_hours&&fillRestaurantHoursHTML(),fillReviewsHTML()}),fillRestaurantHoursHTML=((e=self.restaurant.operating_hours)=>{const t=document.getElementById("restaurant-hours");t.innerHTML="";for(let n in e){const r=document.createElement("tr"),a=document.createElement("td");a.innerHTML=n,r.appendChild(a);const i=document.createElement("td");i.innerHTML=e[n],r.appendChild(i),t.appendChild(r)}}),fillReviewsHTML=((e=self.restaurant.id)=>{DBHelper.fetchReviews(e,(e,t)=>{if(e)console.log(e);else{const e=document.getElementById("reviews-container");e.innerHTML='<ul id="reviews-list"></ul>';const n=document.createElement("h2");if(n.innerHTML="Reviews",n.tabIndex="0",e.appendChild(n),!t){const t=document.createElement("p");return t.innerHTML="No reviews yet!",void e.appendChild(t)}{const n=document.getElementById("reviews-list");t.forEach(e=>{n.appendChild(createReviewHTML(e))}),e.appendChild(n),fillTmpReviewsHTML()}}})}),window.addEventListener("online",function(e){navigator.serviceWorker.ready.then(function(e){e.sync.register("myFirstSync")})},!1),fillTmpReviewsHTML=((e=self.restaurant.id)=>{DBHelper.fetchTmpReviews(e,(e,t)=>{if(e)console.log(e);else{const e=document.getElementById("reviews-list");0===document.getElementsByClassName("tmp").length&&t.forEach(t=>{e.appendChild(createTmpReviewHTML(t))})}})}),addReview=(()=>{const e={restaurant_id:self.restaurant.id,name:document.getElementById("name").value,createdAt:(new Date).getTime(),updatedAt:(new Date).getTime(),rating:+document.getElementById("rating").value,comments:document.getElementById("comments").value},t=document.getElementById("reviews-list");t.insertBefore(createReviewHTML(e),t.childNodes[0]),navigator.onLine||alert("You are currently offline. Your review will be posted once you are online again. Thank you for reviewing!"),DBHelper.postReview(e).then(function(){navigator.serviceWorker.ready.then(function(e){e.sync.register("myFirstSync"),location.reload()})}).then(function(){fillReviewsHTML()}).then(function(){fillTmpReviewsHTML()}).catch(function(e){console.error(e)})}),document.getElementById("review-form").addEventListener("submit",function(e){e.preventDefault(),addReview()}),createReviewHTML=(e=>{const t=document.createElement("li");t.tabIndex="0";const n=document.createElement("h5"),r=new Date(e.createdAt);n.innerHTML=r.toDateString(),t.appendChild(n);const a=document.createElement("h1");a.innerHTML=e.name,t.appendChild(a);const i=document.createElement("i");i.innerHTML=`Rating: ${e.rating}`,t.appendChild(i);const s=document.createElement("p");s.innerHTML=e.comments,t.appendChild(s);const o=`${e.name} said ${e.comments} and rated the restaurant ${e.rating} out of 5`;return t.setAttribute("aria-label",o),t}),createTmpReviewHTML=(e=>{const t=document.createElement("li");t.setAttribute("class","tmp");const n=document.createElement("div");n.setAttribute("class","review-header"),t.appendChild(n);const r=document.createElement("p");r.setAttribute("class","reviewName"),r.innerHTML=e.name,n.appendChild(r);const a=document.createElement("p");a.setAttribute("class","reviewDate");a.innerHTML=new Date(e.createdAt).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),n.appendChild(a);const i=document.createElement("p");i.innerHTML=`Rating: ${e.rating}`,i.setAttribute("class","reviewRating"),i.style.backgroundColor=5===e.rating?"green":e.rating>2?"orange":"red",t.appendChild(i);const s=document.createElement("p");return s.innerHTML=e.comments,s.setAttribute("class","reviewComment"),t.appendChild(s),t}),fillBreadcrumb=((e=self.restaurant)=>{const t=document.getElementById("breadcrumb"),n=t.querySelectorAll("li");for(element of n)element.removeAttribute("aria-current");const r=document.createElement("li");r.setAttribute("aria-current","page"),2!==t.childElementCount&&(r.innerHTML=e.name,t.appendChild(r))}),getParameterByName=((e,t)=>{t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");const n=new RegExp(`[?&]${e}(=([^&#]*)|&|#|$)`).exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null}),navigator.serviceWorker&&navigator.serviceWorker.register("sw.js").then(()=>console.log("Passed Test")),registerServiceWorker=(()=>{navigator.serviceWorker&&navigator.serviceWorker.register("/sw.js").catch(function(){console.log("Something went wrong. ServiceWorker not registered")})}),registerServiceWorker();var vue=new Vue({el:"#app",data:{formOpen:!1,review:{name:"",rating:"",comments:""}},methods:{resetForm:function(){this.review={name:"",rating:"",comments:""}},cancel:function(){this.formOpen=!1,this.resetForm()}}});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRiaGVscGVyLmpzIiwicmVzdGF1cmFudF9pbmZvLmpzIiwicmVnaXN0ZXJTZXJ2aWNlV29ya2VyLmpzIiwiZm9ybS5qcyJdLCJuYW1lcyI6WyJEQkhlbHBlciIsIkRBVEFCQVNFX1VSTCIsIlJFU1RBVVJBTlRfVVJMIiwiUkVWSUVXU19VUkwiLCJbb2JqZWN0IE9iamVjdF0iLCJuYXZpZ2F0b3IiLCJzZXJ2aWNlV29ya2VyIiwiaWRiIiwib3BlbiIsInVwZ3JhZGVEYiIsImNyZWF0ZU9iamVjdFN0b3JlIiwia2V5UGF0aCIsImNyZWF0ZUluZGV4IiwiYXV0b0luY3JlbWVudCIsInVuaXF1ZSIsImNvbnNvbGUiLCJsb2ciLCJQcm9taXNlIiwicmVzb2x2ZSIsImNhbGxiYWNrIiwib3BlbkRhdGFiYXNlIiwidGhlbiIsImRiIiwidHJhbnNhY3Rpb24iLCJvYmplY3RTdG9yZSIsImdldEFsbCIsInJlc3RhdXJhbnRzIiwibGVuZ3RoIiwiZmV0Y2giLCJyZXNwb25zZSIsInN0YXR1cyIsImpzb24iLCJ0eCIsInN0b3JlUmVzdGF1cmFudHMiLCJmb3JFYWNoIiwicmVzdGF1cmFudCIsInB1dCIsImNvbXBsZXRlIiwiY2F0Y2giLCJlcnIiLCJpZCIsImZldGNoUmVzdGF1cmFudHMiLCJlcnJvciIsImZpbmQiLCJyIiwiY3Vpc2luZSIsInJlc3VsdHMiLCJmaWx0ZXIiLCJjdWlzaW5lX3R5cGUiLCJuZWlnaGJvcmhvb2QiLCJuZWlnaGJvcmhvb2RzIiwibWFwIiwidiIsImkiLCJ1bmlxdWVOZWlnaGJvcmhvb2RzIiwiaW5kZXhPZiIsImN1aXNpbmVzIiwidW5pcXVlQ3Vpc2luZXMiLCJpbmRleCIsInBhcnNlSW50IiwicmV2aWV3cyIsInN0b3JlUmV2aWV3cyIsInJldmlldyIsInBob3RvZ3JhcGgiLCJnb29nbGUiLCJtYXBzIiwiTWFya2VyIiwicG9zaXRpb24iLCJsYXRsbmciLCJ0aXRsZSIsIm5hbWUiLCJ1cmwiLCJ1cmxGb3JSZXN0YXVyYW50IiwiYW5pbWF0aW9uIiwiQW5pbWF0aW9uIiwiRFJPUCIsInBob3RvZ3JhcGhBbHRzIiwiMSIsIjIiLCIzIiwiNCIsIjUiLCI2IiwiNyIsIjgiLCI5IiwiMTAiLCJ3aW5kb3ciLCJpbml0TWFwIiwiZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCIsInNlbGYiLCJNYXAiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiem9vbSIsImNlbnRlciIsInNjcm9sbHdoZWVsIiwiZmlsbEJyZWFkY3J1bWIiLCJtYXBNYXJrZXJGb3JSZXN0YXVyYW50IiwiY2FsbE1hcCIsImFkZEV2ZW50TGlzdGVuZXIiLCJldmVudCIsInN0eWxlIiwiZGlzcGxheSIsImdldFBhcmFtZXRlckJ5TmFtZSIsImZldGNoUmVzdGF1cmFudEJ5SWQiLCJmaWxsUmVzdGF1cmFudEhUTUwiLCJpbm5lckhUTUwiLCJhZGRyZXNzIiwiaW1hZ2UiLCJjbGFzc05hbWUiLCJzcmMiLCJpbWFnZVVybEZvclJlc3RhdXJhbnQiLCJzcmNzZXQiLCJpbWFnZVJlc3BvbnNpdmVVcmxGb3JSZXN0YXVyYW50IiwiYWx0Iiwib3BlcmF0aW5nX2hvdXJzIiwiZmlsbFJlc3RhdXJhbnRIb3Vyc0hUTUwiLCJmaWxsUmV2aWV3c0hUTUwiLCJvcGVyYXRpbmdIb3VycyIsImhvdXJzIiwia2V5Iiwicm93IiwiY3JlYXRlRWxlbWVudCIsImRheSIsImFwcGVuZENoaWxkIiwidGltZSIsInJlc3RhdXJhbnRJZCIsImZldGNoUmV2aWV3cyIsImNvbnRhaW5lciIsInRhYkluZGV4Iiwibm9SZXZpZXdzIiwidWwiLCJjcmVhdGVSZXZpZXdIVE1MIiwiZmlsbFRtcFJldmlld3NIVE1MIiwiZSIsInJlYWR5Iiwic3dSZWdpc3RyYXRpb24iLCJzeW5jIiwicmVnaXN0ZXIiLCJmZXRjaFRtcFJldmlld3MiLCJnZXRFbGVtZW50c0J5Q2xhc3NOYW1lIiwiY3JlYXRlVG1wUmV2aWV3SFRNTCIsImFkZFJldmlldyIsInJlc3RhdXJhbnRfaWQiLCJ2YWx1ZSIsImNyZWF0ZWRBdCIsIkRhdGUiLCJnZXRUaW1lIiwidXBkYXRlZEF0IiwicmF0aW5nIiwiY29tbWVudHMiLCJpbnNlcnRCZWZvcmUiLCJjaGlsZE5vZGVzIiwib25MaW5lIiwiYWxlcnQiLCJwb3N0UmV2aWV3IiwibG9jYXRpb24iLCJyZWxvYWQiLCJwcmV2ZW50RGVmYXVsdCIsImxpIiwiZGF0ZSIsIm15X2RhdGUiLCJ0b0RhdGVTdHJpbmciLCJsYWJlbCIsInNldEF0dHJpYnV0ZSIsImRpdiIsInRvTG9jYWxlRGF0ZVN0cmluZyIsIndlZWtkYXkiLCJ5ZWFyIiwibW9udGgiLCJiYWNrZ3JvdW5kQ29sb3IiLCJicmVhZGNydW1iIiwiYnJlYWRjcnVtYkVsZW1lbnRzIiwicXVlcnlTZWxlY3RvckFsbCIsImVsZW1lbnQiLCJyZW1vdmVBdHRyaWJ1dGUiLCJjaGlsZEVsZW1lbnRDb3VudCIsImhyZWYiLCJyZXBsYWNlIiwiUmVnRXhwIiwiZXhlYyIsImRlY29kZVVSSUNvbXBvbmVudCIsInJlZ2lzdGVyU2VydmljZVdvcmtlciIsInZ1ZSIsIlZ1ZSIsImVsIiwiZGF0YSIsImZvcm1PcGVuIiwibWV0aG9kcyIsInJlc2V0Rm9ybSIsInRoaXMiLCJjYW5jZWwiXSwibWFwcGluZ3MiOiJNQUdNQSxTQU1KQywwQkFFRSxNQUFRLHdCQUVWQyw0QkFFQSxNQUFRLG9DQUdWQyx5QkFFRSxNQUFRLGdEQU1WQyxzQkFJRSxPQUFLQyxVQUFVQyxjQUtSQyxJQUFJQyxLQUFLLGlCQUFrQixFQUFHLFNBQVVDLEdBQ3RCQSxFQUFVQyxrQkFBa0IsZUFDakRDLFFBQVMsT0FFTUMsWUFBWSxVQUFXLE1BQ3JCSCxFQUFVQyxrQkFBa0IsV0FDN0NDLFFBQVMsS0FDVEUsZUFBZSxJQUVKRCxZQUFZLGdCQUNBLGlCQUNFRSxRQUFRLElBQ2JMLEVBQVVDLGtCQUFrQixnQkFDaERDLFFBQVMsS0FDVEUsZUFBZSxJQUVERCxZQUFZLGdCQUNILGlCQUNFRSxRQUFRLE9BdEJuQ0MsUUFBUUMsSUFBSywyQ0FDTkMsUUFBUUMsV0E4QmpCZCx3QkFBd0JlLEdBR3RCbkIsU0FB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QkFBZ0IsZ0JBRXhCLE1BQU1oQixFQUFLcEUsU0FBUytCLGNBQWMsTUFDbENxQyxFQUFHSyxhQUFhLGVBQWdCLFFBQ0ssSUFBakNPLEVBQVdLLG9CQUNkakIsRUFBR3JELFVBQVl4RSxFQUFXbUMsS0FDMUJzRyxFQUFXL0MsWUFBWW1DLE1BTXpCeEQsbUJBQXFCLEVBQUNsQyxFQUFNQyxLQUNyQkEsSUFDSEEsRUFBTWdCLE9BQU9zRSxTQUFTcUIsTUFDeEI1RyxFQUFPQSxFQUFLNkcsUUFBUSxVQUFXLFFBQy9CLE1BQ0VySSxFQURZLElBQUlzSSxjQUFjOUcsc0JBQ2QrRyxLQUFLOUcsR0FDdkIsT0FBS3pCLEVBRUFBLEVBQVEsR0FFTndJLG1CQUFtQnhJLEVBQVEsR0FBR3FJLFFBQVEsTUFBTyxNQUQzQyxHQUZBLE9BU1A5SyxVQUFVQyxlQUNaRCxVQUFVQyxjQUFjcUksU0FBUyxTQUM5QnRILEtBQUssSUFBTU4sUUFBUUMsSUFBSSxnQkN4WTVCdUssc0JBQXdCLE1BRWZsTCxVQUFVQyxlQUVmRCxVQUFVQyxjQUFjcUksU0FBUyxVQUFVckcsTUFBTSxXQUMvQ3ZCLFFBQVFDLElBQUksMERBSWhCdUssd0JDYkYsSUFBSUMsSUFBTSxJQUFJQyxLQUNaQyxHQUFJLE9BQ0pDLE1BQ0VDLFVBQVUsRUFDVjlILFFBQ0VRLEtBQU0sR0FDTmdGLE9BQVEsR0FDUkMsU0FBUyxLQUdic0MsU0FDRUMsVUFBVyxXQUNUQyxLQUFLakksUUFDSFEsS0FBTSxHQUNOZ0YsT0FBUSxHQUNSQyxTQUFTLEtBR2J5QyxPQUFRLFdBQ05ELEtBQUtILFVBQVcsRUFDaEJHLEtBQUtEIiwiZmlsZSI6ImFsbF9yZXN0YXVyYW50LmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIENvbW1vbiBkYXRhYmFzZSBoZWxwZXIgZnVuY3Rpb25zLlxyXG4gKi9cclxuY2xhc3MgREJIZWxwZXIge1xyXG5cclxuICAvKipcclxuICAgKiBEYXRhYmFzZSBVUkwuXHJcbiAgICogQ2hhbmdlIHRoaXMgdG8gcmVzdGF1cmFudHMuanNvbiBmaWxlIGxvY2F0aW9uIG9uIHlvdXIgc2VydmVyLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBnZXQgREFUQUJBU0VfVVJMKCkge1xyXG4gICAgY29uc3QgcG9ydCA9IDEzMzc7XHJcbiAgICByZXR1cm4gYGh0dHA6Ly9sb2NhbGhvc3Q6JHtwb3J0fWA7XHJcbiAgfVxyXG4gIHN0YXRpYyBnZXQgUkVTVEFVUkFOVF9VUkwoKSB7XHJcbiAgY29uc3QgcG9ydCA9IDEzMzc7XHJcbiAgcmV0dXJuIGBodHRwOi8vbG9jYWxob3N0OiR7cG9ydH0vcmVzdGF1cmFudHNgO1xyXG59XHJcblxyXG5zdGF0aWMgZ2V0IFJFVklFV1NfVVJMKCkge1xyXG4gIGNvbnN0IHBvcnQgPSAxMzM3O1xyXG4gIHJldHVybiBgaHR0cDovL2xvY2FsaG9zdDoke3BvcnR9L3Jldmlld3MvP3Jlc3RhdXJhbnRfaWQ9YDtcclxufVxyXG5cclxuLy8gSURCIGNyZWF0aW9uXHJcblxyXG5cclxuc3RhdGljIG9wZW5EYXRhYmFzZSAoKSB7XHJcblxyXG4gIC8vIElmIHRoZSBicm93c2VyIGRvZXNuJ3Qgc3VwcG9ydCBzZXJ2aWNlIHdvcmtlcixcclxuICAvLyB3ZSBkb24ndCBjYXJlIGFib3V0IGhhdmluZyBhIGRhdGFiYXNlXHJcbiAgaWYgKCFuYXZpZ2F0b3Iuc2VydmljZVdvcmtlcikge1xyXG4gICAgY29uc29sZS5sb2coYEJyb3dzZXIgZG9lc24ndCBzdXBwb3J0IFNlcnZpY2UgV29ya2Vyc2ApO1xyXG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xyXG4gIH1cclxuXHJcbiAgcmV0dXJuIGlkYi5vcGVuKCdyZXN0YXVyYW50cy1kYicsIDEsIGZ1bmN0aW9uICh1cGdyYWRlRGIpIHtcclxuICAgIHZhciBzdG9yZVJlc3RhdXJhbnRzID0gdXBncmFkZURiLmNyZWF0ZU9iamVjdFN0b3JlKCdyZXN0YXVyYW50cycsIHtcclxuICAgICAga2V5UGF0aDogJ2lkJyxcclxuICAgIH0pO1xyXG4gICAgc3RvcmVSZXN0YXVyYW50cy5jcmVhdGVJbmRleCgncmVzdC1pZCcsICdpZCcpO1xyXG4gICAgdmFyIHN0b3JlUmV2aWV3cyA9IHVwZ3JhZGVEYi5jcmVhdGVPYmplY3RTdG9yZSgncmV2aWV3cycsIHtcclxuICAgICAga2V5UGF0aDogJ2lkJyxcclxuICAgICAgYXV0b0luY3JlbWVudDogdHJ1ZSxcclxuICAgIH0pO1xyXG4gICAgc3RvcmVSZXZpZXdzLmNyZWF0ZUluZGV4KCdyZXN0YXVyYW50X2lkJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAncmVzdGF1cmFudF9pZCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeyB1bmlxdWU6IGZhbHNlIH0pO1xyXG4gICAgdmFyIHN0b3JlU3luY1JldmlldyA9IHVwZ3JhZGVEYi5jcmVhdGVPYmplY3RTdG9yZSgnc3luYy1yZXZpZXdzJywge1xyXG4gICAgICBrZXlQYXRoOiAnaWQnLFxyXG4gICAgICBhdXRvSW5jcmVtZW50OiB0cnVlLFxyXG4gICAgfSk7XHJcbiAgICBzdG9yZVN5bmNSZXZpZXcuY3JlYXRlSW5kZXgoJ3Jlc3RhdXJhbnRfaWQnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICdyZXN0YXVyYW50X2lkJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IHVuaXF1ZTogZmFsc2UgfSk7XHJcbiAgfSk7XHJcbn1cclxuXHJcblxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCBhbGwgcmVzdGF1cmFudHMuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudHMoY2FsbGJhY2spIHtcclxuXHJcbiAgICAvLyBnZXQgcmVzdGF1cmFudHMgZnJvbSBpbmRleGVkREJcclxuICAgIERCSGVscGVyLm9wZW5EYXRhYmFzZSgpLnRoZW4oZnVuY3Rpb24gKGRiKSB7XHJcbiAgICAgIGlmICghZGIpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICAgIH0gIGVsc2Uge1xyXG4gICAgICAgIHJldHVybiBkYi50cmFuc2FjdGlvbigncmVzdGF1cmFudHMnLCAncmVhZHdyaXRlJylcclxuICAgICAgICAgICAgICAgICAub2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnRzJylcclxuICAgICAgICAgICAgICAgICAuZ2V0QWxsKCk7XHJcbiAgICAgIH1cclxuICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3RhdXJhbnRzKSB7XHJcbiAgICAgIGlmIChyZXN0YXVyYW50cy5sZW5ndGggPT09IDApIHJldHVybjtcclxuICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdGF1cmFudHMpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZmV0Y2goREJIZWxwZXIuUkVTVEFVUkFOVF9VUkwpXHJcbiAgICAudGhlbihcclxuICAgICAgZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgaWYgKHJlc3BvbnNlLnN0YXR1cyAhPT0gMjAwKSB7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZygnRmV0Y2ggSXNzdWUgLSBTdGF0dXMgQ29kZTogJyArIHJlc3BvbnNlLnN0YXR1cyk7XHJcbiAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXNwb25zZS5qc29uKCkudGhlbihmdW5jdGlvbiAocmVzdGF1cmFudHMpIHtcclxuXHJcbiAgICAgICAgICAvKiBBZGQgcmVzdGF1cmFudHMgdG8gaW5kZXhlZERCICovXHJcbiAgICAgICAgICBEQkhlbHBlci5vcGVuRGF0YWJhc2UoKS50aGVuKGZ1bmN0aW9uIChkYikge1xyXG4gICAgICAgICAgICBpZiAoIWRiKSB7XHJcbiAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgIGxldCB0eCA9IGRiLnRyYW5zYWN0aW9uKCdyZXN0YXVyYW50cycsICdyZWFkd3JpdGUnKTtcclxuICAgICAgICAgICAgICBsZXQgc3RvcmVSZXN0YXVyYW50cyA9IHR4Lm9iamVjdFN0b3JlKCdyZXN0YXVyYW50cycpO1xyXG5cclxuICAgICAgICAgICAgICByZXN0YXVyYW50cy5mb3JFYWNoKGZ1bmN0aW9uIChyZXN0YXVyYW50KSB7XHJcbiAgICAgICAgICAgICAgICBzdG9yZVJlc3RhdXJhbnRzLnB1dChyZXN0YXVyYW50KTtcclxuICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgcmV0dXJuIHR4LmNvbXBsZXRlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICBjYWxsYmFjayhudWxsLCByZXN0YXVyYW50cyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgIClcclxuICAgIC5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKCdGZXRjaCBFcnJvcjogJywgZXJyKTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggYSByZXN0YXVyYW50IGJ5IGl0cyBJRC5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlJZChpZCwgY2FsbGJhY2spIHtcclxuICAgIC8vIGZldGNoIGFsbCByZXN0YXVyYW50cyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY29uc3QgcmVzdGF1cmFudCA9IHJlc3RhdXJhbnRzLmZpbmQociA9PiByLmlkID09IGlkKTtcclxuICAgICAgICBpZiAocmVzdGF1cmFudCkgeyAvLyBHb3QgdGhlIHJlc3RhdXJhbnRcclxuICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3RhdXJhbnQpO1xyXG4gICAgICAgIH0gZWxzZSB7IC8vIFJlc3RhdXJhbnQgZG9lcyBub3QgZXhpc3QgaW4gdGhlIGRhdGFiYXNlXHJcbiAgICAgICAgICBjYWxsYmFjaygnUmVzdGF1cmFudCBkb2VzIG5vdCBleGlzdCcsIG51bGwpO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIGN1aXNpbmUgdHlwZSB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50QnlDdWlzaW5lKGN1aXNpbmUsIGNhbGxiYWNrKSB7XHJcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHMgIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nXHJcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcclxuICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIEZpbHRlciByZXN0YXVyYW50cyB0byBoYXZlIG9ubHkgZ2l2ZW4gY3Vpc2luZSB0eXBlXHJcbiAgICAgICAgY29uc3QgcmVzdWx0cyA9IHJlc3RhdXJhbnRzLmZpbHRlcihyID0+IHIuY3Vpc2luZV90eXBlID09IGN1aXNpbmUpO1xyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdHMpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgbmVpZ2hib3Job29kIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeU5laWdoYm9yaG9vZChuZWlnaGJvcmhvb2QsIGNhbGxiYWNrKSB7XHJcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gRmlsdGVyIHJlc3RhdXJhbnRzIHRvIGhhdmUgb25seSBnaXZlbiBuZWlnaGJvcmhvb2RcclxuICAgICAgICBjb25zdCByZXN1bHRzID0gcmVzdGF1cmFudHMuZmlsdGVyKHIgPT4gci5uZWlnaGJvcmhvb2QgPT0gbmVpZ2hib3Job29kKTtcclxuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHRzKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCByZXN0YXVyYW50cyBieSBhIGN1aXNpbmUgYW5kIGEgbmVpZ2hib3Job29kIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmVBbmROZWlnaGJvcmhvb2QoY3Vpc2luZSwgbmVpZ2hib3Job29kLCBjYWxsYmFjaykge1xyXG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXHJcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcclxuICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGxldCByZXN1bHRzID0gcmVzdGF1cmFudHM7XHJcbiAgICAgICAgaWYgKGN1aXNpbmUgIT0gJ2FsbCcpIHsgLy8gZmlsdGVyIGJ5IGN1aXNpbmVcclxuICAgICAgICAgIHJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcihyID0+IHIuY3Vpc2luZV90eXBlID09IGN1aXNpbmUpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKG5laWdoYm9yaG9vZCAhPSAnYWxsJykgeyAvLyBmaWx0ZXIgYnkgbmVpZ2hib3Job29kXHJcbiAgICAgICAgICByZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIociA9PiByLm5laWdoYm9yaG9vZCA9PSBuZWlnaGJvcmhvb2QpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0cyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggYWxsIG5laWdoYm9yaG9vZHMgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoTmVpZ2hib3Job29kcyhjYWxsYmFjaykge1xyXG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXHJcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcclxuICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIEdldCBhbGwgbmVpZ2hib3Job29kcyBmcm9tIGFsbCByZXN0YXVyYW50c1xyXG4gICAgICAgIGNvbnN0IG5laWdoYm9yaG9vZHMgPSByZXN0YXVyYW50cy5tYXAoKHYsIGkpID0+IHJlc3RhdXJhbnRzW2ldLm5laWdoYm9yaG9vZCk7XHJcblxyXG4gICAgICAgIC8vIFJlbW92ZSBkdXBsaWNhdGVzIGZyb20gbmVpZ2hib3Job29kc1xyXG4gICAgICAgIGNvbnN0IHVuaXF1ZU5laWdoYm9yaG9vZHMgPSBuZWlnaGJvcmhvb2RzLmZpbHRlcigodiwgaSkgPT4gbmVpZ2hib3Job29kcy5pbmRleE9mKHYpID09IGkpO1xyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHVuaXF1ZU5laWdoYm9yaG9vZHMpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIGFsbCBjdWlzaW5lcyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hDdWlzaW5lcyhjYWxsYmFjaykge1xyXG4gICAgLy8gRmV0Y2ggYWxsIHJlc3RhdXJhbnRzXHJcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcclxuICAgICAgaWYgKGVycm9yKSB7XHJcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIC8vIEdldCBhbGwgY3Vpc2luZXMgZnJvbSBhbGwgcmVzdGF1cmFudHNcclxuICAgICAgICBjb25zdCBjdWlzaW5lcyA9IHJlc3RhdXJhbnRzLm1hcCgodiwgaSkgPT4gcmVzdGF1cmFudHNbaV0uY3Vpc2luZV90eXBlKTtcclxuXHJcbiAgICAgICAgLy8gUmVtb3ZlIGR1cGxpY2F0ZXMgZnJvbSBjdWlzaW5lc1xyXG4gICAgICAgIGNvbnN0IHVuaXF1ZUN1aXNpbmVzID0gY3Vpc2luZXMuZmlsdGVyKCh2LCBpKSA9PiBjdWlzaW5lcy5pbmRleE9mKHYpID09IGkpO1xyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHVuaXF1ZUN1aXNpbmVzKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgICAqIEZldGNoIGFsbCByZXZpZXdzLlxyXG4gICAgICovXHJcbiAgICBzdGF0aWMgZmV0Y2hSZXZpZXdzKGlkLCBjYWxsYmFjaykge1xyXG5cclxuICAgICAgLy8gZ2V0IHJldmlld3MgZnJvbSBpbmRleGVkREJcclxuICAgICAgREJIZWxwZXIub3BlbkRhdGFiYXNlKCkudGhlbihmdW5jdGlvbiAoZGIpIHtcclxuICAgICAgICBpZiAoIWRiKSB7XHJcbiAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfSAgZWxzZSB7XHJcbiAgICAgICAgICBsZXQgc3RvcmVSZXZpZXdzID0gZGIudHJhbnNhY3Rpb24oJ3Jldmlld3MnLCAncmVhZHdyaXRlJylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5vYmplY3RTdG9yZSgncmV2aWV3cycpO1xyXG4gICAgICAgICAgbGV0IHJlc3RJbmRleCA9IHN0b3JlUmV2aWV3cy5pbmRleCgncmVzdGF1cmFudF9pZCcpO1xyXG4gICAgICAgICAgcmV0dXJuIHJlc3RJbmRleC5nZXRBbGwocGFyc2VJbnQoaWQpKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJldmlld3MpIHtcclxuICAgICAgICBpZiAocmV2aWV3cy5sZW5ndGggPT09IDApIHJldHVybjtcclxuICAgICAgICBjYWxsYmFjayhudWxsLCByZXZpZXdzKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICAvKiBGZXRjaCByZXZpZXdzIGZyb20gbmV0d29yayAqL1xyXG4gICAgICBmZXRjaChgJHtEQkhlbHBlci5SRVZJRVdTX1VSTH0ke2lkfWApXHJcbiAgICAgICAgICAgICAudGhlbihyZXNwb25zZSA9PiByZXNwb25zZS5qc29uKCkpXHJcbiAgICAgICAgICAgICAudGhlbihyZXZpZXdzID0+IHtcclxuXHJcbiAgICAgICAgICAgICAgICAvKiBBZGQgcmV2aWV3cyB0byBpbmRleGVkREIgKi9cclxuICAgICAgICAgICAgICAgIERCSGVscGVyLm9wZW5EYXRhYmFzZSgpLnRoZW4oZnVuY3Rpb24gKGRiKSB7XHJcbiAgICAgICAgICAgICAgICAgIGlmICghZGIpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IHR4ID0gZGIudHJhbnNhY3Rpb24oJ3Jldmlld3MnLCAncmVhZHdyaXRlJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IHN0b3JlUmV2aWV3cyA9IHR4Lm9iamVjdFN0b3JlKCdyZXZpZXdzJyk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJldmlld3MuZm9yRWFjaChmdW5jdGlvbiAocmV2aWV3KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICBzdG9yZVJldmlld3MucHV0KHJldmlldyk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0eC5jb21wbGV0ZTtcclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgcmV2aWV3cyk7XHJcbiAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgIC5jYXRjaChlcnJvciA9PiBjYWxsYmFjayhgUmVxdWVzdCBmYWlsZWQuIFJldHVybmVkICR7ZXJyb3J9YCwgbnVsbCkpO1xyXG4gICAgfVxyXG5cclxuICAgIHN0YXRpYyBmZXRjaFRtcFJldmlld3MoaWQsIGNhbGxiYWNrKSB7XHJcblxyXG4gICAgICAvLyBnZXQgcmV2aWV3cyBmcm9tIGluZGV4ZWREQlxyXG4gICAgICBEQkhlbHBlci5vcGVuRGF0YWJhc2UoKS50aGVuKGZ1bmN0aW9uIChkYikge1xyXG4gICAgICAgIGlmICghZGIpIHtcclxuICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9ICBlbHNlIHtcclxuICAgICAgICAgIGxldCBzdG9yZVJldmlld3MgPSBkYi50cmFuc2FjdGlvbignc3luYy1yZXZpZXdzJywgJ3JlYWRvbmx5JylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5vYmplY3RTdG9yZSgnc3luYy1yZXZpZXdzJyk7XHJcbiAgICAgICAgICBsZXQgcmVzdEluZGV4ID0gc3RvcmVSZXZpZXdzLmluZGV4KCdyZXN0YXVyYW50X2lkJyk7XHJcbiAgICAgICAgICByZXR1cm4gcmVzdEluZGV4LmdldEFsbChwYXJzZUludChpZCkpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSkudGhlbihmdW5jdGlvbiAocmV2aWV3cykge1xyXG4gICAgICAgIGlmIChyZXZpZXdzLmxlbmd0aCA9PT0gMCkgcmV0dXJuO1xyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJldmlld3MpO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFBvc3QgcmV2aWV3cyB0byBEQlxyXG4gICAgICovXHJcbiAgICBzdGF0aWMgcG9zdFJldmlldyhyZXZpZXcpIHtcclxuICAgICAgcmV0dXJuIERCSGVscGVyLm9wZW5EYXRhYmFzZSgpLnRoZW4oZnVuY3Rpb24gKGRiKSB7XHJcbiAgICAgICAgaWYgKCFkYikge1xyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBsZXQgdHggPSBkYi50cmFuc2FjdGlvbignc3luYy1yZXZpZXdzJywgJ3JlYWR3cml0ZScpO1xyXG4gICAgICAgICAgbGV0IHN0b3JlUmV2aWV3cyA9IHR4Lm9iamVjdFN0b3JlKCdzeW5jLXJldmlld3MnKTtcclxuXHJcbiAgICAgICAgICBzdG9yZVJldmlld3MucHV0KHJldmlldyk7XHJcbiAgICAgICAgICByZXR1cm4gdHguY29tcGxldGU7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KS50aGVuKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XHJcbiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlc3RhdXJhbnQgcGFnZSBVUkwuXHJcbiAgICovXHJcbiAgc3RhdGljIHVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xyXG4gICAgcmV0dXJuIChgLi9yZXN0YXVyYW50Lmh0bWw/aWQ9JHtyZXN0YXVyYW50LmlkfWApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVzdGF1cmFudCBpbWFnZSBVUkwuXHJcbiAgICovXHJcbiAgc3RhdGljIGltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XHJcbiAgICByZXR1cm4gKGAvaW1nLyR7cmVzdGF1cmFudC5waG90b2dyYXBofS53ZWJwYCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICogUmVzdGF1cmFudCByZXNwb25zaXZlIGltYWdlcyBzb3VyY2Ugc2V0LlxyXG4gKi9cclxuc3RhdGljIGltYWdlUmVzcG9uc2l2ZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xyXG4gICAgY29uc3Qgc2NhbGUxeCA9ICczMjAnO1xyXG4gICAgY29uc3Qgc2NhbGUxXzV4ID0gJzQ4MCc7XHJcbiAgICBjb25zdCBzY2FsZTJ4ID0gJzY0MCc7XHJcbiAgICBjb25zdCBzY2FsZTN4ID0gJzgwMCc7XHJcblxyXG4gICAgcmV0dXJuIChcclxuICAgICAgICBgL2ltZ19yZXNwb25zaXZlLyR7cmVzdGF1cmFudC5pZH0tJHtzY2FsZTF4fS53ZWJwICR7c2NhbGUxeH13LFxyXG4gICAgICAgIC9pbWdfcmVzcG9uc2l2ZS8ke3Jlc3RhdXJhbnQuaWR9LSR7c2NhbGUxXzV4fS53ZWJwICR7c2NhbGUxXzV4fXcsXHJcbiAgICAgICAgL2ltZ19yZXNwb25zaXZlLyR7cmVzdGF1cmFudC5pZH0tJHtzY2FsZTJ4fS53ZWJwICR7c2NhbGUyeH13LFxyXG4gICAgICAgIC9pbWdfcmVzcG9uc2l2ZS8ke3Jlc3RhdXJhbnQuaWR9LSR7c2NhbGUzeH0ud2VicCAke3NjYWxlM3h9d2ApO1xyXG59XHJcblxyXG4gIC8qKlxyXG4gICAqIE1hcCBtYXJrZXIgZm9yIGEgcmVzdGF1cmFudC5cclxuICAgKi9cclxuICBzdGF0aWMgbWFwTWFya2VyRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCBtYXApIHtcclxuICAgIGNvbnN0IG1hcmtlciA9IG5ldyBnb29nbGUubWFwcy5NYXJrZXIoe1xyXG4gICAgICBwb3NpdGlvbjogcmVzdGF1cmFudC5sYXRsbmcsXHJcbiAgICAgIHRpdGxlOiByZXN0YXVyYW50Lm5hbWUsXHJcbiAgICAgIHVybDogREJIZWxwZXIudXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSxcclxuICAgICAgbWFwOiBtYXAsXHJcbiAgICAgIGFuaW1hdGlvbjogZ29vZ2xlLm1hcHMuQW5pbWF0aW9uLkRST1AsXHJcbiAgICB9KTtcclxuICAgIHJldHVybiBtYXJrZXI7XHJcbiAgfVxyXG5cclxufVxyXG4iLCJsZXQgcmVzdGF1cmFudDtcclxubGV0IHJldmlld3M7XHJcbnZhciBtYXA7XHJcblxyXG5cclxuXHJcblxyXG4vKlxyXG5TZXR0aW5nIHBob3RvZ3JhcGhzIGFsdHMqL1xyXG5cclxuY29uc3QgcGhvdG9ncmFwaEFsdHMgPSB7XHJcblx0MTogXCJTZXJldmFsIGdyb3VwcyBvZiBwZW9wbGUgaGF2aW5nIHF1YWxpdHkgdGltZSBhdCBhIHJlc3RhdXJhbnQuXCIsXHJcblx0MjogXCJBIGxvdmVseSBtYXJnZXJpdHRhIHBpenphXCIsXHJcblx0MzogXCJBbiBlbXB0eSByZXN0YXVyYW50IHNldHRpbmcgd2hpY2ggaGFzIGhlYXRlcnNcIixcclxuXHQ0OiBcIkEgY29ybmVyIHNob3Qgb2YgdGhlIG91dHNpZGUgb2YgdGhlIHJlc3RhdXJhdC5cIixcclxuXHQ1OiBcIkEgY3Jvd2RlZCByZXN0YXVyYW50IGFuZCBzdGFmZiBzZXJ2aW5nIGZvb2QgZnJvbSBiZWhpbmQgdGhlIGJhci5cIixcclxuXHQ2OiBcIlJlc3RhdXJhbnQgd2l0aCB3b29kZW4gdGFibGVzLCBjaGFyaXMsIGFuZCBhIFVTIGZsYWcgYXMgYSB3YWxsIGRlY29yYXRpb25cIixcclxuXHQ3OiBcImEgZG9nIHdhdGNoaW5nIGZyb20gdGhlIG91dHNpZGUgb2YgYSBjcm93ZGVkIGJ1cmdlciBzaG9wLCBhY2NvbXBhbmllZCBieSB0d28gbWVuLlwiLFxyXG5cdDg6IFwiQ2xvc2UgdXAgb2YgdGhlIGR1dGNoIHJlc3RhdXJhbnQgbG9nbyBiZXNpZGUgYSBmbG93ZXJpbmcgdHJlZVwiLFxyXG5cdDk6IFwiQmxhY2sgYW5kIHdoaXRlIHBpY3R1cmUgb2YgcGVvcGxlIGVhdGluZyBhdCBhbiBhc2lhbiByZXN0YXVyYXQuXCIsXHJcblx0MTA6IFwiRW1wdHkgcmVzdGF1cmFudCdzIHdoaXRlIGNoYWlycywgd2FsbHMgYW5kIGNlaWxpbmdzLlwiXHJcbn07XHJcblxyXG5cclxuXHJcbi8qKlxyXG4gKiBJbml0aWFsaXplIEdvb2dsZSBtYXAsIGNhbGxlZCBmcm9tIEhUTUwuXHJcbiAqL1xyXG53aW5kb3cuaW5pdE1hcCA9ICgpID0+IHtcclxuICBmZXRjaFJlc3RhdXJhbnRGcm9tVVJMKChlcnJvciwgcmVzdGF1cmFudCkgPT4ge1xyXG4gICAgaWYgKGVycm9yKSB7IC8vIEdvdCBhbiBlcnJvciFcclxuICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBzZWxmLm1hcCA9IG5ldyBnb29nbGUubWFwcy5NYXAoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcCcpLCB7XHJcbiAgICAgICAgem9vbTogMTYsXHJcbiAgICAgICAgY2VudGVyOiByZXN0YXVyYW50LmxhdGxuZyxcclxuICAgICAgICBzY3JvbGx3aGVlbDogZmFsc2VcclxuICAgICAgfSk7XHJcbiAgICAgIGZpbGxCcmVhZGNydW1iKCk7XHJcbiAgICAgIERCSGVscGVyLm1hcE1hcmtlckZvclJlc3RhdXJhbnQoc2VsZi5yZXN0YXVyYW50LCBzZWxmLm1hcCk7XHJcbiAgICB9XHJcbiAgfSk7XHJcbn1cclxuXHJcbi8qKlxyXG5TaG93IG1hcCBidXR0b25cclxuKi9cclxuY2FsbE1hcCA9XHJcbmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXBUb2dnbGUnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGZ1bmN0aW9uKGV2ZW50KSB7XHJcbiAgaWYgKChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFwLWNvbnRhaW5lcicpLnN0eWxlLmRpc3BsYXkpID09PSAnYmxvY2snKSB7XHJcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFwLWNvbnRhaW5lcicpLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XHJcbiAgICB3aW5kb3cuaW5pdE1hcCgpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFwLWNvbnRhaW5lcicpLnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snO1xyXG4gIH1cclxufSk7XHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcbi8qKlxyXG4gKiBHZXQgY3VycmVudCByZXN0YXVyYW50IGZyb20gcGFnZSBVUkwuXHJcbiAqL1xyXG5mZXRjaFJlc3RhdXJhbnRGcm9tVVJMID0gKGNhbGxiYWNrKSA9PiB7XHJcbiAgaWYgKHNlbGYucmVzdGF1cmFudCkgeyAvLyByZXN0YXVyYW50IGFscmVhZHkgZmV0Y2hlZCFcclxuICAgIGNhbGxiYWNrKG51bGwsIHNlbGYucmVzdGF1cmFudClcclxuICAgIHJldHVybjtcclxuICB9XHJcbiAgY29uc3QgaWQgPSBnZXRQYXJhbWV0ZXJCeU5hbWUoJ2lkJyk7XHJcbiAgaWYgKCFpZCkgeyAvLyBubyBpZCBmb3VuZCBpbiBVUkxcclxuICAgIGVycm9yID0gJ05vIHJlc3RhdXJhbnQgaWQgaW4gVVJMJ1xyXG4gICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRCeUlkKGlkLCAoZXJyb3IsIHJlc3RhdXJhbnQpID0+IHtcclxuICAgICAgc2VsZi5yZXN0YXVyYW50ID0gcmVzdGF1cmFudDtcclxuICAgICAgaWYgKCFyZXN0YXVyYW50KSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcbiAgICAgIGZpbGxSZXN0YXVyYW50SFRNTCgpO1xyXG4gICAgICBjYWxsYmFjayhudWxsLCByZXN0YXVyYW50KVxyXG4gICAgfSk7XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogQ3JlYXRlIHJlc3RhdXJhbnQgSFRNTCBhbmQgYWRkIGl0IHRvIHRoZSB3ZWJwYWdlXHJcbiAqL1xyXG5maWxsUmVzdGF1cmFudEhUTUwgPSAocmVzdGF1cmFudCA9IHNlbGYucmVzdGF1cmFudCkgPT4ge1xyXG4gIGNvbnN0IG5hbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1uYW1lJyk7XHJcbiAgbmFtZS5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5hbWU7XHJcblxyXG4gIGNvbnN0IGFkZHJlc3MgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1hZGRyZXNzJyk7XHJcbiAgYWRkcmVzcy5pbm5lckhUTUwgPSByZXN0YXVyYW50LmFkZHJlc3M7XHJcblxyXG4gIGNvbnN0IGltYWdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtaW1nJyk7XHJcbiAgaW1hZ2UuY2xhc3NOYW1lID0gJ3Jlc3RhdXJhbnQtaW1nJ1xyXG4gIGltYWdlLnNyYyA9IERCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KTtcclxuXHRpbWFnZS5zcmNzZXQgPSBEQkhlbHBlci5pbWFnZVJlc3BvbnNpdmVVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpO1xyXG4gIGltYWdlLmFsdCA9IHBob3RvZ3JhcGhBbHRzW3Jlc3RhdXJhbnQuaWRdO1xyXG5cclxuICBjb25zdCBjdWlzaW5lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtY3Vpc2luZScpO1xyXG4gIGN1aXNpbmUuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5jdWlzaW5lX3R5cGU7XHJcblxyXG4gIC8vIGZpbGwgb3BlcmF0aW5nIGhvdXJzXHJcbiAgaWYgKHJlc3RhdXJhbnQub3BlcmF0aW5nX2hvdXJzKSB7XHJcbiAgICBmaWxsUmVzdGF1cmFudEhvdXJzSFRNTCgpO1xyXG4gIH1cclxuICAvLyBmaWxsIHJldmlld3NcclxuICBmaWxsUmV2aWV3c0hUTUwoKTtcclxufVxyXG5cclxuLyoqXHJcbiAqIENyZWF0ZSByZXN0YXVyYW50IG9wZXJhdGluZyBob3VycyBIVE1MIHRhYmxlIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2UuXHJcbiAqL1xyXG5maWxsUmVzdGF1cmFudEhvdXJzSFRNTCA9IChvcGVyYXRpbmdIb3VycyA9IHNlbGYucmVzdGF1cmFudC5vcGVyYXRpbmdfaG91cnMpID0+IHtcclxuICBjb25zdCBob3VycyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWhvdXJzJyk7XHJcblx0aG91cnMuaW5uZXJIVE1MID0gJyc7XHJcbiAgZm9yIChsZXQga2V5IGluIG9wZXJhdGluZ0hvdXJzKSB7XHJcbiAgICBjb25zdCByb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0cicpO1xyXG5cclxuICAgIGNvbnN0IGRheSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XHJcbiAgICBkYXkuaW5uZXJIVE1MID0ga2V5O1xyXG4gICAgcm93LmFwcGVuZENoaWxkKGRheSk7XHJcblxyXG4gICAgY29uc3QgdGltZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7XHJcbiAgICB0aW1lLmlubmVySFRNTCA9IG9wZXJhdGluZ0hvdXJzW2tleV07XHJcbiAgICByb3cuYXBwZW5kQ2hpbGQodGltZSk7XHJcblxyXG4gICAgaG91cnMuYXBwZW5kQ2hpbGQocm93KTtcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDcmVhdGUgYWxsIHJldmlld3MgSFRNTCBhbmQgYWRkIHRoZW0gdG8gdGhlIHdlYnBhZ2UuXHJcbiAqL1xyXG5maWxsUmV2aWV3c0hUTUwgPSAocmVzdGF1cmFudElkID0gc2VsZi5yZXN0YXVyYW50LmlkKSA9PiB7XHJcbiAgREJIZWxwZXIuZmV0Y2hSZXZpZXdzKHJlc3RhdXJhbnRJZCwgKGVycm9yLCByZXZpZXdzKSA9PiB7XHJcbiAgICBpZihlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmxvZyhlcnJvcik7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV2aWV3cy1jb250YWluZXInKTtcclxuICAgICAgY29udGFpbmVyLmlubmVySFRNTCA9ICc8dWwgaWQ9XCJyZXZpZXdzLWxpc3RcIj48L3VsPic7XHJcbiAgICAgIGNvbnN0IHRpdGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaDInKTtcclxuICAgICAgdGl0bGUuaW5uZXJIVE1MID0gJ1Jldmlld3MnO1xyXG4gICAgICB0aXRsZS50YWJJbmRleCA9ICcwJztcclxuICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHRpdGxlKTtcclxuXHJcbiAgICAgIGlmICghcmV2aWV3cykge1xyXG4gICAgICAgIGNvbnN0IG5vUmV2aWV3cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcclxuICAgICAgICBub1Jldmlld3MuaW5uZXJIVE1MID0gJ05vIHJldmlld3MgeWV0ISc7XHJcbiAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKG5vUmV2aWV3cyk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICBjb25zdCB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXdzLWxpc3QnKTtcclxuICAgICAgcmV2aWV3cy5mb3JFYWNoKHJldmlldyA9PiB7XHJcbiAgICAgICAgdWwuYXBwZW5kQ2hpbGQoY3JlYXRlUmV2aWV3SFRNTChyZXZpZXcpKTtcclxuICAgICAgfSk7XHJcbiAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZCh1bCk7XHJcbiAgICAgIGZpbGxUbXBSZXZpZXdzSFRNTCgpO1xyXG4gICAgfVxyXG4gICAgfVxyXG4gIH0pO1xyXG59O1xyXG5cclxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ29ubGluZScsIGZ1bmN0aW9uIChlKSB7XHJcbiAgbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIucmVhZHkudGhlbihmdW5jdGlvbiAoc3dSZWdpc3RyYXRpb24pIHtcclxuICAgIHN3UmVnaXN0cmF0aW9uLnN5bmMucmVnaXN0ZXIoJ215Rmlyc3RTeW5jJyk7XHJcbiAgfSk7XHJcbn0sIGZhbHNlKTtcclxuXHJcbmZpbGxUbXBSZXZpZXdzSFRNTCA9IChyZXN0YXVyYW50SWQgPSBzZWxmLnJlc3RhdXJhbnQuaWQpID0+IHtcclxuICBEQkhlbHBlci5mZXRjaFRtcFJldmlld3MocmVzdGF1cmFudElkLCAoZXJyb3IsIHJldmlld3MpID0+IHtcclxuXHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgY29uc3QgdWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV2aWV3cy1saXN0Jyk7XHJcbiAgICAgIGNvbnN0IHRtcHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCd0bXAnKTtcclxuICAgICAgaWYgKHRtcHMubGVuZ3RoID09PSAwKSB7IC8vIG1pdGlnYXRlIGRvdWJsZSBhZGRzXHJcbiAgICAgICAgcmV2aWV3cy5mb3JFYWNoKHJldmlldyA9PiB7XHJcbiAgICAgICAgICB1bC5hcHBlbmRDaGlsZChjcmVhdGVUbXBSZXZpZXdIVE1MKHJldmlldykpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfSk7XHJcbn07XHJcblxyXG5cclxuLyoqXHJcbiAqIEhhbmxkaW5nIGZvcm0gc3VibWl0aW9uXHJcbiAqL1xyXG4gYWRkUmV2aWV3ID0gKCkgPT4ge1xyXG4gICBjb25zdCByZXZpZXcgPSB7XHJcbiAgICByZXN0YXVyYW50X2lkOiBzZWxmLnJlc3RhdXJhbnQuaWQsXHJcbiAgICBuYW1lOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmFtZScpLnZhbHVlLFxyXG4gICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLmdldFRpbWUoKSxcclxuICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKS5nZXRUaW1lKCksXHJcbiAgICByYXRpbmc6ICtkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmF0aW5nJykudmFsdWUsXHJcbiAgICBjb21tZW50czogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbW1lbnRzJykudmFsdWUsXHJcbiAgfTtcclxuICBjb25zdCB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXdzLWxpc3QnKTtcclxuICB1bC5pbnNlcnRCZWZvcmUoY3JlYXRlUmV2aWV3SFRNTChyZXZpZXcpLCB1bC5jaGlsZE5vZGVzWzBdKTtcclxuICBpZiAoIW5hdmlnYXRvci5vbkxpbmUpIHtcclxuICAgIGFsZXJ0KCdZb3UgYXJlIGN1cnJlbnRseSBvZmZsaW5lLiBZb3VyIHJldmlldyB3aWxsIGJlIHBvc3RlZCBvbmNlIHlvdSBhcmUgb25saW5lIGFnYWluLiBUaGFuayB5b3UgZm9yIHJldmlld2luZyEnKTtcclxuICB9XHJcbiAgREJIZWxwZXIucG9zdFJldmlldyhyZXZpZXcpLnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gIG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLnJlYWR5LnRoZW4oZnVuY3Rpb24gKHN3UmVnaXN0cmF0aW9uKSB7XHJcbiAgICBzd1JlZ2lzdHJhdGlvbi5zeW5jLnJlZ2lzdGVyKCdteUZpcnN0U3luYycpO1xyXG4gICAgbG9jYXRpb24ucmVsb2FkKCk7XHJcbiAgfSk7XHJcbn0pLnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gIGZpbGxSZXZpZXdzSFRNTCgpO1xyXG59KS50aGVuKGZ1bmN0aW9uICgpIHtcclxuICBmaWxsVG1wUmV2aWV3c0hUTUwoKTtcclxufSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xyXG4gIGNvbnNvbGUuZXJyb3IoZXJyKTtcclxufSk7XHJcbn07XHJcblxyXG5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV2aWV3LWZvcm0nKS5hZGRFdmVudExpc3RlbmVyKCdzdWJtaXQnLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gIGFkZFJldmlldygpO1xyXG59KTtcclxuXHJcbi8qZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3Jldmlldy1mb3JtJylcclxuICAuYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgZnVuY3Rpb24oZSkge1xyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICAgIHZhbGlkYXRlUmV2aWV3Rm9ybUZpZWxkcygoZXJyb3IsIGRhdGEpID0+IHtcclxuICAgICAgaWYoZGF0YSkge1xyXG4gICAgICAvLyAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJyZXZpZXctZm9ybVwiKS5yZXNldCgpO1xyXG4gICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXdzLWxpc3QnKS5hcHBlbmRDaGlsZChjcmVhdGVSZXZpZXdIVE1MKGRhdGEpKTtcclxuXHJcbiAgICAgICAgLy8gUmVnaXN0ZXIgYSBTeW5jaHJvbml6YXRpb24gdGFza1xyXG4gICAgICAgIGlmKCdzZXJ2aWNlV29ya2VyJyBpbiBuYXZpZ2F0b3IgJiYgJ1N5bmNNYW5hZ2VyJyBpbiB3aW5kb3cpIHtcclxuICAgICAgICAgIG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLnJlYWR5XHJcbiAgICAgICAgICAgIC50aGVuKChzdykgPT4ge1xyXG4gICAgICAgICAgICAgIGRhdGFbJ2lkJ10gPSBEYXRlLm5vdygpO1xyXG4gICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGRhdGEpO1xyXG4gICAgICAgICAgICAgIERCSGVscGVyLnNhdmVTeW5jUmV2aWV3c0ludG9JREIoZGF0YSlcclxuICAgICAgICAgICAgICAgIC50aGVuKCgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgcmV0dXJuIHN3LnN5bmMucmVnaXN0ZXIoJ3N5bmMtbmV3LXJldmlld3MnKTtcclxuICAgICAgICAgICAgICAgIH0pLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnWW91ciByZXZpZXcgd2FzIHNhdmVkIGZvciBzeW5jaW5nIScpO1xyXG4gICAgICAgICAgICAgICAgfSkuY2F0Y2goKGUpID0+IHtcclxuICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coZSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIERCSGVscGVyLmNyZWF0ZVBvc3RSZXZpZXcoZGF0YSk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgfSlcclxufSk7XHJcbiovXHJcbi8qKlxyXG4gKiBWYWxpZGF0ZSB0aGUgZm9ybSBmaWVsZHNcclxuICovXHJcbi8qY29uc3QgdmFsaWRhdGVSZXZpZXdGb3JtRmllbGRzID0gKGNhbGxiYWNrKSA9PiB7XHJcbiAgY29uc3QgcmVzdGF1cmFudElkID0gZ2V0UGFyYW1ldGVyQnlOYW1lKCdpZCcpXHJcbiAgY29uc3QgbmFtZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNuYW1lJykudmFsdWUudHJpbSgpO1xyXG4gIGNvbnN0IHJhdGluZyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNyYXRpbmcnKS52YWx1ZS50cmltKCk7XHJcbiAgY29uc3QgY29tbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNjb21tZW50cycpLnZhbHVlLnRyaW0oKTtcclxuXHJcbiAgY29uc3QgZGF0YSA9IHtcclxuICAgIHJlc3RhdXJhbnRfaWQ6IHJlc3RhdXJhbnRJZCxcclxuICAgIG5hbWU6IG5hbWUsXHJcbiAgICByYXRpbmc6IHJhdGluZyA/IHBhcnNlSW50KHJhdGluZyk6IG51bGwsXHJcbiAgICBjb21tZW50czogY29tbWVudFxyXG4gIH1cclxuXHJcbiAgY29uc3QgZXJyb3JzX3VsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2Vycm9ycycpO1xyXG4gIGVycm9yc191bC5pbm5lckhUTUwgPSAnJztcclxuICBsZXQgZXJyb3JzID0gZmFsc2U7XHJcbiAgT2JqZWN0LmtleXMoZGF0YSkuZm9yRWFjaChmdW5jdGlvbihrKSB7XHJcbiAgICBpZiAoIWRhdGFba10pIHtcclxuICAgICAgZXJyb3JzID0gdHJ1ZTtcclxuICAgICAgY29uc29sZS5sb2coJ2VycicpO1xyXG4gICAgfVxyXG4gIH0pO1xyXG5cclxuICBkYXRhWydjcmVhdGVkQXQnXSA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xyXG5cclxuICBpZihlcnJvcnMpIHtcclxuICAgIGNhbGxiYWNrKHRydWUsIG51bGwpO1xyXG4gICAgcmV0dXJuO1xyXG4gIH1cclxuICBjYWxsYmFjayhudWxsLCBkYXRhKTtcclxufSovXHJcblxyXG4vKipcclxuICogQ3JlYXRlIHJldmlldyBIVE1MIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2UuXHJcbiAqL1xyXG5jcmVhdGVSZXZpZXdIVE1MID0gKHJldmlldykgPT4ge1xyXG4gIGNvbnN0IGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcclxuICBsaS50YWJJbmRleCA9ICcwJztcclxuXHJcbiAgY29uc3QgZGF0ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2g1Jyk7XHJcbiAgY29uc3QgbXlfZGF0ZSA9IG5ldyBEYXRlKHJldmlldy5jcmVhdGVkQXQpO1xyXG4gIGRhdGUuaW5uZXJIVE1MID0gbXlfZGF0ZS50b0RhdGVTdHJpbmcoKTtcclxuICBsaS5hcHBlbmRDaGlsZChkYXRlKTtcclxuXHJcbiAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2gxJyk7XHJcbiAgbmFtZS5pbm5lckhUTUwgPSByZXZpZXcubmFtZTtcclxuICBsaS5hcHBlbmRDaGlsZChuYW1lKTtcclxuXHJcbiAgY29uc3QgcmF0aW5nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaScpO1xyXG4gIHJhdGluZy5pbm5lckhUTUwgPSBgUmF0aW5nOiAke3Jldmlldy5yYXRpbmd9YDtcclxuICBsaS5hcHBlbmRDaGlsZChyYXRpbmcpO1xyXG5cclxuICBjb25zdCBjb21tZW50cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcclxuICBjb21tZW50cy5pbm5lckhUTUwgPSByZXZpZXcuY29tbWVudHM7XHJcbiAgbGkuYXBwZW5kQ2hpbGQoY29tbWVudHMpO1xyXG5cclxuICBjb25zdCBsYWJlbCA9IGAke3Jldmlldy5uYW1lfSBzYWlkICR7cmV2aWV3LmNvbW1lbnRzfSBhbmQgcmF0ZWQgdGhlIHJlc3RhdXJhbnQgJHtyZXZpZXcucmF0aW5nfSBvdXQgb2YgNWA7XHJcbiAgbGkuc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgbGFiZWwpO1xyXG5cclxuICByZXR1cm4gbGk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDcmVhdGUgVE1QIHJldmlldyBIVE1MIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2UuXHJcbiAqL1xyXG5jcmVhdGVUbXBSZXZpZXdIVE1MID0gKHJldmlldykgPT4ge1xyXG4gIGNvbnN0IGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcclxuICBsaS5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgJ3RtcCcpO1xyXG4gIGNvbnN0IGRpdiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gIGRpdi5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgJ3Jldmlldy1oZWFkZXInKTtcclxuICBsaS5hcHBlbmRDaGlsZChkaXYpO1xyXG5cclxuICBjb25zdCBuYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgncCcpO1xyXG4gIG5hbWUuc2V0QXR0cmlidXRlKCdjbGFzcycsICdyZXZpZXdOYW1lJyk7XHJcbiAgbmFtZS5pbm5lckhUTUwgPSByZXZpZXcubmFtZTtcclxuICBkaXYuYXBwZW5kQ2hpbGQobmFtZSk7XHJcblxyXG4gIGNvbnN0IGRhdGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XHJcbiAgZGF0ZS5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgJ3Jldmlld0RhdGUnKTtcclxuICBjb25zdCBkYXRlT3B0aW9ucyA9IHsgd2Vla2RheTogJ2xvbmcnLCB5ZWFyOiAnbnVtZXJpYycsIG1vbnRoOiAnbG9uZycsIGRheTogJ251bWVyaWMnIH07XHJcbiAgZGF0ZS5pbm5lckhUTUwgPSAobmV3IERhdGUocmV2aWV3LmNyZWF0ZWRBdCkpLnRvTG9jYWxlRGF0ZVN0cmluZygnZW4tVVMnLCBkYXRlT3B0aW9ucyk7XHJcbiAgZGl2LmFwcGVuZENoaWxkKGRhdGUpO1xyXG5cclxuICBjb25zdCByYXRpbmcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XHJcbiAgcmF0aW5nLmlubmVySFRNTCA9IGBSYXRpbmc6ICR7cmV2aWV3LnJhdGluZ31gO1xyXG4gIHJhdGluZy5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgJ3Jldmlld1JhdGluZycpO1xyXG4gIHJhdGluZy5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSByZXZpZXcucmF0aW5nID09PSA1ID8gJ2dyZWVuJyA6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldmlldy5yYXRpbmcgPiAyID8gJ29yYW5nZScgOiAncmVkJztcclxuICBsaS5hcHBlbmRDaGlsZChyYXRpbmcpO1xyXG5cclxuICBjb25zdCBjb21tZW50cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcclxuICBjb21tZW50cy5pbm5lckhUTUwgPSByZXZpZXcuY29tbWVudHM7XHJcbiAgY29tbWVudHMuc2V0QXR0cmlidXRlKCdjbGFzcycsICdyZXZpZXdDb21tZW50Jyk7XHJcbiAgbGkuYXBwZW5kQ2hpbGQoY29tbWVudHMpO1xyXG5cclxuICByZXR1cm4gbGk7XHJcbn07XHJcblxyXG4vKipcclxuICogQWRkIHJlc3RhdXJhbnQgbmFtZSB0byB0aGUgYnJlYWRjcnVtYiBuYXZpZ2F0aW9uIG1lbnVcclxuICovXHJcbmZpbGxCcmVhZGNydW1iID0gKHJlc3RhdXJhbnQ9c2VsZi5yZXN0YXVyYW50KSA9PiB7XHJcbiAgY29uc3QgYnJlYWRjcnVtYiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdicmVhZGNydW1iJyk7XHJcblx0Y29uc3QgYnJlYWRjcnVtYkVsZW1lbnRzID0gYnJlYWRjcnVtYi5xdWVyeVNlbGVjdG9yQWxsKCdsaScpO1xyXG5cdGZvciAoZWxlbWVudCBvZiBicmVhZGNydW1iRWxlbWVudHMpIHtcclxuXHRlbGVtZW50LnJlbW92ZUF0dHJpYnV0ZSgnYXJpYS1jdXJyZW50Jyk7XHJcbn1cclxuXHRjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XHJcblx0bGkuc2V0QXR0cmlidXRlKCdhcmlhLWN1cnJlbnQnLCAncGFnZScpO1xyXG5cdGlmIChicmVhZGNydW1iLmNoaWxkRWxlbWVudENvdW50ID09PSAyKSByZXR1cm47XHJcbiAgbGkuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xyXG4gIGJyZWFkY3J1bWIuYXBwZW5kQ2hpbGQobGkpO1xyXG59XHJcblxyXG4vKipcclxuICogR2V0IGEgcGFyYW1ldGVyIGJ5IG5hbWUgZnJvbSBwYWdlIFVSTC5cclxuICovXHJcbmdldFBhcmFtZXRlckJ5TmFtZSA9IChuYW1lLCB1cmwpID0+IHtcclxuICBpZiAoIXVybClcclxuICAgIHVybCA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmO1xyXG4gIG5hbWUgPSBuYW1lLnJlcGxhY2UoL1tcXFtcXF1dL2csICdcXFxcJCYnKTtcclxuICBjb25zdCByZWdleCA9IG5ldyBSZWdFeHAoYFs/Jl0ke25hbWV9KD0oW14mI10qKXwmfCN8JClgKSxcclxuICAgIHJlc3VsdHMgPSByZWdleC5leGVjKHVybCk7XHJcbiAgaWYgKCFyZXN1bHRzKVxyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgaWYgKCFyZXN1bHRzWzJdKVxyXG4gICAgcmV0dXJuICcnO1xyXG4gIHJldHVybiBkZWNvZGVVUklDb21wb25lbnQocmVzdWx0c1syXS5yZXBsYWNlKC9cXCsvZywgJyAnKSk7XHJcbn1cclxuXHJcblxyXG5cclxuXHJcbmlmIChuYXZpZ2F0b3Iuc2VydmljZVdvcmtlcikge1xyXG4gIG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLnJlZ2lzdGVyKCdzdy5qcycpXHJcbiAgICAudGhlbigoKSA9PiBjb25zb2xlLmxvZygnUGFzc2VkIFRlc3QnKSlcclxufTtcclxuIiwiXHJcbi8qKlxyXG4gKiBSZWdpc3RlciBhIHNlcnZpY2VXb3JrZXJcclxuICovXHJcbnJlZ2lzdGVyU2VydmljZVdvcmtlciA9ICgpID0+IHtcclxuICAgIC8vY2hlY2sgaWYgc2VydmljZVdvcmtlciBpcyBzdXBwb3J0ZWQsIG90aGVyd2lzZSByZXR1cm5cclxuICAgIGlmICghbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIpIHJldHVybjtcclxuXHJcbiAgICBuYXZpZ2F0b3Iuc2VydmljZVdvcmtlci5yZWdpc3RlcignL3N3LmpzJykuY2F0Y2goZnVuY3Rpb24oKXtcclxuICAgICAgY29uc29sZS5sb2coXCJTb21ldGhpbmcgd2VudCB3cm9uZy4gU2VydmljZVdvcmtlciBub3QgcmVnaXN0ZXJlZFwiKTtcclxuICAgIH0pO1xyXG4gIH07XHJcblxyXG4gIHJlZ2lzdGVyU2VydmljZVdvcmtlcigpO1xyXG4iLCJ2YXIgdnVlID0gbmV3IFZ1ZSh7XHJcbiAgZWw6ICcjYXBwJyxcclxuICBkYXRhOiB7XHJcbiAgICBmb3JtT3BlbjogZmFsc2UsXHJcbiAgICByZXZpZXc6IHtcclxuICAgICAgbmFtZTogJycsXHJcbiAgICAgIHJhdGluZzogJycsXHJcbiAgICAgIGNvbW1lbnRzOicnXHJcbiAgICB9XHJcbiAgfSxcclxuICBtZXRob2RzOiB7XHJcbiAgICByZXNldEZvcm06IGZ1bmN0aW9uICgpIHtcclxuICAgICAgdGhpcy5yZXZpZXcgPSB7XHJcbiAgICAgICAgbmFtZTogJycsXHJcbiAgICAgICAgcmF0aW5nOiAnJyxcclxuICAgICAgICBjb21tZW50czonJ1xyXG4gICAgICB9XHJcbiAgICB9LFxyXG4gICAgY2FuY2VsOiBmdW5jdGlvbigpIHtcclxuICAgICAgdGhpcy5mb3JtT3BlbiA9IGZhbHNlO1xyXG4gICAgICB0aGlzLnJlc2V0Rm9ybSgpO1xyXG4gICAgfVxyXG4gIH1cclxufSlcclxuIl19
