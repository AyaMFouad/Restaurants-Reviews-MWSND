class DBHelper{static get DATABASE_URL(){return"http://localhost:1337/restaurants"}static fetchRestaurants(e){DBHelper.fetchRestaurantsFromIDB((t,r)=>{t&&DBHelper.fetchRestaurantsFromNetwork((t,r)=>{r&&(DBHelper.saveRestaurantstoIDB(r),e(null,r)),t&&e(t,null)}),r&&e(null,r)})}static fetchReviews(e){DBHelper.fetchReviewsFromIDB((t,r)=>{t&&DBHelper.fetchReviewsFromNetwork((t,r)=>{r&&r.length&&(DBHelper.saveReviewsIntoIDB(r),e(null,r)),t&&e(t,null)}),r&&e(null,r)})}static fetchReviewsFromIDB(e){return DBHelper.openIDB().then(t=>{if(!t)return;return t.transaction("reviews").objectStore("reviews").getAll().then(t=>{if(t.length)e(null,t);else{e("There is no reviews in IDB",null)}})})}static saveReviewsIntoIDB(e){return DBHelper.openIDB().then(t=>{if(!t)return;const r=t.transaction("reviews","readwrite"),n=r.objectStore("reviews");return e.forEach(e=>{n.put(e)}),r.complete})}static saveSyncReviewsIntoIDB(e){return DBHelper.openIDB().then(t=>{if(!t)return;const r=t.transaction("sync-reviews","readwrite");return r.objectStore("sync-reviews").put(e),r.complete})}static getSyncReviewsFromIDB(){return DBHelper.openIDB().then(e=>{if(!e)return;return e.transaction("sync-reviews").objectStore("sync-reviews").getAll()})}static fetchReviewsFromNetwork(e){return fetch("http://localhost:1337/reviews").then(e=>e.json()).then(t=>{t&&e(null,t)}).catch(t=>{e("Request failed. Returned status of 404",null)})}static saveRestaurantstoIDB(e){return DBHelper.openDatabase().then(function(t){if(!t)return;let r=t.transaction("restaurants","readwrite").objectStore("restaurants");e.forEach(function(e){r.put(e)})})}static fetchRestaurantsFromNetwork(e){return fetch(DBHelper.DATABASE_URL).then(function(t){200===t.status?t.json().then(function(t){e(null,t)}):console.log("Fetch Issue - Status Code: "+t.status)}).catch(function(e){console.log("Fetch Error: ",e)})}static fetchRestaurantsFromIDB(e){return DBHelper.openDatabase().then(function(e){if(e)return e.transaction("restaurants","readwrite").objectStore("restaurants").getAll()}).then(function(t){0!==t.length&&e(null,t)})}static openDatabase(){return navigator.serviceWorker?idb.open("restaurants-db",2,e=>{switch(e.oldVersion){case 0:e.createObjectStore("restaurants",{keyPath:"id"});case 1:e.createObjectStore("reviews",{keyPath:"id"});case 2:e.createObjectStore("sync-reviews",{keyPath:"id"});case 3:e.createObjectStore("sync-favorites",{keyPath:"id"})}}):Promise.resolve()}static createPostReview(e){return fetch("http://localhost:1337/reviews/",{method:"post",body:JSON.stringify(e)}).then(e=>e.json()).then(e=>{DBHelper.saveReviewsIntoIDB([e])}).catch(e=>{console.log("something went wrong",e)})}static fetchRestaurantById(e,t){DBHelper.fetchRestaurants((r,n)=>{if(r)t(r,null);else{const r=n.find(t=>t.id==e);r?t(null,r):t("Restaurant does not exist",null)}})}static fetchRestaurantByCuisine(e,t){DBHelper.fetchRestaurants((r,n)=>{if(r)t(r,null);else{const r=n.filter(t=>t.cuisine_type==e);t(null,r)}})}static fetchRestaurantByNeighborhood(e,t){DBHelper.fetchRestaurants((r,n)=>{if(r)t(r,null);else{const r=n.filter(t=>t.neighborhood==e);t(null,r)}})}static fetchRestaurantByCuisineAndNeighborhood(e,t,r){DBHelper.fetchRestaurants((n,a)=>{if(n)r(n,null);else{let n=a;"all"!=e&&(n=n.filter(t=>t.cuisine_type==e)),"all"!=t&&(n=n.filter(e=>e.neighborhood==t)),r(null,n)}})}static fetchNeighborhoods(e){DBHelper.fetchRestaurants((t,r)=>{if(t)e(t,null);else{const t=r.map((e,t)=>r[t].neighborhood),n=t.filter((e,r)=>t.indexOf(e)==r);e(null,n)}})}static fetchCuisines(e){DBHelper.fetchRestaurants((t,r)=>{if(t)e(t,null);else{const t=r.map((e,t)=>r[t].cuisine_type),n=t.filter((e,r)=>t.indexOf(e)==r);e(null,n)}})}static urlForRestaurant(e){return`./restaurant.html?id=${e.id}`}static imageUrlForRestaurant(e){return`/img/${e.photograph}.webp`}static imageResponsiveUrlForRestaurant(e){return`/img_responsive/${e.id}-320.webp 320w,\n        /img_responsive/${e.id}-480.webp 480w,\n        /img_responsive/${e.id}-640.webp 640w,\n        /img_responsive/${e.id}-800.webp 800w`}static mapMarkerForRestaurant(e,t){return new google.maps.Marker({position:e.latlng,title:e.name,url:DBHelper.urlForRestaurant(e),map:t,animation:google.maps.Animation.DROP})}}let restaurant,reviews;var map;document.addEventListener("DOMContentLoaded",e=>{fetchRestaurantFromURL((e,t)=>{t&&(self.restaurant=t,fillBreadcrumb(),fetchReviews(),addMarkerToMap(t),updateIconData())})}),updateIconData=((e=self.restaurant)=>{const t=document.querySelector("#star-icon"),r=DBHelper.urlForToggleFavoriteLink(e);t.setAttribute("data-link",r),t.setAttribute("data-id",e.id),"true"==e.is_favorite?(t.classList.add("open"),t.setAttribute("title","unfavorite restaurant!")):(t.classList.remove("open"),t.setAttribute("title","favorite restaurant!"))});const photographAlts={1:"Sereval groups of people having quality time at a restaurant.",2:"A lovely margeritta pizza",3:"An empty restaurant setting which has heaters",4:"A corner shot of the outside of the restaurat.",5:"A crowded restaurant and staff serving food from behind the bar.",6:"Restaurant with wooden tables, charis, and a US flag as a wall decoration",7:"a dog watching from the outside of a crowded burger shop, accompanied by two men.",8:"Close up of the dutch restaurant logo beside a flowering tree",9:"Black and white picture of people eating at an asian restaurat.",10:"Empty restaurant's white chairs, walls and ceilings."};window.initMap=(()=>{fetchRestaurantFromURL((e,t)=>{e?console.error(e):(self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:t.latlng,scrollwheel:!1}),fillBreadcrumb(),DBHelper.mapMarkerForRestaurant(self.restaurant,self.map))})}),callMap=document.getElementById("mapToggle").addEventListener("click",function(e){"block"===document.getElementById("map-container").style.display?(document.getElementById("map-container").style.display="none",window.initMap()):document.getElementById("map-container").style.display="block"}),fetchRestaurantFromURL=(e=>{if(self.restaurant)return void e(null,self.restaurant);const t=getParameterByName("id");t?DBHelper.fetchRestaurantById(t,(t,r)=>{self.restaurant=r,r?(fillRestaurantHTML(),e(null,r)):console.error(t)}):(error="No restaurant id in URL",e(error,null))}),fillRestaurantHTML=((e=self.restaurant)=>{document.getElementById("restaurant-name").innerHTML=e.name,document.getElementById("restaurant-address").innerHTML=e.address;const t=document.getElementById("restaurant-img");t.className="restaurant-img",t.src=DBHelper.imageUrlForRestaurant(e),t.srcset=DBHelper.imageResponsiveUrlForRestaurant(e),t.alt=photographAlts[e.id],document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,e.operating_hours&&fillRestaurantHoursHTML(),fillReviewsHTML()}),fillRestaurantHoursHTML=((e=self.restaurant.operating_hours)=>{const t=document.getElementById("restaurant-hours");t.innerHTML="";for(let r in e){const n=document.createElement("tr"),a=document.createElement("td");a.innerHTML=r,n.appendChild(a);const s=document.createElement("td");s.innerHTML=e[r],n.appendChild(s),t.appendChild(n)}}),fillReviewsHTML=((e=self.restaurant.reviews)=>{const t=document.getElementById("reviews-container");t.innerHTML='<ul id="reviews-list"></ul>';const r=document.createElement("h2");if(r.innerHTML="Reviews",r.tabIndex="0",t.appendChild(r),!e){const e=document.createElement("p");return e.innerHTML="No reviews yet!",void t.appendChild(e)}const n=document.getElementById("reviews-list");e.forEach(e=>{n.appendChild(createReviewHTML(e))}),t.appendChild(n)}),createReviewHTML=(e=>{const t=document.createElement("li");t.tabIndex="0";const r=document.createElement("h5");r.innerHTML=e.date,t.appendChild(r);const n=document.createElement("h1");n.innerHTML=e.name,t.appendChild(n);const a=document.createElement("i");a.innerHTML=`Rating: ${e.rating}`,t.appendChild(a);const s=document.createElement("p");return s.innerHTML=e.comments,t.appendChild(s),t}),fillBreadcrumb=((e=self.restaurant)=>{const t=document.getElementById("breadcrumb"),r=t.querySelectorAll("li");for(element of r)element.removeAttribute("aria-current");const n=document.createElement("li");n.setAttribute("aria-current","page"),2!==t.childElementCount&&(n.innerHTML=e.name,t.appendChild(n))}),getParameterByName=((e,t)=>{t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");const r=new RegExp(`[?&]${e}(=([^&#]*)|&|#|$)`).exec(t);return r?r[2]?decodeURIComponent(r[2].replace(/\+/g," ")):"":null}),navigator.serviceWorker&&navigator.serviceWorker.register("sw.js").then(()=>console.log("Passed Test"));const star=document.querySelector("#star-icon");star.addEventListener("click",function(e){let t=star.dataset.link,r=star.dataset.id;"serviceWorker"in navigator&&"SyncManager"in window?navigator.serviceWorker.ready.then(e=>{self.restaurant.is_favorite="true"==self.restaurant.is_favorite?"false":"true",updateIconData(),DBHelper.saveSyncFavoritesIntoIDB({url:t,id:r}).then(()=>e.sync.register("sync-add-favorites")).then(()=>{DBHelper.updateRestaurantIsFavoriteInIDB(r)}).catch(e=>{console.log("error in syncing the favorite link",e)})}):DBHelper.addRestaurantToFavorite(t).then(()=>{DBHelper.updateRestaurantIsFavoriteInIDB(r),self.restaurant.is_favorite="false"==self.restaurant.is_favorite?"true":"false",updateIconData()})}),registerServiceWorker=(()=>{navigator.serviceWorker&&navigator.serviceWorker.register("/sw.js").catch(function(){console.log("Something went wrong. ServiceWorker not registered")})}),registerServiceWorker();var vue=new Vue({el:"#app",data:{formOpen:!1,review:{name:"",rating:"",comments:""}},methods:{resetForm:function(){this.review={name:"",rating:"",comments:""}},cancel:function(){this.formOpen=!1,this.resetForm()}}});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRiaGVscGVyLmpzIiwicmVzdGF1cmFudF9pbmZvLmpzIiwicmVnaXN0ZXJTZXJ2aWNlV29ya2VyLmpzIiwiZm9ybS5qcyJdLCJuYW1lcyI6WyJEQkhlbHBlciIsIkRBVEFCQVNFX1VSTCIsIltvYmplY3QgT2JqZWN0XSIsImNhbGxiYWNrIiwiZmV0Y2hSZXN0YXVyYW50c0Zyb21JREIiLCJlcnJvciIsInJlc3RhdXJhbnRzIiwiZmV0Y2hSZXN0YXVyYW50c0Zyb21OZXR3b3JrIiwic2F2ZVJlc3RhdXJhbnRzdG9JREIiLCJmZXRjaFJldmlld3NGcm9tSURCIiwicmV2aWV3cyIsImZldGNoUmV2aWV3c0Zyb21OZXR3b3JrIiwicmV2aWV3c0Zvcm1OZXR3b3JrIiwibGVuZ3RoIiwic2F2ZVJldmlld3NJbnRvSURCIiwib3BlbklEQiIsInRoZW4iLCJkYiIsInRyYW5zYWN0aW9uIiwib2JqZWN0U3RvcmUiLCJnZXRBbGwiLCJ0eCIsInN0b3JlIiwiZm9yRWFjaCIsInJldmlldyIsInB1dCIsImNvbXBsZXRlIiwiZmV0Y2giLCJyZXNwb25zZSIsImpzb24iLCJjYXRjaCIsImUiLCJvcGVuRGF0YWJhc2UiLCJyZXN0YXVyYW50Iiwic3RhdHVzIiwiY29uc29sZSIsImxvZyIsImVyciIsIm5hdmlnYXRvciIsInNlcnZpY2VXb3JrZXIiLCJpZGIiLCJvcGVuIiwidXBncmFkZURCIiwib2xkVmVyc2lvbiIsImNyZWF0ZU9iamVjdFN0b3JlIiwia2V5UGF0aCIsIlByb21pc2UiLCJyZXNvbHZlIiwibWV0aG9kIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJkYXRhIiwiaWQiLCJmZXRjaFJlc3RhdXJhbnRzIiwiZmluZCIsInIiLCJjdWlzaW5lIiwicmVzdWx0cyIsImZpbHRlciIsImN1aXNpbmVfdHlwZSIsIm5laWdoYm9yaG9vZCIsIm5laWdoYm9yaG9vZHMiLCJtYXAiLCJ2IiwiaSIsInVuaXF1ZU5laWdoYm9yaG9vZHMiLCJpbmRleE9mIiwiY3Vpc2luZXMiLCJ1bmlxdWVDdWlzaW5lcyIsInBob3RvZ3JhcGgiLCJnb29nbGUiLCJtYXBzIiwiTWFya2VyIiwicG9zaXRpb24iLCJsYXRsbmciLCJ0aXRsZSIsIm5hbWUiLCJ1cmwiLCJ1cmxGb3JSZXN0YXVyYW50IiwiYW5pbWF0aW9uIiwiQW5pbWF0aW9uIiwiRFJPUCIsImRvY3VtZW50IiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2ZW50IiwiZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCIsInNlbGYiLCJmaWxsQnJlYWRjcnVtYiIsImZldGNoUmV2aWV3cyIsImFkZE1hcmtlclRvTWFwIiwidXBkYXRlSWNvbkRhdGEiLCJxdWVyeVNlbGVjdG9yIiwiZmF2b3JpdGVMaW5rIiwidXJsRm9yVG9nZ2xlRmF2b3JpdGVMaW5rIiwic2V0QXR0cmlidXRlIiwiaXNfZmF2b3JpdGUiLCJjbGFzc0xpc3QiLCJhZGQiLCJyZW1vdmUiLCJwaG90b2dyYXBoQWx0cyIsIjEiLCIyIiwiMyIsIjQiLCI1IiwiNiIsIjciLCI4IiwiOSIsIjEwIiwid2luZG93IiwiaW5pdE1hcCIsIk1hcCIsImdldEVsZW1lbnRCeUlkIiwiem9vbSIsImNlbnRlciIsInNjcm9sbHdoZWVsIiwibWFwTWFya2VyRm9yUmVzdGF1cmFudCIsImNhbGxNYXAiLCJzdHlsZSIsImRpc3BsYXkiLCJnZXRQYXJhbWV0ZXJCeU5hbWUiLCJmZXRjaFJlc3RhdXJhbnRCeUlkIiwiZmlsbFJlc3RhdXJhbnRIVE1MIiwiaW5uZXJIVE1MIiwiYWRkcmVzcyIsImltYWdlIiwiY2xhc3NOYW1lIiwic3JjIiwiaW1hZ2VVcmxGb3JSZXN0YXVyYW50Iiwic3Jjc2V0IiwiaW1hZ2VSZXNwb25zaXZlVXJsRm9yUmVzdGF1cmFudCIsImFsdCIsIm9wZXJhdGluZ19ob3VycyIsImZpbGxSZXN0YXVyYW50SG91cnNIVE1MIiwiZmlsbFJldmlld3NIVE1MIiwib3BlcmF0aW5nSG91cnMiLCJob3VycyIsImtleSIsInJvdyIsImNyZWF0ZUVsZW1lbnQiLCJkYXkiLCJhcHBlbmRDaGlsZCIsInRpbWUiLCJjb250YWluZXIiLCJ0YWJJbmRleCIsIm5vUmV2aWV3cyIsInVsIiwiY3JlYXRlUmV2aWV3SFRNTCIsImxpIiwiZGF0ZSIsInJhdGluZyIsImNvbW1lbnRzIiwiYnJlYWRjcnVtYiIsImJyZWFkY3J1bWJFbGVtZW50cyIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJlbGVtZW50IiwicmVtb3ZlQXR0cmlidXRlIiwiY2hpbGRFbGVtZW50Q291bnQiLCJsb2NhdGlvbiIsImhyZWYiLCJyZXBsYWNlIiwiUmVnRXhwIiwiZXhlYyIsImRlY29kZVVSSUNvbXBvbmVudCIsInJlZ2lzdGVyIiwic3RhciIsImRhdGFzZXQiLCJsaW5rIiwicmVzdGF1cmFudElkIiwicmVhZHkiLCJzdyIsInNhdmVTeW5jRmF2b3JpdGVzSW50b0lEQiIsInN5bmMiLCJ1cGRhdGVSZXN0YXVyYW50SXNGYXZvcml0ZUluSURCIiwiYWRkUmVzdGF1cmFudFRvRmF2b3JpdGUiLCJyZWdpc3RlclNlcnZpY2VXb3JrZXIiLCJ2dWUiLCJWdWUiLCJlbCIsImZvcm1PcGVuIiwibWV0aG9kcyIsInJlc2V0Rm9ybSIsInRoaXMiLCJjYW5jZWwiXSwibWFwcGluZ3MiOiJNQUdNQSxTQU1KQywwQkFFRSxNQUFRLG9DQU1WQyx3QkFBd0JDLEdBRXRCSCxTQUFTSSx3QkFBd0IsQ0FBQ0MsRUFBT0MsS0FDcENELEdBQ0RMLFNBQVNPLDRCQUE0QixDQUFDRixFQUFPQyxLQUN4Q0EsSUFDRE4sU0FBU1EscUJBQXFCRixHQUU5QkgsRUFBUyxLQUFNRyxJQUVkRCxHQUNERixFQUFTRSxFQUFPLFFBSW5CQyxHQUNESCxFQUFTLEtBQUtHLEtBVXRCSixvQkFBb0JDLEdBQ2xCSCxTQUFTUyxvQkFBb0IsQ0FBQ0osRUFBT0ssS0FDaENMLEdBQ0RMLFNBQVNXLHdCQUF3QixDQUFDTixFQUFPTyxLQUNwQ0EsR0FBc0JBLEVBQW1CQyxTQUMxQ2IsU0FBU2MsbUJBQW1CRixHQUU1QlQsRUFBUyxLQUFNUyxJQUdkUCxHQUNERixFQUFTRSxFQUFPLFFBSW5CSyxH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QUFRLEdBQ1JDLFNBQVMsS0FHYmdDLE9BQVEsV0FDTkQsS0FBS0gsVUFBVyxFQUNoQkcsS0FBS0QiLCJmaWxlIjoiYWxsX3Jlc3RhdXJhbnQuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQ29tbW9uIGRhdGFiYXNlIGhlbHBlciBmdW5jdGlvbnMuXHJcbiAqL1xyXG5jbGFzcyBEQkhlbHBlciB7XHJcblxyXG4gIC8qKlxyXG4gICAqIERhdGFiYXNlIFVSTC5cclxuICAgKiBDaGFuZ2UgdGhpcyB0byByZXN0YXVyYW50cy5qc29uIGZpbGUgbG9jYXRpb24gb24geW91ciBzZXJ2ZXIuXHJcbiAgICovXHJcbiAgc3RhdGljIGdldCBEQVRBQkFTRV9VUkwoKSB7XHJcbiAgICBjb25zdCBwb3J0ID0gMTMzNztcclxuICAgIHJldHVybiBgaHR0cDovL2xvY2FsaG9zdDoke3BvcnR9L3Jlc3RhdXJhbnRzYDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIGFsbCByZXN0YXVyYW50cyAodXNpbmcgQVBJcylcclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50cyhjYWxsYmFjaykge1xyXG5cclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHNGcm9tSURCKChlcnJvciwgcmVzdGF1cmFudHMpID0+IHtcclxuICAgICAgaWYoZXJyb3IpIHtcclxuICAgICAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRzRnJvbU5ldHdvcmsoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICAgICAgaWYocmVzdGF1cmFudHMpIHtcclxuICAgICAgICAgICAgREJIZWxwZXIuc2F2ZVJlc3RhdXJhbnRzdG9JREIocmVzdGF1cmFudHMpO1xyXG5cclxuICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdGF1cmFudHMpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgICAgaWYoZXJyb3IpIHtcclxuICAgICAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICAgIGlmKHJlc3RhdXJhbnRzKSB7XHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCxyZXN0YXVyYW50cyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqIElCRCBBUElTICovXHJcblxyXG4gIC8qKlxyXG4gKiBGZXRjaCBSZXZpZXdzXHJcbiAqL1xyXG5zdGF0aWMgZmV0Y2hSZXZpZXdzKGNhbGxiYWNrKSB7XHJcbiAgREJIZWxwZXIuZmV0Y2hSZXZpZXdzRnJvbUlEQigoZXJyb3IsIHJldmlld3MpID0+IHtcclxuICAgIGlmKGVycm9yKSB7XHJcbiAgICAgIERCSGVscGVyLmZldGNoUmV2aWV3c0Zyb21OZXR3b3JrKChlcnJvciwgcmV2aWV3c0Zvcm1OZXR3b3JrKSA9PiB7XHJcbiAgICAgICAgaWYocmV2aWV3c0Zvcm1OZXR3b3JrICYmIHJldmlld3NGb3JtTmV0d29yay5sZW5ndGgpIHtcclxuICAgICAgICAgIERCSGVscGVyLnNhdmVSZXZpZXdzSW50b0lEQihyZXZpZXdzRm9ybU5ldHdvcmspO1xyXG5cclxuICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHJldmlld3NGb3JtTmV0d29yayk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZihlcnJvcikge1xyXG4gICAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBpZihyZXZpZXdzKSB7XHJcbiAgICAgIGNhbGxiYWNrKG51bGwsIHJldmlld3MpO1xyXG4gICAgfVxyXG5cclxuICB9KVxyXG59XHJcblxyXG4vKipcclxuICogRmV0Y2ggcmV2aWV3cyBmcm9tIEluZGV4ZWQgREJcclxuICovXHJcbnN0YXRpYyBmZXRjaFJldmlld3NGcm9tSURCKGNhbGxiYWNrKSB7XHJcbiAgLy8gY29uc3QgZGJQcm9taXNlID0gREJIZWxwZXIub3BlbklEQigpO1xyXG4gIHJldHVybiBEQkhlbHBlci5vcGVuSURCKCkudGhlbigoZGIpID0+IHtcclxuICAgIGlmKCFkYikgcmV0dXJuO1xyXG5cclxuICAgIGNvbnN0IHR4ID0gZGIudHJhbnNhY3Rpb24oJ3Jldmlld3MnKTtcclxuICAgIGNvbnN0IHN0b3JlID0gIHR4Lm9iamVjdFN0b3JlKCdyZXZpZXdzJyk7XHJcblxyXG4gICAgcmV0dXJuIHN0b3JlLmdldEFsbCgpLnRoZW4oKHJldmlld3MpID0+IHtcclxuICAgICAgaWYocmV2aWV3cy5sZW5ndGgpIHtcclxuICAgICAgICBjYWxsYmFjayhudWxsLCByZXZpZXdzKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjb25zdCBlcnJvciA9ICdUaGVyZSBpcyBubyByZXZpZXdzIGluIElEQic7XHJcbiAgICAgICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9KTtcclxufVxyXG5cclxuLyoqXHJcbiogU2F2ZSByZXZpZXdzIGludG8gdGhlIGluZGV4ZWQgREJcclxuKi9cclxuc3RhdGljIHNhdmVSZXZpZXdzSW50b0lEQihyZXZpZXdzKSB7XHJcblxyXG4gIHJldHVybiBEQkhlbHBlci5vcGVuSURCKCkudGhlbigoZGIpID0+IHtcclxuICAgIGlmKCFkYikgcmV0dXJuO1xyXG4gICAgY29uc3QgdHggPSBkYi50cmFuc2FjdGlvbigncmV2aWV3cycsICdyZWFkd3JpdGUnKVxyXG4gICAgY29uc3Qgc3RvcmUgPSB0eC5vYmplY3RTdG9yZSgncmV2aWV3cycpO1xyXG4gICAgcmV2aWV3cy5mb3JFYWNoKChyZXZpZXcpID0+IHtcclxuICAgICAgc3RvcmUucHV0KHJldmlldyk7XHJcbiAgICB9KTtcclxuICAgIHJldHVybiB0eC5jb21wbGV0ZTtcclxuICB9KTtcclxufVxyXG5cclxuLyoqXHJcbiogU2F2ZSBTeW5jIHJldmlld3MgaW50byB0aGUgaW5kZXhlZCBEQlxyXG4qL1xyXG5zdGF0aWMgc2F2ZVN5bmNSZXZpZXdzSW50b0lEQihyZXZpZXcpIHtcclxuICByZXR1cm4gREJIZWxwZXIub3BlbklEQigpLnRoZW4oKGRiKSA9PiB7XHJcbiAgICBpZighZGIpIHJldHVybjtcclxuICAgIGNvbnN0IHR4ID0gZGIudHJhbnNhY3Rpb24oJ3N5bmMtcmV2aWV3cycsICdyZWFkd3JpdGUnKVxyXG4gICAgY29uc3Qgc3RvcmUgPSB0eC5vYmplY3RTdG9yZSgnc3luYy1yZXZpZXdzJyk7XHJcbiAgICBzdG9yZS5wdXQocmV2aWV3KTtcclxuICAgIHJldHVybiB0eC5jb21wbGV0ZTtcclxuICB9KTtcclxufVxyXG5cclxuLyoqXHJcbiAqIGdldCBhbGwgc3luY2luZyByZXZpZXdzXHJcbiAqL1xyXG5zdGF0aWMgZ2V0U3luY1Jldmlld3NGcm9tSURCKCkge1xyXG4gIHJldHVybiBEQkhlbHBlci5vcGVuSURCKCkudGhlbigoZGIpID0+IHtcclxuICAgICAgaWYoIWRiKSByZXR1cm47XHJcblxyXG4gICAgICBjb25zdCB0eCA9IGRiLnRyYW5zYWN0aW9uKCdzeW5jLXJldmlld3MnKTtcclxuICAgICAgY29uc3Qgc3RvcmUgPSAgdHgub2JqZWN0U3RvcmUoJ3N5bmMtcmV2aWV3cycpO1xyXG5cclxuICAgICAgcmV0dXJuIHN0b3JlLmdldEFsbCgpO1xyXG4gIH0pO1xyXG59XHJcblxyXG4vKipcclxuICogRmV0Y2ggcmV2aWV3cyBmcm9tIG5ldHdvcmtcclxuICovXHJcbnN0YXRpYyBmZXRjaFJldmlld3NGcm9tTmV0d29yayhjYWxsYmFjaykge1xyXG5cclxuICBjb25zdCB1cmwgPSBcImh0dHA6Ly9sb2NhbGhvc3Q6MTMzNy9yZXZpZXdzXCI7XHJcbiAgcmV0dXJuIGZldGNoKHVybCkudGhlbigocmVzcG9uc2UpID0+IHtcclxuICAgIHJldHVybiByZXNwb25zZS5qc29uKCk7XHJcbiAgfSkudGhlbigocmV2aWV3cykgPT4ge1xyXG4gICAgaWYocmV2aWV3cykge1xyXG4gICAgICBjYWxsYmFjayhudWxsLCByZXZpZXdzKTtcclxuICAgIH1cclxuICB9KS5jYXRjaChlID0+IHtcclxuICAgIGNvbnN0IGVycm9yID0gKGBSZXF1ZXN0IGZhaWxlZC4gUmV0dXJuZWQgc3RhdHVzIG9mIDQwNGApO1xyXG4gICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG4gIH0pO1xyXG59XHJcblxyXG4gIC8qIEFkZCByZXN0YXVyYW50cyB0byBpbmRleGVkREIgKi9cclxuICBzdGF0aWMgc2F2ZVJlc3RhdXJhbnRzdG9JREIocmVzdGF1cmFudHMpe1xyXG4gIHJldHVybiBEQkhlbHBlci5vcGVuRGF0YWJhc2UoKS50aGVuKGZ1bmN0aW9uIChkYikge1xyXG4gICAgaWYgKCFkYikgcmV0dXJuO1xyXG4gICAgICBsZXQgc3RvcmUgPSBkYi50cmFuc2FjdGlvbigncmVzdGF1cmFudHMnLCAncmVhZHdyaXRlJylcclxuICAgICAgICAgICAgICAgICAgICAub2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnRzJyk7XHJcbiAgICAgIHJlc3RhdXJhbnRzLmZvckVhY2goZnVuY3Rpb24gKHJlc3RhdXJhbnQpIHtcclxuICAgICAgICBzdG9yZS5wdXQocmVzdGF1cmFudCk7XHJcbiAgICAgIH0pO1xyXG4gIH0pO1xyXG59XHJcblxyXG4vKmZldGNoIHJlc3RhdXJhbnRzIGZyb20gbmV0d29yayovXHJcbnN0YXRpYyBmZXRjaFJlc3RhdXJhbnRzRnJvbU5ldHdvcmsoY2FsbGJhY2spIHtcclxuICByZXR1cm4gICAgIGZldGNoKERCSGVscGVyLkRBVEFCQVNFX1VSTClcclxuICAgICAgLnRoZW4oXHJcbiAgICAgICAgZnVuY3Rpb24gKHJlc3BvbnNlKSB7XHJcbiAgICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ0ZldGNoIElzc3VlIC0gU3RhdHVzIENvZGU6ICcgKyByZXNwb25zZS5zdGF0dXMpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgICByZXNwb25zZS5qc29uKCkudGhlbihmdW5jdGlvbiAocmVzdGF1cmFudHMpIHtcclxuICAgICAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdGF1cmFudHMpO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICApXHJcbiAgICAgIC5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ0ZldGNoIEVycm9yOiAnLCBlcnIpO1xyXG4gICAgICB9KTtcclxufVxyXG5cclxuLyoqZmV0Y2ggcmVzdGF1cmFudHMgZnJvbSBpZGIqL1xyXG5zdGF0aWMgZmV0Y2hSZXN0YXVyYW50c0Zyb21JREIoY2FsbGJhY2spIHtcclxuICByZXR1cm4gIERCSGVscGVyLm9wZW5EYXRhYmFzZSgpLnRoZW4oZnVuY3Rpb24gKGRiKSB7XHJcbiAgICAgICAgaWYgKCFkYikgcmV0dXJuO1xyXG4gICAgICAgICAgcmV0dXJuIGRiLnRyYW5zYWN0aW9uKCdyZXN0YXVyYW50cycsICdyZWFkd3JpdGUnKVxyXG4gICAgICAgICAgICAgICAgICAgLm9iamVjdFN0b3JlKCdyZXN0YXVyYW50cycpXHJcbiAgICAgICAgICAgICAgICAgICAuZ2V0QWxsKCk7XHJcbiAgICAgIH0pLnRoZW4oZnVuY3Rpb24gKHJlc3RhdXJhbnRzKSB7XHJcbiAgICAgICAgaWYgKHJlc3RhdXJhbnRzLmxlbmd0aCA9PT0gMCkgcmV0dXJuO1xyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3RhdXJhbnRzKTtcclxuICAgICAgfSk7XHJcbn1cclxuXHJcblxyXG4gICAvLyBJREIgY3JlYXRpb25cclxuXHJcblxyXG4gIHN0YXRpYyBvcGVuRGF0YWJhc2UgKCkge1xyXG5cclxuICAgIGlmICghbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIpIHtcclxuICAgICAgLy9jb25zb2xlLmxvZyhgU2VydmljZSBXb3JrZXJzIGlzIG5vdCBzdXBwb3J0ZWQgYnkgYnJvd3NlcnNgKTtcclxuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiBpZGIub3BlbigncmVzdGF1cmFudHMtZGInLCAyLCAodXBncmFkZURCKSA9PiB7XHJcbiAgICAgIHN3aXRjaCAodXBncmFkZURCLm9sZFZlcnNpb24pIHtcclxuICAgICAgICBjYXNlIDA6XHJcbiAgICAgICAgICB1cGdyYWRlREIuY3JlYXRlT2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnRzJywge1xyXG4gICAgICAgICAgICBrZXlQYXRoOiAnaWQnXHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICBjYXNlIDE6XHJcbiAgICAgICAgICB1cGdyYWRlREIuY3JlYXRlT2JqZWN0U3RvcmUoJ3Jldmlld3MnLCB7XHJcbiAgICAgICAgICAgIGtleVBhdGg6ICdpZCdcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIGNhc2UgMjpcclxuICAgICAgICAgIHVwZ3JhZGVEQi5jcmVhdGVPYmplY3RTdG9yZSgnc3luYy1yZXZpZXdzJywge1xyXG4gICAgICAgICAgICBrZXlQYXRoOiAnaWQnXHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICBjYXNlIDM6XHJcbiAgICAgICAgICB1cGdyYWRlREIuY3JlYXRlT2JqZWN0U3RvcmUoJ3N5bmMtZmF2b3JpdGVzJywge1xyXG4gICAgICAgICAgICBrZXlQYXRoOiAnaWQnXHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG5cclxuICAvKipjcmVhdGUgcmV2aWV3Ki9cclxuXHJcbiAgc3RhdGljIGNyZWF0ZVBvc3RSZXZpZXcgKHJldmlldykge1xyXG4gIGNvbnN0IHVybCA9ICdodHRwOi8vbG9jYWxob3N0OjEzMzcvcmV2aWV3cy8nO1xyXG4gIHJldHVybiBmZXRjaCh1cmwsIHtcclxuICAgIG1ldGhvZDogJ3Bvc3QnLFxyXG4gICAgYm9keTogSlNPTi5zdHJpbmdpZnkocmV2aWV3KSxcclxuICB9KS50aGVuKHJlc3BvbnNlID0+IHtcclxuICAgIHJldHVybiByZXNwb25zZS5qc29uKCk7XHJcbiAgfSkudGhlbigoZGF0YSkgPT4ge1xyXG4gICAgLy8gY29uc29sZS5sb2coZGF0YSk7XHJcbiAgICBEQkhlbHBlci5zYXZlUmV2aWV3c0ludG9JREIoW2RhdGFdKTtcclxuICB9KS5jYXRjaCgoZSkgPT4ge1xyXG4gICAgY29uc29sZS5sb2coJ3NvbWV0aGluZyB3ZW50IHdyb25nJywgZSk7XHJcbiAgfSlcclxufVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCBhIHJlc3RhdXJhbnQgYnkgaXRzIElELlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeUlkKGlkLCBjYWxsYmFjaykge1xyXG4gICAgLy8gZmV0Y2ggYWxsIHJlc3RhdXJhbnRzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjb25zdCByZXN0YXVyYW50ID0gcmVzdGF1cmFudHMuZmluZChyID0+IHIuaWQgPT0gaWQpO1xyXG4gICAgICAgIGlmIChyZXN0YXVyYW50KSB7IC8vIEdvdCB0aGUgcmVzdGF1cmFudFxyXG4gICAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdGF1cmFudCk7XHJcbiAgICAgICAgfSBlbHNlIHsgLy8gUmVzdGF1cmFudCBkb2VzIG5vdCBleGlzdCBpbiB0aGUgZGF0YWJhc2VcclxuICAgICAgICAgIGNhbGxiYWNrKCdSZXN0YXVyYW50IGRvZXMgbm90IGV4aXN0JywgbnVsbCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgY3Vpc2luZSB0eXBlIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmUoY3Vpc2luZSwgY2FsbGJhY2spIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50cyAgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmdcclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gRmlsdGVyIHJlc3RhdXJhbnRzIHRvIGhhdmUgb25seSBnaXZlbiBjdWlzaW5lIHR5cGVcclxuICAgICAgICBjb25zdCByZXN1bHRzID0gcmVzdGF1cmFudHMuZmlsdGVyKHIgPT4gci5jdWlzaW5lX3R5cGUgPT0gY3Vpc2luZSk7XHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0cyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBuZWlnaGJvcmhvb2Qgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5TmVpZ2hib3Job29kKG5laWdoYm9yaG9vZCwgY2FsbGJhY2spIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBGaWx0ZXIgcmVzdGF1cmFudHMgdG8gaGF2ZSBvbmx5IGdpdmVuIG5laWdoYm9yaG9vZFxyXG4gICAgICAgIGNvbnN0IHJlc3VsdHMgPSByZXN0YXVyYW50cy5maWx0ZXIociA9PiByLm5laWdoYm9yaG9vZCA9PSBuZWlnaGJvcmhvb2QpO1xyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdHMpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgY3Vpc2luZSBhbmQgYSBuZWlnaGJvcmhvb2Qgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZChjdWlzaW5lLCBuZWlnaGJvcmhvb2QsIGNhbGxiYWNrKSB7XHJcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgbGV0IHJlc3VsdHMgPSByZXN0YXVyYW50cztcclxuICAgICAgICBpZiAoY3Vpc2luZSAhPSAnYWxsJykgeyAvLyBmaWx0ZXIgYnkgY3Vpc2luZVxyXG4gICAgICAgICAgcmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKHIgPT4gci5jdWlzaW5lX3R5cGUgPT0gY3Vpc2luZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAobmVpZ2hib3Job29kICE9ICdhbGwnKSB7IC8vIGZpbHRlciBieSBuZWlnaGJvcmhvb2RcclxuICAgICAgICAgIHJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcihyID0+IHIubmVpZ2hib3Job29kID09IG5laWdoYm9yaG9vZCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHRzKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCBhbGwgbmVpZ2hib3Job29kcyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hOZWlnaGJvcmhvb2RzKGNhbGxiYWNrKSB7XHJcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gR2V0IGFsbCBuZWlnaGJvcmhvb2RzIGZyb20gYWxsIHJlc3RhdXJhbnRzXHJcbiAgICAgICAgY29uc3QgbmVpZ2hib3Job29kcyA9IHJlc3RhdXJhbnRzLm1hcCgodiwgaSkgPT4gcmVzdGF1cmFudHNbaV0ubmVpZ2hib3Job29kKTtcclxuXHJcbiAgICAgICAgLy8gUmVtb3ZlIGR1cGxpY2F0ZXMgZnJvbSBuZWlnaGJvcmhvb2RzXHJcbiAgICAgICAgY29uc3QgdW5pcXVlTmVpZ2hib3Job29kcyA9IG5laWdoYm9yaG9vZHMuZmlsdGVyKCh2LCBpKSA9PiBuZWlnaGJvcmhvb2RzLmluZGV4T2YodikgPT0gaSk7XHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgdW5pcXVlTmVpZ2hib3Job29kcyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggYWxsIGN1aXNpbmVzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaEN1aXNpbmVzKGNhbGxiYWNrKSB7XHJcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gR2V0IGFsbCBjdWlzaW5lcyBmcm9tIGFsbCByZXN0YXVyYW50c1xyXG4gICAgICAgIGNvbnN0IGN1aXNpbmVzID0gcmVzdGF1cmFudHMubWFwKCh2LCBpKSA9PiByZXN0YXVyYW50c1tpXS5jdWlzaW5lX3R5cGUpO1xyXG5cclxuICAgICAgICAvLyBSZW1vdmUgZHVwbGljYXRlcyBmcm9tIGN1aXNpbmVzXHJcbiAgICAgICAgY29uc3QgdW5pcXVlQ3Vpc2luZXMgPSBjdWlzaW5lcy5maWx0ZXIoKHYsIGkpID0+IGN1aXNpbmVzLmluZGV4T2YodikgPT0gaSk7XHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgdW5pcXVlQ3Vpc2luZXMpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJlc3RhdXJhbnQgcGFnZSBVUkwuXHJcbiAgICovXHJcbiAgc3RhdGljIHVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xyXG4gICAgcmV0dXJuIChgLi9yZXN0YXVyYW50Lmh0bWw/aWQ9JHtyZXN0YXVyYW50LmlkfWApO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVzdGF1cmFudCBpbWFnZSBVUkwuXHJcbiAgICovXHJcbiAgc3RhdGljIGltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XHJcbiAgICByZXR1cm4gKGAvaW1nLyR7cmVzdGF1cmFudC5waG90b2dyYXBofS53ZWJwYCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICogUmVzdGF1cmFudCByZXNwb25zaXZlIGltYWdlcyBzb3VyY2Ugc2V0LlxyXG4gKi9cclxuc3RhdGljIGltYWdlUmVzcG9uc2l2ZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCkge1xyXG4gICAgY29uc3Qgc2NhbGUxeCA9ICczMjAnO1xyXG4gICAgY29uc3Qgc2NhbGUxXzV4ID0gJzQ4MCc7XHJcbiAgICBjb25zdCBzY2FsZTJ4ID0gJzY0MCc7XHJcbiAgICBjb25zdCBzY2FsZTN4ID0gJzgwMCc7XHJcblxyXG4gICAgcmV0dXJuIChcclxuICAgICAgICBgL2ltZ19yZXNwb25zaXZlLyR7cmVzdGF1cmFudC5pZH0tJHtzY2FsZTF4fS53ZWJwICR7c2NhbGUxeH13LFxyXG4gICAgICAgIC9pbWdfcmVzcG9uc2l2ZS8ke3Jlc3RhdXJhbnQuaWR9LSR7c2NhbGUxXzV4fS53ZWJwICR7c2NhbGUxXzV4fXcsXHJcbiAgICAgICAgL2ltZ19yZXNwb25zaXZlLyR7cmVzdGF1cmFudC5pZH0tJHtzY2FsZTJ4fS53ZWJwICR7c2NhbGUyeH13LFxyXG4gICAgICAgIC9pbWdfcmVzcG9uc2l2ZS8ke3Jlc3RhdXJhbnQuaWR9LSR7c2NhbGUzeH0ud2VicCAke3NjYWxlM3h9d2ApO1xyXG59XHJcblxyXG4gIC8qKlxyXG4gICAqIE1hcCBtYXJrZXIgZm9yIGEgcmVzdGF1cmFudC5cclxuICAgKi9cclxuICBzdGF0aWMgbWFwTWFya2VyRm9yUmVzdGF1cmFudChyZXN0YXVyYW50LCBtYXApIHtcclxuICAgIGNvbnN0IG1hcmtlciA9IG5ldyBnb29nbGUubWFwcy5NYXJrZXIoe1xyXG4gICAgICBwb3NpdGlvbjogcmVzdGF1cmFudC5sYXRsbmcsXHJcbiAgICAgIHRpdGxlOiByZXN0YXVyYW50Lm5hbWUsXHJcbiAgICAgIHVybDogREJIZWxwZXIudXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSxcclxuICAgICAgbWFwOiBtYXAsXHJcbiAgICAgIGFuaW1hdGlvbjogZ29vZ2xlLm1hcHMuQW5pbWF0aW9uLkRST1AsXHJcbiAgICB9KTtcclxuICAgIHJldHVybiBtYXJrZXI7XHJcbiAgfVxyXG5cclxufVxyXG4iLCJsZXQgcmVzdGF1cmFudDtcclxubGV0IHJldmlld3M7XHJcbnZhciBtYXA7XHJcblxyXG4vKipmZXRjaCByZXN0YXVyYW50IGFuZCByZXZpZXdzIGFzIHNvb24gYXMgdGhlIHBhZ2UgbG9hZHMgKi9cclxuZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIChldmVudCkgPT4ge1xyXG4gIGZldGNoUmVzdGF1cmFudEZyb21VUkwoKGVycm9yLCByZXN0YXVyYW50KSA9PiB7XHJcbiAgICBpZihyZXN0YXVyYW50KSB7XHJcbiAgICAgIHNlbGYucmVzdGF1cmFudCA9IHJlc3RhdXJhbnQ7XHJcbiAgICAgIGZpbGxCcmVhZGNydW1iKCk7XHJcbiAgICAgIC8vIEZldGNoIEFsbCBSZXZpZXdzO1xyXG4gICAgICBmZXRjaFJldmlld3MoKTtcclxuICAgICAgYWRkTWFya2VyVG9NYXAocmVzdGF1cmFudCk7XHJcbiAgICAgIHVwZGF0ZUljb25EYXRhKCk7XHJcbiAgICB9XHJcbiAgfSk7XHJcbn0pO1xyXG5cclxuIHVwZGF0ZUljb25EYXRhID0gKHJlc3RhdXJhbnQgPSBzZWxmLnJlc3RhdXJhbnQpID0+IHtcclxuICBjb25zdCBpID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3N0YXItaWNvbicpO1xyXG4gIGNvbnN0IGZhdm9yaXRlTGluayA9IERCSGVscGVyLnVybEZvclRvZ2dsZUZhdm9yaXRlTGluayhyZXN0YXVyYW50KTtcclxuICBpLnNldEF0dHJpYnV0ZSgnZGF0YS1saW5rJywgZmF2b3JpdGVMaW5rKTtcclxuICBpLnNldEF0dHJpYnV0ZSgnZGF0YS1pZCcsIHJlc3RhdXJhbnQuaWQpO1xyXG4gIGlmKHJlc3RhdXJhbnQuaXNfZmF2b3JpdGUgPT0gJ3RydWUnKSB7XHJcbiAgICBpLmNsYXNzTGlzdC5hZGQoJ29wZW4nKTtcclxuICAgIGkuc2V0QXR0cmlidXRlKCd0aXRsZScsICd1bmZhdm9yaXRlIHJlc3RhdXJhbnQhJyk7XHJcbiAgfSBlbHNlIHtcclxuICAgIGkuY2xhc3NMaXN0LnJlbW92ZSgnb3BlbicpO1xyXG4gICAgaS5zZXRBdHRyaWJ1dGUoJ3RpdGxlJywgJ2Zhdm9yaXRlIHJlc3RhdXJhbnQhJyk7XHJcbiAgfVxyXG59XHJcblxyXG5cclxuLypcclxuU2V0dGluZyBwaG90b2dyYXBocyBhbHRzKi9cclxuXHJcbmNvbnN0IHBob3RvZ3JhcGhBbHRzID0ge1xyXG5cdDE6IFwiU2VyZXZhbCBncm91cHMgb2YgcGVvcGxlIGhhdmluZyBxdWFsaXR5IHRpbWUgYXQgYSByZXN0YXVyYW50LlwiLFxyXG5cdDI6IFwiQSBsb3ZlbHkgbWFyZ2VyaXR0YSBwaXp6YVwiLFxyXG5cdDM6IFwiQW4gZW1wdHkgcmVzdGF1cmFudCBzZXR0aW5nIHdoaWNoIGhhcyBoZWF0ZXJzXCIsXHJcblx0NDogXCJBIGNvcm5lciBzaG90IG9mIHRoZSBvdXRzaWRlIG9mIHRoZSByZXN0YXVyYXQuXCIsXHJcblx0NTogXCJBIGNyb3dkZWQgcmVzdGF1cmFudCBhbmQgc3RhZmYgc2VydmluZyBmb29kIGZyb20gYmVoaW5kIHRoZSBiYXIuXCIsXHJcblx0NjogXCJSZXN0YXVyYW50IHdpdGggd29vZGVuIHRhYmxlcywgY2hhcmlzLCBhbmQgYSBVUyBmbGFnIGFzIGEgd2FsbCBkZWNvcmF0aW9uXCIsXHJcblx0NzogXCJhIGRvZyB3YXRjaGluZyBmcm9tIHRoZSBvdXRzaWRlIG9mIGEgY3Jvd2RlZCBidXJnZXIgc2hvcCwgYWNjb21wYW5pZWQgYnkgdHdvIG1lbi5cIixcclxuXHQ4OiBcIkNsb3NlIHVwIG9mIHRoZSBkdXRjaCByZXN0YXVyYW50IGxvZ28gYmVzaWRlIGEgZmxvd2VyaW5nIHRyZWVcIixcclxuXHQ5OiBcIkJsYWNrIGFuZCB3aGl0ZSBwaWN0dXJlIG9mIHBlb3BsZSBlYXRpbmcgYXQgYW4gYXNpYW4gcmVzdGF1cmF0LlwiLFxyXG5cdDEwOiBcIkVtcHR5IHJlc3RhdXJhbnQncyB3aGl0ZSBjaGFpcnMsIHdhbGxzIGFuZCBjZWlsaW5ncy5cIlxyXG59O1xyXG5cclxuXHJcblxyXG4vKipcclxuICogSW5pdGlhbGl6ZSBHb29nbGUgbWFwLCBjYWxsZWQgZnJvbSBIVE1MLlxyXG4gKi9cclxud2luZG93LmluaXRNYXAgPSAoKSA9PiB7XHJcbiAgZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCgoZXJyb3IsIHJlc3RhdXJhbnQpID0+IHtcclxuICAgIGlmIChlcnJvcikgeyAvLyBHb3QgYW4gZXJyb3IhXHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgc2VsZi5tYXAgPSBuZXcgZ29vZ2xlLm1hcHMuTWFwKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKSwge1xyXG4gICAgICAgIHpvb206IDE2LFxyXG4gICAgICAgIGNlbnRlcjogcmVzdGF1cmFudC5sYXRsbmcsXHJcbiAgICAgICAgc2Nyb2xsd2hlZWw6IGZhbHNlXHJcbiAgICAgIH0pO1xyXG4gICAgICBmaWxsQnJlYWRjcnVtYigpO1xyXG4gICAgICBEQkhlbHBlci5tYXBNYXJrZXJGb3JSZXN0YXVyYW50KHNlbGYucmVzdGF1cmFudCwgc2VsZi5tYXApO1xyXG4gICAgfVxyXG4gIH0pO1xyXG59XHJcblxyXG4vKipcclxuU2hvdyBtYXAgYnV0dG9uXHJcbiovXHJcbmNhbGxNYXAgPVxyXG5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFwVG9nZ2xlJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbihldmVudCkge1xyXG4gIGlmICgoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcC1jb250YWluZXInKS5zdHlsZS5kaXNwbGF5KSA9PT0gJ2Jsb2NrJykge1xyXG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcC1jb250YWluZXInKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xyXG4gICAgd2luZG93LmluaXRNYXAoKTtcclxuICB9IGVsc2Uge1xyXG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcC1jb250YWluZXInKS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJztcclxuICB9XHJcbn0pO1xyXG4vKipcclxuICogR2V0IGN1cnJlbnQgcmVzdGF1cmFudCBmcm9tIHBhZ2UgVVJMLlxyXG4gKi9cclxuZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCA9IChjYWxsYmFjaykgPT4ge1xyXG4gIGlmIChzZWxmLnJlc3RhdXJhbnQpIHsgLy8gcmVzdGF1cmFudCBhbHJlYWR5IGZldGNoZWQhXHJcbiAgICBjYWxsYmFjayhudWxsLCBzZWxmLnJlc3RhdXJhbnQpXHJcbiAgICByZXR1cm47XHJcbiAgfVxyXG4gIGNvbnN0IGlkID0gZ2V0UGFyYW1ldGVyQnlOYW1lKCdpZCcpO1xyXG4gIGlmICghaWQpIHsgLy8gbm8gaWQgZm91bmQgaW4gVVJMXHJcbiAgICBlcnJvciA9ICdObyByZXN0YXVyYW50IGlkIGluIFVSTCdcclxuICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICB9IGVsc2Uge1xyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50QnlJZChpZCwgKGVycm9yLCByZXN0YXVyYW50KSA9PiB7XHJcbiAgICAgIHNlbGYucmVzdGF1cmFudCA9IHJlc3RhdXJhbnQ7XHJcbiAgICAgIGlmICghcmVzdGF1cmFudCkge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgICBmaWxsUmVzdGF1cmFudEhUTUwoKTtcclxuICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdGF1cmFudClcclxuICAgIH0pO1xyXG4gIH1cclxufVxyXG5cclxuLyoqXHJcbiAqIENyZWF0ZSByZXN0YXVyYW50IEhUTUwgYW5kIGFkZCBpdCB0byB0aGUgd2VicGFnZVxyXG4gKi9cclxuZmlsbFJlc3RhdXJhbnRIVE1MID0gKHJlc3RhdXJhbnQgPSBzZWxmLnJlc3RhdXJhbnQpID0+IHtcclxuICBjb25zdCBuYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtbmFtZScpO1xyXG4gIG5hbWUuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xyXG5cclxuICBjb25zdCBhZGRyZXNzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtYWRkcmVzcycpO1xyXG4gIGFkZHJlc3MuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5hZGRyZXNzO1xyXG5cclxuICBjb25zdCBpbWFnZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWltZycpO1xyXG4gIGltYWdlLmNsYXNzTmFtZSA9ICdyZXN0YXVyYW50LWltZydcclxuICBpbWFnZS5zcmMgPSBEQkhlbHBlci5pbWFnZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCk7XHJcblx0aW1hZ2Uuc3Jjc2V0ID0gREJIZWxwZXIuaW1hZ2VSZXNwb25zaXZlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KTtcclxuICBpbWFnZS5hbHQgPSBwaG90b2dyYXBoQWx0c1tyZXN0YXVyYW50LmlkXTtcclxuXHJcbiAgY29uc3QgY3Vpc2luZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWN1aXNpbmUnKTtcclxuICBjdWlzaW5lLmlubmVySFRNTCA9IHJlc3RhdXJhbnQuY3Vpc2luZV90eXBlO1xyXG5cclxuICAvLyBmaWxsIG9wZXJhdGluZyBob3Vyc1xyXG4gIGlmIChyZXN0YXVyYW50Lm9wZXJhdGluZ19ob3Vycykge1xyXG4gICAgZmlsbFJlc3RhdXJhbnRIb3Vyc0hUTUwoKTtcclxuICB9XHJcbiAgLy8gZmlsbCByZXZpZXdzXHJcbiAgZmlsbFJldmlld3NIVE1MKCk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDcmVhdGUgcmVzdGF1cmFudCBvcGVyYXRpbmcgaG91cnMgSFRNTCB0YWJsZSBhbmQgYWRkIGl0IHRvIHRoZSB3ZWJwYWdlLlxyXG4gKi9cclxuZmlsbFJlc3RhdXJhbnRIb3Vyc0hUTUwgPSAob3BlcmF0aW5nSG91cnMgPSBzZWxmLnJlc3RhdXJhbnQub3BlcmF0aW5nX2hvdXJzKSA9PiB7XHJcbiAgY29uc3QgaG91cnMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1ob3VycycpO1xyXG5cdGhvdXJzLmlubmVySFRNTCA9ICcnO1xyXG4gIGZvciAobGV0IGtleSBpbiBvcGVyYXRpbmdIb3Vycykge1xyXG4gICAgY29uc3Qgcm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTtcclxuXHJcbiAgICBjb25zdCBkYXkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xyXG4gICAgZGF5LmlubmVySFRNTCA9IGtleTtcclxuICAgIHJvdy5hcHBlbmRDaGlsZChkYXkpO1xyXG5cclxuICAgIGNvbnN0IHRpbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xyXG4gICAgdGltZS5pbm5lckhUTUwgPSBvcGVyYXRpbmdIb3Vyc1trZXldO1xyXG4gICAgcm93LmFwcGVuZENoaWxkKHRpbWUpO1xyXG5cclxuICAgIGhvdXJzLmFwcGVuZENoaWxkKHJvdyk7XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogQ3JlYXRlIGFsbCByZXZpZXdzIEhUTUwgYW5kIGFkZCB0aGVtIHRvIHRoZSB3ZWJwYWdlLlxyXG4gKi9cclxuZmlsbFJldmlld3NIVE1MID0gKHJldmlld3MgPSBzZWxmLnJlc3RhdXJhbnQucmV2aWV3cykgPT4ge1xyXG4gIGNvbnN0IGNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXdzLWNvbnRhaW5lcicpO1xyXG5cdGNvbnRhaW5lci5pbm5lckhUTUwgPSAnPHVsIGlkPVwicmV2aWV3cy1saXN0XCI+PC91bD4nO1xyXG5cdGNvbnN0IHRpdGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaDInKTtcclxuICB0aXRsZS5pbm5lckhUTUwgPSAnUmV2aWV3cyc7XHJcbiAgdGl0bGUudGFiSW5kZXggPSAnMCc7XHJcbiAgY29udGFpbmVyLmFwcGVuZENoaWxkKHRpdGxlKTtcclxuXHJcbiAgaWYgKCFyZXZpZXdzKSB7XHJcbiAgICBjb25zdCBub1Jldmlld3MgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XHJcbiAgICBub1Jldmlld3MuaW5uZXJIVE1MID0gJ05vIHJldmlld3MgeWV0ISc7XHJcbiAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQobm9SZXZpZXdzKTtcclxuICAgIHJldHVybjtcclxuICB9XHJcbiAgY29uc3QgdWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV2aWV3cy1saXN0Jyk7XHJcbiAgcmV2aWV3cy5mb3JFYWNoKHJldmlldyA9PiB7XHJcbiAgICB1bC5hcHBlbmRDaGlsZChjcmVhdGVSZXZpZXdIVE1MKHJldmlldykpO1xyXG4gIH0pO1xyXG4gIGNvbnRhaW5lci5hcHBlbmRDaGlsZCh1bCk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDcmVhdGUgcmV2aWV3IEhUTUwgYW5kIGFkZCBpdCB0byB0aGUgd2VicGFnZS5cclxuICovXHJcbmNyZWF0ZVJldmlld0hUTUwgPSAocmV2aWV3KSA9PiB7XHJcbiAgY29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xyXG4gIGxpLnRhYkluZGV4ID0gJzAnO1xyXG5cclxuXHJcbiAgY29uc3QgZGF0ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2g1Jyk7XHJcbiAgZGF0ZS5pbm5lckhUTUwgPSByZXZpZXcuZGF0ZTtcclxuICBsaS5hcHBlbmRDaGlsZChkYXRlKTtcclxuXHJcbiAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2gxJyk7XHJcbiAgbmFtZS5pbm5lckhUTUwgPSByZXZpZXcubmFtZTtcclxuICBsaS5hcHBlbmRDaGlsZChuYW1lKTtcclxuXHJcbiAgY29uc3QgcmF0aW5nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaScpO1xyXG4gIHJhdGluZy5pbm5lckhUTUwgPSBgUmF0aW5nOiAke3Jldmlldy5yYXRpbmd9YDtcclxuICBsaS5hcHBlbmRDaGlsZChyYXRpbmcpO1xyXG5cclxuICBjb25zdCBjb21tZW50cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcclxuICBjb21tZW50cy5pbm5lckhUTUwgPSByZXZpZXcuY29tbWVudHM7XHJcbiAgbGkuYXBwZW5kQ2hpbGQoY29tbWVudHMpO1xyXG5cclxuICByZXR1cm4gbGk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBBZGQgcmVzdGF1cmFudCBuYW1lIHRvIHRoZSBicmVhZGNydW1iIG5hdmlnYXRpb24gbWVudVxyXG4gKi9cclxuZmlsbEJyZWFkY3J1bWIgPSAocmVzdGF1cmFudD1zZWxmLnJlc3RhdXJhbnQpID0+IHtcclxuICBjb25zdCBicmVhZGNydW1iID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JyZWFkY3J1bWInKTtcclxuXHRjb25zdCBicmVhZGNydW1iRWxlbWVudHMgPSBicmVhZGNydW1iLnF1ZXJ5U2VsZWN0b3JBbGwoJ2xpJyk7XHJcblx0Zm9yIChlbGVtZW50IG9mIGJyZWFkY3J1bWJFbGVtZW50cykge1xyXG5cdGVsZW1lbnQucmVtb3ZlQXR0cmlidXRlKCdhcmlhLWN1cnJlbnQnKTtcclxufVxyXG5cdGNvbnN0IGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcclxuXHRsaS5zZXRBdHRyaWJ1dGUoJ2FyaWEtY3VycmVudCcsICdwYWdlJyk7XHJcblx0aWYgKGJyZWFkY3J1bWIuY2hpbGRFbGVtZW50Q291bnQgPT09IDIpIHJldHVybjtcclxuICBsaS5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5hbWU7XHJcbiAgYnJlYWRjcnVtYi5hcHBlbmRDaGlsZChsaSk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBHZXQgYSBwYXJhbWV0ZXIgYnkgbmFtZSBmcm9tIHBhZ2UgVVJMLlxyXG4gKi9cclxuZ2V0UGFyYW1ldGVyQnlOYW1lID0gKG5hbWUsIHVybCkgPT4ge1xyXG4gIGlmICghdXJsKVxyXG4gICAgdXJsID0gd2luZG93LmxvY2F0aW9uLmhyZWY7XHJcbiAgbmFtZSA9IG5hbWUucmVwbGFjZSgvW1xcW1xcXV0vZywgJ1xcXFwkJicpO1xyXG4gIGNvbnN0IHJlZ2V4ID0gbmV3IFJlZ0V4cChgWz8mXSR7bmFtZX0oPShbXiYjXSopfCZ8I3wkKWApLFxyXG4gICAgcmVzdWx0cyA9IHJlZ2V4LmV4ZWModXJsKTtcclxuICBpZiAoIXJlc3VsdHMpXHJcbiAgICByZXR1cm4gbnVsbDtcclxuICBpZiAoIXJlc3VsdHNbMl0pXHJcbiAgICByZXR1cm4gJyc7XHJcbiAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChyZXN1bHRzWzJdLnJlcGxhY2UoL1xcKy9nLCAnICcpKTtcclxufVxyXG5cclxuaWYgKG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyKSB7XHJcbiAgbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIucmVnaXN0ZXIoJ3N3LmpzJylcclxuICAgIC50aGVuKCgpID0+IGNvbnNvbGUubG9nKCdQYXNzZWQgVGVzdCcpKVxyXG59O1xyXG5cclxuXHJcbmNvbnN0IHN0YXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjc3Rhci1pY29uJyk7XHJcbnN0YXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbihlKSB7XHJcbiAgbGV0IHVybCA9IHN0YXIuZGF0YXNldC5saW5rO1xyXG4gIGxldCByZXN0YXVyYW50SWQgPSBzdGFyLmRhdGFzZXQuaWQ7XHJcbiAgaWYoJ3NlcnZpY2VXb3JrZXInIGluIG5hdmlnYXRvciAmJiAnU3luY01hbmFnZXInIGluIHdpbmRvdykge1xyXG4gICAgbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIucmVhZHlcclxuICAgICAgLnRoZW4oKHN3KSA9PiB7XHJcbiAgICAgICAgc2VsZi5yZXN0YXVyYW50LmlzX2Zhdm9yaXRlID0gc2VsZi5yZXN0YXVyYW50LmlzX2Zhdm9yaXRlID09ICd0cnVlJyA/ICdmYWxzZScgOiAndHJ1ZSc7XHJcbiAgICAgICAgdXBkYXRlSWNvbkRhdGEoKTtcclxuICAgICAgICBEQkhlbHBlci5zYXZlU3luY0Zhdm9yaXRlc0ludG9JREIoe3VybCwgaWQ6cmVzdGF1cmFudElkfSlcclxuICAgICAgICAudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICByZXR1cm4gc3cuc3luYy5yZWdpc3Rlcignc3luYy1hZGQtZmF2b3JpdGVzJyk7XHJcbiAgICAgICAgfSkudGhlbigoKSA9PiB7XHJcbiAgICAgICAgICBEQkhlbHBlci51cGRhdGVSZXN0YXVyYW50SXNGYXZvcml0ZUluSURCKHJlc3RhdXJhbnRJZCk7XHJcbiAgICAgICAgfSkuY2F0Y2goKGUpID0+IHtcclxuICAgICAgICAgIGNvbnNvbGUubG9nKCdlcnJvciBpbiBzeW5jaW5nIHRoZSBmYXZvcml0ZSBsaW5rJywgZSk7XHJcbiAgICAgICAgfSlcclxuICAgICAgfSk7XHJcbiAgfSBlbHNlIHtcclxuICAgIERCSGVscGVyLmFkZFJlc3RhdXJhbnRUb0Zhdm9yaXRlKHVybClcclxuICAgICAgLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgIERCSGVscGVyLnVwZGF0ZVJlc3RhdXJhbnRJc0Zhdm9yaXRlSW5JREIocmVzdGF1cmFudElkKTtcclxuICAgICAgICBzZWxmLnJlc3RhdXJhbnQuaXNfZmF2b3JpdGUgPSBzZWxmLnJlc3RhdXJhbnQuaXNfZmF2b3JpdGUgPT0gXCJmYWxzZVwiID8gXCJ0cnVlXCI6IFwiZmFsc2VcIjtcclxuICAgICAgICB1cGRhdGVJY29uRGF0YSgpO1xyXG4gICAgICB9KTtcclxuICB9XHJcbn0pO1xyXG4iLCJcclxuLyoqXHJcbiAqIFJlZ2lzdGVyIGEgc2VydmljZVdvcmtlclxyXG4gKi9cclxucmVnaXN0ZXJTZXJ2aWNlV29ya2VyID0gKCkgPT4ge1xyXG4gICAgLy9jaGVjayBpZiBzZXJ2aWNlV29ya2VyIGlzIHN1cHBvcnRlZCwgb3RoZXJ3aXNlIHJldHVyblxyXG4gICAgaWYgKCFuYXZpZ2F0b3Iuc2VydmljZVdvcmtlcikgcmV0dXJuO1xyXG5cclxuICAgIG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLnJlZ2lzdGVyKCcvc3cuanMnKS5jYXRjaChmdW5jdGlvbigpe1xyXG4gICAgICBjb25zb2xlLmxvZyhcIlNvbWV0aGluZyB3ZW50IHdyb25nLiBTZXJ2aWNlV29ya2VyIG5vdCByZWdpc3RlcmVkXCIpO1xyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgcmVnaXN0ZXJTZXJ2aWNlV29ya2VyKCk7XHJcbiIsInZhciB2dWUgPSBuZXcgVnVlKHtcclxuICBlbDogJyNhcHAnLFxyXG4gIGRhdGE6IHtcclxuICAgIGZvcm1PcGVuOiBmYWxzZSxcclxuICAgIHJldmlldzoge1xyXG4gICAgICBuYW1lOiAnJyxcclxuICAgICAgcmF0aW5nOiAnJyxcclxuICAgICAgY29tbWVudHM6JydcclxuICAgIH1cclxuICB9LFxyXG4gIG1ldGhvZHM6IHtcclxuICAgIHJlc2V0Rm9ybTogZnVuY3Rpb24gKCkge1xyXG4gICAgICB0aGlzLnJldmlldyA9IHtcclxuICAgICAgICBuYW1lOiAnJyxcclxuICAgICAgICByYXRpbmc6ICcnLFxyXG4gICAgICAgIGNvbW1lbnRzOicnXHJcbiAgICAgIH1cclxuICAgIH0sXHJcbiAgICBjYW5jZWw6IGZ1bmN0aW9uKCkge1xyXG4gICAgICB0aGlzLmZvcm1PcGVuID0gZmFsc2U7XHJcbiAgICAgIHRoaXMucmVzZXRGb3JtKCk7XHJcbiAgICB9XHJcbiAgfVxyXG59KVxyXG4iXX0=
