class DBHelper{static get DATABASE_URL(){return"http://localhost:1337"}static get RESTAURANT_URL(){return"http://localhost:1337/restaurants"}static get REVIEWS_URL(){return"http://localhost:1337/reviews/?restaurant_id="}static openDatabase(){return navigator.serviceWorker?idb.open("restaurants-db",1,function(e){e.createObjectStore("restaurants",{keyPath:"id"}).createIndex("rest-id","id"),e.createObjectStore("reviews",{keyPath:"id",autoIncrement:!0}).createIndex("restaurant_id","restaurant_id",{unique:!1}),e.createObjectStore("sync-reviews",{keyPath:"id",autoIncrement:!0}).createIndex("restaurant_id","restaurant_id",{unique:!1})}):(console.log("Browser doesn't support Service Workers"),Promise.resolve())}static fetchRestaurants(e){DBHelper.openDatabase().then(function(e){return e?e.transaction("restaurants","readwrite").objectStore("restaurants").getAll():void 0}).then(function(t){0!==t.length&&e(null,t)}),fetch(DBHelper.RESTAURANT_URL).then(function(t){200===t.status?t.json().then(function(t){DBHelper.openDatabase().then(function(e){if(e){let n=e.transaction("restaurants","readwrite"),r=n.objectStore("restaurants");return t.forEach(function(e){r.put(e)}),n.complete}}),e(null,t)}):console.log("Fetch Issue - Status Code: "+t.status)}).catch(function(e){console.log("Fetch Error: ",e)})}static fetchRestaurantById(e,t){DBHelper.fetchRestaurants((n,r)=>{if(n)t(n,null);else{const n=r.find(t=>t.id==e);n?t(null,n):t("Restaurant does not exist",null)}})}static fetchRestaurantByCuisine(e,t){DBHelper.fetchRestaurants((n,r)=>{if(n)t(n,null);else{const n=r.filter(t=>t.cuisine_type==e);t(null,n)}})}static fetchRestaurantByNeighborhood(e,t){DBHelper.fetchRestaurants((n,r)=>{if(n)t(n,null);else{const n=r.filter(t=>t.neighborhood==e);t(null,n)}})}static fetchRestaurantByCuisineAndNeighborhood(e,t,n){DBHelper.fetchRestaurants((r,a)=>{if(r)n(r,null);else{let r=a;"all"!=e&&(r=r.filter(t=>t.cuisine_type==e)),"all"!=t&&(r=r.filter(e=>e.neighborhood==t)),n(null,r)}})}static fetchNeighborhoods(e){DBHelper.fetchRestaurants((t,n)=>{if(t)e(t,null);else{const t=n.map((e,t)=>n[t].neighborhood),r=t.filter((e,n)=>t.indexOf(e)==n);e(null,r)}})}static fetchCuisines(e){DBHelper.fetchRestaurants((t,n)=>{if(t)e(t,null);else{const t=n.map((e,t)=>n[t].cuisine_type),r=t.filter((e,n)=>t.indexOf(e)==n);e(null,r)}})}static fetchReviews(e,t){DBHelper.openDatabase().then(function(t){if(t){return t.transaction("reviews","readwrite").objectStore("reviews").index("restaurant_id").getAll(parseInt(e))}}).then(function(e){0!==e.length&&t(null,e)}),fetch(`${DBHelper.REVIEWS_URL}${e}`).then(e=>e.json()).then(e=>{DBHelper.openDatabase().then(function(t){if(t){let n=t.transaction("reviews","readwrite"),r=n.objectStore("reviews");return e.forEach(function(e){r.put(e)}),n.complete}}),t(null,e)}).catch(e=>t(`Request failed. Returned ${e}`,null))}static fetchOfflineReviews(e,t){DBHelper.openDatabase().then(function(t){if(t){return t.transaction("sync-reviews","readonly").objectStore("sync-reviews").index("restaurant_id").getAll(parseInt(e))}}).then(function(e){0!==e.length&&t(null,e)})}static postReview(e){return DBHelper.openDatabase().then(function(t){if(t){let n=t.transaction("sync-reviews","readwrite");return n.objectStore("sync-reviews").put(e),n.complete}}).then(function(){return Promise.resolve()}).catch(function(e){return console.log(e),Promise.resolve()})}static toggleFavorite(e,t){return DBHelper.openDatabase().then(function(e){if(e){return e.transaction("restaurants","readwrite").objectStore("restaurants").index("rest-id").openCursor()}}).then(function n(r){if(e=+e,r){if(r.value.id===e){var a=r.value;a.is_favorite=t,r.update(a).onsuccess=function(){}}return r.continue().then(n)}}).then(function(){fetch(`http://localhost:1337/restaurants/${e}/?is_favorite=${t}`,{method:"PUT"}).then(e=>e.json()).catch(e=>{console.log("Error fetching is_favorite: "+e)})}).then(function(){return Promise.resolve()})}static urlForRestaurant(e){return`./restaurant.html?id=${e.id}`}static imageUrlForRestaurant(e){return`/img/${e.photograph}.webp`}static imageResponsiveUrlForRestaurant(e){return`/img_responsive/${e.id}-320.webp 320w,\n        /img_responsive/${e.id}-480.webp 480w,\n        /img_responsive/${e.id}-640.webp 640w,\n        /img_responsive/${e.id}-800.webp 800w`}static mapMarkerForRestaurant(e,t){return new google.maps.Marker({position:e.latlng,title:e.name,url:DBHelper.urlForRestaurant(e),map:t,animation:google.maps.Animation.DROP})}}let restaurant;var map;const photographAlts={1:"Sereval groups of people having quality time at a restaurant.",2:"A lovely margeritta pizza",3:"An empty restaurant setting which has heaters",4:"A corner shot of the outside of the restaurat.",5:"A crowded restaurant and staff serving food from behind the bar.",6:"Restaurant with wooden tables, charis, and a US flag as a wall decoration",7:"a dog watching from the outside of a crowded burger shop, accompanied by two men.",8:"Close up of the dutch restaurant logo beside a flowering tree",9:"Black and white picture of people eating at an asian restaurat.",10:"Empty restaurant's white chairs, walls and ceilings."};window.initMap=(()=>{fetchRestaurantFromURL((e,t)=>{e?console.error(e):(self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:t.latlng,scrollwheel:!1}),fillBreadcrumb(),DBHelper.mapMarkerForRestaurant(self.restaurant,self.map))})}),callMap=document.getElementById("mapToggle").addEventListener("click",function(e){"block"===document.getElementById("map-container").style.display?(document.getElementById("map-container").style.display="none",window.initMap()):document.getElementById("map-container").style.display="block"}),fetchRestaurantFromURL=(e=>{if(self.restaurant)return void e(null,self.restaurant);const t=getParameterByName("id");t?DBHelper.fetchRestaurantById(t,(t,n)=>{self.restaurant=n,n?(fillRestaurantHTML(),e(null,n)):console.error(t)}):(error="No restaurant id in URL",e(error,null))}),toggleFavorite=(e=>{const t=document.getElementById("isFavorite"),n=t.classList.contains("far");t.classList.toggle("far"),t.classList.toggle("fas"),DBHelper.toggleFavorite(e,n)}),fillRestaurantHTML=((e=self.restaurant)=>{document.getElementById("restaurant-name").innerHTML=e.name;const t=document.getElementById("isFavorite"),n="true"==e.is_favorite?"fas":"far";t.classList.remove("far"),t.classList.add(`${n}`),"true"==e.is_favorite?t.setAttribute("aria-label",`Unmark ${e.name} as favorite`):t.setAttribute("aria-label",`Mark ${e.name} as favorite`),document.getElementById("restaurant-address").innerHTML=e.address;const r=document.getElementById("restaurant-img");r.className="restaurant-img",r.src=DBHelper.imageUrlForRestaurant(e),r.srcset=DBHelper.imageResponsiveUrlForRestaurant(e),r.alt=photographAlts[e.id],document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,e.operating_hours&&fillRestaurantHoursHTML(),fillReviewsHTML()}),fillRestaurantHoursHTML=((e=self.restaurant.operating_hours)=>{const t=document.getElementById("restaurant-hours");t.innerHTML="";for(let n in e){const r=document.createElement("tr"),a=document.createElement("td");a.innerHTML=n,r.appendChild(a);const i=document.createElement("td");i.innerHTML=e[n],r.appendChild(i),t.appendChild(r)}}),fillReviewsHTML=((e=self.restaurant.id)=>{DBHelper.fetchReviews(e,(e,t)=>{if(e)console.log(e);else{const e=document.getElementById("reviews-container");e.innerHTML='<ul id="reviews-list"></ul>';const n=document.createElement("h2");if(n.innerHTML="Reviews",n.tabIndex="0",e.appendChild(n),!t){const t=document.createElement("p");return t.innerHTML="No reviews yet!",void e.appendChild(t)}{const n=document.getElementById("reviews-list");t.forEach(e=>{n.appendChild(createReviewHTML(e))}),e.appendChild(n),offlineReviewsHTML()}}})}),window.addEventListener("online",function(e){navigator.serviceWorker.ready.then(function(e){e.sync.register("reqReviewSync")})},!1),offlineReviewsHTML=((e=self.restaurant.id)=>{DBHelper.fetchOfflineReviews(e,(e,t)=>{if(e)console.log(e);else{const e=document.getElementById("reviews-list");0===document.getElementsByClassName("tmp").length&&t.forEach(t=>{e.appendChild(createTmpReviewHTML(t))})}})}),createReviewHTML=(e=>{const t=document.createElement("li");t.tabIndex="0";const n=document.createElement("h5"),r=new Date(e.createdAt);n.innerHTML=r.toDateString(),t.appendChild(n);const a=document.createElement("h1");a.innerHTML=e.name,t.appendChild(a);const i=document.createElement("i");i.innerHTML=`Rating: ${e.rating}`,i.style.backgroundColor=5===e.rating?"green":e.rating>2?"orange":"red",t.appendChild(i);const o=document.createElement("p");o.innerHTML=e.comments,t.appendChild(o);const s=`${e.name} said ${e.comments} and rated the restaurant ${e.rating} out of 5`;return t.setAttribute("aria-label",s),t}),createTmpReviewHTML=(e=>{const t=document.createElement("li");t.setAttribute("class","tmp");const n=document.createElement("div");n.setAttribute("class","review-header"),t.appendChild(n);const r=document.createElement("h1");r.setAttribute("class","reviewName"),r.innerHTML=e.name,n.appendChild(r);const a=document.createElement("h5");a.setAttribute("class","reviewDate");a.innerHTML=new Date(e.createdAt).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),n.appendChild(a);const i=document.createElement("i");i.innerHTML=`Rating: ${e.rating}`,i.setAttribute("class","reviewRating"),i.style.backgroundColor=5===e.rating?"green":e.rating>2?"orange":"red",t.appendChild(i);const o=document.createElement("p");return o.innerHTML=e.comments,o.setAttribute("class","reviewComment"),t.appendChild(o),t}),fillBreadcrumb=((e=self.restaurant)=>{const t=document.getElementById("breadcrumb"),n=t.querySelectorAll("li");for(element of n)element.removeAttribute("aria-current");const r=document.createElement("li");r.setAttribute("aria-current","page"),2!==t.childElementCount&&(r.innerHTML=e.name,t.appendChild(r))}),getParameterByName=((e,t)=>{t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");const n=new RegExp(`[?&]${e}(=([^&#]*)|&|#|$)`).exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null});const fav=document.getElementById("isFavorite");fav.addEventListener("click",()=>{toggleFavorite(self.restaurant.id)}),fav.addEventListener("keydown",e=>{13===e.keyCode&&toggleFavorite(self.restaurant.id)}),navigator.serviceWorker&&navigator.serviceWorker.register("sw.js").then(()=>console.log("Passed Test")),registerServiceWorker=(()=>{navigator.serviceWorker&&navigator.serviceWorker.register("/sw.js").catch(function(){console.log("Something went wrong. ServiceWorker not registered")})}),registerServiceWorker();var vue=new Vue({el:"#app",data:{formOpen:!1,review:{name:"",rating:"",comments:""}},methods:{resetForm:function(){this.review={name:"",rating:"",comments:""}},cancel:function(){this.formOpen=!1,this.resetForm()}}});addReview=(()=>{const e={restaurant_id:self.restaurant.id,name:document.getElementById("name").value,createdAt:(new Date).getTime(),updatedAt:(new Date).getTime(),rating:+document.getElementById("rating").value,comments:document.getElementById("comments").value},t=document.getElementById("reviews-list");t.insertBefore(createReviewHTML(e),t.childNodes[0]),navigator.onLine||alert("You are currently offline. Your review will be posted once you are online again. Thank you for reviewing!"),DBHelper.postReview(e).then(function(){navigator.serviceWorker.ready.then(function(e){e.sync.register("reqReviewSync"),location.reload()})}).then(function(){fillReviewsHTML()}).then(function(){offlineReviewsHTML()}).catch(function(e){console.error(e)})}),document.getElementById("review-form").addEventListener("submit",function(e){e.preventDefault(),addReview(),13===e.keyCode&&document.getElementById("submit").click()});var input=document.getElementById("add-review");input.addEventListener("keyup",function(e){e.preventDefault(),13===e.keyCode&&(document.getElementById("name").tabIndex="0",document.getElementById("rating").tabIndex="0",document.getElementById("comments").tabIndex="0",document.getElementById("submit").tabIndex="0",document.getElementById("cancel").tabIndex="0",document.getElementById("add-review").click())}),document.getElementById("cancel").addEventListener("keyup",function(e){e.preventDefault(),13===e.keyCode&&document.getElementById("cancel").click()});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRiaGVscGVyLmpzIiwicmVzdGF1cmFudF9pbmZvLmpzIiwicmVnaXN0ZXJTZXJ2aWNlV29ya2VyLmpzIiwiZm9ybS5qcyJdLCJuYW1lcyI6WyJEQkhlbHBlciIsIkRBVEFCQVNFX1VSTCIsIlJFU1RBVVJBTlRfVVJMIiwiUkVWSUVXU19VUkwiLCJbb2JqZWN0IE9iamVjdF0iLCJuYXZpZ2F0b3IiLCJzZXJ2aWNlV29ya2VyIiwiaWRiIiwib3BlbiIsInVwZ3JhZGVEYiIsImNyZWF0ZU9iamVjdFN0b3JlIiwia2V5UGF0aCIsImNyZWF0ZUluZGV4IiwiYXV0b0luY3JlbWVudCIsInVuaXF1ZSIsImNvbnNvbGUiLCJsb2ciLCJQcm9taXNlIiwicmVzb2x2ZSIsImNhbGxiYWNrIiwib3BlbkRhdGFiYXNlIiwidGhlbiIsImRiIiwidHJhbnNhY3Rpb24iLCJvYmplY3RTdG9yZSIsImdldEFsbCIsInJlc3RhdXJhbnRzIiwibGVuZ3RoIiwiZmV0Y2giLCJyZXNwb25zZSIsInN0YXR1cyIsImpzb24iLCJ0eCIsInN0b3JlUmVzdGF1cmFudHMiLCJmb3JFYWNoIiwicmVzdGF1cmFudCIsInB1dCIsImNvbXBsZXRlIiwiY2F0Y2giLCJlcnIiLCJpZCIsImZldGNoUmVzdGF1cmFudHMiLCJlcnJvciIsImZpbmQiLCJyIiwiY3Vpc2luZSIsInJlc3VsdHMiLCJmaWx0ZXIiLCJjdWlzaW5lX3R5cGUiLCJuZWlnaGJvcmhvb2QiLCJuZWlnaGJvcmhvb2RzIiwibWFwIiwidiIsImkiLCJ1bmlxdWVOZWlnaGJvcmhvb2RzIiwiaW5kZXhPZiIsImN1aXNpbmVzIiwidW5pcXVlQ3Vpc2luZXMiLCJpbmRleCIsInBhcnNlSW50IiwicmV2aWV3cyIsInN0b3JlUmV2aWV3cyIsInJldmlldyIsInJlc3RhdXJhbnRJZCIsInRvZ2dsZVZhbHVlIiwib3BlbkN1cnNvciIsInVwZGF0ZUZhdm9yaXRlIiwiY3Vyc29yIiwidmFsdWUiLCJ1cGRhdGVEYXRhIiwiaXNfZmF2b3JpdGUiLCJ1cGRhdGUiLCJvbnN1Y2Nlc3MiLCJjb250aW51ZSIsIm1ldGhvZCIsInBob3RvZ3JhcGgiLCJnb29nbGUiLCJtYXBzIiwiTWFya2VyIiwicG9zaXRpb24iLCJsYXRsbmciLCJ0aXRsZSIsIm5hbWUiLCJ1cmwiLCJ1cmxGb3JSZXN0YXVyYW50IiwiYW5pbWF0aW9uIiwiQW5pbWF0aW9uIiwiRFJPUCIsInBob3RvZ3JhcGhBbHRzIiwiMSIsIjIiLCIzIiwiNCIsIjUiLCI2IiwiNyIsIjgiLCI5IiwiMTAiLCJ3aW5kb3ciLCJpbml0TWFwIiwiZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCIsInNlbGYiLCJNYXAiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiem9vbSIsImNlbnRlciIsInNjcm9sbHdoZWVsIiwiZmlsbEJyZWFkY3J1bWIiLCJtYXBNYXJrZXJGb3JSZXN0YXVyYW50IiwiY2FsbE1hcCIsImFkZEV2ZW50TGlzdGVuZXIiLCJldmVudCIsInN0eWxlIiwiZGlzcGxheSIsImdldFBhcmFtZXRlckJ5TmFtZSIsImZldGNoUmVzdGF1cmFudEJ5SWQiLCJmaWxsUmVzdGF1cmFudEhUTUwiLCJ0b2dnbGVGYXZvcml0ZSIsInJlc3RJZCIsImVsZW1lbnQiLCJzZXRUb2dnbGUiLCJjbGFzc0xpc3QiLCJjb250YWlucyIsInRvZ2dsZSIsImlubmVySFRNTCIsImZhdm9yaXRlIiwiaXNGYXZvcml0ZSIsInJlbW92ZSIsImFkZCIsInNldEF0dHJpYnV0ZSIsImFkZHJlc3MiLCJpbWFnZSIsImNsYXNzTmFtZSIsInNyYyIsImltYWdlVXJsRm9yUmVzdGF1cmFudCIsInNyY3NldCIsImltYWdlUmVzcG9uc2l2ZVVybEZvclJlc3RhdXJhbnQiLCJhbHQiLCJvcGVyYXRpbmdfaG91cnMiLCJmaWxsUmVzdGF1cmFudEhvdXJzSFRNTCIsImZpbGxSZXZpZXdzSFRNTCIsIm9wZXJhdGluZ0hvdXJzIiwiaG91cnMiLCJrZXkiLCJyb3ciLCJjcmVhdGVFbGVtZW50IiwiZGF5IiwiYXBwZW5kQ2hpbGQiLCJ0aW1lIiwiZmV0Y2hSZXZpZXdzIiwiY29udGFpbmVyIiwidGFiSW5kZXgiLCJub1Jldmlld3MiLCJ1bCIsImNyZWF0ZVJldmlld0hUTUwiLCJvZmZsaW5lUmV2aWV3c0hUTUwiLCJlIiwicmVhZHkiLCJyZWdzdyIsInN5bmMiLCJyZWdpc3RlciIsImZldGNoT2ZmbGluZVJldmlld3MiLCJnZXRFbGVtZW50c0J5Q2xhc3NOYW1lIiwiY3JlYXRlVG1wUmV2aWV3SFRNTCIsImxpIiwiZGF0ZSIsIm15X2RhdGUiLCJEYXRlIiwiY3JlYXRlZEF0IiwidG9EYXRlU3RyaW5nIiwicmF0aW5nIiwiYmFja2dyb3VuZENvbG9yIiwiY29tbWVudHMiLCJsYWJlbCIsImRpdiIsInRvTG9jYWxlRGF0ZVN0cmluZyIsIndlZWtkYXkiLCJ5ZWFyIiwibW9udGgiLCJicmVhZGNydW1iIiwiYnJlYWRjcnVtYkVsZW1lbnRzIiwicXVlcnlTZWxlY3RvckFsbCIsInJlbW92ZUF0dHJpYnV0ZSIsImNoaWxkRWxlbWVudENvdW50IiwibG9jYXRpb24iLCJocmVmIiwicmVwbGFjZSIsIlJlZ0V4cCIsImV4ZWMiLCJkZWNvZGVVUklDb21wb25lbnQiLCJmYXYiLCJrZXlDb2RlIiwicmVnaXN0ZXJTZXJ2aWNlV29ya2VyIiwidnVlIiwiVnVlIiwiZWwiLCJkYXRhIiwiZm9ybU9wZW4iLCJtZXRob2RzIiwicmVzZXRGb3JtIiwidGhpcyIsImNhbmNlbCIsImFkZFJldmlldyIsInJlc3RhdXJhbnRfaWQiLCJnZXRUaW1lIiwidXBkYXRlZEF0IiwiaW5zZXJ0QmVmb3JlIiwiY2hpbGROb2RlcyIsIm9uTGluZSIsImFsZXJ0IiwicG9zdFJldmlldyIsInJlbG9hZCIsInByZXZlbnREZWZhdWx0IiwiY2xpY2siLCJpbnB1dCJdLCJtYXBwaW5ncyI6Ik1BR01BLFNBTUpDLDBCQUVFLE1BQVEsd0JBRVZDLDRCQUVBLE1BQVEsb0NBR1ZDLHlCQUVFLE1BQVEsZ0RBTVZDLHNCQUlFLE9BQUtDLFVBQVVDLGNBS1JDLElBQUlDLEtBQUssaUJBQWtCLEVBQUcs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RDVNLFVBQVU2TSxRQUNiQyxNQUFNLDZHQUVSbk4sU0FBU29OLFdBQVd0SixHQUFRekMsS0FBSyxXQUNqQ2hCLFVBQVVDLGNBQWN5SixNQUFNMUksS0FBSyxTQUFVMkksR0FDM0NBLEVBQU1DLEtBQUtDLFNBQVMsaUJBQ3BCd0IsU0FBUzJCLGFBRVZoTSxLQUFLLFdBQ055SCxvQkFDQ3pILEtBQUssV0FDTndJLHVCQUNDdkgsTUFBTSxTQUFVQyxHQUNqQnhCLFFBQVEyQixNQUFNSCxPQUloQmlFLFNBQVNDLGVBQWUsZUFBZU8saUJBQWlCLFNBQVUsU0FBVUMsR0FDMUVBLEVBQU1xRyxpQkFDTlYsWUFDc0IsS0FBbEIzRixFQUFNZ0YsU0FDUnpGLFNBQVNDLGVBQWUsVUFBVThHLFVBS3RDLElBQUlDLE1BQVFoSCxTQUFTQyxlQUFlLGNBR3BDK0csTUFBTXhHLGlCQUFpQixRQUFTLFNBQVNDLEdBRXZDQSxFQUFNcUcsaUJBRWdCLEtBQWxCckcsRUFBTWdGLFVBRVJ6RixTQUFTQyxlQUFlLFFBQVFnRCxTQUFXLElBQzNDakQsU0FBU0MsZUFBZSxVQUFVZ0QsU0FBVyxJQUM3Q2pELFNBQVNDLGVBQWUsWUFBWWdELFNBQVcsSUFDL0NqRCxTQUFTQyxlQUFlLFVBQVVnRCxTQUFXLElBQzdDakQsU0FBU0MsZUFBZSxVQUFVZ0QsU0FBVyxJQUM3Q2pELFNBQVNDLGVBQWUsY0FBYzhHLFdBSzFDL0csU0FBU0MsZUFBZSxVQUFVTyxpQkFBaUIsUUFBUyxTQUFTQyxHQUNuRUEsRUFBTXFHLGlCQUNnQixLQUFsQnJHLEVBQU1nRixTQUNSekYsU0FBU0MsZUFBZSxVQUFVOEciLCJmaWxlIjoiYWxsX3Jlc3RhdXJhbnQuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogQ29tbW9uIGRhdGFiYXNlIGhlbHBlciBmdW5jdGlvbnMuXHJcbiAqL1xyXG5jbGFzcyBEQkhlbHBlciB7XHJcblxyXG4gIC8qKlxyXG4gICAqIERhdGFiYXNlIFVSTC5cclxuICAgKiBDaGFuZ2UgdGhpcyB0byByZXN0YXVyYW50cy5qc29uIGZpbGUgbG9jYXRpb24gb24geW91ciBzZXJ2ZXIuXHJcbiAgICovXHJcbiAgc3RhdGljIGdldCBEQVRBQkFTRV9VUkwoKSB7XHJcbiAgICBjb25zdCBwb3J0ID0gMTMzNztcclxuICAgIHJldHVybiBgaHR0cDovL2xvY2FsaG9zdDoke3BvcnR9YDtcclxuICB9XHJcbiAgc3RhdGljIGdldCBSRVNUQVVSQU5UX1VSTCgpIHtcclxuICBjb25zdCBwb3J0ID0gMTMzNztcclxuICByZXR1cm4gYGh0dHA6Ly9sb2NhbGhvc3Q6JHtwb3J0fS9yZXN0YXVyYW50c2A7XHJcbn1cclxuXHJcbnN0YXRpYyBnZXQgUkVWSUVXU19VUkwoKSB7XHJcbiAgY29uc3QgcG9ydCA9IDEzMzc7XHJcbiAgcmV0dXJuIGBodHRwOi8vbG9jYWxob3N0OiR7cG9ydH0vcmV2aWV3cy8/cmVzdGF1cmFudF9pZD1gO1xyXG59XHJcblxyXG4vLyBJREIgY3JlYXRpb25cclxuXHJcblxyXG5zdGF0aWMgb3BlbkRhdGFiYXNlICgpIHtcclxuXHJcbiAgLy8gSWYgdGhlIGJyb3dzZXIgZG9lc24ndCBzdXBwb3J0IHNlcnZpY2Ugd29ya2VyLFxyXG4gIC8vIHdlIGRvbid0IGNhcmUgYWJvdXQgaGF2aW5nIGEgZGF0YWJhc2VcclxuICBpZiAoIW5hdmlnYXRvci5zZXJ2aWNlV29ya2VyKSB7XHJcbiAgICBjb25zb2xlLmxvZyhgQnJvd3NlciBkb2Vzbid0IHN1cHBvcnQgU2VydmljZSBXb3JrZXJzYCk7XHJcbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gaWRiLm9wZW4oJ3Jlc3RhdXJhbnRzLWRiJywgMSwgZnVuY3Rpb24gKHVwZ3JhZGVEYikge1xyXG4gICAgdmFyIHN0b3JlUmVzdGF1cmFudHMgPSB1cGdyYWRlRGIuY3JlYXRlT2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnRzJywge1xyXG4gICAgICBrZXlQYXRoOiAnaWQnLFxyXG4gICAgfSk7XHJcbiAgICBzdG9yZVJlc3RhdXJhbnRzLmNyZWF0ZUluZGV4KCdyZXN0LWlkJywgJ2lkJyk7XHJcbiAgICB2YXIgc3RvcmVSZXZpZXdzID0gdXBncmFkZURiLmNyZWF0ZU9iamVjdFN0b3JlKCdyZXZpZXdzJywge1xyXG4gICAgICBrZXlQYXRoOiAnaWQnLFxyXG4gICAgICBhdXRvSW5jcmVtZW50OiB0cnVlLFxyXG4gICAgfSk7XHJcbiAgICBzdG9yZVJldmlld3MuY3JlYXRlSW5kZXgoJ3Jlc3RhdXJhbnRfaWQnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICdyZXN0YXVyYW50X2lkJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IHVuaXF1ZTogZmFsc2UgfSk7XHJcbiAgICB2YXIgc3RvcmVTeW5jUmV2aWV3ID0gdXBncmFkZURiLmNyZWF0ZU9iamVjdFN0b3JlKCdzeW5jLXJldmlld3MnLCB7XHJcbiAgICAgIGtleVBhdGg6ICdpZCcsXHJcbiAgICAgIGF1dG9JbmNyZW1lbnQ6IHRydWUsXHJcbiAgICB9KTtcclxuICAgIHN0b3JlU3luY1Jldmlldy5jcmVhdGVJbmRleCgncmVzdGF1cmFudF9pZCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3Jlc3RhdXJhbnRfaWQnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgdW5pcXVlOiBmYWxzZSB9KTtcclxuICB9KTtcclxufVxyXG5cclxuXHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIGFsbCByZXN0YXVyYW50cy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50cyhjYWxsYmFjaykge1xyXG5cclxuICAgIC8vIGdldCByZXN0YXVyYW50cyBmcm9tIGluZGV4ZWREQlxyXG4gICAgREJIZWxwZXIub3BlbkRhdGFiYXNlKCkudGhlbihmdW5jdGlvbiAoZGIpIHtcclxuICAgICAgaWYgKCFkYikge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfSAgZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIGRiLnRyYW5zYWN0aW9uKCdyZXN0YXVyYW50cycsICdyZWFkd3JpdGUnKVxyXG4gICAgICAgICAgICAgICAgIC5vYmplY3RTdG9yZSgncmVzdGF1cmFudHMnKVxyXG4gICAgICAgICAgICAgICAgIC5nZXRBbGwoKTtcclxuICAgICAgfVxyXG4gICAgfSkudGhlbihmdW5jdGlvbiAocmVzdGF1cmFudHMpIHtcclxuICAgICAgaWYgKHJlc3RhdXJhbnRzLmxlbmd0aCA9PT0gMCkgcmV0dXJuO1xyXG4gICAgICBjYWxsYmFjayhudWxsLCByZXN0YXVyYW50cyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBmZXRjaChEQkhlbHBlci5SRVNUQVVSQU5UX1VSTClcclxuICAgIC50aGVuKFxyXG4gICAgICBmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcclxuICAgICAgICAgIGNvbnNvbGUubG9nKCdGZXRjaCBJc3N1ZSAtIFN0YXR1cyBDb2RlOiAnICsgcmVzcG9uc2Uuc3RhdHVzKTtcclxuICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJlc3BvbnNlLmpzb24oKS50aGVuKGZ1bmN0aW9uIChyZXN0YXVyYW50cykge1xyXG5cclxuICAgICAgICAgIC8qIEFkZCByZXN0YXVyYW50cyB0byBpbmRleGVkREIgKi9cclxuICAgICAgICAgIERCSGVscGVyLm9wZW5EYXRhYmFzZSgpLnRoZW4oZnVuY3Rpb24gKGRiKSB7XHJcbiAgICAgICAgICAgIGlmICghZGIpIHtcclxuICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgbGV0IHR4ID0gZGIudHJhbnNhY3Rpb24oJ3Jlc3RhdXJhbnRzJywgJ3JlYWR3cml0ZScpO1xyXG4gICAgICAgICAgICAgIGxldCBzdG9yZVJlc3RhdXJhbnRzID0gdHgub2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnRzJyk7XHJcblxyXG4gICAgICAgICAgICAgIHJlc3RhdXJhbnRzLmZvckVhY2goZnVuY3Rpb24gKHJlc3RhdXJhbnQpIHtcclxuICAgICAgICAgICAgICAgIHN0b3JlUmVzdGF1cmFudHMucHV0KHJlc3RhdXJhbnQpO1xyXG4gICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICByZXR1cm4gdHguY29tcGxldGU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3RhdXJhbnRzKTtcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgKVxyXG4gICAgLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgY29uc29sZS5sb2coJ0ZldGNoIEVycm9yOiAnLCBlcnIpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCBhIHJlc3RhdXJhbnQgYnkgaXRzIElELlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeUlkKGlkLCBjYWxsYmFjaykge1xyXG4gICAgLy8gZmV0Y2ggYWxsIHJlc3RhdXJhbnRzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjb25zdCByZXN0YXVyYW50ID0gcmVzdGF1cmFudHMuZmluZChyID0+IHIuaWQgPT0gaWQpO1xyXG4gICAgICAgIGlmIChyZXN0YXVyYW50KSB7IC8vIEdvdCB0aGUgcmVzdGF1cmFudFxyXG4gICAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdGF1cmFudCk7XHJcbiAgICAgICAgfSBlbHNlIHsgLy8gUmVzdGF1cmFudCBkb2VzIG5vdCBleGlzdCBpbiB0aGUgZGF0YWJhc2VcclxuICAgICAgICAgIGNhbGxiYWNrKCdSZXN0YXVyYW50IGRvZXMgbm90IGV4aXN0JywgbnVsbCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgY3Vpc2luZSB0eXBlIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmUoY3Vpc2luZSwgY2FsbGJhY2spIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50cyAgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmdcclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gRmlsdGVyIHJlc3RhdXJhbnRzIHRvIGhhdmUgb25seSBnaXZlbiBjdWlzaW5lIHR5cGVcclxuICAgICAgICBjb25zdCByZXN1bHRzID0gcmVzdGF1cmFudHMuZmlsdGVyKHIgPT4gci5jdWlzaW5lX3R5cGUgPT0gY3Vpc2luZSk7XHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0cyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBuZWlnaGJvcmhvb2Qgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5TmVpZ2hib3Job29kKG5laWdoYm9yaG9vZCwgY2FsbGJhY2spIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBGaWx0ZXIgcmVzdGF1cmFudHMgdG8gaGF2ZSBvbmx5IGdpdmVuIG5laWdoYm9yaG9vZFxyXG4gICAgICAgIGNvbnN0IHJlc3VsdHMgPSByZXN0YXVyYW50cy5maWx0ZXIociA9PiByLm5laWdoYm9yaG9vZCA9PSBuZWlnaGJvcmhvb2QpO1xyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdHMpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgY3Vpc2luZSBhbmQgYSBuZWlnaGJvcmhvb2Qgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZChjdWlzaW5lLCBuZWlnaGJvcmhvb2QsIGNhbGxiYWNrKSB7XHJcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgbGV0IHJlc3VsdHMgPSByZXN0YXVyYW50cztcclxuICAgICAgICBpZiAoY3Vpc2luZSAhPSAnYWxsJykgeyAvLyBmaWx0ZXIgYnkgY3Vpc2luZVxyXG4gICAgICAgICAgcmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKHIgPT4gci5jdWlzaW5lX3R5cGUgPT0gY3Vpc2luZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAobmVpZ2hib3Job29kICE9ICdhbGwnKSB7IC8vIGZpbHRlciBieSBuZWlnaGJvcmhvb2RcclxuICAgICAgICAgIHJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcihyID0+IHIubmVpZ2hib3Job29kID09IG5laWdoYm9yaG9vZCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHRzKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCBhbGwgbmVpZ2hib3Job29kcyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hOZWlnaGJvcmhvb2RzKGNhbGxiYWNrKSB7XHJcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gR2V0IGFsbCBuZWlnaGJvcmhvb2RzIGZyb20gYWxsIHJlc3RhdXJhbnRzXHJcbiAgICAgICAgY29uc3QgbmVpZ2hib3Job29kcyA9IHJlc3RhdXJhbnRzLm1hcCgodiwgaSkgPT4gcmVzdGF1cmFudHNbaV0ubmVpZ2hib3Job29kKTtcclxuXHJcbiAgICAgICAgLy8gUmVtb3ZlIGR1cGxpY2F0ZXMgZnJvbSBuZWlnaGJvcmhvb2RzXHJcbiAgICAgICAgY29uc3QgdW5pcXVlTmVpZ2hib3Job29kcyA9IG5laWdoYm9yaG9vZHMuZmlsdGVyKCh2LCBpKSA9PiBuZWlnaGJvcmhvb2RzLmluZGV4T2YodikgPT0gaSk7XHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgdW5pcXVlTmVpZ2hib3Job29kcyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggYWxsIGN1aXNpbmVzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaEN1aXNpbmVzKGNhbGxiYWNrKSB7XHJcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gR2V0IGFsbCBjdWlzaW5lcyBmcm9tIGFsbCByZXN0YXVyYW50c1xyXG4gICAgICAgIGNvbnN0IGN1aXNpbmVzID0gcmVzdGF1cmFudHMubWFwKCh2LCBpKSA9PiByZXN0YXVyYW50c1tpXS5jdWlzaW5lX3R5cGUpO1xyXG5cclxuICAgICAgICAvLyBSZW1vdmUgZHVwbGljYXRlcyBmcm9tIGN1aXNpbmVzXHJcbiAgICAgICAgY29uc3QgdW5pcXVlQ3Vpc2luZXMgPSBjdWlzaW5lcy5maWx0ZXIoKHYsIGkpID0+IGN1aXNpbmVzLmluZGV4T2YodikgPT0gaSk7XHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgdW5pcXVlQ3Vpc2luZXMpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAgICogRmV0Y2ggYWxsIHJldmlld3MuXHJcbiAgICAgKi9cclxuICAgIHN0YXRpYyBmZXRjaFJldmlld3MoaWQsIGNhbGxiYWNrKSB7XHJcblxyXG4gICAgICAvLyBnZXQgcmV2aWV3cyBmcm9tIGluZGV4ZWREQlxyXG4gICAgICBEQkhlbHBlci5vcGVuRGF0YWJhc2UoKS50aGVuKGZ1bmN0aW9uIChkYikge1xyXG4gICAgICAgIGlmICghZGIpIHtcclxuICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9ICBlbHNlIHtcclxuICAgICAgICAgIGxldCBzdG9yZVJldmlld3MgPSBkYi50cmFuc2FjdGlvbigncmV2aWV3cycsICdyZWFkd3JpdGUnKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLm9iamVjdFN0b3JlKCdyZXZpZXdzJyk7XHJcbiAgICAgICAgICBsZXQgcmVzdEluZGV4ID0gc3RvcmVSZXZpZXdzLmluZGV4KCdyZXN0YXVyYW50X2lkJyk7XHJcbiAgICAgICAgICByZXR1cm4gcmVzdEluZGV4LmdldEFsbChwYXJzZUludChpZCkpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSkudGhlbihmdW5jdGlvbiAocmV2aWV3cykge1xyXG4gICAgICAgIGlmIChyZXZpZXdzLmxlbmd0aCA9PT0gMCkgcmV0dXJuO1xyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJldmlld3MpO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIC8qIEZldGNoIHJldmlld3MgZnJvbSBuZXR3b3JrICovXHJcbiAgICAgIGZldGNoKGAke0RCSGVscGVyLlJFVklFV1NfVVJMfSR7aWR9YClcclxuICAgICAgICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHJlc3BvbnNlLmpzb24oKSlcclxuICAgICAgICAgICAgIC50aGVuKHJldmlld3MgPT4ge1xyXG5cclxuICAgICAgICAgICAgICAgIC8qIEFkZCByZXZpZXdzIHRvIGluZGV4ZWREQiAqL1xyXG4gICAgICAgICAgICAgICAgREJIZWxwZXIub3BlbkRhdGFiYXNlKCkudGhlbihmdW5jdGlvbiAoZGIpIHtcclxuICAgICAgICAgICAgICAgICAgaWYgKCFkYikge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgdHggPSBkYi50cmFuc2FjdGlvbigncmV2aWV3cycsICdyZWFkd3JpdGUnKTtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgc3RvcmVSZXZpZXdzID0gdHgub2JqZWN0U3RvcmUoJ3Jldmlld3MnKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmV2aWV3cy5mb3JFYWNoKGZ1bmN0aW9uIChyZXZpZXcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgIHN0b3JlUmV2aWV3cy5wdXQocmV2aWV3KTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHR4LmNvbXBsZXRlO1xyXG4gICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhudWxsLCByZXZpZXdzKTtcclxuICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IGNhbGxiYWNrKGBSZXF1ZXN0IGZhaWxlZC4gUmV0dXJuZWQgJHtlcnJvcn1gLCBudWxsKSk7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGZldGNoT2ZmbGluZVJldmlld3MoaWQsIGNhbGxiYWNrKSB7XHJcblxyXG4gICAgICAvLyBnZXQgcmV2aWV3cyBmcm9tIGluZGV4ZWREQlxyXG4gICAgICBEQkhlbHBlci5vcGVuRGF0YWJhc2UoKS50aGVuKGZ1bmN0aW9uIChkYikge1xyXG4gICAgICAgIGlmICghZGIpIHtcclxuICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9ICBlbHNlIHtcclxuICAgICAgICAgIGxldCBzdG9yZVJldmlld3MgPSBkYi50cmFuc2FjdGlvbignc3luYy1yZXZpZXdzJywgJ3JlYWRvbmx5JylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5vYmplY3RTdG9yZSgnc3luYy1yZXZpZXdzJyk7XHJcbiAgICAgICAgICBsZXQgcmVzdEluZGV4ID0gc3RvcmVSZXZpZXdzLmluZGV4KCdyZXN0YXVyYW50X2lkJyk7XHJcbiAgICAgICAgICByZXR1cm4gcmVzdEluZGV4LmdldEFsbChwYXJzZUludChpZCkpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSkudGhlbihmdW5jdGlvbiAocmV2aWV3cykge1xyXG4gICAgICAgIGlmIChyZXZpZXdzLmxlbmd0aCA9PT0gMCkgcmV0dXJuO1xyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJldmlld3MpO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFBvc3QgcmV2aWV3cyB0byBEQlxyXG4gICAgICovXHJcbiAgICBzdGF0aWMgcG9zdFJldmlldyhyZXZpZXcpIHtcclxuICAgICAgcmV0dXJuIERCSGVscGVyLm9wZW5EYXRhYmFzZSgpLnRoZW4oZnVuY3Rpb24gKGRiKSB7XHJcbiAgICAgICAgaWYgKCFkYikge1xyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBsZXQgdHggPSBkYi50cmFuc2FjdGlvbignc3luYy1yZXZpZXdzJywgJ3JlYWR3cml0ZScpO1xyXG4gICAgICAgICAgbGV0IHN0b3JlUmV2aWV3cyA9IHR4Lm9iamVjdFN0b3JlKCdzeW5jLXJldmlld3MnKTtcclxuXHJcbiAgICAgICAgICBzdG9yZVJldmlld3MucHV0KHJldmlldyk7XHJcbiAgICAgICAgICByZXR1cm4gdHguY29tcGxldGU7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KS50aGVuKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XHJcbiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIHRvZ2dsZUZhdm9yaXRlKHJlc3RhdXJhbnRJZCwgdG9nZ2xlVmFsdWUpIHtcclxuICByZXR1cm4gREJIZWxwZXIub3BlbkRhdGFiYXNlKCkudGhlbihmdW5jdGlvbiAoZGIpIHtcclxuICAgIGlmICghZGIpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgbGV0IHN0b3JlUmVzdGF1cmFudHMgPSBkYi50cmFuc2FjdGlvbigncmVzdGF1cmFudHMnLCAncmVhZHdyaXRlJylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5vYmplY3RTdG9yZSgncmVzdGF1cmFudHMnKTtcclxuICAgICAgbGV0IHJlc3RhdXJhbnRJbmRleCA9IHN0b3JlUmVzdGF1cmFudHMuaW5kZXgoJ3Jlc3QtaWQnKTtcclxuICAgICAgcmV0dXJuIHJlc3RhdXJhbnRJbmRleC5vcGVuQ3Vyc29yKCk7XHJcbiAgICB9XHJcbiAgfSkudGhlbihmdW5jdGlvbiB1cGRhdGVGYXZvcml0ZShjdXJzb3IpIHtcclxuXHJcbiAgICByZXN0YXVyYW50SWQgPSArcmVzdGF1cmFudElkO1xyXG5cclxuICAgIGlmICghY3Vyc29yKSByZXR1cm47XHJcblxyXG4gICAgaWYgKGN1cnNvci52YWx1ZS5pZCA9PT0gcmVzdGF1cmFudElkKSB7XHJcbiAgICAgIHZhciB1cGRhdGVEYXRhID0gY3Vyc29yLnZhbHVlO1xyXG5cclxuICAgICAgdXBkYXRlRGF0YS5pc19mYXZvcml0ZSA9IHRvZ2dsZVZhbHVlO1xyXG4gICAgICB2YXIgcmVxdWVzdCA9IGN1cnNvci51cGRhdGUodXBkYXRlRGF0YSk7XHJcbiAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfTtcclxuICAgIH07XHJcblxyXG4gICAgcmV0dXJuIGN1cnNvci5jb250aW51ZSgpLnRoZW4odXBkYXRlRmF2b3JpdGUpO1xyXG5cclxuICB9KS50aGVuKGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgICAgIGNvbnN0IHVybCA9IGBodHRwOi8vbG9jYWxob3N0OjEzMzcvcmVzdGF1cmFudHMvJHtyZXN0YXVyYW50SWR9Lz9pc19mYXZvcml0ZT0ke3RvZ2dsZVZhbHVlfWA7XHJcblxyXG4gICAgICBmZXRjaCh1cmwsIHtcclxuICAgICAgICBtZXRob2Q6ICdQVVQnLFxyXG4gICAgICB9KS50aGVuKChyZXNwb25zZSkgPT4gcmVzcG9uc2UuanNvbigpXHJcbiAgICAgICkuY2F0Y2goKGVycm9yKSA9PiB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ0Vycm9yIGZldGNoaW5nIGlzX2Zhdm9yaXRlOiAnICsgZXJyb3IpO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICB9KS50aGVuKGZ1bmN0aW9uICgpIHtcclxuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xyXG4gICAgfSk7XHJcbn1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVzdGF1cmFudCBwYWdlIFVSTC5cclxuICAgKi9cclxuICBzdGF0aWMgdXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XHJcbiAgICByZXR1cm4gKGAuL3Jlc3RhdXJhbnQuaHRtbD9pZD0ke3Jlc3RhdXJhbnQuaWR9YCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXN0YXVyYW50IGltYWdlIFVSTC5cclxuICAgKi9cclxuICBzdGF0aWMgaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcclxuICAgIHJldHVybiAoYC9pbWcvJHtyZXN0YXVyYW50LnBob3RvZ3JhcGh9LndlYnBgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gKiBSZXN0YXVyYW50IHJlc3BvbnNpdmUgaW1hZ2VzIHNvdXJjZSBzZXQuXHJcbiAqL1xyXG5zdGF0aWMgaW1hZ2VSZXNwb25zaXZlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XHJcbiAgICBjb25zdCBzY2FsZTF4ID0gJzMyMCc7XHJcbiAgICBjb25zdCBzY2FsZTFfNXggPSAnNDgwJztcclxuICAgIGNvbnN0IHNjYWxlMnggPSAnNjQwJztcclxuICAgIGNvbnN0IHNjYWxlM3ggPSAnODAwJztcclxuXHJcbiAgICByZXR1cm4gKFxyXG4gICAgICAgIGAvaW1nX3Jlc3BvbnNpdmUvJHtyZXN0YXVyYW50LmlkfS0ke3NjYWxlMXh9LndlYnAgJHtzY2FsZTF4fXcsXHJcbiAgICAgICAgL2ltZ19yZXNwb25zaXZlLyR7cmVzdGF1cmFudC5pZH0tJHtzY2FsZTFfNXh9LndlYnAgJHtzY2FsZTFfNXh9dyxcclxuICAgICAgICAvaW1nX3Jlc3BvbnNpdmUvJHtyZXN0YXVyYW50LmlkfS0ke3NjYWxlMnh9LndlYnAgJHtzY2FsZTJ4fXcsXHJcbiAgICAgICAgL2ltZ19yZXNwb25zaXZlLyR7cmVzdGF1cmFudC5pZH0tJHtzY2FsZTN4fS53ZWJwICR7c2NhbGUzeH13YCk7XHJcbn1cclxuXHJcbiAgLyoqXHJcbiAgICogTWFwIG1hcmtlciBmb3IgYSByZXN0YXVyYW50LlxyXG4gICAqL1xyXG4gIHN0YXRpYyBtYXBNYXJrZXJGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQsIG1hcCkge1xyXG4gICAgY29uc3QgbWFya2VyID0gbmV3IGdvb2dsZS5tYXBzLk1hcmtlcih7XHJcbiAgICAgIHBvc2l0aW9uOiByZXN0YXVyYW50LmxhdGxuZyxcclxuICAgICAgdGl0bGU6IHJlc3RhdXJhbnQubmFtZSxcclxuICAgICAgdXJsOiBEQkhlbHBlci51cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpLFxyXG4gICAgICBtYXA6IG1hcCxcclxuICAgICAgYW5pbWF0aW9uOiBnb29nbGUubWFwcy5BbmltYXRpb24uRFJPUCxcclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIG1hcmtlcjtcclxuICB9XHJcblxyXG59XHJcbiIsImxldCByZXN0YXVyYW50O1xyXG52YXIgbWFwO1xyXG5cclxuLypcclxuU2V0dGluZyBwaG90b2dyYXBocyBhbHRzKi9cclxuXHJcbmNvbnN0IHBob3RvZ3JhcGhBbHRzID0ge1xyXG5cdDE6IFwiU2VyZXZhbCBncm91cHMgb2YgcGVvcGxlIGhhdmluZyBxdWFsaXR5IHRpbWUgYXQgYSByZXN0YXVyYW50LlwiLFxyXG5cdDI6IFwiQSBsb3ZlbHkgbWFyZ2VyaXR0YSBwaXp6YVwiLFxyXG5cdDM6IFwiQW4gZW1wdHkgcmVzdGF1cmFudCBzZXR0aW5nIHdoaWNoIGhhcyBoZWF0ZXJzXCIsXHJcblx0NDogXCJBIGNvcm5lciBzaG90IG9mIHRoZSBvdXRzaWRlIG9mIHRoZSByZXN0YXVyYXQuXCIsXHJcblx0NTogXCJBIGNyb3dkZWQgcmVzdGF1cmFudCBhbmQgc3RhZmYgc2VydmluZyBmb29kIGZyb20gYmVoaW5kIHRoZSBiYXIuXCIsXHJcblx0NjogXCJSZXN0YXVyYW50IHdpdGggd29vZGVuIHRhYmxlcywgY2hhcmlzLCBhbmQgYSBVUyBmbGFnIGFzIGEgd2FsbCBkZWNvcmF0aW9uXCIsXHJcblx0NzogXCJhIGRvZyB3YXRjaGluZyBmcm9tIHRoZSBvdXRzaWRlIG9mIGEgY3Jvd2RlZCBidXJnZXIgc2hvcCwgYWNjb21wYW5pZWQgYnkgdHdvIG1lbi5cIixcclxuXHQ4OiBcIkNsb3NlIHVwIG9mIHRoZSBkdXRjaCByZXN0YXVyYW50IGxvZ28gYmVzaWRlIGEgZmxvd2VyaW5nIHRyZWVcIixcclxuXHQ5OiBcIkJsYWNrIGFuZCB3aGl0ZSBwaWN0dXJlIG9mIHBlb3BsZSBlYXRpbmcgYXQgYW4gYXNpYW4gcmVzdGF1cmF0LlwiLFxyXG5cdDEwOiBcIkVtcHR5IHJlc3RhdXJhbnQncyB3aGl0ZSBjaGFpcnMsIHdhbGxzIGFuZCBjZWlsaW5ncy5cIlxyXG59O1xyXG5cclxuXHJcblxyXG4vKipcclxuICogSW5pdGlhbGl6ZSBHb29nbGUgbWFwLCBjYWxsZWQgZnJvbSBIVE1MLlxyXG4gKi9cclxud2luZG93LmluaXRNYXAgPSAoKSA9PiB7XHJcbiAgZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCgoZXJyb3IsIHJlc3RhdXJhbnQpID0+IHtcclxuICAgIGlmIChlcnJvcikgeyAvLyBHb3QgYW4gZXJyb3IhXHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgc2VsZi5tYXAgPSBuZXcgZ29vZ2xlLm1hcHMuTWFwKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKSwge1xyXG4gICAgICAgIHpvb206IDE2LFxyXG4gICAgICAgIGNlbnRlcjogcmVzdGF1cmFudC5sYXRsbmcsXHJcbiAgICAgICAgc2Nyb2xsd2hlZWw6IGZhbHNlXHJcbiAgICAgIH0pO1xyXG4gICAgICBmaWxsQnJlYWRjcnVtYigpO1xyXG4gICAgICBEQkhlbHBlci5tYXBNYXJrZXJGb3JSZXN0YXVyYW50KHNlbGYucmVzdGF1cmFudCwgc2VsZi5tYXApO1xyXG4gICAgfVxyXG4gIH0pO1xyXG59XHJcblxyXG4vKipcclxuU2hvdyBtYXAgYnV0dG9uXHJcbiovXHJcbmNhbGxNYXAgPVxyXG5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFwVG9nZ2xlJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbihldmVudCkge1xyXG4gIGlmICgoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcC1jb250YWluZXInKS5zdHlsZS5kaXNwbGF5KSA9PT0gJ2Jsb2NrJykge1xyXG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcC1jb250YWluZXInKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xyXG4gICAgd2luZG93LmluaXRNYXAoKTtcclxuICB9IGVsc2Uge1xyXG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcC1jb250YWluZXInKS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJztcclxuICB9XHJcbn0pO1xyXG5cclxuXHJcbi8qKlxyXG4gKiBHZXQgY3VycmVudCByZXN0YXVyYW50IGZyb20gcGFnZSBVUkwuXHJcbiAqL1xyXG5mZXRjaFJlc3RhdXJhbnRGcm9tVVJMID0gKGNhbGxiYWNrKSA9PiB7XHJcbiAgaWYgKHNlbGYucmVzdGF1cmFudCkgeyAvLyByZXN0YXVyYW50IGFscmVhZHkgZmV0Y2hlZCFcclxuICAgIGNhbGxiYWNrKG51bGwsIHNlbGYucmVzdGF1cmFudClcclxuICAgIHJldHVybjtcclxuICB9XHJcbiAgY29uc3QgaWQgPSBnZXRQYXJhbWV0ZXJCeU5hbWUoJ2lkJyk7XHJcbiAgaWYgKCFpZCkgeyAvLyBubyBpZCBmb3VuZCBpbiBVUkxcclxuICAgIGVycm9yID0gJ05vIHJlc3RhdXJhbnQgaWQgaW4gVVJMJ1xyXG4gICAgY2FsbGJhY2soZXJyb3IsIG51bGwpO1xyXG4gIH0gZWxzZSB7XHJcbiAgICBEQkhlbHBlci5mZXRjaFJlc3RhdXJhbnRCeUlkKGlkLCAoZXJyb3IsIHJlc3RhdXJhbnQpID0+IHtcclxuICAgICAgc2VsZi5yZXN0YXVyYW50ID0gcmVzdGF1cmFudDtcclxuICAgICAgaWYgKCFyZXN0YXVyYW50KSB7XHJcbiAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcbiAgICAgIGZpbGxSZXN0YXVyYW50SFRNTCgpO1xyXG4gICAgICBjYWxsYmFjayhudWxsLCByZXN0YXVyYW50KVxyXG4gICAgfSk7XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogZmF2b3JpdGUgcmVzdGF1cmFudCBidXNpbmVzc1xyXG4gKi9cclxudG9nZ2xlRmF2b3JpdGUgPSAocmVzdElkKSA9PiB7XHJcbiAgY29uc3QgZWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdpc0Zhdm9yaXRlJyk7XHJcbiAgY29uc3Qgc2V0VG9nZ2xlID0gZWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoJ2ZhcicpO1xyXG4gIGVsZW1lbnQuY2xhc3NMaXN0LnRvZ2dsZSgnZmFyJyk7XHJcbiAgZWxlbWVudC5jbGFzc0xpc3QudG9nZ2xlKCdmYXMnKTtcclxuICBEQkhlbHBlci50b2dnbGVGYXZvcml0ZShyZXN0SWQsIHNldFRvZ2dsZSk7XHJcbn07XHJcblxyXG4vKipcclxuICogQ3JlYXRlIHJlc3RhdXJhbnQgSFRNTCBhbmQgYWRkIGl0IHRvIHRoZSB3ZWJwYWdlXHJcbiAqL1xyXG5maWxsUmVzdGF1cmFudEhUTUwgPSAocmVzdGF1cmFudCA9IHNlbGYucmVzdGF1cmFudCkgPT4ge1xyXG4gIGNvbnN0IG5hbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1uYW1lJyk7XHJcbiAgbmFtZS5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5hbWU7XHJcblx0Y29uc3QgZmF2b3JpdGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaXNGYXZvcml0ZScpO1xyXG5cdGNvbnN0IGlzRmF2b3JpdGUgPSByZXN0YXVyYW50LmlzX2Zhdm9yaXRlID09ICd0cnVlJyA/ICdmYXMnIDogJ2Zhcic7XHJcblx0ZmF2b3JpdGUuY2xhc3NMaXN0LnJlbW92ZSgnZmFyJyk7XHJcblx0ZmF2b3JpdGUuY2xhc3NMaXN0LmFkZChgJHtpc0Zhdm9yaXRlfWApO1xyXG5cdGlmIChyZXN0YXVyYW50LmlzX2Zhdm9yaXRlID09ICd0cnVlJykge1xyXG5cdGZhdm9yaXRlLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsIGBVbm1hcmsgJHtyZXN0YXVyYW50Lm5hbWV9IGFzIGZhdm9yaXRlYCk7XHJcblx0fSBlbHNlIHtcclxuXHRmYXZvcml0ZS5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCBgTWFyayAke3Jlc3RhdXJhbnQubmFtZX0gYXMgZmF2b3JpdGVgKTtcclxuXHR9XHJcblxyXG4gIGNvbnN0IGFkZHJlc3MgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1hZGRyZXNzJyk7XHJcbiAgYWRkcmVzcy5pbm5lckhUTUwgPSByZXN0YXVyYW50LmFkZHJlc3M7XHJcblxyXG4gIGNvbnN0IGltYWdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtaW1nJyk7XHJcbiAgaW1hZ2UuY2xhc3NOYW1lID0gJ3Jlc3RhdXJhbnQtaW1nJ1xyXG4gIGltYWdlLnNyYyA9IERCSGVscGVyLmltYWdlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KTtcclxuXHRpbWFnZS5zcmNzZXQgPSBEQkhlbHBlci5pbWFnZVJlc3BvbnNpdmVVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpO1xyXG4gIGltYWdlLmFsdCA9IHBob3RvZ3JhcGhBbHRzW3Jlc3RhdXJhbnQuaWRdO1xyXG5cclxuICBjb25zdCBjdWlzaW5lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtY3Vpc2luZScpO1xyXG4gIGN1aXNpbmUuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5jdWlzaW5lX3R5cGU7XHJcblxyXG4gIC8vIGZpbGwgb3BlcmF0aW5nIGhvdXJzXHJcbiAgaWYgKHJlc3RhdXJhbnQub3BlcmF0aW5nX2hvdXJzKSB7XHJcbiAgICBmaWxsUmVzdGF1cmFudEhvdXJzSFRNTCgpO1xyXG4gIH1cclxuICAvLyBmaWxsIHJldmlld3NcclxuICBmaWxsUmV2aWV3c0hUTUwoKTtcclxufVxyXG5cclxuXHJcbi8qKlxyXG4gKiBDcmVhdGUgcmVzdGF1cmFudCBvcGVyYXRpbmcgaG91cnMgSFRNTCB0YWJsZSBhbmQgYWRkIGl0IHRvIHRoZSB3ZWJwYWdlLlxyXG4gKi9cclxuZmlsbFJlc3RhdXJhbnRIb3Vyc0hUTUwgPSAob3BlcmF0aW5nSG91cnMgPSBzZWxmLnJlc3RhdXJhbnQub3BlcmF0aW5nX2hvdXJzKSA9PiB7XHJcbiAgY29uc3QgaG91cnMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1ob3VycycpO1xyXG5cdGhvdXJzLmlubmVySFRNTCA9ICcnO1xyXG4gIGZvciAobGV0IGtleSBpbiBvcGVyYXRpbmdIb3Vycykge1xyXG4gICAgY29uc3Qgcm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTtcclxuXHJcbiAgICBjb25zdCBkYXkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xyXG4gICAgZGF5LmlubmVySFRNTCA9IGtleTtcclxuICAgIHJvdy5hcHBlbmRDaGlsZChkYXkpO1xyXG5cclxuICAgIGNvbnN0IHRpbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xyXG4gICAgdGltZS5pbm5lckhUTUwgPSBvcGVyYXRpbmdIb3Vyc1trZXldO1xyXG4gICAgcm93LmFwcGVuZENoaWxkKHRpbWUpO1xyXG5cclxuICAgIGhvdXJzLmFwcGVuZENoaWxkKHJvdyk7XHJcbiAgfVxyXG59XHJcblxyXG4vKipcclxuICogQ3JlYXRlIGFsbCByZXZpZXdzIEhUTUwgYW5kIGFkZCB0aGVtIHRvIHRoZSB3ZWJwYWdlLlxyXG4gKi9cclxuZmlsbFJldmlld3NIVE1MID0gKHJlc3RhdXJhbnRJZCA9IHNlbGYucmVzdGF1cmFudC5pZCkgPT4ge1xyXG4gIERCSGVscGVyLmZldGNoUmV2aWV3cyhyZXN0YXVyYW50SWQsIChlcnJvciwgcmV2aWV3cykgPT4ge1xyXG4gICAgaWYoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlld3MtY29udGFpbmVyJyk7XHJcbiAgICAgIGNvbnRhaW5lci5pbm5lckhUTUwgPSAnPHVsIGlkPVwicmV2aWV3cy1saXN0XCI+PC91bD4nO1xyXG4gICAgICBjb25zdCB0aXRsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2gyJyk7XHJcbiAgICAgIHRpdGxlLmlubmVySFRNTCA9ICdSZXZpZXdzJztcclxuICAgICAgdGl0bGUudGFiSW5kZXggPSAnMCc7XHJcbiAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZCh0aXRsZSk7XHJcblxyXG4gICAgICBpZiAoIXJldmlld3MpIHtcclxuICAgICAgICBjb25zdCBub1Jldmlld3MgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XHJcbiAgICAgICAgbm9SZXZpZXdzLmlubmVySFRNTCA9ICdObyByZXZpZXdzIHlldCEnO1xyXG4gICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChub1Jldmlld3MpO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgY29uc3QgdWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV2aWV3cy1saXN0Jyk7XHJcbiAgICAgIHJldmlld3MuZm9yRWFjaChyZXZpZXcgPT4ge1xyXG4gICAgICAgIHVsLmFwcGVuZENoaWxkKGNyZWF0ZVJldmlld0hUTUwocmV2aWV3KSk7XHJcbiAgICAgIH0pO1xyXG4gICAgICBjb250YWluZXIuYXBwZW5kQ2hpbGQodWwpO1xyXG4gICAgICBvZmZsaW5lUmV2aWV3c0hUTUwoKTtcclxuICAgIH1cclxuICAgIH1cclxuICB9KTtcclxufTtcclxuXHJcbndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdvbmxpbmUnLCBmdW5jdGlvbiAoZSkge1xyXG4gIG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLnJlYWR5LnRoZW4oZnVuY3Rpb24gKHJlZ3N3KSB7XHJcbiAgICByZWdzdy5zeW5jLnJlZ2lzdGVyKCdyZXFSZXZpZXdTeW5jJyk7XHJcbiAgfSk7XHJcbn0sIGZhbHNlKTtcclxuXHJcbi8vc3RvcmluZyByZXZpZXdzIHBvc3RlZCBvZmZsaW5lXHJcblxyXG5vZmZsaW5lUmV2aWV3c0hUTUwgPSAocmVzdGF1cmFudElkID0gc2VsZi5yZXN0YXVyYW50LmlkKSA9PiB7XHJcbiAgREJIZWxwZXIuZmV0Y2hPZmZsaW5lUmV2aWV3cyhyZXN0YXVyYW50SWQsIChlcnJvciwgcmV2aWV3cykgPT4ge1xyXG5cclxuICAgIGlmIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmxvZyhlcnJvcik7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjb25zdCB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXdzLWxpc3QnKTtcclxuICAgICAgY29uc3QgdG1wcyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ3RtcCcpO1xyXG4gICAgICBpZiAodG1wcy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICByZXZpZXdzLmZvckVhY2gocmV2aWV3ID0+IHtcclxuICAgICAgICAgIHVsLmFwcGVuZENoaWxkKGNyZWF0ZVRtcFJldmlld0hUTUwocmV2aWV3KSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9KTtcclxufTtcclxuXHJcblxyXG4vKipcclxuICogQ3JlYXRlIHJldmlldyBIVE1MIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2UuXHJcbiAqL1xyXG5jcmVhdGVSZXZpZXdIVE1MID0gKHJldmlldykgPT4ge1xyXG4gIGNvbnN0IGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcclxuICBsaS50YWJJbmRleCA9ICcwJztcclxuXHJcbiAgY29uc3QgZGF0ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2g1Jyk7XHJcbiAgY29uc3QgbXlfZGF0ZSA9IG5ldyBEYXRlKHJldmlldy5jcmVhdGVkQXQpO1xyXG4gIGRhdGUuaW5uZXJIVE1MID0gbXlfZGF0ZS50b0RhdGVTdHJpbmcoKTtcclxuICBsaS5hcHBlbmRDaGlsZChkYXRlKTtcclxuXHJcbiAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2gxJyk7XHJcbiAgbmFtZS5pbm5lckhUTUwgPSByZXZpZXcubmFtZTtcclxuICBsaS5hcHBlbmRDaGlsZChuYW1lKTtcclxuXHJcbiAgY29uc3QgcmF0aW5nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaScpO1xyXG4gIHJhdGluZy5pbm5lckhUTUwgPSBgUmF0aW5nOiAke3Jldmlldy5yYXRpbmd9YDtcclxuXHRyYXRpbmcuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gcmV2aWV3LnJhdGluZyA9PT0gNSA/ICdncmVlbicgOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXZpZXcucmF0aW5nID4gMiA/ICdvcmFuZ2UnIDogJ3JlZCc7XHJcbiAgbGkuYXBwZW5kQ2hpbGQocmF0aW5nKTtcclxuXHJcbiAgY29uc3QgY29tbWVudHMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XHJcbiAgY29tbWVudHMuaW5uZXJIVE1MID0gcmV2aWV3LmNvbW1lbnRzO1xyXG4gIGxpLmFwcGVuZENoaWxkKGNvbW1lbnRzKTtcclxuXHJcbiAgY29uc3QgbGFiZWwgPSBgJHtyZXZpZXcubmFtZX0gc2FpZCAke3Jldmlldy5jb21tZW50c30gYW5kIHJhdGVkIHRoZSByZXN0YXVyYW50ICR7cmV2aWV3LnJhdGluZ30gb3V0IG9mIDVgO1xyXG4gIGxpLnNldEF0dHJpYnV0ZSgnYXJpYS1sYWJlbCcsIGxhYmVsKTtcclxuXHJcbiAgcmV0dXJuIGxpO1xyXG59XHJcblxyXG4vKipcclxuICogQ3JlYXRlIFRNUCByZXZpZXcgSFRNTCBhbmQgYWRkIGl0IHRvIHRoZSB3ZWJwYWdlLlxyXG4gKi9cclxuY3JlYXRlVG1wUmV2aWV3SFRNTCA9IChyZXZpZXcpID0+IHtcclxuICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XHJcbiAgbGkuc2V0QXR0cmlidXRlKCdjbGFzcycsICd0bXAnKTtcclxuICBjb25zdCBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICBkaXYuc2V0QXR0cmlidXRlKCdjbGFzcycsICdyZXZpZXctaGVhZGVyJyk7XHJcbiAgbGkuYXBwZW5kQ2hpbGQoZGl2KTtcclxuXHJcbiAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2gxJyk7XHJcbiAgbmFtZS5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgJ3Jldmlld05hbWUnKTtcclxuICBuYW1lLmlubmVySFRNTCA9IHJldmlldy5uYW1lO1xyXG4gIGRpdi5hcHBlbmRDaGlsZChuYW1lKTtcclxuXHJcbiAgY29uc3QgZGF0ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2g1Jyk7XHJcbiAgZGF0ZS5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgJ3Jldmlld0RhdGUnKTtcclxuICBjb25zdCBkYXRlT3B0aW9ucyA9IHsgd2Vla2RheTogJ2xvbmcnLCB5ZWFyOiAnbnVtZXJpYycsIG1vbnRoOiAnbG9uZycsIGRheTogJ251bWVyaWMnIH07XHJcbiAgZGF0ZS5pbm5lckhUTUwgPSAobmV3IERhdGUocmV2aWV3LmNyZWF0ZWRBdCkpLnRvTG9jYWxlRGF0ZVN0cmluZygnZW4tVVMnLCBkYXRlT3B0aW9ucyk7XHJcbiAgZGl2LmFwcGVuZENoaWxkKGRhdGUpO1xyXG5cclxuICBjb25zdCByYXRpbmcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpJyk7XHJcbiAgcmF0aW5nLmlubmVySFRNTCA9IGBSYXRpbmc6ICR7cmV2aWV3LnJhdGluZ31gO1xyXG4gIHJhdGluZy5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgJ3Jldmlld1JhdGluZycpO1xyXG4gIHJhdGluZy5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSByZXZpZXcucmF0aW5nID09PSA1ID8gJ2dyZWVuJyA6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldmlldy5yYXRpbmcgPiAyID8gJ29yYW5nZScgOiAncmVkJztcclxuICBsaS5hcHBlbmRDaGlsZChyYXRpbmcpO1xyXG5cclxuICBjb25zdCBjb21tZW50cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcclxuICBjb21tZW50cy5pbm5lckhUTUwgPSByZXZpZXcuY29tbWVudHM7XHJcbiAgY29tbWVudHMuc2V0QXR0cmlidXRlKCdjbGFzcycsICdyZXZpZXdDb21tZW50Jyk7XHJcbiAgbGkuYXBwZW5kQ2hpbGQoY29tbWVudHMpO1xyXG5cclxuICByZXR1cm4gbGk7XHJcbn07XHJcblxyXG4vKipcclxuICogQWRkIHJlc3RhdXJhbnQgbmFtZSB0byB0aGUgYnJlYWRjcnVtYiBuYXZpZ2F0aW9uIG1lbnVcclxuICovXHJcbmZpbGxCcmVhZGNydW1iID0gKHJlc3RhdXJhbnQ9c2VsZi5yZXN0YXVyYW50KSA9PiB7XHJcbiAgY29uc3QgYnJlYWRjcnVtYiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdicmVhZGNydW1iJyk7XHJcblx0Y29uc3QgYnJlYWRjcnVtYkVsZW1lbnRzID0gYnJlYWRjcnVtYi5xdWVyeVNlbGVjdG9yQWxsKCdsaScpO1xyXG5cdGZvciAoZWxlbWVudCBvZiBicmVhZGNydW1iRWxlbWVudHMpIHtcclxuXHRlbGVtZW50LnJlbW92ZUF0dHJpYnV0ZSgnYXJpYS1jdXJyZW50Jyk7XHJcbn1cclxuXHRjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XHJcblx0bGkuc2V0QXR0cmlidXRlKCdhcmlhLWN1cnJlbnQnLCAncGFnZScpO1xyXG5cdGlmIChicmVhZGNydW1iLmNoaWxkRWxlbWVudENvdW50ID09PSAyKSByZXR1cm47XHJcbiAgbGkuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xyXG4gIGJyZWFkY3J1bWIuYXBwZW5kQ2hpbGQobGkpO1xyXG59XHJcblxyXG4vKipcclxuICogR2V0IGEgcGFyYW1ldGVyIGJ5IG5hbWUgZnJvbSBwYWdlIFVSTC5cclxuICovXHJcbmdldFBhcmFtZXRlckJ5TmFtZSA9IChuYW1lLCB1cmwpID0+IHtcclxuICBpZiAoIXVybClcclxuICAgIHVybCA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmO1xyXG4gIG5hbWUgPSBuYW1lLnJlcGxhY2UoL1tcXFtcXF1dL2csICdcXFxcJCYnKTtcclxuICBjb25zdCByZWdleCA9IG5ldyBSZWdFeHAoYFs/Jl0ke25hbWV9KD0oW14mI10qKXwmfCN8JClgKSxcclxuICAgIHJlc3VsdHMgPSByZWdleC5leGVjKHVybCk7XHJcbiAgaWYgKCFyZXN1bHRzKVxyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgaWYgKCFyZXN1bHRzWzJdKVxyXG4gICAgcmV0dXJuICcnO1xyXG4gIHJldHVybiBkZWNvZGVVUklDb21wb25lbnQocmVzdWx0c1syXS5yZXBsYWNlKC9cXCsvZywgJyAnKSk7XHJcbn1cclxuXHJcbi8vZXZlbnRsaXN0ZW5lcnMgZm9yIGZhdm9yaXRlIHRvZ2dsZVxyXG5cclxuY29uc3QgZmF2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2lzRmF2b3JpdGUnKTtcclxuZmF2LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xyXG4gIHRvZ2dsZUZhdm9yaXRlKHNlbGYucmVzdGF1cmFudC5pZCk7XHJcbn0pO1xyXG5mYXYuYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIChlKSA9PiB7XHJcbiAgaWYgKGUua2V5Q29kZSA9PT0gMTMpIHsgLy8gPSBlbnRlciBrZXlcclxuICAgIHRvZ2dsZUZhdm9yaXRlKHNlbGYucmVzdGF1cmFudC5pZCk7XHJcbiAgfVxyXG59KTtcclxuXHJcblxyXG5pZiAobmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIpIHtcclxuICBuYXZpZ2F0b3Iuc2VydmljZVdvcmtlci5yZWdpc3Rlcignc3cuanMnKVxyXG4gICAgLnRoZW4oKCkgPT4gY29uc29sZS5sb2coJ1Bhc3NlZCBUZXN0JykpXHJcbn07XHJcbiIsIlxyXG4vKipcclxuICogUmVnaXN0ZXIgYSBzZXJ2aWNlV29ya2VyXHJcbiAqL1xyXG5yZWdpc3RlclNlcnZpY2VXb3JrZXIgPSAoKSA9PiB7XHJcbiAgICAvL2NoZWNrIGlmIHNlcnZpY2VXb3JrZXIgaXMgc3VwcG9ydGVkLCBvdGhlcndpc2UgcmV0dXJuXHJcbiAgICBpZiAoIW5hdmlnYXRvci5zZXJ2aWNlV29ya2VyKSByZXR1cm47XHJcblxyXG4gICAgbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIucmVnaXN0ZXIoJy9zdy5qcycpLmNhdGNoKGZ1bmN0aW9uKCl7XHJcbiAgICAgIGNvbnNvbGUubG9nKFwiU29tZXRoaW5nIHdlbnQgd3JvbmcuIFNlcnZpY2VXb3JrZXIgbm90IHJlZ2lzdGVyZWRcIik7XHJcbiAgICB9KTtcclxuICB9O1xyXG5cclxuICByZWdpc3RlclNlcnZpY2VXb3JrZXIoKTtcclxuIiwidmFyIHZ1ZSA9IG5ldyBWdWUoe1xyXG4gIGVsOiAnI2FwcCcsXHJcbiAgZGF0YToge1xyXG4gICAgZm9ybU9wZW46IGZhbHNlLFxyXG4gICAgcmV2aWV3OiB7XHJcbiAgICAgIG5hbWU6ICcnLFxyXG4gICAgICByYXRpbmc6ICcnLFxyXG4gICAgICBjb21tZW50czonJ1xyXG4gICAgfVxyXG4gIH0sXHJcbiAgbWV0aG9kczoge1xyXG4gICAgcmVzZXRGb3JtOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgIHRoaXMucmV2aWV3ID0ge1xyXG4gICAgICAgIG5hbWU6ICcnLFxyXG4gICAgICAgIHJhdGluZzogJycsXHJcbiAgICAgICAgY29tbWVudHM6JydcclxuICAgICAgfVxyXG4gICAgfSxcclxuICAgIGNhbmNlbDogZnVuY3Rpb24oKSB7XHJcbiAgICAgIHRoaXMuZm9ybU9wZW4gPSBmYWxzZTtcclxuICAgICAgdGhpcy5yZXNldEZvcm0oKTtcclxuICAgIH1cclxuICB9XHJcbn0pXHJcblxyXG4vKipcclxuICogSGFubGRpbmcgZm9ybSBzdWJtaXRpb25cclxuICovXHJcbiBhZGRSZXZpZXcgPSAoKSA9PiB7XHJcbiAgIGNvbnN0IHJldmlldyA9IHtcclxuICAgIHJlc3RhdXJhbnRfaWQ6IHNlbGYucmVzdGF1cmFudC5pZCxcclxuICAgIG5hbWU6IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCduYW1lJykudmFsdWUsXHJcbiAgICBjcmVhdGVkQXQ6IG5ldyBEYXRlKCkuZ2V0VGltZSgpLFxyXG4gICAgdXBkYXRlZEF0OiBuZXcgRGF0ZSgpLmdldFRpbWUoKSxcclxuICAgIHJhdGluZzogK2RvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyYXRpbmcnKS52YWx1ZSxcclxuICAgIGNvbW1lbnRzOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29tbWVudHMnKS52YWx1ZSxcclxuICB9O1xyXG4gIGNvbnN0IHVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlld3MtbGlzdCcpO1xyXG4gIHVsLmluc2VydEJlZm9yZShjcmVhdGVSZXZpZXdIVE1MKHJldmlldyksIHVsLmNoaWxkTm9kZXNbMF0pO1xyXG4gIGlmICghbmF2aWdhdG9yLm9uTGluZSkge1xyXG4gICAgYWxlcnQoJ1lvdSBhcmUgY3VycmVudGx5IG9mZmxpbmUuIFlvdXIgcmV2aWV3IHdpbGwgYmUgcG9zdGVkIG9uY2UgeW91IGFyZSBvbmxpbmUgYWdhaW4uIFRoYW5rIHlvdSBmb3IgcmV2aWV3aW5nIScpO1xyXG4gIH1cclxuICBEQkhlbHBlci5wb3N0UmV2aWV3KHJldmlldykudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIucmVhZHkudGhlbihmdW5jdGlvbiAocmVnc3cpIHtcclxuICAgIHJlZ3N3LnN5bmMucmVnaXN0ZXIoJ3JlcVJldmlld1N5bmMnKTtcclxuICAgIGxvY2F0aW9uLnJlbG9hZCgpO1xyXG4gIH0pO1xyXG59KS50aGVuKGZ1bmN0aW9uICgpIHtcclxuICBmaWxsUmV2aWV3c0hUTUwoKTtcclxufSkudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgb2ZmbGluZVJldmlld3NIVE1MKCk7XHJcbn0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcclxuICBjb25zb2xlLmVycm9yKGVycik7XHJcbn0pO1xyXG59O1xyXG5cclxuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jldmlldy1mb3JtJykuYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICBhZGRSZXZpZXcoKTtcclxuICBpZiAoZXZlbnQua2V5Q29kZSA9PT0gMTMpIHtcclxuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzdWJtaXQnKS5jbGljaygpO1xyXG4gIH1cclxuXHJcbn0pO1xyXG5cclxudmFyIGlucHV0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJhZGQtcmV2aWV3XCIpO1xyXG5cclxuLy8gRXhlY3V0ZSBhIGZ1bmN0aW9uIHdoZW4gdGhlIHVzZXIgcmVsZWFzZXMgYSBrZXkgb24gdGhlIGtleWJvYXJkXHJcbmlucHV0LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXl1cFwiLCBmdW5jdGlvbihldmVudCkge1xyXG4gIC8vIENhbmNlbCB0aGUgZGVmYXVsdCBhY3Rpb24sIGlmIG5lZWRlZFxyXG4gIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgLy8gTnVtYmVyIDEzIGlzIHRoZSBcIkVudGVyXCIga2V5IG9uIHRoZSBrZXlib2FyZFxyXG4gIGlmIChldmVudC5rZXlDb2RlID09PSAxMykge1xyXG4gICAgLy8gVHJpZ2dlciB0aGUgYnV0dG9uIGVsZW1lbnQgd2l0aCBhIGNsaWNrXHJcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcIm5hbWVcIikudGFiSW5kZXggPSAnMCc7XHJcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInJhdGluZ1wiKS50YWJJbmRleCA9ICcwJztcclxuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiY29tbWVudHNcIikudGFiSW5kZXggPSAnMCc7XHJcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcInN1Ym1pdFwiKS50YWJJbmRleCA9ICcwJztcclxuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiY2FuY2VsXCIpLnRhYkluZGV4ID0gJzAnO1xyXG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJhZGQtcmV2aWV3XCIpLmNsaWNrKCk7XHJcblxyXG4gIH1cclxufSk7XHJcblxyXG5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FuY2VsJykuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCBmdW5jdGlvbihldmVudCkge1xyXG4gIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgaWYgKGV2ZW50LmtleUNvZGUgPT09IDEzKSB7XHJcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2FuY2VsJykuY2xpY2soKTtcclxuICB9XHJcbn0pO1xyXG4iXX0=
