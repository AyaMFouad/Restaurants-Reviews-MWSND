class DBHelper{static get DATABASE_URL(){return"http://localhost:1337"}static get RESTAURANT_URL(){return"http://localhost:1337/restaurants"}static get REVIEWS_URL(){return"http://localhost:1337/reviews/?restaurant_id="}static openDatabase(){return navigator.serviceWorker?idb.open("restaurants-db",1,function(e){e.createObjectStore("restaurants",{keyPath:"id"}).createIndex("rest-id","id"),e.createObjectStore("reviews",{keyPath:"id",autoIncrement:!0}).createIndex("restaurant_id","restaurant_id",{unique:!1}),e.createObjectStore("sync-reviews",{keyPath:"id",autoIncrement:!0}).createIndex("restaurant_id","restaurant_id",{unique:!1})}):(console.log("Browser doesn't support Service Workers"),Promise.resolve())}static fetchRestaurants(e){DBHelper.openDatabase().then(function(e){return e?e.transaction("restaurants","readwrite").objectStore("restaurants").getAll():void 0}).then(function(t){0!==t.length&&e(null,t)}),fetch(DBHelper.RESTAURANT_URL).then(function(t){200===t.status?t.json().then(function(t){DBHelper.openDatabase().then(function(e){if(e){let n=e.transaction("restaurants","readwrite"),r=n.objectStore("restaurants");return t.forEach(function(e){r.put(e)}),n.complete}}),e(null,t)}):console.log("Fetch Issue - Status Code: "+t.status)}).catch(function(e){console.log("Fetch Error: ",e)})}static fetchRestaurantById(e,t){DBHelper.fetchRestaurants((n,r)=>{if(n)t(n,null);else{const n=r.find(t=>t.id==e);n?t(null,n):t("Restaurant does not exist",null)}})}static fetchRestaurantByCuisine(e,t){DBHelper.fetchRestaurants((n,r)=>{if(n)t(n,null);else{const n=r.filter(t=>t.cuisine_type==e);t(null,n)}})}static fetchRestaurantByNeighborhood(e,t){DBHelper.fetchRestaurants((n,r)=>{if(n)t(n,null);else{const n=r.filter(t=>t.neighborhood==e);t(null,n)}})}static fetchRestaurantByCuisineAndNeighborhood(e,t,n){DBHelper.fetchRestaurants((r,a)=>{if(r)n(r,null);else{let r=a;"all"!=e&&(r=r.filter(t=>t.cuisine_type==e)),"all"!=t&&(r=r.filter(e=>e.neighborhood==t)),n(null,r)}})}static fetchNeighborhoods(e){DBHelper.fetchRestaurants((t,n)=>{if(t)e(t,null);else{const t=n.map((e,t)=>n[t].neighborhood),r=t.filter((e,n)=>t.indexOf(e)==n);e(null,r)}})}static fetchCuisines(e){DBHelper.fetchRestaurants((t,n)=>{if(t)e(t,null);else{const t=n.map((e,t)=>n[t].cuisine_type),r=t.filter((e,n)=>t.indexOf(e)==n);e(null,r)}})}static fetchReviews(e,t){DBHelper.openDatabase().then(function(t){if(t){return t.transaction("reviews","readwrite").objectStore("reviews").index("restaurant_id").getAll(parseInt(e))}}).then(function(e){0!==e.length&&t(null,e)}),fetch(`${DBHelper.REVIEWS_URL}${e}`).then(e=>e.json()).then(e=>{DBHelper.openDatabase().then(function(t){if(t){let n=t.transaction("reviews","readwrite"),r=n.objectStore("reviews");return e.forEach(function(e){r.put(e)}),n.complete}}),t(null,e)}).catch(e=>t(`Request failed. Returned ${e}`,null))}static fetchOfflineReviews(e,t){DBHelper.openDatabase().then(function(t){if(t){return t.transaction("sync-reviews","readonly").objectStore("sync-reviews").index("restaurant_id").getAll(parseInt(e))}}).then(function(e){0!==e.length&&t(null,e)})}static postReview(e){return DBHelper.openDatabase().then(function(t){if(t){let n=t.transaction("sync-reviews","readwrite");return n.objectStore("sync-reviews").put(e),n.complete}}).then(function(){return Promise.resolve()}).catch(function(e){return console.log(e),Promise.resolve()})}static toggleFavorite(e,t){return DBHelper.openDatabase().then(function(e){if(e){return e.transaction("restaurants","readwrite").objectStore("restaurants").index("rest-id").openCursor()}}).then(function n(r){if(e=+e,r){if(r.value.id===e){var a=r.value;a.is_favorite=t,r.update(a).onsuccess=function(){}}return r.continue().then(n)}}).then(function(){fetch(`http://localhost:1337/restaurants/${e}/?is_favorite=${t}`,{method:"PUT"}).then(e=>e.json()).catch(e=>{console.log("Error fetching is_favorite: "+e)})}).then(function(){return Promise.resolve()})}static urlForRestaurant(e){return`./restaurant.html?id=${e.id}`}static imageUrlForRestaurant(e){return`/img/${e.photograph}.webp`}static imageResponsiveUrlForRestaurant(e){return`/img_responsive/${e.id}-320.webp 320w,\n        /img_responsive/${e.id}-480.webp 480w,\n        /img_responsive/${e.id}-640.webp 640w,\n        /img_responsive/${e.id}-800.webp 800w`}static mapMarkerForRestaurant(e,t){return new google.maps.Marker({position:e.latlng,title:e.name,url:DBHelper.urlForRestaurant(e),map:t,animation:google.maps.Animation.DROP})}}let restaurant;var map;const photographAlts={1:"Sereval groups of people having quality time at a restaurant.",2:"A lovely margeritta pizza",3:"An empty restaurant setting which has heaters",4:"A corner shot of the outside of the restaurat.",5:"A crowded restaurant and staff serving food from behind the bar.",6:"Restaurant with wooden tables, charis, and a US flag as a wall decoration",7:"a dog watching from the outside of a crowded burger shop, accompanied by two men.",8:"Close up of the dutch restaurant logo beside a flowering tree",9:"Black and white picture of people eating at an asian restaurat.",10:"Empty restaurant's white chairs, walls and ceilings."};window.initMap=(()=>{fetchRestaurantFromURL((e,t)=>{e?console.error(e):(self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:t.latlng,scrollwheel:!1}),fillBreadcrumb(),DBHelper.mapMarkerForRestaurant(self.restaurant,self.map))})}),document.getElementById("mapToggle").addEventListener("click",function(e){"block"===document.getElementById("map-container").style.display?(document.getElementById("map-container").style.display="none",window.initMap()):document.getElementById("map-container").style.display="block"}),fetchRestaurantFromURL=(e=>{if(self.restaurant)return void e(null,self.restaurant);const t=getParameterByName("id");t?DBHelper.fetchRestaurantById(t,(t,n)=>{self.restaurant=n,n?(fillRestaurantHTML(),e(null,n)):console.error(t)}):(error="No restaurant id in URL",e(error,null))}),favToggle=(e=>{const t=document.getElementById("isFavorite"),n=t.classList.contains("far");t.classList.toggle("far"),t.classList.toggle("fas"),DBHelper.favToggle(e,n)}),fillRestaurantHTML=((e=self.restaurant)=>{document.getElementById("restaurant-name").innerHTML=e.name;const t=document.getElementById("isFavorite"),n="true"==e.is_favorite?"fas":"far";t.classList.remove("far"),t.classList.add(`${n}`),"true"==e.is_favorite?t.setAttribute("aria-label",`Unmark ${e.name} as favorite`):t.setAttribute("aria-label",`Mark ${e.name} as favorite`),document.getElementById("restaurant-address").innerHTML=e.address;const r=document.getElementById("restaurant-img");r.className="restaurant-img",r.src=DBHelper.imageUrlForRestaurant(e),r.srcset=DBHelper.imageResponsiveUrlForRestaurant(e),r.alt=photographAlts[e.id],document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,e.operating_hours&&fillRestaurantHoursHTML(),fillReviewsHTML()}),fillRestaurantHoursHTML=((e=self.restaurant.operating_hours)=>{const t=document.getElementById("restaurant-hours");t.innerHTML="";for(let n in e){const r=document.createElement("tr"),a=document.createElement("td");a.innerHTML=n,r.appendChild(a);const o=document.createElement("td");o.innerHTML=e[n],r.appendChild(o),t.appendChild(r)}}),fillReviewsHTML=((e=self.restaurant.id)=>{DBHelper.fetchReviews(e,(e,t)=>{if(e)console.log(e);else{const e=document.getElementById("reviews-container");e.innerHTML='<ul id="reviews-list"></ul>';const n=document.createElement("h2");if(n.innerHTML="Reviews",n.tabIndex="0",e.appendChild(n),!t){const t=document.createElement("p");return t.innerHTML="No reviews yet!",void e.appendChild(t)}{const n=document.getElementById("reviews-list");t.forEach(e=>{n.appendChild(createReviewHTML(e))}),e.appendChild(n),offlineReviewsHTML()}}})}),window.addEventListener("online",function(e){navigator.serviceWorker.ready.then(function(e){e.sync.register("reqReviewSync")})},!1),offlineReviewsHTML=((e=self.restaurant.id)=>{DBHelper.fetchOfflineReviews(e,(e,t)=>{if(e)console.log(e);else{const e=document.getElementById("reviews-list");0===document.getElementsByClassName("tmp").length&&t.forEach(t=>{e.appendChild(createOffReviewHTML(t))})}})}),createReviewHTML=(e=>{const t=document.createElement("li");t.tabIndex="0";const n=document.createElement("h5"),r=new Date(e.createdAt);n.innerHTML=r.toDateString(),t.appendChild(n);const a=document.createElement("h1");a.innerHTML=e.name,t.appendChild(a);const o=document.createElement("i");o.innerHTML=`Rating: ${e.rating}`,o.style.backgroundColor=5===e.rating?"green":e.rating>2?"orange":"red",t.appendChild(o);const i=document.createElement("p");i.innerHTML=e.comments,t.appendChild(i);const s=`${e.name} said ${e.comments} and rated the restaurant ${e.rating} out of 5`;return t.setAttribute("aria-label",s),t}),createOffReviewHTML=(e=>{const t=document.createElement("li");t.setAttribute("class","tmp");const n=document.createElement("div");n.setAttribute("class","review-header"),t.appendChild(n);const r=document.createElement("h1");r.setAttribute("class","reviewName"),r.innerHTML=e.name,n.appendChild(r);const a=document.createElement("h5");a.setAttribute("class","reviewDate");a.innerHTML=new Date(e.createdAt).toLocaleDateString("en-US",{weekday:"short",year:"numeric",month:"long",day:"numeric"}),n.appendChild(a);const o=document.createElement("i");o.innerHTML=`Rating: ${e.rating}`,o.setAttribute("class","reviewRating"),o.style.backgroundColor=5===e.rating?"green":e.rating>2?"orange":"red",t.appendChild(o);const i=document.createElement("p");return i.innerHTML=e.comments,i.setAttribute("class","reviewComment"),t.appendChild(i),t}),fillBreadcrumb=((e=self.restaurant)=>{const t=document.getElementById("breadcrumb"),n=t.querySelectorAll("li");for(element of n)element.removeAttribute("aria-current");const r=document.createElement("li");r.setAttribute("aria-current","page"),2!==t.childElementCount&&(r.innerHTML=e.name,t.appendChild(r))}),getParameterByName=((e,t)=>{t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");const n=new RegExp(`[?&]${e}(=([^&#]*)|&|#|$)`).exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null});const fav=document.getElementById("isFavorite");fav.addEventListener("click",()=>{favToggle(self.restaurant.id)}),fav.addEventListener("keydown",e=>{13===e.keyCode&&favToggle(self.restaurant.id)}),navigator.serviceWorker&&navigator.serviceWorker.register("sw.js").then(()=>console.log("Passed Test"));var _this=this,vue=new Vue({el:"#app",data:{formOpen:!1,review:{name:"",rating:"",comments:""}},methods:{resetForm:function(){this.review={name:"",rating:"",comments:""}},cancel:function(){this.formOpen=!1,this.resetForm()}}});addReview=(()=>{const e={restaurant_id:self.restaurant.id,name:document.getElementById("name").value,createdAt:(new Date).getTime(),updatedAt:(new Date).getTime(),rating:+document.getElementById("rating").value,comments:document.getElementById("comments").value},t=document.getElementById("reviews-list");t.insertBefore(createReviewHTML(e),t.childNodes[0]),navigator.onLine||alert("You are currently offline. Your review will be posted once you are online again. Thank you for reviewing!"),DBHelper.postReview(e).then(function(){navigator.serviceWorker.ready.then(function(e){e.sync.register("reqReviewSync"),location.reload()})}).then(function(){fillReviewsHTML()}).then(function(){offlineReviewsHTML()}).catch(function(e){console.error(e)})}),document.getElementById("review-form").addEventListener("submit",function(e){e.preventDefault(),addReview(),13===e.keyCode&&removeTabfocusFromForm()}),document.getElementById("add-review").addEventListener("keyup",function(e){e.preventDefault(),13===e.keyCode&&(document.getElementById("name").tabIndex="0",document.getElementById("rating").tabIndex="0",document.getElementById("comments").tabIndex="0",document.getElementById("submit").tabIndex="0",document.getElementById("cancel").tabIndex="0",document.getElementById("add-review").click())}),document.getElementById("cancel").addEventListener("keyup",function(e){e.preventDefault(),13===e.keyCode&&removeTabfocusFromForm()}),removeTabfocusFromForm=(()=>{window.onload=(()=>{const e=document.querySelector("#add-review");formDesc=e.querySelectorAll("*"),formDesc.forEach(e=>{e.setAttribute("tabindex","-1")},_this)})}),registerServiceWorker=(()=>{navigator.serviceWorker&&navigator.serviceWorker.register("/sw.js").catch(function(){console.log("Something went wrong. ServiceWorker not registered")})}),registerServiceWorker();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImRiaGVscGVyLmpzIiwicmVzdGF1cmFudF9pbmZvLmpzIiwiZm9ybS5qcyIsInJlZ2lzdGVyU2VydmljZVdvcmtlci5qcyJdLCJuYW1lcyI6WyJEQkhlbHBlciIsIkRBVEFCQVNFX1VSTCIsIlJFU1RBVVJBTlRfVVJMIiwiUkVWSUVXU19VUkwiLCJbb2JqZWN0IE9iamVjdF0iLCJuYXZpZ2F0b3IiLCJzZXJ2aWNlV29ya2VyIiwiaWRiIiwib3BlbiIsInVwZ3JhZGVEYiIsImNyZWF0ZU9iamVjdFN0b3JlIiwia2V5UGF0aCIsImNyZWF0ZUluZGV4IiwiYXV0b0luY3JlbWVudCIsInVuaXF1ZSIsImNvbnNvbGUiLCJsb2ciLCJQcm9taXNlIiwicmVzb2x2ZSIsImNhbGxiYWNrIiwib3BlbkRhdGFiYXNlIiwidGhlbiIsImRiIiwidHJhbnNhY3Rpb24iLCJvYmplY3RTdG9yZSIsImdldEFsbCIsInJlc3RhdXJhbnRzIiwibGVuZ3RoIiwiZmV0Y2giLCJyZXNwb25zZSIsInN0YXR1cyIsImpzb24iLCJ0eCIsInN0b3JlUmVzdGF1cmFudHMiLCJmb3JFYWNoIiwicmVzdGF1cmFudCIsInB1dCIsImNvbXBsZXRlIiwiY2F0Y2giLCJlcnIiLCJpZCIsImZldGNoUmVzdGF1cmFudHMiLCJlcnJvciIsImZpbmQiLCJyIiwiY3Vpc2luZSIsInJlc3VsdHMiLCJmaWx0ZXIiLCJjdWlzaW5lX3R5cGUiLCJuZWlnaGJvcmhvb2QiLCJuZWlnaGJvcmhvb2RzIiwibWFwIiwidiIsImkiLCJ1bmlxdWVOZWlnaGJvcmhvb2RzIiwiaW5kZXhPZiIsImN1aXNpbmVzIiwidW5pcXVlQ3Vpc2luZXMiLCJpbmRleCIsInBhcnNlSW50IiwicmV2aWV3cyIsInN0b3JlUmV2aWV3cyIsInJldmlldyIsInJlc3RhdXJhbnRJZCIsInRvZ2dsZVZhbHVlIiwib3BlbkN1cnNvciIsInVwZGF0ZUZhdm9yaXRlIiwiY3Vyc29yIiwidmFsdWUiLCJ1cGRhdGVEYXRhIiwiaXNfZmF2b3JpdGUiLCJ1cGRhdGUiLCJvbnN1Y2Nlc3MiLCJjb250aW51ZSIsIm1ldGhvZCIsInBob3RvZ3JhcGgiLCJnb29nbGUiLCJtYXBzIiwiTWFya2VyIiwicG9zaXRpb24iLCJsYXRsbmciLCJ0aXRsZSIsIm5hbWUiLCJ1cmwiLCJ1cmxGb3JSZXN0YXVyYW50IiwiYW5pbWF0aW9uIiwiQW5pbWF0aW9uIiwiRFJPUCIsInBob3RvZ3JhcGhBbHRzIiwiMSIsIjIiLCIzIiwiNCIsIjUiLCI2IiwiNyIsIjgiLCI5IiwiMTAiLCJ3aW5kb3ciLCJpbml0TWFwIiwiZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCIsInNlbGYiLCJNYXAiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiem9vbSIsImNlbnRlciIsInNjcm9sbHdoZWVsIiwiZmlsbEJyZWFkY3J1bWIiLCJtYXBNYXJrZXJGb3JSZXN0YXVyYW50IiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2ZW50Iiwic3R5bGUiLCJkaXNwbGF5IiwiZ2V0UGFyYW1ldGVyQnlOYW1lIiwiZmV0Y2hSZXN0YXVyYW50QnlJZCIsImZpbGxSZXN0YXVyYW50SFRNTCIsImZhdlRvZ2dsZSIsInJlc3RJZCIsImVsZW1lbnQiLCJzZXRUb2dnbGUiLCJjbGFzc0xpc3QiLCJjb250YWlucyIsInRvZ2dsZSIsImlubmVySFRNTCIsImZhdm9yaXRlIiwiaXNGYXZvcml0ZSIsInJlbW92ZSIsImFkZCIsInNldEF0dHJpYnV0ZSIsImFkZHJlc3MiLCJpbWFnZSIsImNsYXNzTmFtZSIsInNyYyIsImltYWdlVXJsRm9yUmVzdGF1cmFudCIsInNyY3NldCIsImltYWdlUmVzcG9uc2l2ZVVybEZvclJlc3RhdXJhbnQiLCJhbHQiLCJvcGVyYXRpbmdfaG91cnMiLCJmaWxsUmVzdGF1cmFudEhvdXJzSFRNTCIsImZpbGxSZXZpZXdzSFRNTCIsIm9wZXJhdGluZ0hvdXJzIiwiaG91cnMiLCJrZXkiLCJyb3ciLCJjcmVhdGVFbGVtZW50IiwiZGF5IiwiYXBwZW5kQ2hpbGQiLCJ0aW1lIiwiZmV0Y2hSZXZpZXdzIiwiY29udGFpbmVyIiwidGFiSW5kZXgiLCJub1Jldmlld3MiLCJ1bCIsImNyZWF0ZVJldmlld0hUTUwiLCJvZmZsaW5lUmV2aWV3c0hUTUwiLCJlIiwicmVhZHkiLCJyZWdzdyIsInN5bmMiLCJyZWdpc3RlciIsImZldGNoT2ZmbGluZVJldmlld3MiLCJnZXRFbGVtZW50c0J5Q2xhc3NOYW1lIiwiY3JlYXRlT2ZmUmV2aWV3SFRNTCIsImxpIiwiZGF0ZSIsIm15X2RhdGUiLCJEYXRlIiwiY3JlYXRlZEF0IiwidG9EYXRlU3RyaW5nIiwicmF0aW5nIiwiYmFja2dyb3VuZENvbG9yIiwiY29tbWVudHMiLCJsYWJlbCIsImRpdiIsInRvTG9jYWxlRGF0ZVN0cmluZyIsIndlZWtkYXkiLCJ5ZWFyIiwibW9udGgiLCJicmVhZGNydW1iIiwiYnJlYWRjcnVtYkVsZW1lbnRzIiwicXVlcnlTZWxlY3RvckFsbCIsInJlbW92ZUF0dHJpYnV0ZSIsImNoaWxkRWxlbWVudENvdW50IiwibG9jYXRpb24iLCJocmVmIiwicmVwbGFjZSIsIlJlZ0V4cCIsImV4ZWMiLCJkZWNvZGVVUklDb21wb25lbnQiLCJmYXYiLCJrZXlDb2RlIiwidnVlIiwiVnVlIiwiZWwiLCJkYXRhIiwiZm9ybU9wZW4iLCJtZXRob2RzIiwicmVzZXRGb3JtIiwidGhpcyIsImNhbmNlbCIsImFkZFJldmlldyIsInJlc3RhdXJhbnRfaWQiLCJnZXRUaW1lIiwidXBkYXRlZEF0IiwiaW5zZXJ0QmVmb3JlIiwiY2hpbGROb2RlcyIsIm9uTGluZSIsImFsZXJ0IiwicG9zdFJldmlldyIsInJlbG9hZCIsInByZXZlbnREZWZhdWx0IiwicmVtb3ZlVGFiZm9jdXNGcm9tRm9ybSIsImNsaWNrIiwib25sb2FkIiwiZm9ybSIsInF1ZXJ5U2VsZWN0b3IiLCJmb3JtRGVzYyIsImRlc2MiLCJfdGhpcyIsInJlZ2lzdGVyU2VydmljZVdvcmtlciJdLCJtYXBwaW5ncyI6Ik1BR01BLFNBTUpDLDBCQUVFLE1BQVEsd0JBRVZDLDRCQUVBLE1BQVEsb0NBR1ZDLHlCQUVF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Q29tbW9uIGRhdGFiYXNlIGhlbHBlciBmdW5jdGlvbnMuXHJcbiAqL1xyXG5jbGFzcyBEQkhlbHBlciB7XHJcblxyXG4gIC8qKlxyXG4gICAqIERhdGFiYXNlIFVSTC5cclxuICAgKiBDaGFuZ2UgdGhpcyB0byByZXN0YXVyYW50cy5qc29uIGZpbGUgbG9jYXRpb24gb24geW91ciBzZXJ2ZXIuXHJcbiAgICovXHJcbiAgc3RhdGljIGdldCBEQVRBQkFTRV9VUkwoKSB7XHJcbiAgICBjb25zdCBwb3J0ID0gMTMzNztcclxuICAgIHJldHVybiBgaHR0cDovL2xvY2FsaG9zdDoke3BvcnR9YDtcclxuICB9XHJcbiAgc3RhdGljIGdldCBSRVNUQVVSQU5UX1VSTCgpIHtcclxuICBjb25zdCBwb3J0ID0gMTMzNztcclxuICByZXR1cm4gYGh0dHA6Ly9sb2NhbGhvc3Q6JHtwb3J0fS9yZXN0YXVyYW50c2A7XHJcbn1cclxuXHJcbnN0YXRpYyBnZXQgUkVWSUVXU19VUkwoKSB7XHJcbiAgY29uc3QgcG9ydCA9IDEzMzc7XHJcbiAgcmV0dXJuIGBodHRwOi8vbG9jYWxob3N0OiR7cG9ydH0vcmV2aWV3cy8/cmVzdGF1cmFudF9pZD1gO1xyXG59XHJcblxyXG4vLyBJREIgY3JlYXRpb25cclxuXHJcblxyXG5zdGF0aWMgb3BlbkRhdGFiYXNlICgpIHtcclxuXHJcbiAgLy8gSWYgdGhlIGJyb3dzZXIgZG9lc24ndCBzdXBwb3J0IHNlcnZpY2Ugd29ya2VyLFxyXG4gIC8vIHdlIGRvbid0IGNhcmUgYWJvdXQgaGF2aW5nIGEgZGF0YWJhc2VcclxuICBpZiAoIW5hdmlnYXRvci5zZXJ2aWNlV29ya2VyKSB7XHJcbiAgICBjb25zb2xlLmxvZyhgQnJvd3NlciBkb2Vzbid0IHN1cHBvcnQgU2VydmljZSBXb3JrZXJzYCk7XHJcbiAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XHJcbiAgfVxyXG5cclxuICByZXR1cm4gaWRiLm9wZW4oJ3Jlc3RhdXJhbnRzLWRiJywgMSwgZnVuY3Rpb24gKHVwZ3JhZGVEYikge1xyXG4gICAgdmFyIHN0b3JlUmVzdGF1cmFudHMgPSB1cGdyYWRlRGIuY3JlYXRlT2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnRzJywge1xyXG4gICAgICBrZXlQYXRoOiAnaWQnLFxyXG4gICAgfSk7XHJcbiAgICBzdG9yZVJlc3RhdXJhbnRzLmNyZWF0ZUluZGV4KCdyZXN0LWlkJywgJ2lkJyk7XHJcbiAgICB2YXIgc3RvcmVSZXZpZXdzID0gdXBncmFkZURiLmNyZWF0ZU9iamVjdFN0b3JlKCdyZXZpZXdzJywge1xyXG4gICAgICBrZXlQYXRoOiAnaWQnLFxyXG4gICAgICBhdXRvSW5jcmVtZW50OiB0cnVlLFxyXG4gICAgfSk7XHJcbiAgICBzdG9yZVJldmlld3MuY3JlYXRlSW5kZXgoJ3Jlc3RhdXJhbnRfaWQnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICdyZXN0YXVyYW50X2lkJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICB7IHVuaXF1ZTogZmFsc2UgfSk7XHJcbiAgICB2YXIgc3RvcmVTeW5jUmV2aWV3ID0gdXBncmFkZURiLmNyZWF0ZU9iamVjdFN0b3JlKCdzeW5jLXJldmlld3MnLCB7XHJcbiAgICAgIGtleVBhdGg6ICdpZCcsXHJcbiAgICAgIGF1dG9JbmNyZW1lbnQ6IHRydWUsXHJcbiAgICB9KTtcclxuICAgIHN0b3JlU3luY1Jldmlldy5jcmVhdGVJbmRleCgncmVzdGF1cmFudF9pZCcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3Jlc3RhdXJhbnRfaWQnLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIHsgdW5pcXVlOiBmYWxzZSB9KTtcclxuICB9KTtcclxufVxyXG5cclxuXHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIGFsbCByZXN0YXVyYW50cy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hSZXN0YXVyYW50cyhjYWxsYmFjaykge1xyXG5cclxuICAgIC8vIGdldCByZXN0YXVyYW50cyBmcm9tIGluZGV4ZWREQlxyXG4gICAgREJIZWxwZXIub3BlbkRhdGFiYXNlKCkudGhlbihmdW5jdGlvbiAoZGIpIHtcclxuICAgICAgaWYgKCFkYikge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfSAgZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIGRiLnRyYW5zYWN0aW9uKCdyZXN0YXVyYW50cycsICdyZWFkd3JpdGUnKVxyXG4gICAgICAgICAgICAgICAgIC5vYmplY3RTdG9yZSgncmVzdGF1cmFudHMnKVxyXG4gICAgICAgICAgICAgICAgIC5nZXRBbGwoKTtcclxuICAgICAgfVxyXG4gICAgfSkudGhlbihmdW5jdGlvbiAocmVzdGF1cmFudHMpIHtcclxuICAgICAgaWYgKHJlc3RhdXJhbnRzLmxlbmd0aCA9PT0gMCkgcmV0dXJuO1xyXG4gICAgICBjYWxsYmFjayhudWxsLCByZXN0YXVyYW50cyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBmZXRjaChEQkhlbHBlci5SRVNUQVVSQU5UX1VSTClcclxuICAgIC50aGVuKFxyXG4gICAgICBmdW5jdGlvbiAocmVzcG9uc2UpIHtcclxuICAgICAgICBpZiAocmVzcG9uc2Uuc3RhdHVzICE9PSAyMDApIHtcclxuICAgICAgICAgIGNvbnNvbGUubG9nKCdGZXRjaCBJc3N1ZSAtIFN0YXR1cyBDb2RlOiAnICsgcmVzcG9uc2Uuc3RhdHVzKTtcclxuICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHJlc3BvbnNlLmpzb24oKS50aGVuKGZ1bmN0aW9uIChyZXN0YXVyYW50cykge1xyXG5cclxuICAgICAgICAgIC8qIEFkZCByZXN0YXVyYW50cyB0byBpbmRleGVkREIgKi9cclxuICAgICAgICAgIERCSGVscGVyLm9wZW5EYXRhYmFzZSgpLnRoZW4oZnVuY3Rpb24gKGRiKSB7XHJcbiAgICAgICAgICAgIGlmICghZGIpIHtcclxuICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgbGV0IHR4ID0gZGIudHJhbnNhY3Rpb24oJ3Jlc3RhdXJhbnRzJywgJ3JlYWR3cml0ZScpO1xyXG4gICAgICAgICAgICAgIGxldCBzdG9yZVJlc3RhdXJhbnRzID0gdHgub2JqZWN0U3RvcmUoJ3Jlc3RhdXJhbnRzJyk7XHJcblxyXG4gICAgICAgICAgICAgIHJlc3RhdXJhbnRzLmZvckVhY2goZnVuY3Rpb24gKHJlc3RhdXJhbnQpIHtcclxuICAgICAgICAgICAgICAgIHN0b3JlUmVzdGF1cmFudHMucHV0KHJlc3RhdXJhbnQpO1xyXG4gICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICByZXR1cm4gdHguY29tcGxldGU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3RhdXJhbnRzKTtcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgKVxyXG4gICAgLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgY29uc29sZS5sb2coJ0ZldGNoIEVycm9yOiAnLCBlcnIpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCBhIHJlc3RhdXJhbnQgYnkgaXRzIElELlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeUlkKGlkLCBjYWxsYmFjaykge1xyXG4gICAgLy8gZmV0Y2ggYWxsIHJlc3RhdXJhbnRzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjb25zdCByZXN0YXVyYW50ID0gcmVzdGF1cmFudHMuZmluZChyID0+IHIuaWQgPT0gaWQpO1xyXG4gICAgICAgIGlmIChyZXN0YXVyYW50KSB7IC8vIEdvdCB0aGUgcmVzdGF1cmFudFxyXG4gICAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdGF1cmFudCk7XHJcbiAgICAgICAgfSBlbHNlIHsgLy8gUmVzdGF1cmFudCBkb2VzIG5vdCBleGlzdCBpbiB0aGUgZGF0YWJhc2VcclxuICAgICAgICAgIGNhbGxiYWNrKCdSZXN0YXVyYW50IGRvZXMgbm90IGV4aXN0JywgbnVsbCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgY3Vpc2luZSB0eXBlIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaFJlc3RhdXJhbnRCeUN1aXNpbmUoY3Vpc2luZSwgY2FsbGJhY2spIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50cyAgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmdcclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gRmlsdGVyIHJlc3RhdXJhbnRzIHRvIGhhdmUgb25seSBnaXZlbiBjdWlzaW5lIHR5cGVcclxuICAgICAgICBjb25zdCByZXN1bHRzID0gcmVzdGF1cmFudHMuZmlsdGVyKHIgPT4gci5jdWlzaW5lX3R5cGUgPT0gY3Vpc2luZSk7XHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgcmVzdWx0cyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggcmVzdGF1cmFudHMgYnkgYSBuZWlnaGJvcmhvb2Qgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5TmVpZ2hib3Job29kKG5laWdoYm9yaG9vZCwgY2FsbGJhY2spIHtcclxuICAgIC8vIEZldGNoIGFsbCByZXN0YXVyYW50c1xyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50cygoZXJyb3IsIHJlc3RhdXJhbnRzKSA9PiB7XHJcbiAgICAgIGlmIChlcnJvcikge1xyXG4gICAgICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICAvLyBGaWx0ZXIgcmVzdGF1cmFudHMgdG8gaGF2ZSBvbmx5IGdpdmVuIG5laWdoYm9yaG9vZFxyXG4gICAgICAgIGNvbnN0IHJlc3VsdHMgPSByZXN0YXVyYW50cy5maWx0ZXIociA9PiByLm5laWdoYm9yaG9vZCA9PSBuZWlnaGJvcmhvb2QpO1xyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3VsdHMpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEZldGNoIHJlc3RhdXJhbnRzIGJ5IGEgY3Vpc2luZSBhbmQgYSBuZWlnaGJvcmhvb2Qgd2l0aCBwcm9wZXIgZXJyb3IgaGFuZGxpbmcuXHJcbiAgICovXHJcbiAgc3RhdGljIGZldGNoUmVzdGF1cmFudEJ5Q3Vpc2luZUFuZE5laWdoYm9yaG9vZChjdWlzaW5lLCBuZWlnaGJvcmhvb2QsIGNhbGxiYWNrKSB7XHJcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgbGV0IHJlc3VsdHMgPSByZXN0YXVyYW50cztcclxuICAgICAgICBpZiAoY3Vpc2luZSAhPSAnYWxsJykgeyAvLyBmaWx0ZXIgYnkgY3Vpc2luZVxyXG4gICAgICAgICAgcmVzdWx0cyA9IHJlc3VsdHMuZmlsdGVyKHIgPT4gci5jdWlzaW5lX3R5cGUgPT0gY3Vpc2luZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAobmVpZ2hib3Job29kICE9ICdhbGwnKSB7IC8vIGZpbHRlciBieSBuZWlnaGJvcmhvb2RcclxuICAgICAgICAgIHJlc3VsdHMgPSByZXN1bHRzLmZpbHRlcihyID0+IHIubmVpZ2hib3Job29kID09IG5laWdoYm9yaG9vZCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHRzKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBGZXRjaCBhbGwgbmVpZ2hib3Job29kcyB3aXRoIHByb3BlciBlcnJvciBoYW5kbGluZy5cclxuICAgKi9cclxuICBzdGF0aWMgZmV0Y2hOZWlnaGJvcmhvb2RzKGNhbGxiYWNrKSB7XHJcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gR2V0IGFsbCBuZWlnaGJvcmhvb2RzIGZyb20gYWxsIHJlc3RhdXJhbnRzXHJcbiAgICAgICAgY29uc3QgbmVpZ2hib3Job29kcyA9IHJlc3RhdXJhbnRzLm1hcCgodiwgaSkgPT4gcmVzdGF1cmFudHNbaV0ubmVpZ2hib3Job29kKTtcclxuXHJcbiAgICAgICAgLy8gUmVtb3ZlIGR1cGxpY2F0ZXMgZnJvbSBuZWlnaGJvcmhvb2RzXHJcbiAgICAgICAgY29uc3QgdW5pcXVlTmVpZ2hib3Job29kcyA9IG5laWdoYm9yaG9vZHMuZmlsdGVyKCh2LCBpKSA9PiBuZWlnaGJvcmhvb2RzLmluZGV4T2YodikgPT0gaSk7XHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgdW5pcXVlTmVpZ2hib3Job29kcyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogRmV0Y2ggYWxsIGN1aXNpbmVzIHdpdGggcHJvcGVyIGVycm9yIGhhbmRsaW5nLlxyXG4gICAqL1xyXG4gIHN0YXRpYyBmZXRjaEN1aXNpbmVzKGNhbGxiYWNrKSB7XHJcbiAgICAvLyBGZXRjaCBhbGwgcmVzdGF1cmFudHNcclxuICAgIERCSGVscGVyLmZldGNoUmVzdGF1cmFudHMoKGVycm9yLCByZXN0YXVyYW50cykgPT4ge1xyXG4gICAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgICBjYWxsYmFjayhlcnJvciwgbnVsbCk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gR2V0IGFsbCBjdWlzaW5lcyBmcm9tIGFsbCByZXN0YXVyYW50c1xyXG4gICAgICAgIGNvbnN0IGN1aXNpbmVzID0gcmVzdGF1cmFudHMubWFwKCh2LCBpKSA9PiByZXN0YXVyYW50c1tpXS5jdWlzaW5lX3R5cGUpO1xyXG5cclxuICAgICAgICAvLyBSZW1vdmUgZHVwbGljYXRlcyBmcm9tIGN1aXNpbmVzXHJcbiAgICAgICAgY29uc3QgdW5pcXVlQ3Vpc2luZXMgPSBjdWlzaW5lcy5maWx0ZXIoKHYsIGkpID0+IGN1aXNpbmVzLmluZGV4T2YodikgPT0gaSk7XHJcbiAgICAgICAgY2FsbGJhY2sobnVsbCwgdW5pcXVlQ3Vpc2luZXMpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAgICogRmV0Y2ggYWxsIHJldmlld3MuXHJcbiAgICAgKi9cclxuICAgIHN0YXRpYyBmZXRjaFJldmlld3MoaWQsIGNhbGxiYWNrKSB7XHJcblxyXG4gICAgICAvLyBnZXQgcmV2aWV3cyBmcm9tIGluZGV4ZWREQlxyXG4gICAgICBEQkhlbHBlci5vcGVuRGF0YWJhc2UoKS50aGVuKGZ1bmN0aW9uIChkYikge1xyXG4gICAgICAgIGlmICghZGIpIHtcclxuICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9ICBlbHNlIHtcclxuICAgICAgICAgIGxldCBzdG9yZVJldmlld3MgPSBkYi50cmFuc2FjdGlvbigncmV2aWV3cycsICdyZWFkd3JpdGUnKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLm9iamVjdFN0b3JlKCdyZXZpZXdzJyk7XHJcbiAgICAgICAgICBsZXQgcmVzdEluZGV4ID0gc3RvcmVSZXZpZXdzLmluZGV4KCdyZXN0YXVyYW50X2lkJyk7XHJcbiAgICAgICAgICByZXR1cm4gcmVzdEluZGV4LmdldEFsbChwYXJzZUludChpZCkpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSkudGhlbihmdW5jdGlvbiAocmV2aWV3cykge1xyXG4gICAgICAgIGlmIChyZXZpZXdzLmxlbmd0aCA9PT0gMCkgcmV0dXJuO1xyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJldmlld3MpO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICAgIC8qIEZldGNoIHJldmlld3MgZnJvbSBuZXR3b3JrICovXHJcbiAgICAgIGZldGNoKGAke0RCSGVscGVyLlJFVklFV1NfVVJMfSR7aWR9YClcclxuICAgICAgICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHJlc3BvbnNlLmpzb24oKSlcclxuICAgICAgICAgICAgIC50aGVuKHJldmlld3MgPT4ge1xyXG5cclxuICAgICAgICAgICAgICAgIC8qIEFkZCByZXZpZXdzIHRvIGluZGV4ZWREQiAqL1xyXG4gICAgICAgICAgICAgICAgREJIZWxwZXIub3BlbkRhdGFiYXNlKCkudGhlbihmdW5jdGlvbiAoZGIpIHtcclxuICAgICAgICAgICAgICAgICAgaWYgKCFkYikge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgdHggPSBkYi50cmFuc2FjdGlvbigncmV2aWV3cycsICdyZWFkd3JpdGUnKTtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgc3RvcmVSZXZpZXdzID0gdHgub2JqZWN0U3RvcmUoJ3Jldmlld3MnKTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmV2aWV3cy5mb3JFYWNoKGZ1bmN0aW9uIChyZXZpZXcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgIHN0b3JlUmV2aWV3cy5wdXQocmV2aWV3KTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHR4LmNvbXBsZXRlO1xyXG4gICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgICAgICBjYWxsYmFjayhudWxsLCByZXZpZXdzKTtcclxuICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IGNhbGxiYWNrKGBSZXF1ZXN0IGZhaWxlZC4gUmV0dXJuZWQgJHtlcnJvcn1gLCBudWxsKSk7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIGZldGNoT2ZmbGluZVJldmlld3MoaWQsIGNhbGxiYWNrKSB7XHJcblxyXG4gICAgICAvLyBnZXQgcmV2aWV3cyBmcm9tIGluZGV4ZWREQlxyXG4gICAgICBEQkhlbHBlci5vcGVuRGF0YWJhc2UoKS50aGVuKGZ1bmN0aW9uIChkYikge1xyXG4gICAgICAgIGlmICghZGIpIHtcclxuICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9ICBlbHNlIHtcclxuICAgICAgICAgIGxldCBzdG9yZVJldmlld3MgPSBkYi50cmFuc2FjdGlvbignc3luYy1yZXZpZXdzJywgJ3JlYWRvbmx5JylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5vYmplY3RTdG9yZSgnc3luYy1yZXZpZXdzJyk7XHJcbiAgICAgICAgICBsZXQgcmVzdEluZGV4ID0gc3RvcmVSZXZpZXdzLmluZGV4KCdyZXN0YXVyYW50X2lkJyk7XHJcbiAgICAgICAgICByZXR1cm4gcmVzdEluZGV4LmdldEFsbChwYXJzZUludChpZCkpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSkudGhlbihmdW5jdGlvbiAocmV2aWV3cykge1xyXG4gICAgICAgIGlmIChyZXZpZXdzLmxlbmd0aCA9PT0gMCkgcmV0dXJuO1xyXG4gICAgICAgIGNhbGxiYWNrKG51bGwsIHJldmlld3MpO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIFBvc3QgcmV2aWV3cyB0byBEQlxyXG4gICAgICovXHJcbiAgICBzdGF0aWMgcG9zdFJldmlldyhyZXZpZXcpIHtcclxuICAgICAgcmV0dXJuIERCSGVscGVyLm9wZW5EYXRhYmFzZSgpLnRoZW4oZnVuY3Rpb24gKGRiKSB7XHJcbiAgICAgICAgaWYgKCFkYikge1xyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICBsZXQgdHggPSBkYi50cmFuc2FjdGlvbignc3luYy1yZXZpZXdzJywgJ3JlYWR3cml0ZScpO1xyXG4gICAgICAgICAgbGV0IHN0b3JlUmV2aWV3cyA9IHR4Lm9iamVjdFN0b3JlKCdzeW5jLXJldmlld3MnKTtcclxuXHJcbiAgICAgICAgICBzdG9yZVJldmlld3MucHV0KHJldmlldyk7XHJcbiAgICAgICAgICByZXR1cm4gdHguY29tcGxldGU7XHJcbiAgICAgICAgfVxyXG4gICAgICB9KS50aGVuKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XHJcbiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uIChlcnIpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xyXG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgc3RhdGljIHRvZ2dsZUZhdm9yaXRlKHJlc3RhdXJhbnRJZCwgdG9nZ2xlVmFsdWUpIHtcclxuICByZXR1cm4gREJIZWxwZXIub3BlbkRhdGFiYXNlKCkudGhlbihmdW5jdGlvbiAoZGIpIHtcclxuICAgIGlmICghZGIpIHtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgbGV0IHN0b3JlUmVzdGF1cmFudHMgPSBkYi50cmFuc2FjdGlvbigncmVzdGF1cmFudHMnLCAncmVhZHdyaXRlJylcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5vYmplY3RTdG9yZSgncmVzdGF1cmFudHMnKTtcclxuICAgICAgbGV0IHJlc3RhdXJhbnRJbmRleCA9IHN0b3JlUmVzdGF1cmFudHMuaW5kZXgoJ3Jlc3QtaWQnKTtcclxuICAgICAgcmV0dXJuIHJlc3RhdXJhbnRJbmRleC5vcGVuQ3Vyc29yKCk7XHJcbiAgICB9XHJcbiAgfSkudGhlbihmdW5jdGlvbiB1cGRhdGVGYXZvcml0ZShjdXJzb3IpIHtcclxuXHJcbiAgICByZXN0YXVyYW50SWQgPSArcmVzdGF1cmFudElkO1xyXG5cclxuICAgIGlmICghY3Vyc29yKSByZXR1cm47XHJcblxyXG4gICAgaWYgKGN1cnNvci52YWx1ZS5pZCA9PT0gcmVzdGF1cmFudElkKSB7XHJcbiAgICAgIHZhciB1cGRhdGVEYXRhID0gY3Vyc29yLnZhbHVlO1xyXG5cclxuICAgICAgdXBkYXRlRGF0YS5pc19mYXZvcml0ZSA9IHRvZ2dsZVZhbHVlO1xyXG4gICAgICB2YXIgcmVxdWVzdCA9IGN1cnNvci51cGRhdGUodXBkYXRlRGF0YSk7XHJcbiAgICAgIHJlcXVlc3Qub25zdWNjZXNzID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfTtcclxuICAgIH07XHJcblxyXG4gICAgcmV0dXJuIGN1cnNvci5jb250aW51ZSgpLnRoZW4odXBkYXRlRmF2b3JpdGUpO1xyXG5cclxuICB9KS50aGVuKGZ1bmN0aW9uICgpIHtcclxuXHJcbiAgICAgIGNvbnN0IHVybCA9IGBodHRwOi8vbG9jYWxob3N0OjEzMzcvcmVzdGF1cmFudHMvJHtyZXN0YXVyYW50SWR9Lz9pc19mYXZvcml0ZT0ke3RvZ2dsZVZhbHVlfWA7XHJcblxyXG4gICAgICBmZXRjaCh1cmwsIHtcclxuICAgICAgICBtZXRob2Q6ICdQVVQnLFxyXG4gICAgICB9KS50aGVuKChyZXNwb25zZSkgPT4gcmVzcG9uc2UuanNvbigpXHJcbiAgICAgICkuY2F0Y2goKGVycm9yKSA9PiB7XHJcbiAgICAgICAgY29uc29sZS5sb2coJ0Vycm9yIGZldGNoaW5nIGlzX2Zhdm9yaXRlOiAnICsgZXJyb3IpO1xyXG4gICAgICB9KTtcclxuXHJcbiAgICB9KS50aGVuKGZ1bmN0aW9uICgpIHtcclxuICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xyXG4gICAgfSk7XHJcbn1cclxuXHJcbiAgLyoqXHJcbiAgICogUmVzdGF1cmFudCBwYWdlIFVSTC5cclxuICAgKi9cclxuICBzdGF0aWMgdXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XHJcbiAgICByZXR1cm4gKGAuL3Jlc3RhdXJhbnQuaHRtbD9pZD0ke3Jlc3RhdXJhbnQuaWR9YCk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZXN0YXVyYW50IGltYWdlIFVSTC5cclxuICAgKi9cclxuICBzdGF0aWMgaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpIHtcclxuICAgIHJldHVybiAoYC9pbWcvJHtyZXN0YXVyYW50LnBob3RvZ3JhcGh9LndlYnBgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gKiBSZXN0YXVyYW50IHJlc3BvbnNpdmUgaW1hZ2VzIHNvdXJjZSBzZXQuXHJcbiAqL1xyXG5zdGF0aWMgaW1hZ2VSZXNwb25zaXZlVXJsRm9yUmVzdGF1cmFudChyZXN0YXVyYW50KSB7XHJcbiAgICBjb25zdCBzY2FsZTF4ID0gJzMyMCc7XHJcbiAgICBjb25zdCBzY2FsZTFfNXggPSAnNDgwJztcclxuICAgIGNvbnN0IHNjYWxlMnggPSAnNjQwJztcclxuICAgIGNvbnN0IHNjYWxlM3ggPSAnODAwJztcclxuXHJcbiAgICByZXR1cm4gKFxyXG4gICAgICAgIGAvaW1nX3Jlc3BvbnNpdmUvJHtyZXN0YXVyYW50LmlkfS0ke3NjYWxlMXh9LndlYnAgJHtzY2FsZTF4fXcsXHJcbiAgICAgICAgL2ltZ19yZXNwb25zaXZlLyR7cmVzdGF1cmFudC5pZH0tJHtzY2FsZTFfNXh9LndlYnAgJHtzY2FsZTFfNXh9dyxcclxuICAgICAgICAvaW1nX3Jlc3BvbnNpdmUvJHtyZXN0YXVyYW50LmlkfS0ke3NjYWxlMnh9LndlYnAgJHtzY2FsZTJ4fXcsXHJcbiAgICAgICAgL2ltZ19yZXNwb25zaXZlLyR7cmVzdGF1cmFudC5pZH0tJHtzY2FsZTN4fS53ZWJwICR7c2NhbGUzeH13YCk7XHJcbn1cclxuXHJcbiAgLyoqXHJcbiAgICogTWFwIG1hcmtlciBmb3IgYSByZXN0YXVyYW50LlxyXG4gICAqL1xyXG4gIHN0YXRpYyBtYXBNYXJrZXJGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQsIG1hcCkge1xyXG4gICAgY29uc3QgbWFya2VyID0gbmV3IGdvb2dsZS5tYXBzLk1hcmtlcih7XHJcbiAgICAgIHBvc2l0aW9uOiByZXN0YXVyYW50LmxhdGxuZyxcclxuICAgICAgdGl0bGU6IHJlc3RhdXJhbnQubmFtZSxcclxuICAgICAgdXJsOiBEQkhlbHBlci51cmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpLFxyXG4gICAgICBtYXA6IG1hcCxcclxuICAgICAgYW5pbWF0aW9uOiBnb29nbGUubWFwcy5BbmltYXRpb24uRFJPUCxcclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIG1hcmtlcjtcclxuICB9XHJcblxyXG59XHJcbiIsImxldCByZXN0YXVyYW50O1xyXG52YXIgbWFwO1xyXG5cclxuLypcclxuU2V0dGluZyBwaG90b2dyYXBocyBhbHRzKi9cclxuXHJcbmNvbnN0IHBob3RvZ3JhcGhBbHRzID0ge1xyXG5cdDE6IFwiU2VyZXZhbCBncm91cHMgb2YgcGVvcGxlIGhhdmluZyBxdWFsaXR5IHRpbWUgYXQgYSByZXN0YXVyYW50LlwiLFxyXG5cdDI6IFwiQSBsb3ZlbHkgbWFyZ2VyaXR0YSBwaXp6YVwiLFxyXG5cdDM6IFwiQW4gZW1wdHkgcmVzdGF1cmFudCBzZXR0aW5nIHdoaWNoIGhhcyBoZWF0ZXJzXCIsXHJcblx0NDogXCJBIGNvcm5lciBzaG90IG9mIHRoZSBvdXRzaWRlIG9mIHRoZSByZXN0YXVyYXQuXCIsXHJcblx0NTogXCJBIGNyb3dkZWQgcmVzdGF1cmFudCBhbmQgc3RhZmYgc2VydmluZyBmb29kIGZyb20gYmVoaW5kIHRoZSBiYXIuXCIsXHJcblx0NjogXCJSZXN0YXVyYW50IHdpdGggd29vZGVuIHRhYmxlcywgY2hhcmlzLCBhbmQgYSBVUyBmbGFnIGFzIGEgd2FsbCBkZWNvcmF0aW9uXCIsXHJcblx0NzogXCJhIGRvZyB3YXRjaGluZyBmcm9tIHRoZSBvdXRzaWRlIG9mIGEgY3Jvd2RlZCBidXJnZXIgc2hvcCwgYWNjb21wYW5pZWQgYnkgdHdvIG1lbi5cIixcclxuXHQ4OiBcIkNsb3NlIHVwIG9mIHRoZSBkdXRjaCByZXN0YXVyYW50IGxvZ28gYmVzaWRlIGEgZmxvd2VyaW5nIHRyZWVcIixcclxuXHQ5OiBcIkJsYWNrIGFuZCB3aGl0ZSBwaWN0dXJlIG9mIHBlb3BsZSBlYXRpbmcgYXQgYW4gYXNpYW4gcmVzdGF1cmF0LlwiLFxyXG5cdDEwOiBcIkVtcHR5IHJlc3RhdXJhbnQncyB3aGl0ZSBjaGFpcnMsIHdhbGxzIGFuZCBjZWlsaW5ncy5cIlxyXG59O1xyXG5cclxuXHJcblxyXG4vKipcclxuICogSW5pdGlhbGl6ZSBHb29nbGUgbWFwLCBjYWxsZWQgZnJvbSBIVE1MLlxyXG4gKi9cclxud2luZG93LmluaXRNYXAgPSAoKSA9PiB7XHJcbiAgZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCgoZXJyb3IsIHJlc3RhdXJhbnQpID0+IHtcclxuICAgIGlmIChlcnJvcikgeyAvLyBHb3QgYW4gZXJyb3IhXHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgc2VsZi5tYXAgPSBuZXcgZ29vZ2xlLm1hcHMuTWFwKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYXAnKSwge1xyXG4gICAgICAgIHpvb206IDE2LFxyXG4gICAgICAgIGNlbnRlcjogcmVzdGF1cmFudC5sYXRsbmcsXHJcbiAgICAgICAgc2Nyb2xsd2hlZWw6IGZhbHNlXHJcbiAgICAgIH0pO1xyXG4gICAgICBmaWxsQnJlYWRjcnVtYigpO1xyXG4gICAgICBEQkhlbHBlci5tYXBNYXJrZXJGb3JSZXN0YXVyYW50KHNlbGYucmVzdGF1cmFudCwgc2VsZi5tYXApO1xyXG4gICAgfVxyXG4gIH0pO1xyXG59O1xyXG5cclxuLyoqXHJcblNob3cgbWFwIGJ1dHRvblxyXG4qL1xyXG5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFwVG9nZ2xlJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbihldmVudCkge1xyXG4gIGlmICgoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcC1jb250YWluZXInKS5zdHlsZS5kaXNwbGF5KSA9PT0gJ2Jsb2NrJykge1xyXG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcC1jb250YWluZXInKS5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnO1xyXG4gICAgd2luZG93LmluaXRNYXAoKTtcclxuICB9IGVsc2Uge1xyXG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21hcC1jb250YWluZXInKS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJztcclxuICB9XHJcbn0pO1xyXG5cclxuXHJcbi8qKlxyXG4gKiBHZXQgY3VycmVudCByZXN0YXVyYW50IGZyb20gcGFnZSBVUkwuXHJcbiAqL1xyXG4gZmV0Y2hSZXN0YXVyYW50RnJvbVVSTCA9IChjYWxsYmFjaykgPT4ge1xyXG4gIGlmIChzZWxmLnJlc3RhdXJhbnQpIHsgLy8gcmVzdGF1cmFudCBhbHJlYWR5IGZldGNoZWQhXHJcbiAgICBjYWxsYmFjayhudWxsLCBzZWxmLnJlc3RhdXJhbnQpXHJcbiAgICByZXR1cm47XHJcbiAgfVxyXG4gIGNvbnN0IGlkID0gZ2V0UGFyYW1ldGVyQnlOYW1lKCdpZCcpO1xyXG4gIGlmICghaWQpIHsgLy8gbm8gaWQgZm91bmQgaW4gVVJMXHJcbiAgICBlcnJvciA9ICdObyByZXN0YXVyYW50IGlkIGluIFVSTCdcclxuICAgIGNhbGxiYWNrKGVycm9yLCBudWxsKTtcclxuICB9IGVsc2Uge1xyXG4gICAgREJIZWxwZXIuZmV0Y2hSZXN0YXVyYW50QnlJZChpZCwgKGVycm9yLCByZXN0YXVyYW50KSA9PiB7XHJcbiAgICAgIHNlbGYucmVzdGF1cmFudCA9IHJlc3RhdXJhbnQ7XHJcbiAgICAgIGlmICghcmVzdGF1cmFudCkge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG4gICAgICBmaWxsUmVzdGF1cmFudEhUTUwoKTtcclxuXHRcdC8vXHRuZXcgTGF6eUxvYWQoeyBlbGVtZW50c19zZWxlY3RvcjogXCIuanMtbGF6eVwifSk7XHJcbiAgICAgIGNhbGxiYWNrKG51bGwsIHJlc3RhdXJhbnQpXHJcbiAgICB9KTtcclxuICB9XHJcbn07XHJcblxyXG4vKipcclxuICogZmF2b3JpdGUgcmVzdGF1cmFudCBidXNpbmVzc1xyXG4gKi9cclxuIGZhdlRvZ2dsZSA9IChyZXN0SWQpID0+IHtcclxuICBjb25zdCBlbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2lzRmF2b3JpdGUnKTtcclxuICBjb25zdCBzZXRUb2dnbGUgPSBlbGVtZW50LmNsYXNzTGlzdC5jb250YWlucygnZmFyJyk7XHJcbiAgZWxlbWVudC5jbGFzc0xpc3QudG9nZ2xlKCdmYXInKTtcclxuICBlbGVtZW50LmNsYXNzTGlzdC50b2dnbGUoJ2ZhcycpO1xyXG4gIERCSGVscGVyLmZhdlRvZ2dsZShyZXN0SWQsIHNldFRvZ2dsZSk7XHJcbn07XHJcblxyXG4vKipcclxuICogQ3JlYXRlIHJlc3RhdXJhbnQgSFRNTCBhbmQgYWRkIGl0IHRvIHRoZSB3ZWJwYWdlXHJcbiAqL1xyXG4gZmlsbFJlc3RhdXJhbnRIVE1MID0gKHJlc3RhdXJhbnQgPSBzZWxmLnJlc3RhdXJhbnQpID0+IHtcclxuICBjb25zdCBuYW1lID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtbmFtZScpO1xyXG4gIG5hbWUuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5uYW1lO1xyXG5cdGNvbnN0IGZhdm9yaXRlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2lzRmF2b3JpdGUnKTtcclxuXHRjb25zdCBpc0Zhdm9yaXRlID0gcmVzdGF1cmFudC5pc19mYXZvcml0ZSA9PSAndHJ1ZScgPyAnZmFzJyA6ICdmYXInO1xyXG5cdGZhdm9yaXRlLmNsYXNzTGlzdC5yZW1vdmUoJ2ZhcicpO1xyXG5cdGZhdm9yaXRlLmNsYXNzTGlzdC5hZGQoYCR7aXNGYXZvcml0ZX1gKTtcclxuXHRpZiAocmVzdGF1cmFudC5pc19mYXZvcml0ZSA9PSAndHJ1ZScpIHtcclxuXHRmYXZvcml0ZS5zZXRBdHRyaWJ1dGUoJ2FyaWEtbGFiZWwnLCBgVW5tYXJrICR7cmVzdGF1cmFudC5uYW1lfSBhcyBmYXZvcml0ZWApO1xyXG5cdH0gZWxzZSB7XHJcblx0ZmF2b3JpdGUuc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgYE1hcmsgJHtyZXN0YXVyYW50Lm5hbWV9IGFzIGZhdm9yaXRlYCk7XHJcblx0fVxyXG5cclxuICBjb25zdCBhZGRyZXNzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3RhdXJhbnQtYWRkcmVzcycpO1xyXG4gIGFkZHJlc3MuaW5uZXJIVE1MID0gcmVzdGF1cmFudC5hZGRyZXNzO1xyXG5cclxuICBjb25zdCBpbWFnZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXN0YXVyYW50LWltZycpO1xyXG4gIGltYWdlLmNsYXNzTmFtZSA9ICdyZXN0YXVyYW50LWltZyc7XHJcbiAgaW1hZ2Uuc3JjID0gREJIZWxwZXIuaW1hZ2VVcmxGb3JSZXN0YXVyYW50KHJlc3RhdXJhbnQpO1xyXG5cdGltYWdlLnNyY3NldCA9IERCSGVscGVyLmltYWdlUmVzcG9uc2l2ZVVybEZvclJlc3RhdXJhbnQocmVzdGF1cmFudCk7XHJcbiAgaW1hZ2UuYWx0ID0gcGhvdG9ncmFwaEFsdHNbcmVzdGF1cmFudC5pZF07XHJcblxyXG4gIGNvbnN0IGN1aXNpbmUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1jdWlzaW5lJyk7XHJcbiAgY3Vpc2luZS5pbm5lckhUTUwgPSByZXN0YXVyYW50LmN1aXNpbmVfdHlwZTtcclxuXHJcbiAgLy8gZmlsbCBvcGVyYXRpbmcgaG91cnNcclxuICBpZiAocmVzdGF1cmFudC5vcGVyYXRpbmdfaG91cnMpIHtcclxuICAgIGZpbGxSZXN0YXVyYW50SG91cnNIVE1MKCk7XHJcbiAgfVxyXG4gIC8vIGZpbGwgcmV2aWV3c1xyXG4gIGZpbGxSZXZpZXdzSFRNTCgpO1xyXG59XHJcblxyXG5cclxuLyoqXHJcbiAqIENyZWF0ZSByZXN0YXVyYW50IG9wZXJhdGluZyBob3VycyBIVE1MIHRhYmxlIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2UuXHJcbiAqL1xyXG4gZmlsbFJlc3RhdXJhbnRIb3Vyc0hUTUwgPSAob3BlcmF0aW5nSG91cnMgPSBzZWxmLnJlc3RhdXJhbnQub3BlcmF0aW5nX2hvdXJzKSA9PiB7XHJcbiAgY29uc3QgaG91cnMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVzdGF1cmFudC1ob3VycycpO1xyXG5cdGhvdXJzLmlubmVySFRNTCA9ICcnO1xyXG4gIGZvciAobGV0IGtleSBpbiBvcGVyYXRpbmdIb3Vycykge1xyXG4gICAgY29uc3Qgcm93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTtcclxuXHJcbiAgICBjb25zdCBkYXkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xyXG4gICAgZGF5LmlubmVySFRNTCA9IGtleTtcclxuICAgIHJvdy5hcHBlbmRDaGlsZChkYXkpO1xyXG5cclxuICAgIGNvbnN0IHRpbWUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpO1xyXG4gICAgdGltZS5pbm5lckhUTUwgPSBvcGVyYXRpbmdIb3Vyc1trZXldO1xyXG4gICAgcm93LmFwcGVuZENoaWxkKHRpbWUpO1xyXG5cclxuICAgIGhvdXJzLmFwcGVuZENoaWxkKHJvdyk7XHJcbiAgfVxyXG59O1xyXG5cclxuLyoqXHJcbiAqIENyZWF0ZSBhbGwgcmV2aWV3cyBIVE1MIGFuZCBhZGQgdGhlbSB0byB0aGUgd2VicGFnZS5cclxuICovXHJcbiBmaWxsUmV2aWV3c0hUTUwgPSAocmVzdGF1cmFudElkID0gc2VsZi5yZXN0YXVyYW50LmlkKSA9PiB7XHJcbiAgREJIZWxwZXIuZmV0Y2hSZXZpZXdzKHJlc3RhdXJhbnRJZCwgKGVycm9yLCByZXZpZXdzKSA9PiB7XHJcbiAgICBpZihlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmxvZyhlcnJvcik7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmV2aWV3cy1jb250YWluZXInKTtcclxuICAgICAgY29udGFpbmVyLmlubmVySFRNTCA9ICc8dWwgaWQ9XCJyZXZpZXdzLWxpc3RcIj48L3VsPic7XHJcbiAgICAgIGNvbnN0IHRpdGxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaDInKTtcclxuICAgICAgdGl0bGUuaW5uZXJIVE1MID0gJ1Jldmlld3MnO1xyXG4gICAgICB0aXRsZS50YWJJbmRleCA9ICcwJztcclxuICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKHRpdGxlKTtcclxuXHJcbiAgICAgIGlmICghcmV2aWV3cykge1xyXG4gICAgICAgIGNvbnN0IG5vUmV2aWV3cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcclxuICAgICAgICBub1Jldmlld3MuaW5uZXJIVE1MID0gJ05vIHJldmlld3MgeWV0ISc7XHJcbiAgICAgICAgY29udGFpbmVyLmFwcGVuZENoaWxkKG5vUmV2aWV3cyk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICBjb25zdCB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXdzLWxpc3QnKTtcclxuICAgICAgcmV2aWV3cy5mb3JFYWNoKHJldmlldyA9PiB7XHJcbiAgICAgICAgdWwuYXBwZW5kQ2hpbGQoY3JlYXRlUmV2aWV3SFRNTChyZXZpZXcpKTtcclxuICAgICAgfSk7XHJcbiAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZCh1bCk7XHJcbiAgICAgIG9mZmxpbmVSZXZpZXdzSFRNTCgpO1xyXG4gICAgfVxyXG4gICAgfVxyXG4gIH0pO1xyXG59O1xyXG5cclxud2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ29ubGluZScsIGZ1bmN0aW9uIChlKSB7XHJcbiAgbmF2aWdhdG9yLnNlcnZpY2VXb3JrZXIucmVhZHkudGhlbihmdW5jdGlvbiAocmVnc3cpIHtcclxuICAgIHJlZ3N3LnN5bmMucmVnaXN0ZXIoJ3JlcVJldmlld1N5bmMnKTtcclxuICB9KTtcclxufSwgZmFsc2UpO1xyXG5cclxuLy9zdG9yaW5nIHJldmlld3MgcG9zdGVkIG9mZmxpbmVcclxuXHJcbiBvZmZsaW5lUmV2aWV3c0hUTUwgPSAocmVzdGF1cmFudElkID0gc2VsZi5yZXN0YXVyYW50LmlkKSA9PiB7XHJcbiAgREJIZWxwZXIuZmV0Y2hPZmZsaW5lUmV2aWV3cyhyZXN0YXVyYW50SWQsIChlcnJvciwgcmV2aWV3cykgPT4ge1xyXG5cclxuICAgIGlmIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmxvZyhlcnJvcik7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBjb25zdCB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXdzLWxpc3QnKTtcclxuICAgICAgY29uc3QgdG1wcyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlDbGFzc05hbWUoJ3RtcCcpO1xyXG4gICAgICBpZiAodG1wcy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICByZXZpZXdzLmZvckVhY2gocmV2aWV3ID0+IHtcclxuICAgICAgICAgIHVsLmFwcGVuZENoaWxkKGNyZWF0ZU9mZlJldmlld0hUTUwocmV2aWV3KSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9KTtcclxufTtcclxuXHJcblxyXG4vKipcclxuICogQ3JlYXRlIHJldmlldyBIVE1MIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2UuXHJcbiAqL1xyXG4gIGNyZWF0ZVJldmlld0hUTUwgPSAocmV2aWV3KSA9PiB7XHJcbiAgY29uc3QgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpO1xyXG4gIGxpLnRhYkluZGV4ID0gJzAnO1xyXG5cclxuICBjb25zdCBkYXRlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaDUnKTtcclxuICBjb25zdCBteV9kYXRlID0gbmV3IERhdGUocmV2aWV3LmNyZWF0ZWRBdCk7XHJcbiAgZGF0ZS5pbm5lckhUTUwgPSBteV9kYXRlLnRvRGF0ZVN0cmluZygpO1xyXG4gIGxpLmFwcGVuZENoaWxkKGRhdGUpO1xyXG5cclxuICBjb25zdCBuYW1lID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaDEnKTtcclxuICBuYW1lLmlubmVySFRNTCA9IHJldmlldy5uYW1lO1xyXG4gIGxpLmFwcGVuZENoaWxkKG5hbWUpO1xyXG5cclxuICBjb25zdCByYXRpbmcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpJyk7XHJcbiAgcmF0aW5nLmlubmVySFRNTCA9IGBSYXRpbmc6ICR7cmV2aWV3LnJhdGluZ31gO1xyXG5cdHJhdGluZy5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSByZXZpZXcucmF0aW5nID09PSA1ID8gJ2dyZWVuJyA6XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldmlldy5yYXRpbmcgPiAyID8gJ29yYW5nZScgOiAncmVkJztcclxuICBsaS5hcHBlbmRDaGlsZChyYXRpbmcpO1xyXG5cclxuICBjb25zdCBjb21tZW50cyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTtcclxuICBjb21tZW50cy5pbm5lckhUTUwgPSByZXZpZXcuY29tbWVudHM7XHJcbiAgbGkuYXBwZW5kQ2hpbGQoY29tbWVudHMpO1xyXG5cclxuICBjb25zdCBsYWJlbCA9IGAke3Jldmlldy5uYW1lfSBzYWlkICR7cmV2aWV3LmNvbW1lbnRzfSBhbmQgcmF0ZWQgdGhlIHJlc3RhdXJhbnQgJHtyZXZpZXcucmF0aW5nfSBvdXQgb2YgNWA7XHJcbiAgbGkuc2V0QXR0cmlidXRlKCdhcmlhLWxhYmVsJywgbGFiZWwpO1xyXG5cclxuICByZXR1cm4gbGk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBDcmVhdGUgVE1QIHJldmlldyBIVE1MIGFuZCBhZGQgaXQgdG8gdGhlIHdlYnBhZ2UuXHJcbiAqL1xyXG4gY3JlYXRlT2ZmUmV2aWV3SFRNTCA9IChyZXZpZXcpID0+IHtcclxuICBjb25zdCBsaSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2xpJyk7XHJcbiAgbGkuc2V0QXR0cmlidXRlKCdjbGFzcycsICd0bXAnKTtcclxuICBjb25zdCBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcclxuICBkaXYuc2V0QXR0cmlidXRlKCdjbGFzcycsICdyZXZpZXctaGVhZGVyJyk7XHJcbiAgbGkuYXBwZW5kQ2hpbGQoZGl2KTtcclxuXHJcbiAgY29uc3QgbmFtZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2gxJyk7XHJcbiAgbmFtZS5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgJ3Jldmlld05hbWUnKTtcclxuICBuYW1lLmlubmVySFRNTCA9IHJldmlldy5uYW1lO1xyXG4gIGRpdi5hcHBlbmRDaGlsZChuYW1lKTtcclxuXHJcbiAgY29uc3QgZGF0ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2g1Jyk7XHJcbiAgZGF0ZS5zZXRBdHRyaWJ1dGUoJ2NsYXNzJywgJ3Jldmlld0RhdGUnKTtcclxuICBjb25zdCBkYXRlT3B0aW9ucyA9IHsgd2Vla2RheTogJ3Nob3J0JywgeWVhcjogJ251bWVyaWMnLCBtb250aDogJ2xvbmcnLCBkYXk6ICdudW1lcmljJyB9O1xyXG4gIGRhdGUuaW5uZXJIVE1MID0gKG5ldyBEYXRlKHJldmlldy5jcmVhdGVkQXQpKS50b0xvY2FsZURhdGVTdHJpbmcoJ2VuLVVTJywgZGF0ZU9wdGlvbnMpO1xyXG4gIGRpdi5hcHBlbmRDaGlsZChkYXRlKTtcclxuXHJcbiAgY29uc3QgcmF0aW5nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaScpO1xyXG4gIHJhdGluZy5pbm5lckhUTUwgPSBgUmF0aW5nOiAke3Jldmlldy5yYXRpbmd9YDtcclxuICByYXRpbmcuc2V0QXR0cmlidXRlKCdjbGFzcycsICdyZXZpZXdSYXRpbmcnKTtcclxuICByYXRpbmcuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gcmV2aWV3LnJhdGluZyA9PT0gNSA/ICdncmVlbicgOlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXZpZXcucmF0aW5nID4gMiA/ICdvcmFuZ2UnIDogJ3JlZCc7XHJcbiAgbGkuYXBwZW5kQ2hpbGQocmF0aW5nKTtcclxuXHJcbiAgY29uc3QgY29tbWVudHMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwJyk7XHJcbiAgY29tbWVudHMuaW5uZXJIVE1MID0gcmV2aWV3LmNvbW1lbnRzO1xyXG4gIGNvbW1lbnRzLnNldEF0dHJpYnV0ZSgnY2xhc3MnLCAncmV2aWV3Q29tbWVudCcpO1xyXG4gIGxpLmFwcGVuZENoaWxkKGNvbW1lbnRzKTtcclxuXHJcbiAgcmV0dXJuIGxpO1xyXG59O1xyXG5cclxuLyoqXHJcbiAqIEFkZCByZXN0YXVyYW50IG5hbWUgdG8gdGhlIGJyZWFkY3J1bWIgbmF2aWdhdGlvbiBtZW51XHJcbiAqL1xyXG4gZmlsbEJyZWFkY3J1bWIgPSAocmVzdGF1cmFudD1zZWxmLnJlc3RhdXJhbnQpID0+IHtcclxuICBjb25zdCBicmVhZGNydW1iID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JyZWFkY3J1bWInKTtcclxuXHRjb25zdCBicmVhZGNydW1iRWxlbWVudHMgPSBicmVhZGNydW1iLnF1ZXJ5U2VsZWN0b3JBbGwoJ2xpJyk7XHJcblx0Zm9yIChlbGVtZW50IG9mIGJyZWFkY3J1bWJFbGVtZW50cykge1xyXG5cdGVsZW1lbnQucmVtb3ZlQXR0cmlidXRlKCdhcmlhLWN1cnJlbnQnKTtcclxufVxyXG5cdGNvbnN0IGxpID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnbGknKTtcclxuXHRsaS5zZXRBdHRyaWJ1dGUoJ2FyaWEtY3VycmVudCcsICdwYWdlJyk7XHJcblx0aWYgKGJyZWFkY3J1bWIuY2hpbGRFbGVtZW50Q291bnQgPT09IDIpIHJldHVybjtcclxuICBsaS5pbm5lckhUTUwgPSByZXN0YXVyYW50Lm5hbWU7XHJcbiAgYnJlYWRjcnVtYi5hcHBlbmRDaGlsZChsaSk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBHZXQgYSBwYXJhbWV0ZXIgYnkgbmFtZSBmcm9tIHBhZ2UgVVJMLlxyXG4gKi9cclxuIGdldFBhcmFtZXRlckJ5TmFtZSA9IChuYW1lLCB1cmwpID0+IHtcclxuICBpZiAoIXVybClcclxuICAgIHVybCA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmO1xyXG4gIG5hbWUgPSBuYW1lLnJlcGxhY2UoL1tcXFtcXF1dL2csICdcXFxcJCYnKTtcclxuICBjb25zdCByZWdleCA9IG5ldyBSZWdFeHAoYFs/Jl0ke25hbWV9KD0oW14mI10qKXwmfCN8JClgKSxcclxuICAgIHJlc3VsdHMgPSByZWdleC5leGVjKHVybCk7XHJcbiAgaWYgKCFyZXN1bHRzKVxyXG4gICAgcmV0dXJuIG51bGw7XHJcbiAgaWYgKCFyZXN1bHRzWzJdKVxyXG4gICAgcmV0dXJuICcnO1xyXG4gIHJldHVybiBkZWNvZGVVUklDb21wb25lbnQocmVzdWx0c1syXS5yZXBsYWNlKC9cXCsvZywgJyAnKSk7XHJcbn1cclxuXHJcbi8vZXZlbnRsaXN0ZW5lcnMgZm9yIGZhdm9yaXRlIHRvZ2dsZVxyXG5cclxuY29uc3QgZmF2ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2lzRmF2b3JpdGUnKTtcclxuZmF2LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xyXG4gIGZhdlRvZ2dsZShzZWxmLnJlc3RhdXJhbnQuaWQpO1xyXG59KTtcclxuZmF2LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCAoZSkgPT4ge1xyXG4gIGlmIChlLmtleUNvZGUgPT09IDEzKSB7IC8vID0gZW50ZXIga2V5XHJcbiAgICBmYXZUb2dnbGUoc2VsZi5yZXN0YXVyYW50LmlkKTtcclxuICB9XHJcbn0pO1xyXG5cclxuXHJcbmlmIChuYXZpZ2F0b3Iuc2VydmljZVdvcmtlcikge1xyXG4gIG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLnJlZ2lzdGVyKCdzdy5qcycpXHJcbiAgICAudGhlbigoKSA9PiBjb25zb2xlLmxvZygnUGFzc2VkIFRlc3QnKSlcclxufTtcclxuIiwiLypjcmVkaXQgb2YgdGhlIG9yaWdpbmFsIGNvZGUgZm9yIHRoaXMgZnJvbSBnb2VzIHRvXHJcbiogdXNlciAnZ3JlZ2gnIGZyb20gY29kZXBlblxyXG4qKGh0dHBzOi8vY29kZXBlbi5pby9ncmVnaC9wZW4vcmpibVhiKVxyXG4qIEkganVzdCB0d2Vha2VkIGl0IHRvIHN1aXQgdGhpcyBhcHBsaWNhdGlvbidzIG5lZWRzKi9cclxuXHJcbnZhciB2dWUgPSBuZXcgVnVlKHtcclxuICBlbDogJyNhcHAnLFxyXG4gIGRhdGE6IHtcclxuICAgIGZvcm1PcGVuOiBmYWxzZSxcclxuICAgIHJldmlldzoge1xyXG4gICAgICBuYW1lOiAnJyxcclxuICAgICAgcmF0aW5nOiAnJyxcclxuICAgICAgY29tbWVudHM6JydcclxuICAgIH1cclxuICB9LFxyXG4gIG1ldGhvZHM6IHtcclxuICAgIHJlc2V0Rm9ybTogZnVuY3Rpb24gKCkge1xyXG4gICAgICB0aGlzLnJldmlldyA9IHtcclxuICAgICAgICBuYW1lOiAnJyxcclxuICAgICAgICByYXRpbmc6ICcnLFxyXG4gICAgICAgIGNvbW1lbnRzOicnXHJcbiAgICAgIH1cclxuICAgIH0sXHJcbiAgICBjYW5jZWw6IGZ1bmN0aW9uKCkge1xyXG4gICAgICB0aGlzLmZvcm1PcGVuID0gZmFsc2U7XHJcbiAgICAgIHRoaXMucmVzZXRGb3JtKCk7XHJcbiAgICB9XHJcbiAgfVxyXG59KVxyXG5cclxuLyoqXHJcbiAqIEhhbmxkaW5nIGZvcm0gc3VibWl0aW9uXHJcbiAqL1xyXG4gYWRkUmV2aWV3ID0gKCkgPT4ge1xyXG4gICBjb25zdCByZXZpZXcgPSB7XHJcbiAgICByZXN0YXVyYW50X2lkOiBzZWxmLnJlc3RhdXJhbnQuaWQsXHJcbiAgICBuYW1lOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmFtZScpLnZhbHVlLFxyXG4gICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLmdldFRpbWUoKSxcclxuICAgIHVwZGF0ZWRBdDogbmV3IERhdGUoKS5nZXRUaW1lKCksXHJcbiAgICByYXRpbmc6ICtkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmF0aW5nJykudmFsdWUsXHJcbiAgICBjb21tZW50czogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NvbW1lbnRzJykudmFsdWUsXHJcbiAgfTtcclxuICBjb25zdCB1bCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXdzLWxpc3QnKTtcclxuICB1bC5pbnNlcnRCZWZvcmUoY3JlYXRlUmV2aWV3SFRNTChyZXZpZXcpLCB1bC5jaGlsZE5vZGVzWzBdKTtcclxuICBpZiAoIW5hdmlnYXRvci5vbkxpbmUpIHtcclxuICAgIGFsZXJ0KCdZb3UgYXJlIGN1cnJlbnRseSBvZmZsaW5lLiBZb3VyIHJldmlldyB3aWxsIGJlIHBvc3RlZCBvbmNlIHlvdSBhcmUgb25saW5lIGFnYWluLiBUaGFuayB5b3UgZm9yIHJldmlld2luZyEnKTtcclxuICB9XHJcbiAgREJIZWxwZXIucG9zdFJldmlldyhyZXZpZXcpLnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gIG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLnJlYWR5LnRoZW4oZnVuY3Rpb24gKHJlZ3N3KSB7XHJcbiAgICByZWdzdy5zeW5jLnJlZ2lzdGVyKCdyZXFSZXZpZXdTeW5jJyk7XHJcbiAgICBsb2NhdGlvbi5yZWxvYWQoKTtcclxuICB9KTtcclxufSkudGhlbihmdW5jdGlvbiAoKSB7XHJcbiAgZmlsbFJldmlld3NIVE1MKCk7XHJcbn0pLnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gIG9mZmxpbmVSZXZpZXdzSFRNTCgpO1xyXG59KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XHJcbiAgY29uc29sZS5lcnJvcihlcnIpO1xyXG59KTtcclxufTtcclxuXHJcbmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZXZpZXctZm9ybScpLmFkZEV2ZW50TGlzdGVuZXIoJ3N1Ym1pdCcsIGZ1bmN0aW9uIChldmVudCkge1xyXG4gIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgYWRkUmV2aWV3KCk7XHJcbiAgaWYgKGV2ZW50LmtleUNvZGUgPT09IDEzKSB7XHJcbiAgICByZW1vdmVUYWJmb2N1c0Zyb21Gb3JtKCk7XHJcbiAgfVxyXG59KTtcclxuXHJcblxyXG5kb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImFkZC1yZXZpZXdcIikuYWRkRXZlbnRMaXN0ZW5lcihcImtleXVwXCIsIGZ1bmN0aW9uKGV2ZW50KSB7XHJcbiAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcclxuICBpZiAoZXZlbnQua2V5Q29kZSA9PT0gMTMpIHtcclxuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwibmFtZVwiKS50YWJJbmRleCA9ICcwJztcclxuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwicmF0aW5nXCIpLnRhYkluZGV4ID0gJzAnO1xyXG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJjb21tZW50c1wiKS50YWJJbmRleCA9ICcwJztcclxuICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic3VibWl0XCIpLnRhYkluZGV4ID0gJzAnO1xyXG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJjYW5jZWxcIikudGFiSW5kZXggPSAnMCc7XHJcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImFkZC1yZXZpZXdcIikuY2xpY2soKTtcclxuICB9XHJcbn0pO1xyXG5cclxuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbmNlbCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgZnVuY3Rpb24oZXZlbnQpIHtcclxuICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gIGlmIChldmVudC5rZXlDb2RlID09PSAxMykge1xyXG4gICAgcmVtb3ZlVGFiZm9jdXNGcm9tRm9ybSgpO1xyXG4gIH1cclxufSk7XHJcblxyXG5cclxuICByZW1vdmVUYWJmb2N1c0Zyb21Gb3JtID0gKCkgPT4ge1xyXG4gICAgd2luZG93Lm9ubG9hZCA9ICgpID0+e1xyXG4gICAgICBjb25zdCBmb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2FkZC1yZXZpZXcnKTtcclxuICAgICAgZm9ybURlc2MgPSBmb3JtLnF1ZXJ5U2VsZWN0b3JBbGwoJyonKTtcclxuICAgICAgZm9ybURlc2MuZm9yRWFjaCggKGRlc2MpID0+e1xyXG4gICAgICAgIGRlc2Muc2V0QXR0cmlidXRlKFwidGFiaW5kZXhcIiwgXCItMVwiKTtcclxuICAgICAgfSwgdGhpcyk7XHJcbiAgICB9XHJcbiAgfVxyXG4iLCJcclxuLyoqXHJcbiAqIFJlZ2lzdGVyIGEgc2VydmljZVdvcmtlclxyXG4gKi9cclxucmVnaXN0ZXJTZXJ2aWNlV29ya2VyID0gKCkgPT4ge1xyXG4gICAgLy9jaGVjayBpZiBzZXJ2aWNlV29ya2VyIGlzIHN1cHBvcnRlZCwgb3RoZXJ3aXNlIHJldHVyblxyXG4gICAgaWYgKCFuYXZpZ2F0b3Iuc2VydmljZVdvcmtlcikgcmV0dXJuO1xyXG5cclxuICAgIG5hdmlnYXRvci5zZXJ2aWNlV29ya2VyLnJlZ2lzdGVyKCcvc3cuanMnKS5jYXRjaChmdW5jdGlvbigpe1xyXG4gICAgICBjb25zb2xlLmxvZyhcIlNvbWV0aGluZyB3ZW50IHdyb25nLiBTZXJ2aWNlV29ya2VyIG5vdCByZWdpc3RlcmVkXCIpO1xyXG4gICAgfSk7XHJcbiAgfTtcclxuXHJcbiAgcmVnaXN0ZXJTZXJ2aWNlV29ya2VyKCk7XHJcbiJdfQ==
